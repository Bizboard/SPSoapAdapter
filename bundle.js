/* */ 
"format global";
"exports $traceurRuntime";
(function(global) {
  'use strict';
  if (global.$traceurRuntime) {
    return ;
  }
  var $Object = Object;
  var $TypeError = TypeError;
  var $create = $Object.create;
  var $defineProperties = $Object.defineProperties;
  var $defineProperty = $Object.defineProperty;
  var $freeze = $Object.freeze;
  var $getOwnPropertyDescriptor = $Object.getOwnPropertyDescriptor;
  var $getOwnPropertyNames = $Object.getOwnPropertyNames;
  var $keys = $Object.keys;
  var $hasOwnProperty = $Object.prototype.hasOwnProperty;
  var $toString = $Object.prototype.toString;
  var $preventExtensions = Object.preventExtensions;
  var $seal = Object.seal;
  var $isExtensible = Object.isExtensible;
  var $apply = Function.prototype.call.bind(Function.prototype.apply);
  function $bind(operand, thisArg, args) {
    var argArray = [thisArg];
    for (var i = 0; i < args.length; i++) {
      argArray[i + 1] = args[i];
    }
    var func = $apply(Function.prototype.bind, operand, argArray);
    return func;
  }
  function $construct(func, argArray) {
    var object = new ($bind(func, null, argArray));
    return object;
  }
  var counter = 0;
  function newUniqueString() {
    return '__$' + Math.floor(Math.random() * 1e9) + '$' + ++counter + '$__';
  }
  var privateNames = $create(null);
  function isPrivateName(s) {
    return privateNames[s];
  }
  function createPrivateName() {
    var s = newUniqueString();
    privateNames[s] = true;
    return s;
  }
  var CONTINUATION_TYPE = Object.create(null);
  function createContinuation(operand, thisArg, argsArray) {
    return [CONTINUATION_TYPE, operand, thisArg, argsArray];
  }
  function isContinuation(object) {
    return object && object[0] === CONTINUATION_TYPE;
  }
  var isTailRecursiveName = null;
  function setupProperTailCalls() {
    isTailRecursiveName = createPrivateName();
    Function.prototype.call = initTailRecursiveFunction(function call(thisArg) {
      var result = tailCall(function(thisArg) {
        var argArray = [];
        for (var i = 1; i < arguments.length; ++i) {
          argArray[i - 1] = arguments[i];
        }
        var continuation = createContinuation(this, thisArg, argArray);
        return continuation;
      }, this, arguments);
      return result;
    });
    Function.prototype.apply = initTailRecursiveFunction(function apply(thisArg, argArray) {
      var result = tailCall(function(thisArg, argArray) {
        var continuation = createContinuation(this, thisArg, argArray);
        return continuation;
      }, this, arguments);
      return result;
    });
  }
  function initTailRecursiveFunction(func) {
    if (isTailRecursiveName === null) {
      setupProperTailCalls();
    }
    func[isTailRecursiveName] = true;
    return func;
  }
  function isTailRecursive(func) {
    return !!func[isTailRecursiveName];
  }
  function tailCall(func, thisArg, argArray) {
    var continuation = argArray[0];
    if (isContinuation(continuation)) {
      continuation = $apply(func, thisArg, continuation[3]);
      return continuation;
    }
    continuation = createContinuation(func, thisArg, argArray);
    while (true) {
      if (isTailRecursive(func)) {
        continuation = $apply(func, continuation[2], [continuation]);
      } else {
        continuation = $apply(func, continuation[2], continuation[3]);
      }
      if (!isContinuation(continuation)) {
        return continuation;
      }
      func = continuation[1];
    }
  }
  function construct() {
    var object;
    if (isTailRecursive(this)) {
      object = $construct(this, [createContinuation(null, null, arguments)]);
    } else {
      object = $construct(this, arguments);
    }
    return object;
  }
  var $traceurRuntime = {
    initTailRecursiveFunction: initTailRecursiveFunction,
    call: tailCall,
    continuation: createContinuation,
    construct: construct
  };
  (function() {
    function nonEnum(value) {
      return {
        configurable: true,
        enumerable: false,
        value: value,
        writable: true
      };
    }
    var method = nonEnum;
    var symbolInternalProperty = newUniqueString();
    var symbolDescriptionProperty = newUniqueString();
    var symbolDataProperty = newUniqueString();
    var symbolValues = $create(null);
    function isShimSymbol(symbol) {
      return typeof symbol === 'object' && symbol instanceof SymbolValue;
    }
    function typeOf(v) {
      if (isShimSymbol(v))
        return 'symbol';
      return typeof v;
    }
    function Symbol(description) {
      var value = new SymbolValue(description);
      if (!(this instanceof Symbol))
        return value;
      throw new TypeError('Symbol cannot be new\'ed');
    }
    $defineProperty(Symbol.prototype, 'constructor', nonEnum(Symbol));
    $defineProperty(Symbol.prototype, 'toString', method(function() {
      var symbolValue = this[symbolDataProperty];
      return symbolValue[symbolInternalProperty];
    }));
    $defineProperty(Symbol.prototype, 'valueOf', method(function() {
      var symbolValue = this[symbolDataProperty];
      if (!symbolValue)
        throw TypeError('Conversion from symbol to string');
      if (!getOption('symbols'))
        return symbolValue[symbolInternalProperty];
      return symbolValue;
    }));
    function SymbolValue(description) {
      var key = newUniqueString();
      $defineProperty(this, symbolDataProperty, {value: this});
      $defineProperty(this, symbolInternalProperty, {value: key});
      $defineProperty(this, symbolDescriptionProperty, {value: description});
      freeze(this);
      symbolValues[key] = this;
    }
    $defineProperty(SymbolValue.prototype, 'constructor', nonEnum(Symbol));
    $defineProperty(SymbolValue.prototype, 'toString', {
      value: Symbol.prototype.toString,
      enumerable: false
    });
    $defineProperty(SymbolValue.prototype, 'valueOf', {
      value: Symbol.prototype.valueOf,
      enumerable: false
    });
    var hashProperty = createPrivateName();
    var hashPropertyDescriptor = {value: undefined};
    var hashObjectProperties = {
      hash: {value: undefined},
      self: {value: undefined}
    };
    var hashCounter = 0;
    function getOwnHashObject(object) {
      var hashObject = object[hashProperty];
      if (hashObject && hashObject.self === object)
        return hashObject;
      if ($isExtensible(object)) {
        hashObjectProperties.hash.value = hashCounter++;
        hashObjectProperties.self.value = object;
        hashPropertyDescriptor.value = $create(null, hashObjectProperties);
        $defineProperty(object, hashProperty, hashPropertyDescriptor);
        return hashPropertyDescriptor.value;
      }
      return undefined;
    }
    function freeze(object) {
      getOwnHashObject(object);
      return $freeze.apply(this, arguments);
    }
    function preventExtensions(object) {
      getOwnHashObject(object);
      return $preventExtensions.apply(this, arguments);
    }
    function seal(object) {
      getOwnHashObject(object);
      return $seal.apply(this, arguments);
    }
    freeze(SymbolValue.prototype);
    function isSymbolString(s) {
      return symbolValues[s] || privateNames[s];
    }
    function toProperty(name) {
      if (isShimSymbol(name))
        return name[symbolInternalProperty];
      return name;
    }
    function removeSymbolKeys(array) {
      var rv = [];
      for (var i = 0; i < array.length; i++) {
        if (!isSymbolString(array[i])) {
          rv.push(array[i]);
        }
      }
      return rv;
    }
    function getOwnPropertyNames(object) {
      return removeSymbolKeys($getOwnPropertyNames(object));
    }
    function keys(object) {
      return removeSymbolKeys($keys(object));
    }
    function getOwnPropertySymbols(object) {
      var rv = [];
      var names = $getOwnPropertyNames(object);
      for (var i = 0; i < names.length; i++) {
        var symbol = symbolValues[names[i]];
        if (symbol) {
          rv.push(symbol);
        }
      }
      return rv;
    }
    function getOwnPropertyDescriptor(object, name) {
      return $getOwnPropertyDescriptor(object, toProperty(name));
    }
    function hasOwnProperty(name) {
      return $hasOwnProperty.call(this, toProperty(name));
    }
    function getOption(name) {
      return global.$traceurRuntime.options[name];
    }
    function defineProperty(object, name, descriptor) {
      if (isShimSymbol(name)) {
        name = name[symbolInternalProperty];
      }
      $defineProperty(object, name, descriptor);
      return object;
    }
    function polyfillObject(Object) {
      $defineProperty(Object, 'defineProperty', {value: defineProperty});
      $defineProperty(Object, 'getOwnPropertyNames', {value: getOwnPropertyNames});
      $defineProperty(Object, 'getOwnPropertyDescriptor', {value: getOwnPropertyDescriptor});
      $defineProperty(Object.prototype, 'hasOwnProperty', {value: hasOwnProperty});
      $defineProperty(Object, 'freeze', {value: freeze});
      $defineProperty(Object, 'preventExtensions', {value: preventExtensions});
      $defineProperty(Object, 'seal', {value: seal});
      $defineProperty(Object, 'keys', {value: keys});
    }
    function exportStar(object) {
      for (var i = 1; i < arguments.length; i++) {
        var names = $getOwnPropertyNames(arguments[i]);
        for (var j = 0; j < names.length; j++) {
          var name = names[j];
          if (name === '__esModule' || isSymbolString(name))
            continue;
          (function(mod, name) {
            $defineProperty(object, name, {
              get: function() {
                return mod[name];
              },
              enumerable: true
            });
          })(arguments[i], names[j]);
        }
      }
      return object;
    }
    function isObject(x) {
      return x != null && (typeof x === 'object' || typeof x === 'function');
    }
    function toObject(x) {
      if (x == null)
        throw $TypeError();
      return $Object(x);
    }
    function checkObjectCoercible(argument) {
      if (argument == null) {
        throw new TypeError('Value cannot be converted to an Object');
      }
      return argument;
    }
    function polyfillSymbol(global, Symbol) {
      if (!global.Symbol) {
        global.Symbol = Symbol;
        Object.getOwnPropertySymbols = getOwnPropertySymbols;
      }
      if (!global.Symbol.iterator) {
        global.Symbol.iterator = Symbol('Symbol.iterator');
      }
      if (!global.Symbol.observer) {
        global.Symbol.observer = Symbol('Symbol.observer');
      }
    }
    function setupGlobals(global) {
      polyfillSymbol(global, Symbol);
      global.Reflect = global.Reflect || {};
      global.Reflect.global = global.Reflect.global || global;
      polyfillObject(global.Object);
    }
    setupGlobals(global);
    global.$traceurRuntime = {
      call: tailCall,
      checkObjectCoercible: checkObjectCoercible,
      construct: construct,
      continuation: createContinuation,
      createPrivateName: createPrivateName,
      defineProperties: $defineProperties,
      defineProperty: $defineProperty,
      exportStar: exportStar,
      getOwnHashObject: getOwnHashObject,
      getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
      getOwnPropertyNames: $getOwnPropertyNames,
      initTailRecursiveFunction: initTailRecursiveFunction,
      isObject: isObject,
      isPrivateName: isPrivateName,
      isSymbolString: isSymbolString,
      keys: $keys,
      options: {},
      setupGlobals: setupGlobals,
      toObject: toObject,
      toProperty: toProperty,
      typeof: typeOf
    };
  })();
})(typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : this);
(function() {
  function buildFromEncodedParts(opt_scheme, opt_userInfo, opt_domain, opt_port, opt_path, opt_queryData, opt_fragment) {
    var out = [];
    if (opt_scheme) {
      out.push(opt_scheme, ':');
    }
    if (opt_domain) {
      out.push('//');
      if (opt_userInfo) {
        out.push(opt_userInfo, '@');
      }
      out.push(opt_domain);
      if (opt_port) {
        out.push(':', opt_port);
      }
    }
    if (opt_path) {
      out.push(opt_path);
    }
    if (opt_queryData) {
      out.push('?', opt_queryData);
    }
    if (opt_fragment) {
      out.push('#', opt_fragment);
    }
    return out.join('');
  }
  ;
  var splitRe = new RegExp('^' + '(?:' + '([^:/?#.]+)' + ':)?' + '(?://' + '(?:([^/?#]*)@)?' + '([\\w\\d\\-\\u0100-\\uffff.%]*)' + '(?::([0-9]+))?' + ')?' + '([^?#]+)?' + '(?:\\?([^#]*))?' + '(?:#(.*))?' + '$');
  var ComponentIndex = {
    SCHEME: 1,
    USER_INFO: 2,
    DOMAIN: 3,
    PORT: 4,
    PATH: 5,
    QUERY_DATA: 6,
    FRAGMENT: 7
  };
  function split(uri) {
    return (uri.match(splitRe));
  }
  function removeDotSegments(path) {
    if (path === '/')
      return '/';
    var leadingSlash = path[0] === '/' ? '/' : '';
    var trailingSlash = path.slice(-1) === '/' ? '/' : '';
    var segments = path.split('/');
    var out = [];
    var up = 0;
    for (var pos = 0; pos < segments.length; pos++) {
      var segment = segments[pos];
      switch (segment) {
        case '':
        case '.':
          break;
        case '..':
          if (out.length)
            out.pop();
          else
            up++;
          break;
        default:
          out.push(segment);
      }
    }
    if (!leadingSlash) {
      while (up-- > 0) {
        out.unshift('..');
      }
      if (out.length === 0)
        out.push('.');
    }
    return leadingSlash + out.join('/') + trailingSlash;
  }
  function joinAndCanonicalizePath(parts) {
    var path = parts[ComponentIndex.PATH] || '';
    path = removeDotSegments(path);
    parts[ComponentIndex.PATH] = path;
    return buildFromEncodedParts(parts[ComponentIndex.SCHEME], parts[ComponentIndex.USER_INFO], parts[ComponentIndex.DOMAIN], parts[ComponentIndex.PORT], parts[ComponentIndex.PATH], parts[ComponentIndex.QUERY_DATA], parts[ComponentIndex.FRAGMENT]);
  }
  function canonicalizeUrl(url) {
    var parts = split(url);
    return joinAndCanonicalizePath(parts);
  }
  function resolveUrl(base, url) {
    var parts = split(url);
    var baseParts = split(base);
    if (parts[ComponentIndex.SCHEME]) {
      return joinAndCanonicalizePath(parts);
    } else {
      parts[ComponentIndex.SCHEME] = baseParts[ComponentIndex.SCHEME];
    }
    for (var i = ComponentIndex.SCHEME; i <= ComponentIndex.PORT; i++) {
      if (!parts[i]) {
        parts[i] = baseParts[i];
      }
    }
    if (parts[ComponentIndex.PATH][0] == '/') {
      return joinAndCanonicalizePath(parts);
    }
    var path = baseParts[ComponentIndex.PATH];
    var index = path.lastIndexOf('/');
    path = path.slice(0, index + 1) + parts[ComponentIndex.PATH];
    parts[ComponentIndex.PATH] = path;
    return joinAndCanonicalizePath(parts);
  }
  function isAbsolute(name) {
    if (!name)
      return false;
    if (name[0] === '/')
      return true;
    var parts = split(name);
    if (parts[ComponentIndex.SCHEME])
      return true;
    return false;
  }
  $traceurRuntime.canonicalizeUrl = canonicalizeUrl;
  $traceurRuntime.isAbsolute = isAbsolute;
  $traceurRuntime.removeDotSegments = removeDotSegments;
  $traceurRuntime.resolveUrl = resolveUrl;
})();
(function(global) {
  'use strict';
  var $__1 = $traceurRuntime,
      canonicalizeUrl = $__1.canonicalizeUrl,
      resolveUrl = $__1.resolveUrl,
      isAbsolute = $__1.isAbsolute;
  var moduleInstantiators = Object.create(null);
  var baseURL;
  if (global.location && global.location.href)
    baseURL = resolveUrl(global.location.href, './');
  else
    baseURL = '';
  function UncoatedModuleEntry(url, uncoatedModule) {
    this.url = url;
    this.value_ = uncoatedModule;
  }
  function ModuleEvaluationError(erroneousModuleName, cause) {
    this.message = this.constructor.name + ': ' + this.stripCause(cause) + ' in ' + erroneousModuleName;
    if (!(cause instanceof ModuleEvaluationError) && cause.stack)
      this.stack = this.stripStack(cause.stack);
    else
      this.stack = '';
  }
  ModuleEvaluationError.prototype = Object.create(Error.prototype);
  ModuleEvaluationError.prototype.constructor = ModuleEvaluationError;
  ModuleEvaluationError.prototype.stripError = function(message) {
    return message.replace(/.*Error:/, this.constructor.name + ':');
  };
  ModuleEvaluationError.prototype.stripCause = function(cause) {
    if (!cause)
      return '';
    if (!cause.message)
      return cause + '';
    return this.stripError(cause.message);
  };
  ModuleEvaluationError.prototype.loadedBy = function(moduleName) {
    this.stack += '\n loaded by ' + moduleName;
  };
  ModuleEvaluationError.prototype.stripStack = function(causeStack) {
    var stack = [];
    causeStack.split('\n').some((function(frame) {
      if (/UncoatedModuleInstantiator/.test(frame))
        return true;
      stack.push(frame);
    }));
    stack[0] = this.stripError(stack[0]);
    return stack.join('\n');
  };
  function beforeLines(lines, number) {
    var result = [];
    var first = number - 3;
    if (first < 0)
      first = 0;
    for (var i = first; i < number; i++) {
      result.push(lines[i]);
    }
    return result;
  }
  function afterLines(lines, number) {
    var last = number + 1;
    if (last > lines.length - 1)
      last = lines.length - 1;
    var result = [];
    for (var i = number; i <= last; i++) {
      result.push(lines[i]);
    }
    return result;
  }
  function columnSpacing(columns) {
    var result = '';
    for (var i = 0; i < columns - 1; i++) {
      result += '-';
    }
    return result;
  }
  function UncoatedModuleInstantiator(url, func) {
    UncoatedModuleEntry.call(this, url, null);
    this.func = func;
  }
  UncoatedModuleInstantiator.prototype = Object.create(UncoatedModuleEntry.prototype);
  UncoatedModuleInstantiator.prototype.getUncoatedModule = function() {
    var $__0 = this;
    if (this.value_)
      return this.value_;
    try {
      var relativeRequire;
      if (typeof $traceurRuntime !== undefined && $traceurRuntime.require) {
        relativeRequire = $traceurRuntime.require.bind(null, this.url);
      }
      return this.value_ = this.func.call(global, relativeRequire);
    } catch (ex) {
      if (ex instanceof ModuleEvaluationError) {
        ex.loadedBy(this.url);
        throw ex;
      }
      if (ex.stack) {
        var lines = this.func.toString().split('\n');
        var evaled = [];
        ex.stack.split('\n').some((function(frame, index) {
          if (frame.indexOf('UncoatedModuleInstantiator.getUncoatedModule') > 0)
            return true;
          var m = /(at\s[^\s]*\s).*>:(\d*):(\d*)\)/.exec(frame);
          if (m) {
            var line = parseInt(m[2], 10);
            evaled = evaled.concat(beforeLines(lines, line));
            if (index === 1) {
              evaled.push(columnSpacing(m[3]) + '^ ' + $__0.url);
            } else {
              evaled.push(columnSpacing(m[3]) + '^');
            }
            evaled = evaled.concat(afterLines(lines, line));
            evaled.push('= = = = = = = = =');
          } else {
            evaled.push(frame);
          }
        }));
        ex.stack = evaled.join('\n');
      }
      throw new ModuleEvaluationError(this.url, ex);
    }
  };
  function getUncoatedModuleInstantiator(name) {
    if (!name)
      return ;
    var url = ModuleStore.normalize(name);
    return moduleInstantiators[url];
  }
  ;
  var moduleInstances = Object.create(null);
  var liveModuleSentinel = {};
  function Module(uncoatedModule) {
    var isLive = arguments[1];
    var coatedModule = Object.create(null);
    Object.getOwnPropertyNames(uncoatedModule).forEach((function(name) {
      var getter,
          value;
      if (isLive === liveModuleSentinel) {
        var descr = Object.getOwnPropertyDescriptor(uncoatedModule, name);
        if (descr.get)
          getter = descr.get;
      }
      if (!getter) {
        value = uncoatedModule[name];
        getter = function() {
          return value;
        };
      }
      Object.defineProperty(coatedModule, name, {
        get: getter,
        enumerable: true
      });
    }));
    Object.preventExtensions(coatedModule);
    return coatedModule;
  }
  var ModuleStore = {
    normalize: function(name, refererName, refererAddress) {
      if (typeof name !== 'string')
        throw new TypeError('module name must be a string, not ' + typeof name);
      if (isAbsolute(name))
        return canonicalizeUrl(name);
      if (/[^\.]\/\.\.\//.test(name)) {
        throw new Error('module name embeds /../: ' + name);
      }
      if (name[0] === '.' && refererName)
        return resolveUrl(refererName, name);
      return canonicalizeUrl(name);
    },
    get: function(normalizedName) {
      var m = getUncoatedModuleInstantiator(normalizedName);
      if (!m)
        return undefined;
      var moduleInstance = moduleInstances[m.url];
      if (moduleInstance)
        return moduleInstance;
      moduleInstance = Module(m.getUncoatedModule(), liveModuleSentinel);
      return moduleInstances[m.url] = moduleInstance;
    },
    set: function(normalizedName, module) {
      normalizedName = String(normalizedName);
      moduleInstantiators[normalizedName] = new UncoatedModuleInstantiator(normalizedName, (function() {
        return module;
      }));
      moduleInstances[normalizedName] = module;
    },
    get baseURL() {
      return baseURL;
    },
    set baseURL(v) {
      baseURL = String(v);
    },
    registerModule: function(name, deps, func) {
      var normalizedName = ModuleStore.normalize(name);
      if (moduleInstantiators[normalizedName])
        throw new Error('duplicate module named ' + normalizedName);
      moduleInstantiators[normalizedName] = new UncoatedModuleInstantiator(normalizedName, func);
    },
    bundleStore: Object.create(null),
    register: function(name, deps, func) {
      if (!deps || !deps.length && !func.length) {
        this.registerModule(name, deps, func);
      } else {
        this.bundleStore[name] = {
          deps: deps,
          execute: function() {
            var $__0 = arguments;
            var depMap = {};
            deps.forEach((function(dep, index) {
              return depMap[dep] = $__0[index];
            }));
            var registryEntry = func.call(this, depMap);
            registryEntry.execute.call(this);
            return registryEntry.exports;
          }
        };
      }
    },
    getAnonymousModule: function(func) {
      return new Module(func.call(global), liveModuleSentinel);
    },
    getForTesting: function(name) {
      var $__0 = this;
      if (!this.testingPrefix_) {
        Object.keys(moduleInstances).some((function(key) {
          var m = /(traceur@[^\/]*\/)/.exec(key);
          if (m) {
            $__0.testingPrefix_ = m[1];
            return true;
          }
        }));
      }
      return this.get(this.testingPrefix_ + name);
    }
  };
  var moduleStoreModule = new Module({ModuleStore: ModuleStore});
  ModuleStore.set('@traceur/src/runtime/ModuleStore.js', moduleStoreModule);
  var setupGlobals = $traceurRuntime.setupGlobals;
  $traceurRuntime.setupGlobals = function(global) {
    setupGlobals(global);
  };
  $traceurRuntime.ModuleStore = ModuleStore;
  global.System = {
    register: ModuleStore.register.bind(ModuleStore),
    registerModule: ModuleStore.registerModule.bind(ModuleStore),
    get: ModuleStore.get,
    set: ModuleStore.set,
    normalize: ModuleStore.normalize
  };
})(typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : this);
System.registerModule("traceur-runtime@0.0.88/src/runtime/async.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/async.js";
  if (typeof $traceurRuntime !== 'object') {
    throw new Error('traceur runtime not found.');
  }
  var $createPrivateName = $traceurRuntime.createPrivateName;
  var $defineProperty = $traceurRuntime.defineProperty;
  var $defineProperties = $traceurRuntime.defineProperties;
  var $create = Object.create;
  var thisName = $createPrivateName();
  var argsName = $createPrivateName();
  var observeName = $createPrivateName();
  function AsyncGeneratorFunction() {}
  function AsyncGeneratorFunctionPrototype() {}
  AsyncGeneratorFunction.prototype = AsyncGeneratorFunctionPrototype;
  AsyncGeneratorFunctionPrototype.constructor = AsyncGeneratorFunction;
  $defineProperty(AsyncGeneratorFunctionPrototype, 'constructor', {enumerable: false});
  var AsyncGeneratorContext = (function() {
    function AsyncGeneratorContext(observer) {
      var $__0 = this;
      this.decoratedObserver = $traceurRuntime.createDecoratedGenerator(observer, (function() {
        $__0.done = true;
      }));
      this.done = false;
      this.inReturn = false;
    }
    return ($traceurRuntime.createClass)(AsyncGeneratorContext, {
      throw: function(error) {
        if (!this.inReturn) {
          throw error;
        }
      },
      yield: function(value) {
        if (this.done) {
          this.inReturn = true;
          throw undefined;
        }
        var result;
        try {
          result = this.decoratedObserver.next(value);
        } catch (e) {
          this.done = true;
          throw e;
        }
        if (result === undefined) {
          return ;
        }
        if (result.done) {
          this.done = true;
          this.inReturn = true;
          throw undefined;
        }
        return result.value;
      },
      yieldFor: function(observable) {
        var ctx = this;
        return $traceurRuntime.observeForEach(observable[$traceurRuntime.toProperty(Symbol.observer)].bind(observable), function(value) {
          if (ctx.done) {
            this.return();
            return ;
          }
          var result;
          try {
            result = ctx.decoratedObserver.next(value);
          } catch (e) {
            ctx.done = true;
            throw e;
          }
          if (result === undefined) {
            return ;
          }
          if (result.done) {
            ctx.done = true;
          }
          return result;
        });
      }
    }, {});
  }());
  AsyncGeneratorFunctionPrototype.prototype[Symbol.observer] = function(observer) {
    var observe = this[observeName];
    var ctx = new AsyncGeneratorContext(observer);
    $traceurRuntime.schedule((function() {
      return observe(ctx);
    })).then((function(value) {
      if (!ctx.done) {
        ctx.decoratedObserver.return(value);
      }
    })).catch((function(error) {
      if (!ctx.done) {
        ctx.decoratedObserver.throw(error);
      }
    }));
    return ctx.decoratedObserver;
  };
  $defineProperty(AsyncGeneratorFunctionPrototype.prototype, Symbol.observer, {enumerable: false});
  function initAsyncGeneratorFunction(functionObject) {
    functionObject.prototype = $create(AsyncGeneratorFunctionPrototype.prototype);
    functionObject.__proto__ = AsyncGeneratorFunctionPrototype;
    return functionObject;
  }
  function createAsyncGeneratorInstance(observe, functionObject) {
    for (var args = [],
        $__2 = 2; $__2 < arguments.length; $__2++)
      args[$__2 - 2] = arguments[$__2];
    var object = $create(functionObject.prototype);
    object[thisName] = this;
    object[argsName] = args;
    object[observeName] = observe;
    return object;
  }
  function observeForEach(observe, next) {
    return new Promise((function(resolve, reject) {
      var generator = observe({
        next: function(value) {
          return next.call(generator, value);
        },
        throw: function(error) {
          reject(error);
        },
        return: function(value) {
          resolve(value);
        }
      });
    }));
  }
  function schedule(asyncF) {
    return Promise.resolve().then(asyncF);
  }
  var generator = Symbol();
  var onDone = Symbol();
  var DecoratedGenerator = (function() {
    function DecoratedGenerator(_generator, _onDone) {
      this[generator] = _generator;
      this[onDone] = _onDone;
    }
    return ($traceurRuntime.createClass)(DecoratedGenerator, {
      next: function(value) {
        var result = this[generator].next(value);
        if (result !== undefined && result.done) {
          this[onDone].call(this);
        }
        return result;
      },
      throw: function(error) {
        this[onDone].call(this);
        return this[generator].throw(error);
      },
      return: function(value) {
        this[onDone].call(this);
        return this[generator].return(value);
      }
    }, {});
  }());
  function createDecoratedGenerator(generator, onDone) {
    return new DecoratedGenerator(generator, onDone);
  }
  $traceurRuntime.initAsyncGeneratorFunction = initAsyncGeneratorFunction;
  $traceurRuntime.createAsyncGeneratorInstance = createAsyncGeneratorInstance;
  $traceurRuntime.observeForEach = observeForEach;
  $traceurRuntime.schedule = schedule;
  $traceurRuntime.createDecoratedGenerator = createDecoratedGenerator;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/classes.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/classes.js";
  var $Object = Object;
  var $TypeError = TypeError;
  var $create = $Object.create;
  var $defineProperties = $traceurRuntime.defineProperties;
  var $defineProperty = $traceurRuntime.defineProperty;
  var $getOwnPropertyDescriptor = $traceurRuntime.getOwnPropertyDescriptor;
  var $getOwnPropertyNames = $traceurRuntime.getOwnPropertyNames;
  var $getPrototypeOf = Object.getPrototypeOf;
  var $__0 = Object,
      getOwnPropertyNames = $__0.getOwnPropertyNames,
      getOwnPropertySymbols = $__0.getOwnPropertySymbols;
  function superDescriptor(homeObject, name) {
    var proto = $getPrototypeOf(homeObject);
    do {
      var result = $getOwnPropertyDescriptor(proto, name);
      if (result)
        return result;
      proto = $getPrototypeOf(proto);
    } while (proto);
    return undefined;
  }
  function superConstructor(ctor) {
    return ctor.__proto__;
  }
  function superGet(self, homeObject, name) {
    var descriptor = superDescriptor(homeObject, name);
    if (descriptor) {
      if (!descriptor.get)
        return descriptor.value;
      return descriptor.get.call(self);
    }
    return undefined;
  }
  function superSet(self, homeObject, name, value) {
    var descriptor = superDescriptor(homeObject, name);
    if (descriptor && descriptor.set) {
      descriptor.set.call(self, value);
      return value;
    }
    throw $TypeError(("super has no setter '" + name + "'."));
  }
  function forEachPropertyKey(object, f) {
    getOwnPropertyNames(object).forEach(f);
    getOwnPropertySymbols(object).forEach(f);
  }
  function getDescriptors(object) {
    var descriptors = {};
    forEachPropertyKey(object, (function(key) {
      descriptors[key] = $getOwnPropertyDescriptor(object, key);
      descriptors[key].enumerable = false;
    }));
    return descriptors;
  }
  var nonEnum = {enumerable: false};
  function makePropertiesNonEnumerable(object) {
    forEachPropertyKey(object, (function(key) {
      $defineProperty(object, key, nonEnum);
    }));
  }
  function createClass(ctor, object, staticObject, superClass) {
    $defineProperty(object, 'constructor', {
      value: ctor,
      configurable: true,
      enumerable: false,
      writable: true
    });
    if (arguments.length > 3) {
      if (typeof superClass === 'function')
        ctor.__proto__ = superClass;
      ctor.prototype = $create(getProtoParent(superClass), getDescriptors(object));
    } else {
      makePropertiesNonEnumerable(object);
      ctor.prototype = object;
    }
    $defineProperty(ctor, 'prototype', {
      configurable: false,
      writable: false
    });
    return $defineProperties(ctor, getDescriptors(staticObject));
  }
  function getProtoParent(superClass) {
    if (typeof superClass === 'function') {
      var prototype = superClass.prototype;
      if ($Object(prototype) === prototype || prototype === null)
        return superClass.prototype;
      throw new $TypeError('super prototype must be an Object or null');
    }
    if (superClass === null)
      return null;
    throw new $TypeError(("Super expression must either be null or a function, not " + typeof superClass + "."));
  }
  $traceurRuntime.createClass = createClass;
  $traceurRuntime.superConstructor = superConstructor;
  $traceurRuntime.superGet = superGet;
  $traceurRuntime.superSet = superSet;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/destructuring.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/destructuring.js";
  function iteratorToArray(iter) {
    var rv = [];
    var i = 0;
    var tmp;
    while (!(tmp = iter.next()).done) {
      rv[i++] = tmp.value;
    }
    return rv;
  }
  $traceurRuntime.iteratorToArray = iteratorToArray;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/generators.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/generators.js";
  if (typeof $traceurRuntime !== 'object') {
    throw new Error('traceur runtime not found.');
  }
  var createPrivateName = $traceurRuntime.createPrivateName;
  var $defineProperties = $traceurRuntime.defineProperties;
  var $defineProperty = $traceurRuntime.defineProperty;
  var $create = Object.create;
  var $TypeError = TypeError;
  function nonEnum(value) {
    return {
      configurable: true,
      enumerable: false,
      value: value,
      writable: true
    };
  }
  var ST_NEWBORN = 0;
  var ST_EXECUTING = 1;
  var ST_SUSPENDED = 2;
  var ST_CLOSED = 3;
  var END_STATE = -2;
  var RETHROW_STATE = -3;
  function getInternalError(state) {
    return new Error('Traceur compiler bug: invalid state in state machine: ' + state);
  }
  var RETURN_SENTINEL = {};
  function GeneratorContext() {
    this.state = 0;
    this.GState = ST_NEWBORN;
    this.storedException = undefined;
    this.finallyFallThrough = undefined;
    this.sent_ = undefined;
    this.returnValue = undefined;
    this.oldReturnValue = undefined;
    this.tryStack_ = [];
  }
  GeneratorContext.prototype = {
    pushTry: function(catchState, finallyState) {
      if (finallyState !== null) {
        var finallyFallThrough = null;
        for (var i = this.tryStack_.length - 1; i >= 0; i--) {
          if (this.tryStack_[i].catch !== undefined) {
            finallyFallThrough = this.tryStack_[i].catch;
            break;
          }
        }
        if (finallyFallThrough === null)
          finallyFallThrough = RETHROW_STATE;
        this.tryStack_.push({
          finally: finallyState,
          finallyFallThrough: finallyFallThrough
        });
      }
      if (catchState !== null) {
        this.tryStack_.push({catch: catchState});
      }
    },
    popTry: function() {
      this.tryStack_.pop();
    },
    maybeUncatchable: function() {
      if (this.storedException === RETURN_SENTINEL) {
        throw RETURN_SENTINEL;
      }
    },
    get sent() {
      this.maybeThrow();
      return this.sent_;
    },
    set sent(v) {
      this.sent_ = v;
    },
    get sentIgnoreThrow() {
      return this.sent_;
    },
    maybeThrow: function() {
      if (this.action === 'throw') {
        this.action = 'next';
        throw this.sent_;
      }
    },
    end: function() {
      switch (this.state) {
        case END_STATE:
          return this;
        case RETHROW_STATE:
          throw this.storedException;
        default:
          throw getInternalError(this.state);
      }
    },
    handleException: function(ex) {
      this.GState = ST_CLOSED;
      this.state = END_STATE;
      throw ex;
    },
    wrapYieldStar: function(iterator) {
      var ctx = this;
      return {
        next: function(v) {
          return iterator.next(v);
        },
        throw: function(e) {
          var result;
          if (e === RETURN_SENTINEL) {
            if (iterator.return) {
              result = iterator.return(ctx.returnValue);
              if (!result.done) {
                ctx.returnValue = ctx.oldReturnValue;
                return result;
              }
              ctx.returnValue = result.value;
            }
            throw e;
          }
          if (iterator.throw) {
            return iterator.throw(e);
          }
          iterator.return && iterator.return();
          throw $TypeError('Inner iterator does not have a throw method');
        }
      };
    }
  };
  function nextOrThrow(ctx, moveNext, action, x) {
    switch (ctx.GState) {
      case ST_EXECUTING:
        throw new Error(("\"" + action + "\" on executing generator"));
      case ST_CLOSED:
        if (action == 'next') {
          return {
            value: undefined,
            done: true
          };
        }
        if (x === RETURN_SENTINEL) {
          return {
            value: ctx.returnValue,
            done: true
          };
        }
        throw x;
      case ST_NEWBORN:
        if (action === 'throw') {
          ctx.GState = ST_CLOSED;
          if (x === RETURN_SENTINEL) {
            return {
              value: ctx.returnValue,
              done: true
            };
          }
          throw x;
        }
        if (x !== undefined)
          throw $TypeError('Sent value to newborn generator');
      case ST_SUSPENDED:
        ctx.GState = ST_EXECUTING;
        ctx.action = action;
        ctx.sent = x;
        var value;
        try {
          value = moveNext(ctx);
        } catch (ex) {
          if (ex === RETURN_SENTINEL) {
            value = ctx;
          } else {
            throw ex;
          }
        }
        var done = value === ctx;
        if (done)
          value = ctx.returnValue;
        ctx.GState = done ? ST_CLOSED : ST_SUSPENDED;
        return {
          value: value,
          done: done
        };
    }
  }
  var ctxName = createPrivateName();
  var moveNextName = createPrivateName();
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}
  GeneratorFunction.prototype = GeneratorFunctionPrototype;
  $defineProperty(GeneratorFunctionPrototype, 'constructor', nonEnum(GeneratorFunction));
  GeneratorFunctionPrototype.prototype = {
    constructor: GeneratorFunctionPrototype,
    next: function(v) {
      return nextOrThrow(this[ctxName], this[moveNextName], 'next', v);
    },
    throw: function(v) {
      return nextOrThrow(this[ctxName], this[moveNextName], 'throw', v);
    },
    return: function(v) {
      this[ctxName].oldReturnValue = this[ctxName].returnValue;
      this[ctxName].returnValue = v;
      return nextOrThrow(this[ctxName], this[moveNextName], 'throw', RETURN_SENTINEL);
    }
  };
  $defineProperties(GeneratorFunctionPrototype.prototype, {
    constructor: {enumerable: false},
    next: {enumerable: false},
    throw: {enumerable: false},
    return: {enumerable: false}
  });
  Object.defineProperty(GeneratorFunctionPrototype.prototype, Symbol.iterator, nonEnum(function() {
    return this;
  }));
  function createGeneratorInstance(innerFunction, functionObject, self) {
    var moveNext = getMoveNext(innerFunction, self);
    var ctx = new GeneratorContext();
    var object = $create(functionObject.prototype);
    object[ctxName] = ctx;
    object[moveNextName] = moveNext;
    return object;
  }
  function initGeneratorFunction(functionObject) {
    functionObject.prototype = $create(GeneratorFunctionPrototype.prototype);
    functionObject.__proto__ = GeneratorFunctionPrototype;
    return functionObject;
  }
  function AsyncFunctionContext() {
    GeneratorContext.call(this);
    this.err = undefined;
    var ctx = this;
    ctx.result = new Promise(function(resolve, reject) {
      ctx.resolve = resolve;
      ctx.reject = reject;
    });
  }
  AsyncFunctionContext.prototype = $create(GeneratorContext.prototype);
  AsyncFunctionContext.prototype.end = function() {
    switch (this.state) {
      case END_STATE:
        this.resolve(this.returnValue);
        break;
      case RETHROW_STATE:
        this.reject(this.storedException);
        break;
      default:
        this.reject(getInternalError(this.state));
    }
  };
  AsyncFunctionContext.prototype.handleException = function() {
    this.state = RETHROW_STATE;
  };
  function asyncWrap(innerFunction, self) {
    var moveNext = getMoveNext(innerFunction, self);
    var ctx = new AsyncFunctionContext();
    ctx.createCallback = function(newState) {
      return function(value) {
        ctx.state = newState;
        ctx.value = value;
        moveNext(ctx);
      };
    };
    ctx.errback = function(err) {
      handleCatch(ctx, err);
      moveNext(ctx);
    };
    moveNext(ctx);
    return ctx.result;
  }
  function getMoveNext(innerFunction, self) {
    return function(ctx) {
      while (true) {
        try {
          return innerFunction.call(self, ctx);
        } catch (ex) {
          handleCatch(ctx, ex);
        }
      }
    };
  }
  function handleCatch(ctx, ex) {
    ctx.storedException = ex;
    var last = ctx.tryStack_[ctx.tryStack_.length - 1];
    if (!last) {
      ctx.handleException(ex);
      return ;
    }
    ctx.state = last.catch !== undefined ? last.catch : last.finally;
    if (last.finallyFallThrough !== undefined)
      ctx.finallyFallThrough = last.finallyFallThrough;
  }
  $traceurRuntime.asyncWrap = asyncWrap;
  $traceurRuntime.initGeneratorFunction = initGeneratorFunction;
  $traceurRuntime.createGeneratorInstance = createGeneratorInstance;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/relativeRequire.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/relativeRequire.js";
  var path;
  function relativeRequire(callerPath, requiredPath) {
    path = path || typeof require !== 'undefined' && require('path');
    function isDirectory(path) {
      return path.slice(-1) === '/';
    }
    function isAbsolute(path) {
      return path[0] === '/';
    }
    function isRelative(path) {
      return path[0] === '.';
    }
    if (isDirectory(requiredPath) || isAbsolute(requiredPath))
      return ;
    return isRelative(requiredPath) ? require(path.resolve(path.dirname(callerPath), requiredPath)) : require(requiredPath);
  }
  $traceurRuntime.require = relativeRequire;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/spread.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/spread.js";
  function spread() {
    var rv = [],
        j = 0,
        iterResult;
    for (var i = 0; i < arguments.length; i++) {
      var valueToSpread = $traceurRuntime.checkObjectCoercible(arguments[i]);
      if (typeof valueToSpread[$traceurRuntime.toProperty(Symbol.iterator)] !== 'function') {
        throw new TypeError('Cannot spread non-iterable object.');
      }
      var iter = valueToSpread[$traceurRuntime.toProperty(Symbol.iterator)]();
      while (!(iterResult = iter.next()).done) {
        rv[j++] = iterResult.value;
      }
    }
    return rv;
  }
  $traceurRuntime.spread = spread;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/template.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/template.js";
  var $__0 = Object,
      defineProperty = $__0.defineProperty,
      freeze = $__0.freeze;
  var slice = Array.prototype.slice;
  var map = Object.create(null);
  function getTemplateObject(raw) {
    var cooked = arguments[1];
    var key = raw.join('${}');
    var templateObject = map[key];
    if (templateObject)
      return templateObject;
    if (!cooked) {
      cooked = slice.call(raw);
    }
    return map[key] = freeze(defineProperty(cooked, 'raw', {value: freeze(raw)}));
  }
  $traceurRuntime.getTemplateObject = getTemplateObject;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/type-assertions.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/type-assertions.js";
  var types = {
    any: {name: 'any'},
    boolean: {name: 'boolean'},
    number: {name: 'number'},
    string: {name: 'string'},
    symbol: {name: 'symbol'},
    void: {name: 'void'}
  };
  var GenericType = (function() {
    function GenericType(type, argumentTypes) {
      this.type = type;
      this.argumentTypes = argumentTypes;
    }
    return ($traceurRuntime.createClass)(GenericType, {}, {});
  }());
  var typeRegister = Object.create(null);
  function genericType(type) {
    for (var argumentTypes = [],
        $__1 = 1; $__1 < arguments.length; $__1++)
      argumentTypes[$__1 - 1] = arguments[$__1];
    var typeMap = typeRegister;
    var key = $traceurRuntime.getOwnHashObject(type).hash;
    if (!typeMap[key]) {
      typeMap[key] = Object.create(null);
    }
    typeMap = typeMap[key];
    for (var i = 0; i < argumentTypes.length - 1; i++) {
      key = $traceurRuntime.getOwnHashObject(argumentTypes[i]).hash;
      if (!typeMap[key]) {
        typeMap[key] = Object.create(null);
      }
      typeMap = typeMap[key];
    }
    var tail = argumentTypes[argumentTypes.length - 1];
    key = $traceurRuntime.getOwnHashObject(tail).hash;
    if (!typeMap[key]) {
      typeMap[key] = new GenericType(type, argumentTypes);
    }
    return typeMap[key];
  }
  $traceurRuntime.GenericType = GenericType;
  $traceurRuntime.genericType = genericType;
  $traceurRuntime.type = types;
  return {};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/runtime-modules.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/runtime-modules.js";
  System.get("traceur-runtime@0.0.88/src/runtime/relativeRequire.js");
  System.get("traceur-runtime@0.0.88/src/runtime/spread.js");
  System.get("traceur-runtime@0.0.88/src/runtime/destructuring.js");
  System.get("traceur-runtime@0.0.88/src/runtime/classes.js");
  System.get("traceur-runtime@0.0.88/src/runtime/async.js");
  System.get("traceur-runtime@0.0.88/src/runtime/generators.js");
  System.get("traceur-runtime@0.0.88/src/runtime/template.js");
  System.get("traceur-runtime@0.0.88/src/runtime/type-assertions.js");
  return {};
});
System.get("traceur-runtime@0.0.88/src/runtime/runtime-modules.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/utils.js";
  var $ceil = Math.ceil;
  var $floor = Math.floor;
  var $isFinite = isFinite;
  var $isNaN = isNaN;
  var $pow = Math.pow;
  var $min = Math.min;
  var toObject = $traceurRuntime.toObject;
  function toUint32(x) {
    return x >>> 0;
  }
  function isObject(x) {
    return x && (typeof x === 'object' || typeof x === 'function');
  }
  function isCallable(x) {
    return typeof x === 'function';
  }
  function isNumber(x) {
    return typeof x === 'number';
  }
  function toInteger(x) {
    x = +x;
    if ($isNaN(x))
      return 0;
    if (x === 0 || !$isFinite(x))
      return x;
    return x > 0 ? $floor(x) : $ceil(x);
  }
  var MAX_SAFE_LENGTH = $pow(2, 53) - 1;
  function toLength(x) {
    var len = toInteger(x);
    return len < 0 ? 0 : $min(len, MAX_SAFE_LENGTH);
  }
  function checkIterable(x) {
    return !isObject(x) ? undefined : x[Symbol.iterator];
  }
  function isConstructor(x) {
    return isCallable(x);
  }
  function createIteratorResultObject(value, done) {
    return {
      value: value,
      done: done
    };
  }
  function maybeDefine(object, name, descr) {
    if (!(name in object)) {
      Object.defineProperty(object, name, descr);
    }
  }
  function maybeDefineMethod(object, name, value) {
    maybeDefine(object, name, {
      value: value,
      configurable: true,
      enumerable: false,
      writable: true
    });
  }
  function maybeDefineConst(object, name, value) {
    maybeDefine(object, name, {
      value: value,
      configurable: false,
      enumerable: false,
      writable: false
    });
  }
  function maybeAddFunctions(object, functions) {
    for (var i = 0; i < functions.length; i += 2) {
      var name = functions[i];
      var value = functions[i + 1];
      maybeDefineMethod(object, name, value);
    }
  }
  function maybeAddConsts(object, consts) {
    for (var i = 0; i < consts.length; i += 2) {
      var name = consts[i];
      var value = consts[i + 1];
      maybeDefineConst(object, name, value);
    }
  }
  function maybeAddIterator(object, func, Symbol) {
    if (!Symbol || !Symbol.iterator || object[Symbol.iterator])
      return ;
    if (object['@@iterator'])
      func = object['@@iterator'];
    Object.defineProperty(object, Symbol.iterator, {
      value: func,
      configurable: true,
      enumerable: false,
      writable: true
    });
  }
  var polyfills = [];
  function registerPolyfill(func) {
    polyfills.push(func);
  }
  function polyfillAll(global) {
    polyfills.forEach((function(f) {
      return f(global);
    }));
  }
  return {
    get toObject() {
      return toObject;
    },
    get toUint32() {
      return toUint32;
    },
    get isObject() {
      return isObject;
    },
    get isCallable() {
      return isCallable;
    },
    get isNumber() {
      return isNumber;
    },
    get toInteger() {
      return toInteger;
    },
    get toLength() {
      return toLength;
    },
    get checkIterable() {
      return checkIterable;
    },
    get isConstructor() {
      return isConstructor;
    },
    get createIteratorResultObject() {
      return createIteratorResultObject;
    },
    get maybeDefine() {
      return maybeDefine;
    },
    get maybeDefineMethod() {
      return maybeDefineMethod;
    },
    get maybeDefineConst() {
      return maybeDefineConst;
    },
    get maybeAddFunctions() {
      return maybeAddFunctions;
    },
    get maybeAddConsts() {
      return maybeAddConsts;
    },
    get maybeAddIterator() {
      return maybeAddIterator;
    },
    get registerPolyfill() {
      return registerPolyfill;
    },
    get polyfillAll() {
      return polyfillAll;
    }
  };
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Map.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Map.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      isObject = $__0.isObject,
      maybeAddIterator = $__0.maybeAddIterator,
      registerPolyfill = $__0.registerPolyfill;
  var getOwnHashObject = $traceurRuntime.getOwnHashObject;
  var $hasOwnProperty = Object.prototype.hasOwnProperty;
  var deletedSentinel = {};
  function lookupIndex(map, key) {
    if (isObject(key)) {
      var hashObject = getOwnHashObject(key);
      return hashObject && map.objectIndex_[hashObject.hash];
    }
    if (typeof key === 'string')
      return map.stringIndex_[key];
    return map.primitiveIndex_[key];
  }
  function initMap(map) {
    map.entries_ = [];
    map.objectIndex_ = Object.create(null);
    map.stringIndex_ = Object.create(null);
    map.primitiveIndex_ = Object.create(null);
    map.deletedCount_ = 0;
  }
  var Map = (function() {
    function Map() {
      var $__10,
          $__11;
      var iterable = arguments[0];
      if (!isObject(this))
        throw new TypeError('Map called on incompatible type');
      if ($hasOwnProperty.call(this, 'entries_')) {
        throw new TypeError('Map can not be reentrantly initialised');
      }
      initMap(this);
      if (iterable !== null && iterable !== undefined) {
        var $__5 = true;
        var $__6 = false;
        var $__7 = undefined;
        try {
          for (var $__3 = void 0,
              $__2 = (iterable)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
            var $__9 = $__3.value,
                key = ($__10 = $__9[$traceurRuntime.toProperty(Symbol.iterator)](), ($__11 = $__10.next()).done ? void 0 : $__11.value),
                value = ($__11 = $__10.next()).done ? void 0 : $__11.value;
            {
              this.set(key, value);
            }
          }
        } catch ($__8) {
          $__6 = true;
          $__7 = $__8;
        } finally {
          try {
            if (!$__5 && $__2.return != null) {
              $__2.return();
            }
          } finally {
            if ($__6) {
              throw $__7;
            }
          }
        }
      }
    }
    return ($traceurRuntime.createClass)(Map, {
      get size() {
        return this.entries_.length / 2 - this.deletedCount_;
      },
      get: function(key) {
        var index = lookupIndex(this, key);
        if (index !== undefined)
          return this.entries_[index + 1];
      },
      set: function(key, value) {
        var objectMode = isObject(key);
        var stringMode = typeof key === 'string';
        var index = lookupIndex(this, key);
        if (index !== undefined) {
          this.entries_[index + 1] = value;
        } else {
          index = this.entries_.length;
          this.entries_[index] = key;
          this.entries_[index + 1] = value;
          if (objectMode) {
            var hashObject = getOwnHashObject(key);
            var hash = hashObject.hash;
            this.objectIndex_[hash] = index;
          } else if (stringMode) {
            this.stringIndex_[key] = index;
          } else {
            this.primitiveIndex_[key] = index;
          }
        }
        return this;
      },
      has: function(key) {
        return lookupIndex(this, key) !== undefined;
      },
      delete: function(key) {
        var objectMode = isObject(key);
        var stringMode = typeof key === 'string';
        var index;
        var hash;
        if (objectMode) {
          var hashObject = getOwnHashObject(key);
          if (hashObject) {
            index = this.objectIndex_[hash = hashObject.hash];
            delete this.objectIndex_[hash];
          }
        } else if (stringMode) {
          index = this.stringIndex_[key];
          delete this.stringIndex_[key];
        } else {
          index = this.primitiveIndex_[key];
          delete this.primitiveIndex_[key];
        }
        if (index !== undefined) {
          this.entries_[index] = deletedSentinel;
          this.entries_[index + 1] = undefined;
          this.deletedCount_++;
          return true;
        }
        return false;
      },
      clear: function() {
        initMap(this);
      },
      forEach: function(callbackFn) {
        var thisArg = arguments[1];
        for (var i = 0; i < this.entries_.length; i += 2) {
          var key = this.entries_[i];
          var value = this.entries_[i + 1];
          if (key === deletedSentinel)
            continue;
          callbackFn.call(thisArg, value, key, this);
        }
      },
      entries: $traceurRuntime.initGeneratorFunction(function $__12() {
        var i,
            key,
            value;
        return $traceurRuntime.createGeneratorInstance(function($ctx) {
          while (true)
            switch ($ctx.state) {
              case 0:
                i = 0;
                $ctx.state = 12;
                break;
              case 12:
                $ctx.state = (i < this.entries_.length) ? 8 : -2;
                break;
              case 4:
                i += 2;
                $ctx.state = 12;
                break;
              case 8:
                key = this.entries_[i];
                value = this.entries_[i + 1];
                $ctx.state = 9;
                break;
              case 9:
                $ctx.state = (key === deletedSentinel) ? 4 : 6;
                break;
              case 6:
                $ctx.state = 2;
                return [key, value];
              case 2:
                $ctx.maybeThrow();
                $ctx.state = 4;
                break;
              default:
                return $ctx.end();
            }
        }, $__12, this);
      }),
      keys: $traceurRuntime.initGeneratorFunction(function $__13() {
        var i,
            key,
            value;
        return $traceurRuntime.createGeneratorInstance(function($ctx) {
          while (true)
            switch ($ctx.state) {
              case 0:
                i = 0;
                $ctx.state = 12;
                break;
              case 12:
                $ctx.state = (i < this.entries_.length) ? 8 : -2;
                break;
              case 4:
                i += 2;
                $ctx.state = 12;
                break;
              case 8:
                key = this.entries_[i];
                value = this.entries_[i + 1];
                $ctx.state = 9;
                break;
              case 9:
                $ctx.state = (key === deletedSentinel) ? 4 : 6;
                break;
              case 6:
                $ctx.state = 2;
                return key;
              case 2:
                $ctx.maybeThrow();
                $ctx.state = 4;
                break;
              default:
                return $ctx.end();
            }
        }, $__13, this);
      }),
      values: $traceurRuntime.initGeneratorFunction(function $__14() {
        var i,
            key,
            value;
        return $traceurRuntime.createGeneratorInstance(function($ctx) {
          while (true)
            switch ($ctx.state) {
              case 0:
                i = 0;
                $ctx.state = 12;
                break;
              case 12:
                $ctx.state = (i < this.entries_.length) ? 8 : -2;
                break;
              case 4:
                i += 2;
                $ctx.state = 12;
                break;
              case 8:
                key = this.entries_[i];
                value = this.entries_[i + 1];
                $ctx.state = 9;
                break;
              case 9:
                $ctx.state = (key === deletedSentinel) ? 4 : 6;
                break;
              case 6:
                $ctx.state = 2;
                return value;
              case 2:
                $ctx.maybeThrow();
                $ctx.state = 4;
                break;
              default:
                return $ctx.end();
            }
        }, $__14, this);
      })
    }, {});
  }());
  Object.defineProperty(Map.prototype, Symbol.iterator, {
    configurable: true,
    writable: true,
    value: Map.prototype.entries
  });
  function polyfillMap(global) {
    var $__9 = global,
        Object = $__9.Object,
        Symbol = $__9.Symbol;
    if (!global.Map)
      global.Map = Map;
    var mapPrototype = global.Map.prototype;
    if (mapPrototype.entries === undefined)
      global.Map = Map;
    if (mapPrototype.entries) {
      maybeAddIterator(mapPrototype, mapPrototype.entries, Symbol);
      maybeAddIterator(Object.getPrototypeOf(new global.Map().entries()), function() {
        return this;
      }, Symbol);
    }
  }
  registerPolyfill(polyfillMap);
  return {
    get Map() {
      return Map;
    },
    get polyfillMap() {
      return polyfillMap;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Map.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Set.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Set.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      isObject = $__0.isObject,
      maybeAddIterator = $__0.maybeAddIterator,
      registerPolyfill = $__0.registerPolyfill;
  var Map = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Map.js").Map;
  var getOwnHashObject = $traceurRuntime.getOwnHashObject;
  var $hasOwnProperty = Object.prototype.hasOwnProperty;
  function initSet(set) {
    set.map_ = new Map();
  }
  var Set = (function() {
    function Set() {
      var iterable = arguments[0];
      if (!isObject(this))
        throw new TypeError('Set called on incompatible type');
      if ($hasOwnProperty.call(this, 'map_')) {
        throw new TypeError('Set can not be reentrantly initialised');
      }
      initSet(this);
      if (iterable !== null && iterable !== undefined) {
        var $__7 = true;
        var $__8 = false;
        var $__9 = undefined;
        try {
          for (var $__5 = void 0,
              $__4 = (iterable)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__7 = ($__5 = $__4.next()).done); $__7 = true) {
            var item = $__5.value;
            {
              this.add(item);
            }
          }
        } catch ($__10) {
          $__8 = true;
          $__9 = $__10;
        } finally {
          try {
            if (!$__7 && $__4.return != null) {
              $__4.return();
            }
          } finally {
            if ($__8) {
              throw $__9;
            }
          }
        }
      }
    }
    return ($traceurRuntime.createClass)(Set, {
      get size() {
        return this.map_.size;
      },
      has: function(key) {
        return this.map_.has(key);
      },
      add: function(key) {
        this.map_.set(key, key);
        return this;
      },
      delete: function(key) {
        return this.map_.delete(key);
      },
      clear: function() {
        return this.map_.clear();
      },
      forEach: function(callbackFn) {
        var thisArg = arguments[1];
        var $__2 = this;
        return this.map_.forEach((function(value, key) {
          callbackFn.call(thisArg, key, key, $__2);
        }));
      },
      values: $traceurRuntime.initGeneratorFunction(function $__12() {
        var $__13,
            $__14;
        return $traceurRuntime.createGeneratorInstance(function($ctx) {
          while (true)
            switch ($ctx.state) {
              case 0:
                $__13 = $ctx.wrapYieldStar(this.map_.keys()[Symbol.iterator]());
                $ctx.sent = void 0;
                $ctx.action = 'next';
                $ctx.state = 12;
                break;
              case 12:
                $__14 = $__13[$ctx.action]($ctx.sentIgnoreThrow);
                $ctx.state = 9;
                break;
              case 9:
                $ctx.state = ($__14.done) ? 3 : 2;
                break;
              case 3:
                $ctx.sent = $__14.value;
                $ctx.state = -2;
                break;
              case 2:
                $ctx.state = 12;
                return $__14.value;
              default:
                return $ctx.end();
            }
        }, $__12, this);
      }),
      entries: $traceurRuntime.initGeneratorFunction(function $__15() {
        var $__16,
            $__17;
        return $traceurRuntime.createGeneratorInstance(function($ctx) {
          while (true)
            switch ($ctx.state) {
              case 0:
                $__16 = $ctx.wrapYieldStar(this.map_.entries()[Symbol.iterator]());
                $ctx.sent = void 0;
                $ctx.action = 'next';
                $ctx.state = 12;
                break;
              case 12:
                $__17 = $__16[$ctx.action]($ctx.sentIgnoreThrow);
                $ctx.state = 9;
                break;
              case 9:
                $ctx.state = ($__17.done) ? 3 : 2;
                break;
              case 3:
                $ctx.sent = $__17.value;
                $ctx.state = -2;
                break;
              case 2:
                $ctx.state = 12;
                return $__17.value;
              default:
                return $ctx.end();
            }
        }, $__15, this);
      })
    }, {});
  }());
  Object.defineProperty(Set.prototype, Symbol.iterator, {
    configurable: true,
    writable: true,
    value: Set.prototype.values
  });
  Object.defineProperty(Set.prototype, 'keys', {
    configurable: true,
    writable: true,
    value: Set.prototype.values
  });
  function polyfillSet(global) {
    var $__11 = global,
        Object = $__11.Object,
        Symbol = $__11.Symbol;
    if (!global.Set)
      global.Set = Set;
    var setPrototype = global.Set.prototype;
    if (setPrototype.values) {
      maybeAddIterator(setPrototype, setPrototype.values, Symbol);
      maybeAddIterator(Object.getPrototypeOf(new global.Set().values()), function() {
        return this;
      }, Symbol);
    }
  }
  registerPolyfill(polyfillSet);
  return {
    get Set() {
      return Set;
    },
    get polyfillSet() {
      return polyfillSet;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Set.js" + '');
System.registerModule("traceur-runtime@0.0.88/node_modules/rsvp/lib/rsvp/asap.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/node_modules/rsvp/lib/rsvp/asap.js";
  var len = 0;
  function asap(callback, arg) {
    queue[len] = callback;
    queue[len + 1] = arg;
    len += 2;
    if (len === 2) {
      scheduleFlush();
    }
  }
  var $__default = asap;
  var browserGlobal = (typeof window !== 'undefined') ? window : {};
  var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;
  var isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';
  function useNextTick() {
    return function() {
      process.nextTick(flush);
    };
  }
  function useMutationObserver() {
    var iterations = 0;
    var observer = new BrowserMutationObserver(flush);
    var node = document.createTextNode('');
    observer.observe(node, {characterData: true});
    return function() {
      node.data = (iterations = ++iterations % 2);
    };
  }
  function useMessageChannel() {
    var channel = new MessageChannel();
    channel.port1.onmessage = flush;
    return function() {
      channel.port2.postMessage(0);
    };
  }
  function useSetTimeout() {
    return function() {
      setTimeout(flush, 1);
    };
  }
  var queue = new Array(1000);
  function flush() {
    for (var i = 0; i < len; i += 2) {
      var callback = queue[i];
      var arg = queue[i + 1];
      callback(arg);
      queue[i] = undefined;
      queue[i + 1] = undefined;
    }
    len = 0;
  }
  var scheduleFlush;
  if (typeof process !== 'undefined' && {}.toString.call(process) === '[object process]') {
    scheduleFlush = useNextTick();
  } else if (BrowserMutationObserver) {
    scheduleFlush = useMutationObserver();
  } else if (isWorker) {
    scheduleFlush = useMessageChannel();
  } else {
    scheduleFlush = useSetTimeout();
  }
  return {get default() {
      return $__default;
    }};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Promise.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Promise.js";
  var async = System.get("traceur-runtime@0.0.88/node_modules/rsvp/lib/rsvp/asap.js").default;
  var registerPolyfill = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js").registerPolyfill;
  var promiseRaw = {};
  function isPromise(x) {
    return x && typeof x === 'object' && x.status_ !== undefined;
  }
  function idResolveHandler(x) {
    return x;
  }
  function idRejectHandler(x) {
    throw x;
  }
  function chain(promise) {
    var onResolve = arguments[1] !== (void 0) ? arguments[1] : idResolveHandler;
    var onReject = arguments[2] !== (void 0) ? arguments[2] : idRejectHandler;
    var deferred = getDeferred(promise.constructor);
    switch (promise.status_) {
      case undefined:
        throw TypeError;
      case 0:
        promise.onResolve_.push(onResolve, deferred);
        promise.onReject_.push(onReject, deferred);
        break;
      case +1:
        promiseEnqueue(promise.value_, [onResolve, deferred]);
        break;
      case -1:
        promiseEnqueue(promise.value_, [onReject, deferred]);
        break;
    }
    return deferred.promise;
  }
  function getDeferred(C) {
    if (this === $Promise) {
      var promise = promiseInit(new $Promise(promiseRaw));
      return {
        promise: promise,
        resolve: (function(x) {
          promiseResolve(promise, x);
        }),
        reject: (function(r) {
          promiseReject(promise, r);
        })
      };
    } else {
      var result = {};
      result.promise = new C((function(resolve, reject) {
        result.resolve = resolve;
        result.reject = reject;
      }));
      return result;
    }
  }
  function promiseSet(promise, status, value, onResolve, onReject) {
    promise.status_ = status;
    promise.value_ = value;
    promise.onResolve_ = onResolve;
    promise.onReject_ = onReject;
    return promise;
  }
  function promiseInit(promise) {
    return promiseSet(promise, 0, undefined, [], []);
  }
  var Promise = (function() {
    function Promise(resolver) {
      if (resolver === promiseRaw)
        return ;
      if (typeof resolver !== 'function')
        throw new TypeError;
      var promise = promiseInit(this);
      try {
        resolver((function(x) {
          promiseResolve(promise, x);
        }), (function(r) {
          promiseReject(promise, r);
        }));
      } catch (e) {
        promiseReject(promise, e);
      }
    }
    return ($traceurRuntime.createClass)(Promise, {
      catch: function(onReject) {
        return this.then(undefined, onReject);
      },
      then: function(onResolve, onReject) {
        if (typeof onResolve !== 'function')
          onResolve = idResolveHandler;
        if (typeof onReject !== 'function')
          onReject = idRejectHandler;
        var that = this;
        var constructor = this.constructor;
        return chain(this, function(x) {
          x = promiseCoerce(constructor, x);
          return x === that ? onReject(new TypeError) : isPromise(x) ? x.then(onResolve, onReject) : onResolve(x);
        }, onReject);
      }
    }, {
      resolve: function(x) {
        if (this === $Promise) {
          if (isPromise(x)) {
            return x;
          }
          return promiseSet(new $Promise(promiseRaw), +1, x);
        } else {
          return new this(function(resolve, reject) {
            resolve(x);
          });
        }
      },
      reject: function(r) {
        if (this === $Promise) {
          return promiseSet(new $Promise(promiseRaw), -1, r);
        } else {
          return new this((function(resolve, reject) {
            reject(r);
          }));
        }
      },
      all: function(values) {
        var deferred = getDeferred(this);
        var resolutions = [];
        try {
          var makeCountdownFunction = function(i) {
            return (function(x) {
              resolutions[i] = x;
              if (--count === 0)
                deferred.resolve(resolutions);
            });
          };
          var count = 0;
          var i = 0;
          var $__6 = true;
          var $__7 = false;
          var $__8 = undefined;
          try {
            for (var $__4 = void 0,
                $__3 = (values)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__6 = ($__4 = $__3.next()).done); $__6 = true) {
              var value = $__4.value;
              {
                var countdownFunction = makeCountdownFunction(i);
                this.resolve(value).then(countdownFunction, (function(r) {
                  deferred.reject(r);
                }));
                ++i;
                ++count;
              }
            }
          } catch ($__9) {
            $__7 = true;
            $__8 = $__9;
          } finally {
            try {
              if (!$__6 && $__3.return != null) {
                $__3.return();
              }
            } finally {
              if ($__7) {
                throw $__8;
              }
            }
          }
          if (count === 0) {
            deferred.resolve(resolutions);
          }
        } catch (e) {
          deferred.reject(e);
        }
        return deferred.promise;
      },
      race: function(values) {
        var deferred = getDeferred(this);
        try {
          for (var i = 0; i < values.length; i++) {
            this.resolve(values[i]).then((function(x) {
              deferred.resolve(x);
            }), (function(r) {
              deferred.reject(r);
            }));
          }
        } catch (e) {
          deferred.reject(e);
        }
        return deferred.promise;
      }
    });
  }());
  var $Promise = Promise;
  var $PromiseReject = $Promise.reject;
  function promiseResolve(promise, x) {
    promiseDone(promise, +1, x, promise.onResolve_);
  }
  function promiseReject(promise, r) {
    promiseDone(promise, -1, r, promise.onReject_);
  }
  function promiseDone(promise, status, value, reactions) {
    if (promise.status_ !== 0)
      return ;
    promiseEnqueue(value, reactions);
    promiseSet(promise, status, value);
  }
  function promiseEnqueue(value, tasks) {
    async((function() {
      for (var i = 0; i < tasks.length; i += 2) {
        promiseHandle(value, tasks[i], tasks[i + 1]);
      }
    }));
  }
  function promiseHandle(value, handler, deferred) {
    try {
      var result = handler(value);
      if (result === deferred.promise)
        throw new TypeError;
      else if (isPromise(result))
        chain(result, deferred.resolve, deferred.reject);
      else
        deferred.resolve(result);
    } catch (e) {
      try {
        deferred.reject(e);
      } catch (e) {}
    }
  }
  var thenableSymbol = '@@thenable';
  function isObject(x) {
    return x && (typeof x === 'object' || typeof x === 'function');
  }
  function promiseCoerce(constructor, x) {
    if (!isPromise(x) && isObject(x)) {
      var then;
      try {
        then = x.then;
      } catch (r) {
        var promise = $PromiseReject.call(constructor, r);
        x[thenableSymbol] = promise;
        return promise;
      }
      if (typeof then === 'function') {
        var p = x[thenableSymbol];
        if (p) {
          return p;
        } else {
          var deferred = getDeferred(constructor);
          x[thenableSymbol] = deferred.promise;
          try {
            then.call(x, deferred.resolve, deferred.reject);
          } catch (r) {
            deferred.reject(r);
          }
          return deferred.promise;
        }
      }
    }
    return x;
  }
  function polyfillPromise(global) {
    if (!global.Promise)
      global.Promise = Promise;
  }
  registerPolyfill(polyfillPromise);
  return {
    get Promise() {
      return Promise;
    },
    get polyfillPromise() {
      return polyfillPromise;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Promise.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/StringIterator.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/StringIterator.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      createIteratorResultObject = $__0.createIteratorResultObject,
      isObject = $__0.isObject;
  var toProperty = $traceurRuntime.toProperty;
  var hasOwnProperty = Object.prototype.hasOwnProperty;
  var iteratedString = Symbol('iteratedString');
  var stringIteratorNextIndex = Symbol('stringIteratorNextIndex');
  var StringIterator = (function() {
    var $__2;
    function StringIterator() {}
    return ($traceurRuntime.createClass)(StringIterator, ($__2 = {}, Object.defineProperty($__2, "next", {
      value: function() {
        var o = this;
        if (!isObject(o) || !hasOwnProperty.call(o, iteratedString)) {
          throw new TypeError('this must be a StringIterator object');
        }
        var s = o[toProperty(iteratedString)];
        if (s === undefined) {
          return createIteratorResultObject(undefined, true);
        }
        var position = o[toProperty(stringIteratorNextIndex)];
        var len = s.length;
        if (position >= len) {
          o[toProperty(iteratedString)] = undefined;
          return createIteratorResultObject(undefined, true);
        }
        var first = s.charCodeAt(position);
        var resultString;
        if (first < 0xD800 || first > 0xDBFF || position + 1 === len) {
          resultString = String.fromCharCode(first);
        } else {
          var second = s.charCodeAt(position + 1);
          if (second < 0xDC00 || second > 0xDFFF) {
            resultString = String.fromCharCode(first);
          } else {
            resultString = String.fromCharCode(first) + String.fromCharCode(second);
          }
        }
        o[toProperty(stringIteratorNextIndex)] = position + resultString.length;
        return createIteratorResultObject(resultString, false);
      },
      configurable: true,
      enumerable: true,
      writable: true
    }), Object.defineProperty($__2, Symbol.iterator, {
      value: function() {
        return this;
      },
      configurable: true,
      enumerable: true,
      writable: true
    }), $__2), {});
  }());
  function createStringIterator(string) {
    var s = String(string);
    var iterator = Object.create(StringIterator.prototype);
    iterator[toProperty(iteratedString)] = s;
    iterator[toProperty(stringIteratorNextIndex)] = 0;
    return iterator;
  }
  return {get createStringIterator() {
      return createStringIterator;
    }};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/String.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/String.js";
  var createStringIterator = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/StringIterator.js").createStringIterator;
  var $__1 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      maybeAddFunctions = $__1.maybeAddFunctions,
      maybeAddIterator = $__1.maybeAddIterator,
      registerPolyfill = $__1.registerPolyfill;
  var $toString = Object.prototype.toString;
  var $indexOf = String.prototype.indexOf;
  var $lastIndexOf = String.prototype.lastIndexOf;
  function startsWith(search) {
    var string = String(this);
    if (this == null || $toString.call(search) == '[object RegExp]') {
      throw TypeError();
    }
    var stringLength = string.length;
    var searchString = String(search);
    var searchLength = searchString.length;
    var position = arguments.length > 1 ? arguments[1] : undefined;
    var pos = position ? Number(position) : 0;
    if (isNaN(pos)) {
      pos = 0;
    }
    var start = Math.min(Math.max(pos, 0), stringLength);
    return $indexOf.call(string, searchString, pos) == start;
  }
  function endsWith(search) {
    var string = String(this);
    if (this == null || $toString.call(search) == '[object RegExp]') {
      throw TypeError();
    }
    var stringLength = string.length;
    var searchString = String(search);
    var searchLength = searchString.length;
    var pos = stringLength;
    if (arguments.length > 1) {
      var position = arguments[1];
      if (position !== undefined) {
        pos = position ? Number(position) : 0;
        if (isNaN(pos)) {
          pos = 0;
        }
      }
    }
    var end = Math.min(Math.max(pos, 0), stringLength);
    var start = end - searchLength;
    if (start < 0) {
      return false;
    }
    return $lastIndexOf.call(string, searchString, start) == start;
  }
  function includes(search) {
    if (this == null) {
      throw TypeError();
    }
    var string = String(this);
    if (search && $toString.call(search) == '[object RegExp]') {
      throw TypeError();
    }
    var stringLength = string.length;
    var searchString = String(search);
    var searchLength = searchString.length;
    var position = arguments.length > 1 ? arguments[1] : undefined;
    var pos = position ? Number(position) : 0;
    if (pos != pos) {
      pos = 0;
    }
    var start = Math.min(Math.max(pos, 0), stringLength);
    if (searchLength + start > stringLength) {
      return false;
    }
    return $indexOf.call(string, searchString, pos) != -1;
  }
  function repeat(count) {
    if (this == null) {
      throw TypeError();
    }
    var string = String(this);
    var n = count ? Number(count) : 0;
    if (isNaN(n)) {
      n = 0;
    }
    if (n < 0 || n == Infinity) {
      throw RangeError();
    }
    if (n == 0) {
      return '';
    }
    var result = '';
    while (n--) {
      result += string;
    }
    return result;
  }
  function codePointAt(position) {
    if (this == null) {
      throw TypeError();
    }
    var string = String(this);
    var size = string.length;
    var index = position ? Number(position) : 0;
    if (isNaN(index)) {
      index = 0;
    }
    if (index < 0 || index >= size) {
      return undefined;
    }
    var first = string.charCodeAt(index);
    var second;
    if (first >= 0xD800 && first <= 0xDBFF && size > index + 1) {
      second = string.charCodeAt(index + 1);
      if (second >= 0xDC00 && second <= 0xDFFF) {
        return (first - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
      }
    }
    return first;
  }
  function raw(callsite) {
    var raw = callsite.raw;
    var len = raw.length >>> 0;
    if (len === 0)
      return '';
    var s = '';
    var i = 0;
    while (true) {
      s += raw[i];
      if (i + 1 === len)
        return s;
      s += arguments[++i];
    }
  }
  function fromCodePoint(_) {
    var codeUnits = [];
    var floor = Math.floor;
    var highSurrogate;
    var lowSurrogate;
    var index = -1;
    var length = arguments.length;
    if (!length) {
      return '';
    }
    while (++index < length) {
      var codePoint = Number(arguments[index]);
      if (!isFinite(codePoint) || codePoint < 0 || codePoint > 0x10FFFF || floor(codePoint) != codePoint) {
        throw RangeError('Invalid code point: ' + codePoint);
      }
      if (codePoint <= 0xFFFF) {
        codeUnits.push(codePoint);
      } else {
        codePoint -= 0x10000;
        highSurrogate = (codePoint >> 10) + 0xD800;
        lowSurrogate = (codePoint % 0x400) + 0xDC00;
        codeUnits.push(highSurrogate, lowSurrogate);
      }
    }
    return String.fromCharCode.apply(null, codeUnits);
  }
  function stringPrototypeIterator() {
    var o = $traceurRuntime.checkObjectCoercible(this);
    var s = String(o);
    return createStringIterator(s);
  }
  function polyfillString(global) {
    var String = global.String;
    maybeAddFunctions(String.prototype, ['codePointAt', codePointAt, 'endsWith', endsWith, 'includes', includes, 'repeat', repeat, 'startsWith', startsWith]);
    maybeAddFunctions(String, ['fromCodePoint', fromCodePoint, 'raw', raw]);
    maybeAddIterator(String.prototype, stringPrototypeIterator, Symbol);
  }
  registerPolyfill(polyfillString);
  return {
    get startsWith() {
      return startsWith;
    },
    get endsWith() {
      return endsWith;
    },
    get includes() {
      return includes;
    },
    get repeat() {
      return repeat;
    },
    get codePointAt() {
      return codePointAt;
    },
    get raw() {
      return raw;
    },
    get fromCodePoint() {
      return fromCodePoint;
    },
    get stringPrototypeIterator() {
      return stringPrototypeIterator;
    },
    get polyfillString() {
      return polyfillString;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/String.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/ArrayIterator.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/ArrayIterator.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      toObject = $__0.toObject,
      toUint32 = $__0.toUint32,
      createIteratorResultObject = $__0.createIteratorResultObject;
  var ARRAY_ITERATOR_KIND_KEYS = 1;
  var ARRAY_ITERATOR_KIND_VALUES = 2;
  var ARRAY_ITERATOR_KIND_ENTRIES = 3;
  var ArrayIterator = (function() {
    var $__2;
    function ArrayIterator() {}
    return ($traceurRuntime.createClass)(ArrayIterator, ($__2 = {}, Object.defineProperty($__2, "next", {
      value: function() {
        var iterator = toObject(this);
        var array = iterator.iteratorObject_;
        if (!array) {
          throw new TypeError('Object is not an ArrayIterator');
        }
        var index = iterator.arrayIteratorNextIndex_;
        var itemKind = iterator.arrayIterationKind_;
        var length = toUint32(array.length);
        if (index >= length) {
          iterator.arrayIteratorNextIndex_ = Infinity;
          return createIteratorResultObject(undefined, true);
        }
        iterator.arrayIteratorNextIndex_ = index + 1;
        if (itemKind == ARRAY_ITERATOR_KIND_VALUES)
          return createIteratorResultObject(array[index], false);
        if (itemKind == ARRAY_ITERATOR_KIND_ENTRIES)
          return createIteratorResultObject([index, array[index]], false);
        return createIteratorResultObject(index, false);
      },
      configurable: true,
      enumerable: true,
      writable: true
    }), Object.defineProperty($__2, Symbol.iterator, {
      value: function() {
        return this;
      },
      configurable: true,
      enumerable: true,
      writable: true
    }), $__2), {});
  }());
  function createArrayIterator(array, kind) {
    var object = toObject(array);
    var iterator = new ArrayIterator;
    iterator.iteratorObject_ = object;
    iterator.arrayIteratorNextIndex_ = 0;
    iterator.arrayIterationKind_ = kind;
    return iterator;
  }
  function entries() {
    return createArrayIterator(this, ARRAY_ITERATOR_KIND_ENTRIES);
  }
  function keys() {
    return createArrayIterator(this, ARRAY_ITERATOR_KIND_KEYS);
  }
  function values() {
    return createArrayIterator(this, ARRAY_ITERATOR_KIND_VALUES);
  }
  return {
    get entries() {
      return entries;
    },
    get keys() {
      return keys;
    },
    get values() {
      return values;
    }
  };
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Array.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Array.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/ArrayIterator.js"),
      entries = $__0.entries,
      keys = $__0.keys,
      jsValues = $__0.values;
  var $__1 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      checkIterable = $__1.checkIterable,
      isCallable = $__1.isCallable,
      isConstructor = $__1.isConstructor,
      maybeAddFunctions = $__1.maybeAddFunctions,
      maybeAddIterator = $__1.maybeAddIterator,
      registerPolyfill = $__1.registerPolyfill,
      toInteger = $__1.toInteger,
      toLength = $__1.toLength,
      toObject = $__1.toObject;
  function from(arrLike) {
    var mapFn = arguments[1];
    var thisArg = arguments[2];
    var C = this;
    var items = toObject(arrLike);
    var mapping = mapFn !== undefined;
    var k = 0;
    var arr,
        len;
    if (mapping && !isCallable(mapFn)) {
      throw TypeError();
    }
    if (checkIterable(items)) {
      arr = isConstructor(C) ? new C() : [];
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (items)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var item = $__3.value;
          {
            if (mapping) {
              arr[k] = mapFn.call(thisArg, item, k);
            } else {
              arr[k] = item;
            }
            k++;
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
      arr.length = k;
      return arr;
    }
    len = toLength(items.length);
    arr = isConstructor(C) ? new C(len) : new Array(len);
    for (; k < len; k++) {
      if (mapping) {
        arr[k] = typeof thisArg === 'undefined' ? mapFn(items[k], k) : mapFn.call(thisArg, items[k], k);
      } else {
        arr[k] = items[k];
      }
    }
    arr.length = len;
    return arr;
  }
  function of() {
    for (var items = [],
        $__9 = 0; $__9 < arguments.length; $__9++)
      items[$__9] = arguments[$__9];
    var C = this;
    var len = items.length;
    var arr = isConstructor(C) ? new C(len) : new Array(len);
    for (var k = 0; k < len; k++) {
      arr[k] = items[k];
    }
    arr.length = len;
    return arr;
  }
  function fill(value) {
    var start = arguments[1] !== (void 0) ? arguments[1] : 0;
    var end = arguments[2];
    var object = toObject(this);
    var len = toLength(object.length);
    var fillStart = toInteger(start);
    var fillEnd = end !== undefined ? toInteger(end) : len;
    fillStart = fillStart < 0 ? Math.max(len + fillStart, 0) : Math.min(fillStart, len);
    fillEnd = fillEnd < 0 ? Math.max(len + fillEnd, 0) : Math.min(fillEnd, len);
    while (fillStart < fillEnd) {
      object[fillStart] = value;
      fillStart++;
    }
    return object;
  }
  function find(predicate) {
    var thisArg = arguments[1];
    return findHelper(this, predicate, thisArg);
  }
  function findIndex(predicate) {
    var thisArg = arguments[1];
    return findHelper(this, predicate, thisArg, true);
  }
  function findHelper(self, predicate) {
    var thisArg = arguments[2];
    var returnIndex = arguments[3] !== (void 0) ? arguments[3] : false;
    var object = toObject(self);
    var len = toLength(object.length);
    if (!isCallable(predicate)) {
      throw TypeError();
    }
    for (var i = 0; i < len; i++) {
      var value = object[i];
      if (predicate.call(thisArg, value, i, object)) {
        return returnIndex ? i : value;
      }
    }
    return returnIndex ? -1 : undefined;
  }
  function polyfillArray(global) {
    var $__10 = global,
        Array = $__10.Array,
        Object = $__10.Object,
        Symbol = $__10.Symbol;
    var values = jsValues;
    if (Symbol && Symbol.iterator && Array.prototype[Symbol.iterator]) {
      values = Array.prototype[Symbol.iterator];
    }
    maybeAddFunctions(Array.prototype, ['entries', entries, 'keys', keys, 'values', values, 'fill', fill, 'find', find, 'findIndex', findIndex]);
    maybeAddFunctions(Array, ['from', from, 'of', of]);
    maybeAddIterator(Array.prototype, values, Symbol);
    maybeAddIterator(Object.getPrototypeOf([].values()), function() {
      return this;
    }, Symbol);
  }
  registerPolyfill(polyfillArray);
  return {
    get from() {
      return from;
    },
    get of() {
      return of;
    },
    get fill() {
      return fill;
    },
    get find() {
      return find;
    },
    get findIndex() {
      return findIndex;
    },
    get polyfillArray() {
      return polyfillArray;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Array.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Object.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Object.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      maybeAddFunctions = $__0.maybeAddFunctions,
      registerPolyfill = $__0.registerPolyfill;
  var $__1 = $traceurRuntime,
      defineProperty = $__1.defineProperty,
      getOwnPropertyDescriptor = $__1.getOwnPropertyDescriptor,
      getOwnPropertyNames = $__1.getOwnPropertyNames,
      isPrivateName = $__1.isPrivateName,
      keys = $__1.keys;
  function is(left, right) {
    if (left === right)
      return left !== 0 || 1 / left === 1 / right;
    return left !== left && right !== right;
  }
  function assign(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      var props = source == null ? [] : keys(source);
      var p = void 0,
          length = props.length;
      for (p = 0; p < length; p++) {
        var name = props[p];
        if (isPrivateName(name))
          continue;
        target[name] = source[name];
      }
    }
    return target;
  }
  function mixin(target, source) {
    var props = getOwnPropertyNames(source);
    var p,
        descriptor,
        length = props.length;
    for (p = 0; p < length; p++) {
      var name = props[p];
      if (isPrivateName(name))
        continue;
      descriptor = getOwnPropertyDescriptor(source, props[p]);
      defineProperty(target, props[p], descriptor);
    }
    return target;
  }
  function polyfillObject(global) {
    var Object = global.Object;
    maybeAddFunctions(Object, ['assign', assign, 'is', is, 'mixin', mixin]);
  }
  registerPolyfill(polyfillObject);
  return {
    get is() {
      return is;
    },
    get assign() {
      return assign;
    },
    get mixin() {
      return mixin;
    },
    get polyfillObject() {
      return polyfillObject;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Object.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Number.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Number.js";
  var $__0 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      isNumber = $__0.isNumber,
      maybeAddConsts = $__0.maybeAddConsts,
      maybeAddFunctions = $__0.maybeAddFunctions,
      registerPolyfill = $__0.registerPolyfill,
      toInteger = $__0.toInteger;
  var $abs = Math.abs;
  var $isFinite = isFinite;
  var $isNaN = isNaN;
  var MAX_SAFE_INTEGER = Math.pow(2, 53) - 1;
  var MIN_SAFE_INTEGER = -Math.pow(2, 53) + 1;
  var EPSILON = Math.pow(2, -52);
  function NumberIsFinite(number) {
    return isNumber(number) && $isFinite(number);
  }
  function isInteger(number) {
    return NumberIsFinite(number) && toInteger(number) === number;
  }
  function NumberIsNaN(number) {
    return isNumber(number) && $isNaN(number);
  }
  function isSafeInteger(number) {
    if (NumberIsFinite(number)) {
      var integral = toInteger(number);
      if (integral === number)
        return $abs(integral) <= MAX_SAFE_INTEGER;
    }
    return false;
  }
  function polyfillNumber(global) {
    var Number = global.Number;
    maybeAddConsts(Number, ['MAX_SAFE_INTEGER', MAX_SAFE_INTEGER, 'MIN_SAFE_INTEGER', MIN_SAFE_INTEGER, 'EPSILON', EPSILON]);
    maybeAddFunctions(Number, ['isFinite', NumberIsFinite, 'isInteger', isInteger, 'isNaN', NumberIsNaN, 'isSafeInteger', isSafeInteger]);
  }
  registerPolyfill(polyfillNumber);
  return {
    get MAX_SAFE_INTEGER() {
      return MAX_SAFE_INTEGER;
    },
    get MIN_SAFE_INTEGER() {
      return MIN_SAFE_INTEGER;
    },
    get EPSILON() {
      return EPSILON;
    },
    get isFinite() {
      return NumberIsFinite;
    },
    get isInteger() {
      return isInteger;
    },
    get isNaN() {
      return NumberIsNaN;
    },
    get isSafeInteger() {
      return isSafeInteger;
    },
    get polyfillNumber() {
      return polyfillNumber;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Number.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/fround.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/fround.js";
  var $isFinite = isFinite;
  var $isNaN = isNaN;
  var $__0 = Math,
      LN2 = $__0.LN2,
      abs = $__0.abs,
      floor = $__0.floor,
      log = $__0.log,
      min = $__0.min,
      pow = $__0.pow;
  function packIEEE754(v, ebits, fbits) {
    var bias = (1 << (ebits - 1)) - 1,
        s,
        e,
        f,
        ln,
        i,
        bits,
        str,
        bytes;
    function roundToEven(n) {
      var w = floor(n),
          f = n - w;
      if (f < 0.5)
        return w;
      if (f > 0.5)
        return w + 1;
      return w % 2 ? w + 1 : w;
    }
    if (v !== v) {
      e = (1 << ebits) - 1;
      f = pow(2, fbits - 1);
      s = 0;
    } else if (v === Infinity || v === -Infinity) {
      e = (1 << ebits) - 1;
      f = 0;
      s = (v < 0) ? 1 : 0;
    } else if (v === 0) {
      e = 0;
      f = 0;
      s = (1 / v === -Infinity) ? 1 : 0;
    } else {
      s = v < 0;
      v = abs(v);
      if (v >= pow(2, 1 - bias)) {
        e = min(floor(log(v) / LN2), 1023);
        f = roundToEven(v / pow(2, e) * pow(2, fbits));
        if (f / pow(2, fbits) >= 2) {
          e = e + 1;
          f = 1;
        }
        if (e > bias) {
          e = (1 << ebits) - 1;
          f = 0;
        } else {
          e = e + bias;
          f = f - pow(2, fbits);
        }
      } else {
        e = 0;
        f = roundToEven(v / pow(2, 1 - bias - fbits));
      }
    }
    bits = [];
    for (i = fbits; i; i -= 1) {
      bits.push(f % 2 ? 1 : 0);
      f = floor(f / 2);
    }
    for (i = ebits; i; i -= 1) {
      bits.push(e % 2 ? 1 : 0);
      e = floor(e / 2);
    }
    bits.push(s ? 1 : 0);
    bits.reverse();
    str = bits.join('');
    bytes = [];
    while (str.length) {
      bytes.push(parseInt(str.substring(0, 8), 2));
      str = str.substring(8);
    }
    return bytes;
  }
  function unpackIEEE754(bytes, ebits, fbits) {
    var bits = [],
        i,
        j,
        b,
        str,
        bias,
        s,
        e,
        f;
    for (i = bytes.length; i; i -= 1) {
      b = bytes[i - 1];
      for (j = 8; j; j -= 1) {
        bits.push(b % 2 ? 1 : 0);
        b = b >> 1;
      }
    }
    bits.reverse();
    str = bits.join('');
    bias = (1 << (ebits - 1)) - 1;
    s = parseInt(str.substring(0, 1), 2) ? -1 : 1;
    e = parseInt(str.substring(1, 1 + ebits), 2);
    f = parseInt(str.substring(1 + ebits), 2);
    if (e === (1 << ebits) - 1) {
      return f !== 0 ? NaN : s * Infinity;
    } else if (e > 0) {
      return s * pow(2, e - bias) * (1 + f / pow(2, fbits));
    } else if (f !== 0) {
      return s * pow(2, -(bias - 1)) * (f / pow(2, fbits));
    } else {
      return s < 0 ? -0 : 0;
    }
  }
  function unpackF32(b) {
    return unpackIEEE754(b, 8, 23);
  }
  function packF32(v) {
    return packIEEE754(v, 8, 23);
  }
  function fround(x) {
    if (x === 0 || !$isFinite(x) || $isNaN(x)) {
      return x;
    }
    return unpackF32(packF32(Number(x)));
  }
  return {get fround() {
      return fround;
    }};
});
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/Math.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/Math.js";
  var jsFround = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/fround.js").fround;
  var $__1 = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js"),
      maybeAddFunctions = $__1.maybeAddFunctions,
      registerPolyfill = $__1.registerPolyfill,
      toUint32 = $__1.toUint32;
  var $isFinite = isFinite;
  var $isNaN = isNaN;
  var $__2 = Math,
      abs = $__2.abs,
      ceil = $__2.ceil,
      exp = $__2.exp,
      floor = $__2.floor,
      log = $__2.log,
      pow = $__2.pow,
      sqrt = $__2.sqrt;
  function clz32(x) {
    x = toUint32(+x);
    if (x == 0)
      return 32;
    var result = 0;
    if ((x & 0xFFFF0000) === 0) {
      x <<= 16;
      result += 16;
    }
    ;
    if ((x & 0xFF000000) === 0) {
      x <<= 8;
      result += 8;
    }
    ;
    if ((x & 0xF0000000) === 0) {
      x <<= 4;
      result += 4;
    }
    ;
    if ((x & 0xC0000000) === 0) {
      x <<= 2;
      result += 2;
    }
    ;
    if ((x & 0x80000000) === 0) {
      x <<= 1;
      result += 1;
    }
    ;
    return result;
  }
  function imul(x, y) {
    x = toUint32(+x);
    y = toUint32(+y);
    var xh = (x >>> 16) & 0xffff;
    var xl = x & 0xffff;
    var yh = (y >>> 16) & 0xffff;
    var yl = y & 0xffff;
    return xl * yl + (((xh * yl + xl * yh) << 16) >>> 0) | 0;
  }
  function sign(x) {
    x = +x;
    if (x > 0)
      return 1;
    if (x < 0)
      return -1;
    return x;
  }
  function log10(x) {
    return log(x) * 0.434294481903251828;
  }
  function log2(x) {
    return log(x) * 1.442695040888963407;
  }
  function log1p(x) {
    x = +x;
    if (x < -1 || $isNaN(x)) {
      return NaN;
    }
    if (x === 0 || x === Infinity) {
      return x;
    }
    if (x === -1) {
      return -Infinity;
    }
    var result = 0;
    var n = 50;
    if (x < 0 || x > 1) {
      return log(1 + x);
    }
    for (var i = 1; i < n; i++) {
      if ((i % 2) === 0) {
        result -= pow(x, i) / i;
      } else {
        result += pow(x, i) / i;
      }
    }
    return result;
  }
  function expm1(x) {
    x = +x;
    if (x === -Infinity) {
      return -1;
    }
    if (!$isFinite(x) || x === 0) {
      return x;
    }
    return exp(x) - 1;
  }
  function cosh(x) {
    x = +x;
    if (x === 0) {
      return 1;
    }
    if ($isNaN(x)) {
      return NaN;
    }
    if (!$isFinite(x)) {
      return Infinity;
    }
    if (x < 0) {
      x = -x;
    }
    if (x > 21) {
      return exp(x) / 2;
    }
    return (exp(x) + exp(-x)) / 2;
  }
  function sinh(x) {
    x = +x;
    if (!$isFinite(x) || x === 0) {
      return x;
    }
    return (exp(x) - exp(-x)) / 2;
  }
  function tanh(x) {
    x = +x;
    if (x === 0)
      return x;
    if (!$isFinite(x))
      return sign(x);
    var exp1 = exp(x);
    var exp2 = exp(-x);
    return (exp1 - exp2) / (exp1 + exp2);
  }
  function acosh(x) {
    x = +x;
    if (x < 1)
      return NaN;
    if (!$isFinite(x))
      return x;
    return log(x + sqrt(x + 1) * sqrt(x - 1));
  }
  function asinh(x) {
    x = +x;
    if (x === 0 || !$isFinite(x))
      return x;
    if (x > 0)
      return log(x + sqrt(x * x + 1));
    return -log(-x + sqrt(x * x + 1));
  }
  function atanh(x) {
    x = +x;
    if (x === -1) {
      return -Infinity;
    }
    if (x === 1) {
      return Infinity;
    }
    if (x === 0) {
      return x;
    }
    if ($isNaN(x) || x < -1 || x > 1) {
      return NaN;
    }
    return 0.5 * log((1 + x) / (1 - x));
  }
  function hypot(x, y) {
    var length = arguments.length;
    var args = new Array(length);
    var max = 0;
    for (var i = 0; i < length; i++) {
      var n = arguments[i];
      n = +n;
      if (n === Infinity || n === -Infinity)
        return Infinity;
      n = abs(n);
      if (n > max)
        max = n;
      args[i] = n;
    }
    if (max === 0)
      max = 1;
    var sum = 0;
    var compensation = 0;
    for (var i = 0; i < length; i++) {
      var n = args[i] / max;
      var summand = n * n - compensation;
      var preliminary = sum + summand;
      compensation = (preliminary - sum) - summand;
      sum = preliminary;
    }
    return sqrt(sum) * max;
  }
  function trunc(x) {
    x = +x;
    if (x > 0)
      return floor(x);
    if (x < 0)
      return ceil(x);
    return x;
  }
  var fround,
      f32;
  if (typeof Float32Array === 'function') {
    f32 = new Float32Array(1);
    fround = function(x) {
      f32[0] = Number(x);
      return f32[0];
    };
  } else {
    fround = jsFround;
  }
  function cbrt(x) {
    x = +x;
    if (x === 0)
      return x;
    var negate = x < 0;
    if (negate)
      x = -x;
    var result = pow(x, 1 / 3);
    return negate ? -result : result;
  }
  function polyfillMath(global) {
    var Math = global.Math;
    maybeAddFunctions(Math, ['acosh', acosh, 'asinh', asinh, 'atanh', atanh, 'cbrt', cbrt, 'clz32', clz32, 'cosh', cosh, 'expm1', expm1, 'fround', fround, 'hypot', hypot, 'imul', imul, 'log10', log10, 'log1p', log1p, 'log2', log2, 'sign', sign, 'sinh', sinh, 'tanh', tanh, 'trunc', trunc]);
  }
  registerPolyfill(polyfillMath);
  return {
    get clz32() {
      return clz32;
    },
    get imul() {
      return imul;
    },
    get sign() {
      return sign;
    },
    get log10() {
      return log10;
    },
    get log2() {
      return log2;
    },
    get log1p() {
      return log1p;
    },
    get expm1() {
      return expm1;
    },
    get cosh() {
      return cosh;
    },
    get sinh() {
      return sinh;
    },
    get tanh() {
      return tanh;
    },
    get acosh() {
      return acosh;
    },
    get asinh() {
      return asinh;
    },
    get atanh() {
      return atanh;
    },
    get hypot() {
      return hypot;
    },
    get trunc() {
      return trunc;
    },
    get fround() {
      return fround;
    },
    get cbrt() {
      return cbrt;
    },
    get polyfillMath() {
      return polyfillMath;
    }
  };
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/Math.js" + '');
System.registerModule("traceur-runtime@0.0.88/src/runtime/polyfills/polyfills.js", [], function() {
  "use strict";
  var __moduleName = "traceur-runtime@0.0.88/src/runtime/polyfills/polyfills.js";
  var polyfillAll = System.get("traceur-runtime@0.0.88/src/runtime/polyfills/utils.js").polyfillAll;
  polyfillAll(Reflect.global);
  var setupGlobals = $traceurRuntime.setupGlobals;
  $traceurRuntime.setupGlobals = function(global) {
    setupGlobals(global);
    polyfillAll(global);
  };
  return {};
});
System.get("traceur-runtime@0.0.88/src/runtime/polyfills/polyfills.js" + '');

(function(global) {

  var defined = {};

  // indexOf polyfill for IE8
  var indexOf = Array.prototype.indexOf || function(item) {
    for (var i = 0, l = this.length; i < l; i++)
      if (this[i] === item)
        return i;
    return -1;
  }

  function dedupe(deps) {
    var newDeps = [];
    for (var i = 0, l = deps.length; i < l; i++)
      if (indexOf.call(newDeps, deps[i]) == -1)
        newDeps.push(deps[i])
    return newDeps;
  }

  function register(name, deps, declare, execute) {
    if (typeof name != 'string')
      throw "System.register provided no module name";

    var entry;

    // dynamic
    if (typeof declare == 'boolean') {
      entry = {
        declarative: false,
        deps: deps,
        execute: execute,
        executingRequire: declare
      };
    }
    else {
      // ES6 declarative
      entry = {
        declarative: true,
        deps: deps,
        declare: declare
      };
    }

    entry.name = name;

    // we never overwrite an existing define
    if (!(name in defined))
      defined[name] = entry; 

    entry.deps = dedupe(entry.deps);

    // we have to normalize dependencies
    // (assume dependencies are normalized for now)
    // entry.normalizedDeps = entry.deps.map(normalize);
    entry.normalizedDeps = entry.deps;
  }

  function buildGroups(entry, groups) {
    groups[entry.groupIndex] = groups[entry.groupIndex] || [];

    if (indexOf.call(groups[entry.groupIndex], entry) != -1)
      return;

    groups[entry.groupIndex].push(entry);

    for (var i = 0, l = entry.normalizedDeps.length; i < l; i++) {
      var depName = entry.normalizedDeps[i];
      var depEntry = defined[depName];

      // not in the registry means already linked / ES6
      if (!depEntry || depEntry.evaluated)
        continue;

      // now we know the entry is in our unlinked linkage group
      var depGroupIndex = entry.groupIndex + (depEntry.declarative != entry.declarative);

      // the group index of an entry is always the maximum
      if (depEntry.groupIndex === undefined || depEntry.groupIndex < depGroupIndex) {

        // if already in a group, remove from the old group
        if (depEntry.groupIndex !== undefined) {
          groups[depEntry.groupIndex].splice(indexOf.call(groups[depEntry.groupIndex], depEntry), 1);

          // if the old group is empty, then we have a mixed depndency cycle
          if (groups[depEntry.groupIndex].length == 0)
            throw new TypeError("Mixed dependency cycle detected");
        }

        depEntry.groupIndex = depGroupIndex;
      }

      buildGroups(depEntry, groups);
    }
  }

  function link(name) {
    var startEntry = defined[name];

    startEntry.groupIndex = 0;

    var groups = [];

    buildGroups(startEntry, groups);

    var curGroupDeclarative = !!startEntry.declarative == groups.length % 2;
    for (var i = groups.length - 1; i >= 0; i--) {
      var group = groups[i];
      for (var j = 0; j < group.length; j++) {
        var entry = group[j];

        // link each group
        if (curGroupDeclarative)
          linkDeclarativeModule(entry);
        else
          linkDynamicModule(entry);
      }
      curGroupDeclarative = !curGroupDeclarative; 
    }
  }

  // module binding records
  var moduleRecords = {};
  function getOrCreateModuleRecord(name) {
    return moduleRecords[name] || (moduleRecords[name] = {
      name: name,
      dependencies: [],
      exports: {}, // start from an empty module and extend
      importers: []
    })
  }

  function linkDeclarativeModule(entry) {
    // only link if already not already started linking (stops at circular)
    if (entry.module)
      return;

    var module = entry.module = getOrCreateModuleRecord(entry.name);
    var exports = entry.module.exports;

    var declaration = entry.declare.call(global, function(name, value) {
      module.locked = true;
      exports[name] = value;

      for (var i = 0, l = module.importers.length; i < l; i++) {
        var importerModule = module.importers[i];
        if (!importerModule.locked) {
          var importerIndex = indexOf.call(importerModule.dependencies, module);
          importerModule.setters[importerIndex](exports);
        }
      }

      module.locked = false;
      return value;
    });

    module.setters = declaration.setters;
    module.execute = declaration.execute;

    if (!module.setters || !module.execute)
      throw new TypeError("Invalid System.register form for " + entry.name);

    // now link all the module dependencies
    for (var i = 0, l = entry.normalizedDeps.length; i < l; i++) {
      var depName = entry.normalizedDeps[i];
      var depEntry = defined[depName];
      var depModule = moduleRecords[depName];

      // work out how to set depExports based on scenarios...
      var depExports;

      if (depModule) {
        depExports = depModule.exports;
      }
      else if (depEntry && !depEntry.declarative) {
        if (depEntry.module.exports && depEntry.module.exports.__esModule)
          depExports = depEntry.module.exports;
        else
          depExports = { 'default': depEntry.module.exports, __useDefault: true };
      }
      // in the module registry
      else if (!depEntry) {
        depExports = load(depName);
      }
      // we have an entry -> link
      else {
        linkDeclarativeModule(depEntry);
        depModule = depEntry.module;
        depExports = depModule.exports;
      }

      // only declarative modules have dynamic bindings
      if (depModule && depModule.importers) {
        depModule.importers.push(module);
        module.dependencies.push(depModule);
      }
      else
        module.dependencies.push(null);

      // run the setter for this dependency
      if (module.setters[i])
        module.setters[i](depExports);
    }
  }

  // An analog to loader.get covering execution of all three layers (real declarative, simulated declarative, simulated dynamic)
  function getModule(name) {
    var exports;
    var entry = defined[name];

    if (!entry) {
      exports = load(name);
      if (!exports)
        throw new Error("Unable to load dependency " + name + ".");
    }

    else {
      if (entry.declarative)
        ensureEvaluated(name, []);

      else if (!entry.evaluated)
        linkDynamicModule(entry);

      exports = entry.module.exports;
    }

    if ((!entry || entry.declarative) && exports && exports.__useDefault)
      return exports['default'];

    return exports;
  }

  function linkDynamicModule(entry) {
    if (entry.module)
      return;

    var exports = {};

    var module = entry.module = { exports: exports, id: entry.name };

    // AMD requires execute the tree first
    if (!entry.executingRequire) {
      for (var i = 0, l = entry.normalizedDeps.length; i < l; i++) {
        var depName = entry.normalizedDeps[i];
        var depEntry = defined[depName];
        if (depEntry)
          linkDynamicModule(depEntry);
      }
    }

    // now execute
    entry.evaluated = true;
    var output = entry.execute.call(global, function(name) {
      for (var i = 0, l = entry.deps.length; i < l; i++) {
        if (entry.deps[i] != name)
          continue;
        return getModule(entry.normalizedDeps[i]);
      }
      throw new TypeError('Module ' + name + ' not declared as a dependency.');
    }, exports, module);

    if (output)
      module.exports = output;
  }

  /*
   * Given a module, and the list of modules for this current branch,
   *  ensure that each of the dependencies of this module is evaluated
   *  (unless one is a circular dependency already in the list of seen
   *  modules, in which case we execute it)
   *
   * Then we evaluate the module itself depth-first left to right 
   * execution to match ES6 modules
   */
  function ensureEvaluated(moduleName, seen) {
    var entry = defined[moduleName];

    // if already seen, that means it's an already-evaluated non circular dependency
    if (!entry || entry.evaluated || !entry.declarative)
      return;

    // this only applies to declarative modules which late-execute

    seen.push(moduleName);

    for (var i = 0, l = entry.normalizedDeps.length; i < l; i++) {
      var depName = entry.normalizedDeps[i];
      if (indexOf.call(seen, depName) == -1) {
        if (!defined[depName])
          load(depName);
        else
          ensureEvaluated(depName, seen);
      }
    }

    if (entry.evaluated)
      return;

    entry.evaluated = true;
    entry.module.execute.call(global);
  }

  // magical execution function
  var modules = {};
  function load(name) {
    if (modules[name])
      return modules[name];

    var entry = defined[name];

    // first we check if this module has already been defined in the registry
    if (!entry)
      throw "Module " + name + " not present.";

    // recursively ensure that the module and all its 
    // dependencies are linked (with dependency group handling)
    link(name);

    // now handle dependency execution in correct order
    ensureEvaluated(name, []);

    // remove from the registry
    defined[name] = undefined;

    var module = entry.module.exports;

    if (!module || !entry.declarative && module.__esModule !== true)
      module = { 'default': module, __useDefault: true };

    // return the defined module object
    return modules[name] = module;
  };

  return function(mains, declare) {

    var System;
    var System = {
      register: register, 
      get: load, 
      set: function(name, module) {
        modules[name] = module; 
      },
      newModule: function(module) {
        return module;
      },
      global: global 
    };
    System.set('@empty', {});

    declare(System);

    for (var i = 0; i < mains.length; i++)
      load(mains[i]);
  }

})(typeof window != 'undefined' ? window : global)
/* (['mainModule'], function(System) {
  System.register(...);
}); */

(['main'], function(System) {

System.register("npm:eventemitter3@1.1.0/index", [], true, function(require, exports, module) {
  var global = System.global,
      __define = global.define;
  global.define = undefined;
  'use strict';
  var prefix = typeof Object.create !== 'function' ? '~' : false;
  function EE(fn, context, once) {
    this.fn = fn;
    this.context = context;
    this.once = once || false;
  }
  function EventEmitter() {}
  EventEmitter.prototype._events = undefined;
  EventEmitter.prototype.listeners = function listeners(event, exists) {
    var evt = prefix ? prefix + event : event,
        available = this._events && this._events[evt];
    if (exists)
      return !!available;
    if (!available)
      return [];
    if (this._events[evt].fn)
      return [this._events[evt].fn];
    for (var i = 0,
        l = this._events[evt].length,
        ee = new Array(l); i < l; i++) {
      ee[i] = this._events[evt][i].fn;
    }
    return ee;
  };
  EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {
    var evt = prefix ? prefix + event : event;
    if (!this._events || !this._events[evt])
      return false;
    var listeners = this._events[evt],
        len = arguments.length,
        args,
        i;
    if ('function' === typeof listeners.fn) {
      if (listeners.once)
        this.removeListener(event, listeners.fn, undefined, true);
      switch (len) {
        case 1:
          return listeners.fn.call(listeners.context), true;
        case 2:
          return listeners.fn.call(listeners.context, a1), true;
        case 3:
          return listeners.fn.call(listeners.context, a1, a2), true;
        case 4:
          return listeners.fn.call(listeners.context, a1, a2, a3), true;
        case 5:
          return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;
        case 6:
          return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;
      }
      for (i = 1, args = new Array(len - 1); i < len; i++) {
        args[i - 1] = arguments[i];
      }
      listeners.fn.apply(listeners.context, args);
    } else {
      var length = listeners.length,
          j;
      for (i = 0; i < length; i++) {
        if (listeners[i].once)
          this.removeListener(event, listeners[i].fn, undefined, true);
        switch (len) {
          case 1:
            listeners[i].fn.call(listeners[i].context);
            break;
          case 2:
            listeners[i].fn.call(listeners[i].context, a1);
            break;
          case 3:
            listeners[i].fn.call(listeners[i].context, a1, a2);
            break;
          default:
            if (!args)
              for (j = 1, args = new Array(len - 1); j < len; j++) {
                args[j - 1] = arguments[j];
              }
            listeners[i].fn.apply(listeners[i].context, args);
        }
      }
    }
    return true;
  };
  EventEmitter.prototype.on = function on(event, fn, context) {
    var listener = new EE(fn, context || this),
        evt = prefix ? prefix + event : event;
    if (!this._events)
      this._events = prefix ? {} : Object.create(null);
    if (!this._events[evt])
      this._events[evt] = listener;
    else {
      if (!this._events[evt].fn)
        this._events[evt].push(listener);
      else
        this._events[evt] = [this._events[evt], listener];
    }
    return this;
  };
  EventEmitter.prototype.once = function once(event, fn, context) {
    var listener = new EE(fn, context || this, true),
        evt = prefix ? prefix + event : event;
    if (!this._events)
      this._events = prefix ? {} : Object.create(null);
    if (!this._events[evt])
      this._events[evt] = listener;
    else {
      if (!this._events[evt].fn)
        this._events[evt].push(listener);
      else
        this._events[evt] = [this._events[evt], listener];
    }
    return this;
  };
  EventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {
    var evt = prefix ? prefix + event : event;
    if (!this._events || !this._events[evt])
      return this;
    var listeners = this._events[evt],
        events = [];
    if (fn) {
      if (listeners.fn) {
        if (listeners.fn !== fn || (once && !listeners.once) || (context && listeners.context !== context)) {
          events.push(listeners);
        }
      } else {
        for (var i = 0,
            length = listeners.length; i < length; i++) {
          if (listeners[i].fn !== fn || (once && !listeners[i].once) || (context && listeners[i].context !== context)) {
            events.push(listeners[i]);
          }
        }
      }
    }
    if (events.length) {
      this._events[evt] = events.length === 1 ? events[0] : events;
    } else {
      delete this._events[evt];
    }
    return this;
  };
  EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {
    if (!this._events)
      return this;
    if (event)
      delete this._events[prefix ? prefix + event : event];
    else
      this._events = prefix ? {} : Object.create(null);
    return this;
  };
  EventEmitter.prototype.off = EventEmitter.prototype.removeListener;
  EventEmitter.prototype.addListener = EventEmitter.prototype.on;
  EventEmitter.prototype.setMaxListeners = function setMaxListeners() {
    return this;
  };
  EventEmitter.prefixed = prefix;
  module.exports = EventEmitter;
  global.define = __define;
  return module.exports;
});

System.register("worker.js!base64", [], true, function(require, exports, module) {
  var global = System.global,
      __define = global.define;
  global.define = undefined;
  module.exports = "LyogKi8KImZvcm1hdCBnbG9iYWwiOwoiZXhwb3J0cyAkdHJhY2V1clJ1bnRpbWUiOwoKZ2xvYmFsID0gIHRoaXM7CgooZnVuY3Rpb24oZ2xvYmFsKSB7CiAgJ3VzZSBzdHJpY3QnOwogIGlmIChnbG9iYWwuJHRyYWNldXJSdW50aW1lKSB7CiAgICByZXR1cm4gOwogIH0KICB2YXIgJE9iamVjdCA9IE9iamVjdDsKICB2YXIgJFR5cGVFcnJvciA9IFR5cGVFcnJvcjsKICB2YXIgJGNyZWF0ZSA9ICRPYmplY3QuY3JlYXRlOwogIHZhciAkZGVmaW5lUHJvcGVydGllcyA9ICRPYmplY3QuZGVmaW5lUHJvcGVydGllczsKICB2YXIgJGRlZmluZVByb3BlcnR5ID0gJE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICB2YXIgJGZyZWV6ZSA9ICRPYmplY3QuZnJlZXplOwogIHZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gJE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgdmFyICRnZXRPd25Qcm9wZXJ0eU5hbWVzID0gJE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwogIHZhciAka2V5cyA9ICRPYmplY3Qua2V5czsKICB2YXIgJGhhc093blByb3BlcnR5ID0gJE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgdmFyICR0b1N0cmluZyA9ICRPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogIHZhciAkcHJldmVudEV4dGVuc2lvbnMgPSBPYmplY3QucHJldmVudEV4dGVuc2lvbnM7CiAgdmFyICRzZWFsID0gT2JqZWN0LnNlYWw7CiAgdmFyICRpc0V4dGVuc2libGUgPSBPYmplY3QuaXNFeHRlbnNpYmxlOwogIHZhciAkYXBwbHkgPSBGdW5jdGlvbi5wcm90b3R5cGUuY2FsbC5iaW5kKEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseSk7CiAgZnVuY3Rpb24gJGJpbmQob3BlcmFuZCwgdGhpc0FyZywgYXJncykgewogICAgdmFyIGFyZ0FycmF5ID0gW3RoaXNBcmddOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFyZ0FycmF5W2kgKyAxXSA9IGFyZ3NbaV07CiAgICB9CiAgICB2YXIgZnVuYyA9ICRhcHBseShGdW5jdGlvbi5wcm90b3R5cGUuYmluZCwgb3BlcmFuZCwgYXJnQXJyYXkpOwogICAgcmV0dXJuIGZ1bmM7CiAgfQogIGZ1bmN0aW9uICRjb25zdHJ1Y3QoZnVuYywgYXJnQXJyYXkpIHsKICAgIHZhciBvYmplY3QgPSBuZXcgKCRiaW5kKGZ1bmMsIG51bGwsIGFyZ0FycmF5KSk7CiAgICByZXR1cm4gb2JqZWN0OwogIH0KICB2YXIgY291bnRlciA9IDA7CiAgZnVuY3Rpb24gbmV3VW5pcXVlU3RyaW5nKCkgewogICAgcmV0dXJuICdfXyQnICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMWU5KSArICckJyArICsrY291bnRlciArICckX18nOwogIH0KICB2YXIgcHJpdmF0ZU5hbWVzID0gJGNyZWF0ZShudWxsKTsKICBmdW5jdGlvbiBpc1ByaXZhdGVOYW1lKHMpIHsKICAgIHJldHVybiBwcml2YXRlTmFtZXNbc107CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZVByaXZhdGVOYW1lKCkgewogICAgdmFyIHMgPSBuZXdVbmlxdWVTdHJpbmcoKTsKICAgIHByaXZhdGVOYW1lc1tzXSA9IHRydWU7CiAgICByZXR1cm4gczsKICB9CiAgdmFyIENPTlRJTlVBVElPTl9UWVBFID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmdW5jdGlvbiBjcmVhdGVDb250aW51YXRpb24ob3BlcmFuZCwgdGhpc0FyZywgYXJnc0FycmF5KSB7CiAgICByZXR1cm4gW0NPTlRJTlVBVElPTl9UWVBFLCBvcGVyYW5kLCB0aGlzQXJnLCBhcmdzQXJyYXldOwogIH0KICBmdW5jdGlvbiBpc0NvbnRpbnVhdGlvbihvYmplY3QpIHsKICAgIHJldHVybiBvYmplY3QgJiYgb2JqZWN0WzBdID09PSBDT05USU5VQVRJT05fVFlQRTsKICB9CiAgdmFyIGlzVGFpbFJlY3Vyc2l2ZU5hbWUgPSBudWxsOwogIGZ1bmN0aW9uIHNldHVwUHJvcGVyVGFpbENhbGxzKCkgewogICAgaXNUYWlsUmVjdXJzaXZlTmFtZSA9IGNyZWF0ZVByaXZhdGVOYW1lKCk7CiAgICBGdW5jdGlvbi5wcm90b3R5cGUuY2FsbCA9IGluaXRUYWlsUmVjdXJzaXZlRnVuY3Rpb24oZnVuY3Rpb24gY2FsbCh0aGlzQXJnKSB7CiAgICAgIHZhciByZXN1bHQgPSB0YWlsQ2FsbChmdW5jdGlvbih0aGlzQXJnKSB7CiAgICAgICAgdmFyIGFyZ0FycmF5ID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGFyZ0FycmF5W2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICAgICAgdmFyIGNvbnRpbnVhdGlvbiA9IGNyZWF0ZUNvbnRpbnVhdGlvbih0aGlzLCB0aGlzQXJnLCBhcmdBcnJheSk7CiAgICAgICAgcmV0dXJuIGNvbnRpbnVhdGlvbjsKICAgICAgfSwgdGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0pOwogICAgRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5ID0gaW5pdFRhaWxSZWN1cnNpdmVGdW5jdGlvbihmdW5jdGlvbiBhcHBseSh0aGlzQXJnLCBhcmdBcnJheSkgewogICAgICB2YXIgcmVzdWx0ID0gdGFpbENhbGwoZnVuY3Rpb24odGhpc0FyZywgYXJnQXJyYXkpIHsKICAgICAgICB2YXIgY29udGludWF0aW9uID0gY3JlYXRlQ29udGludWF0aW9uKHRoaXMsIHRoaXNBcmcsIGFyZ0FycmF5KTsKICAgICAgICByZXR1cm4gY29udGludWF0aW9uOwogICAgICB9LCB0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGluaXRUYWlsUmVjdXJzaXZlRnVuY3Rpb24oZnVuYykgewogICAgaWYgKGlzVGFpbFJlY3Vyc2l2ZU5hbWUgPT09IG51bGwpIHsKICAgICAgc2V0dXBQcm9wZXJUYWlsQ2FsbHMoKTsKICAgIH0KICAgIGZ1bmNbaXNUYWlsUmVjdXJzaXZlTmFtZV0gPSB0cnVlOwogICAgcmV0dXJuIGZ1bmM7CiAgfQogIGZ1bmN0aW9uIGlzVGFpbFJlY3Vyc2l2ZShmdW5jKSB7CiAgICByZXR1cm4gISFmdW5jW2lzVGFpbFJlY3Vyc2l2ZU5hbWVdOwogIH0KICBmdW5jdGlvbiB0YWlsQ2FsbChmdW5jLCB0aGlzQXJnLCBhcmdBcnJheSkgewogICAgdmFyIGNvbnRpbnVhdGlvbiA9IGFyZ0FycmF5WzBdOwogICAgaWYgKGlzQ29udGludWF0aW9uKGNvbnRpbnVhdGlvbikpIHsKICAgICAgY29udGludWF0aW9uID0gJGFwcGx5KGZ1bmMsIHRoaXNBcmcsIGNvbnRpbnVhdGlvblszXSk7CiAgICAgIHJldHVybiBjb250aW51YXRpb247CiAgICB9CiAgICBjb250aW51YXRpb24gPSBjcmVhdGVDb250aW51YXRpb24oZnVuYywgdGhpc0FyZywgYXJnQXJyYXkpOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKGlzVGFpbFJlY3Vyc2l2ZShmdW5jKSkgewogICAgICAgIGNvbnRpbnVhdGlvbiA9ICRhcHBseShmdW5jLCBjb250aW51YXRpb25bMl0sIFtjb250aW51YXRpb25dKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb250aW51YXRpb24gPSAkYXBwbHkoZnVuYywgY29udGludWF0aW9uWzJdLCBjb250aW51YXRpb25bM10pOwogICAgICB9CiAgICAgIGlmICghaXNDb250aW51YXRpb24oY29udGludWF0aW9uKSkgewogICAgICAgIHJldHVybiBjb250aW51YXRpb247CiAgICAgIH0KICAgICAgZnVuYyA9IGNvbnRpbnVhdGlvblsxXTsKICAgIH0KICB9CiAgZnVuY3Rpb24gY29uc3RydWN0KCkgewogICAgdmFyIG9iamVjdDsKICAgIGlmIChpc1RhaWxSZWN1cnNpdmUodGhpcykpIHsKICAgICAgb2JqZWN0ID0gJGNvbnN0cnVjdCh0aGlzLCBbY3JlYXRlQ29udGludWF0aW9uKG51bGwsIG51bGwsIGFyZ3VtZW50cyldKTsKICAgIH0gZWxzZSB7CiAgICAgIG9iamVjdCA9ICRjb25zdHJ1Y3QodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIHJldHVybiBvYmplY3Q7CiAgfQogIHZhciAkdHJhY2V1clJ1bnRpbWUgPSB7CiAgICBpbml0VGFpbFJlY3Vyc2l2ZUZ1bmN0aW9uOiBpbml0VGFpbFJlY3Vyc2l2ZUZ1bmN0aW9uLAogICAgY2FsbDogdGFpbENhbGwsCiAgICBjb250aW51YXRpb246IGNyZWF0ZUNvbnRpbnVhdGlvbiwKICAgIGNvbnN0cnVjdDogY29uc3RydWN0CiAgfTsKICAoZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBub25FbnVtKHZhbHVlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICB3cml0YWJsZTogdHJ1ZQogICAgICB9OwogICAgfQogICAgdmFyIG1ldGhvZCA9IG5vbkVudW07CiAgICB2YXIgc3ltYm9sSW50ZXJuYWxQcm9wZXJ0eSA9IG5ld1VuaXF1ZVN0cmluZygpOwogICAgdmFyIHN5bWJvbERlc2NyaXB0aW9uUHJvcGVydHkgPSBuZXdVbmlxdWVTdHJpbmcoKTsKICAgIHZhciBzeW1ib2xEYXRhUHJvcGVydHkgPSBuZXdVbmlxdWVTdHJpbmcoKTsKICAgIHZhciBzeW1ib2xWYWx1ZXMgPSAkY3JlYXRlKG51bGwpOwogICAgZnVuY3Rpb24gaXNTaGltU3ltYm9sKHN5bWJvbCkgewogICAgICByZXR1cm4gdHlwZW9mIHN5bWJvbCA9PT0gJ29iamVjdCcgJiYgc3ltYm9sIGluc3RhbmNlb2YgU3ltYm9sVmFsdWU7CiAgICB9CiAgICBmdW5jdGlvbiB0eXBlT2YodikgewogICAgICBpZiAoaXNTaGltU3ltYm9sKHYpKQogICAgICAgIHJldHVybiAnc3ltYm9sJzsKICAgICAgcmV0dXJuIHR5cGVvZiB2OwogICAgfQogICAgZnVuY3Rpb24gU3ltYm9sKGRlc2NyaXB0aW9uKSB7CiAgICAgIHZhciB2YWx1ZSA9IG5ldyBTeW1ib2xWYWx1ZShkZXNjcmlwdGlvbik7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTeW1ib2wpKQogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignU3ltYm9sIGNhbm5vdCBiZSBuZXdcJ2VkJyk7CiAgICB9CiAgICAkZGVmaW5lUHJvcGVydHkoU3ltYm9sLnByb3RvdHlwZSwgJ2NvbnN0cnVjdG9yJywgbm9uRW51bShTeW1ib2wpKTsKICAgICRkZWZpbmVQcm9wZXJ0eShTeW1ib2wucHJvdG90eXBlLCAndG9TdHJpbmcnLCBtZXRob2QoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzeW1ib2xWYWx1ZSA9IHRoaXNbc3ltYm9sRGF0YVByb3BlcnR5XTsKICAgICAgcmV0dXJuIHN5bWJvbFZhbHVlW3N5bWJvbEludGVybmFsUHJvcGVydHldOwogICAgfSkpOwogICAgJGRlZmluZVByb3BlcnR5KFN5bWJvbC5wcm90b3R5cGUsICd2YWx1ZU9mJywgbWV0aG9kKGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3ltYm9sVmFsdWUgPSB0aGlzW3N5bWJvbERhdGFQcm9wZXJ0eV07CiAgICAgIGlmICghc3ltYm9sVmFsdWUpCiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdDb252ZXJzaW9uIGZyb20gc3ltYm9sIHRvIHN0cmluZycpOwogICAgICBpZiAoIWdldE9wdGlvbignc3ltYm9scycpKQogICAgICAgIHJldHVybiBzeW1ib2xWYWx1ZVtzeW1ib2xJbnRlcm5hbFByb3BlcnR5XTsKICAgICAgcmV0dXJuIHN5bWJvbFZhbHVlOwogICAgfSkpOwogICAgZnVuY3Rpb24gU3ltYm9sVmFsdWUoZGVzY3JpcHRpb24pIHsKICAgICAgdmFyIGtleSA9IG5ld1VuaXF1ZVN0cmluZygpOwogICAgICAkZGVmaW5lUHJvcGVydHkodGhpcywgc3ltYm9sRGF0YVByb3BlcnR5LCB7dmFsdWU6IHRoaXN9KTsKICAgICAgJGRlZmluZVByb3BlcnR5KHRoaXMsIHN5bWJvbEludGVybmFsUHJvcGVydHksIHt2YWx1ZToga2V5fSk7CiAgICAgICRkZWZpbmVQcm9wZXJ0eSh0aGlzLCBzeW1ib2xEZXNjcmlwdGlvblByb3BlcnR5LCB7dmFsdWU6IGRlc2NyaXB0aW9ufSk7CiAgICAgIGZyZWV6ZSh0aGlzKTsKICAgICAgc3ltYm9sVmFsdWVzW2tleV0gPSB0aGlzOwogICAgfQogICAgJGRlZmluZVByb3BlcnR5KFN5bWJvbFZhbHVlLnByb3RvdHlwZSwgJ2NvbnN0cnVjdG9yJywgbm9uRW51bShTeW1ib2wpKTsKICAgICRkZWZpbmVQcm9wZXJ0eShTeW1ib2xWYWx1ZS5wcm90b3R5cGUsICd0b1N0cmluZycsIHsKICAgICAgdmFsdWU6IFN5bWJvbC5wcm90b3R5cGUudG9TdHJpbmcsCiAgICAgIGVudW1lcmFibGU6IGZhbHNlCiAgICB9KTsKICAgICRkZWZpbmVQcm9wZXJ0eShTeW1ib2xWYWx1ZS5wcm90b3R5cGUsICd2YWx1ZU9mJywgewogICAgICB2YWx1ZTogU3ltYm9sLnByb3RvdHlwZS52YWx1ZU9mLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgfSk7CiAgICB2YXIgaGFzaFByb3BlcnR5ID0gY3JlYXRlUHJpdmF0ZU5hbWUoKTsKICAgIHZhciBoYXNoUHJvcGVydHlEZXNjcmlwdG9yID0ge3ZhbHVlOiB1bmRlZmluZWR9OwogICAgdmFyIGhhc2hPYmplY3RQcm9wZXJ0aWVzID0gewogICAgICBoYXNoOiB7dmFsdWU6IHVuZGVmaW5lZH0sCiAgICAgIHNlbGY6IHt2YWx1ZTogdW5kZWZpbmVkfQogICAgfTsKICAgIHZhciBoYXNoQ291bnRlciA9IDA7CiAgICBmdW5jdGlvbiBnZXRPd25IYXNoT2JqZWN0KG9iamVjdCkgewogICAgICB2YXIgaGFzaE9iamVjdCA9IG9iamVjdFtoYXNoUHJvcGVydHldOwogICAgICBpZiAoaGFzaE9iamVjdCAmJiBoYXNoT2JqZWN0LnNlbGYgPT09IG9iamVjdCkKICAgICAgICByZXR1cm4gaGFzaE9iamVjdDsKICAgICAgaWYgKCRpc0V4dGVuc2libGUob2JqZWN0KSkgewogICAgICAgIGhhc2hPYmplY3RQcm9wZXJ0aWVzLmhhc2gudmFsdWUgPSBoYXNoQ291bnRlcisrOwogICAgICAgIGhhc2hPYmplY3RQcm9wZXJ0aWVzLnNlbGYudmFsdWUgPSBvYmplY3Q7CiAgICAgICAgaGFzaFByb3BlcnR5RGVzY3JpcHRvci52YWx1ZSA9ICRjcmVhdGUobnVsbCwgaGFzaE9iamVjdFByb3BlcnRpZXMpOwogICAgICAgICRkZWZpbmVQcm9wZXJ0eShvYmplY3QsIGhhc2hQcm9wZXJ0eSwgaGFzaFByb3BlcnR5RGVzY3JpcHRvcik7CiAgICAgICAgcmV0dXJuIGhhc2hQcm9wZXJ0eURlc2NyaXB0b3IudmFsdWU7CiAgICAgIH0KICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGZ1bmN0aW9uIGZyZWV6ZShvYmplY3QpIHsKICAgICAgZ2V0T3duSGFzaE9iamVjdChvYmplY3QpOwogICAgICByZXR1cm4gJGZyZWV6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgZnVuY3Rpb24gcHJldmVudEV4dGVuc2lvbnMob2JqZWN0KSB7CiAgICAgIGdldE93bkhhc2hPYmplY3Qob2JqZWN0KTsKICAgICAgcmV0dXJuICRwcmV2ZW50RXh0ZW5zaW9ucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgZnVuY3Rpb24gc2VhbChvYmplY3QpIHsKICAgICAgZ2V0T3duSGFzaE9iamVjdChvYmplY3QpOwogICAgICByZXR1cm4gJHNlYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICAgIGZyZWV6ZShTeW1ib2xWYWx1ZS5wcm90b3R5cGUpOwogICAgZnVuY3Rpb24gaXNTeW1ib2xTdHJpbmcocykgewogICAgICByZXR1cm4gc3ltYm9sVmFsdWVzW3NdIHx8IHByaXZhdGVOYW1lc1tzXTsKICAgIH0KICAgIGZ1bmN0aW9uIHRvUHJvcGVydHkobmFtZSkgewogICAgICBpZiAoaXNTaGltU3ltYm9sKG5hbWUpKQogICAgICAgIHJldHVybiBuYW1lW3N5bWJvbEludGVybmFsUHJvcGVydHldOwogICAgICByZXR1cm4gbmFtZTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlbW92ZVN5bWJvbEtleXMoYXJyYXkpIHsKICAgICAgdmFyIHJ2ID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoIWlzU3ltYm9sU3RyaW5nKGFycmF5W2ldKSkgewogICAgICAgICAgcnYucHVzaChhcnJheVtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBydjsKICAgIH0KICAgIGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMob2JqZWN0KSB7CiAgICAgIHJldHVybiByZW1vdmVTeW1ib2xLZXlzKCRnZXRPd25Qcm9wZXJ0eU5hbWVzKG9iamVjdCkpOwogICAgfQogICAgZnVuY3Rpb24ga2V5cyhvYmplY3QpIHsKICAgICAgcmV0dXJuIHJlbW92ZVN5bWJvbEtleXMoJGtleXMob2JqZWN0KSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KSB7CiAgICAgIHZhciBydiA9IFtdOwogICAgICB2YXIgbmFtZXMgPSAkZ2V0T3duUHJvcGVydHlOYW1lcyhvYmplY3QpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHN5bWJvbCA9IHN5bWJvbFZhbHVlc1tuYW1lc1tpXV07CiAgICAgICAgaWYgKHN5bWJvbCkgewogICAgICAgICAgcnYucHVzaChzeW1ib2wpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcnY7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBuYW1lKSB7CiAgICAgIHJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgdG9Qcm9wZXJ0eShuYW1lKSk7CiAgICB9CiAgICBmdW5jdGlvbiBoYXNPd25Qcm9wZXJ0eShuYW1lKSB7CiAgICAgIHJldHVybiAkaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLCB0b1Byb3BlcnR5KG5hbWUpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldE9wdGlvbihuYW1lKSB7CiAgICAgIHJldHVybiBnbG9iYWwuJHRyYWNldXJSdW50aW1lLm9wdGlvbnNbbmFtZV07CiAgICB9CiAgICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShvYmplY3QsIG5hbWUsIGRlc2NyaXB0b3IpIHsKICAgICAgaWYgKGlzU2hpbVN5bWJvbChuYW1lKSkgewogICAgICAgIG5hbWUgPSBuYW1lW3N5bWJvbEludGVybmFsUHJvcGVydHldOwogICAgICB9CiAgICAgICRkZWZpbmVQcm9wZXJ0eShvYmplY3QsIG5hbWUsIGRlc2NyaXB0b3IpOwogICAgICByZXR1cm4gb2JqZWN0OwogICAgfQogICAgZnVuY3Rpb24gcG9seWZpbGxPYmplY3QoT2JqZWN0KSB7CiAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3QsICdkZWZpbmVQcm9wZXJ0eScsIHt2YWx1ZTogZGVmaW5lUHJvcGVydHl9KTsKICAgICAgJGRlZmluZVByb3BlcnR5KE9iamVjdCwgJ2dldE93blByb3BlcnR5TmFtZXMnLCB7dmFsdWU6IGdldE93blByb3BlcnR5TmFtZXN9KTsKICAgICAgJGRlZmluZVByb3BlcnR5KE9iamVjdCwgJ2dldE93blByb3BlcnR5RGVzY3JpcHRvcicsIHt2YWx1ZTogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yfSk7CiAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3QucHJvdG90eXBlLCAnaGFzT3duUHJvcGVydHknLCB7dmFsdWU6IGhhc093blByb3BlcnR5fSk7CiAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3QsICdmcmVlemUnLCB7dmFsdWU6IGZyZWV6ZX0pOwogICAgICAkZGVmaW5lUHJvcGVydHkoT2JqZWN0LCAncHJldmVudEV4dGVuc2lvbnMnLCB7dmFsdWU6IHByZXZlbnRFeHRlbnNpb25zfSk7CiAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3QsICdzZWFsJywge3ZhbHVlOiBzZWFsfSk7CiAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3QsICdrZXlzJywge3ZhbHVlOiBrZXlzfSk7CiAgICB9CiAgICBmdW5jdGlvbiBleHBvcnRTdGFyKG9iamVjdCkgewogICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBuYW1lcyA9ICRnZXRPd25Qcm9wZXJ0eU5hbWVzKGFyZ3VtZW50c1tpXSk7CiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuYW1lcy5sZW5ndGg7IGorKykgewogICAgICAgICAgdmFyIG5hbWUgPSBuYW1lc1tqXTsKICAgICAgICAgIGlmIChuYW1lID09PSAnX19lc01vZHVsZScgfHwgaXNTeW1ib2xTdHJpbmcobmFtZSkpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgKGZ1bmN0aW9uKG1vZCwgbmFtZSkgewogICAgICAgICAgICAkZGVmaW5lUHJvcGVydHkob2JqZWN0LCBuYW1lLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtb2RbbmFtZV07CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkoYXJndW1lbnRzW2ldLCBuYW1lc1tqXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9CiAgICBmdW5jdGlvbiBpc09iamVjdCh4KSB7CiAgICAgIHJldHVybiB4ICE9IG51bGwgJiYgKHR5cGVvZiB4ID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgeCA9PT0gJ2Z1bmN0aW9uJyk7CiAgICB9CiAgICBmdW5jdGlvbiB0b09iamVjdCh4KSB7CiAgICAgIGlmICh4ID09IG51bGwpCiAgICAgICAgdGhyb3cgJFR5cGVFcnJvcigpOwogICAgICByZXR1cm4gJE9iamVjdCh4KTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoZWNrT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KSB7CiAgICAgIGlmIChhcmd1bWVudCA9PSBudWxsKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVmFsdWUgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhbiBPYmplY3QnKTsKICAgICAgfQogICAgICByZXR1cm4gYXJndW1lbnQ7CiAgICB9CiAgICBmdW5jdGlvbiBwb2x5ZmlsbFN5bWJvbChnbG9iYWwsIFN5bWJvbCkgewogICAgICBpZiAoIWdsb2JhbC5TeW1ib2wpIHsKICAgICAgICBnbG9iYWwuU3ltYm9sID0gU3ltYm9sOwogICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgICAgIH0KICAgICAgaWYgKCFnbG9iYWwuU3ltYm9sLml0ZXJhdG9yKSB7CiAgICAgICAgZ2xvYmFsLlN5bWJvbC5pdGVyYXRvciA9IFN5bWJvbCgnU3ltYm9sLml0ZXJhdG9yJyk7CiAgICAgIH0KICAgICAgaWYgKCFnbG9iYWwuU3ltYm9sLm9ic2VydmVyKSB7CiAgICAgICAgZ2xvYmFsLlN5bWJvbC5vYnNlcnZlciA9IFN5bWJvbCgnU3ltYm9sLm9ic2VydmVyJyk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNldHVwR2xvYmFscyhnbG9iYWwpIHsKICAgICAgcG9seWZpbGxTeW1ib2woZ2xvYmFsLCBTeW1ib2wpOwogICAgICBnbG9iYWwuUmVmbGVjdCA9IGdsb2JhbC5SZWZsZWN0IHx8IHt9OwogICAgICBnbG9iYWwuUmVmbGVjdC5nbG9iYWwgPSBnbG9iYWwuUmVmbGVjdC5nbG9iYWwgfHwgZ2xvYmFsOwogICAgICBwb2x5ZmlsbE9iamVjdChnbG9iYWwuT2JqZWN0KTsKICAgIH0KICAgIHNldHVwR2xvYmFscyhnbG9iYWwpOwogICAgZ2xvYmFsLiR0cmFjZXVyUnVudGltZSA9IHsKICAgICAgY2FsbDogdGFpbENhbGwsCiAgICAgIGNoZWNrT2JqZWN0Q29lcmNpYmxlOiBjaGVja09iamVjdENvZXJjaWJsZSwKICAgICAgY29uc3RydWN0OiBjb25zdHJ1Y3QsCiAgICAgIGNvbnRpbnVhdGlvbjogY3JlYXRlQ29udGludWF0aW9uLAogICAgICBjcmVhdGVQcml2YXRlTmFtZTogY3JlYXRlUHJpdmF0ZU5hbWUsCiAgICAgIGRlZmluZVByb3BlcnRpZXM6ICRkZWZpbmVQcm9wZXJ0aWVzLAogICAgICBkZWZpbmVQcm9wZXJ0eTogJGRlZmluZVByb3BlcnR5LAogICAgICBleHBvcnRTdGFyOiBleHBvcnRTdGFyLAogICAgICBnZXRPd25IYXNoT2JqZWN0OiBnZXRPd25IYXNoT2JqZWN0LAogICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgICAgIGdldE93blByb3BlcnR5TmFtZXM6ICRnZXRPd25Qcm9wZXJ0eU5hbWVzLAogICAgICBpbml0VGFpbFJlY3Vyc2l2ZUZ1bmN0aW9uOiBpbml0VGFpbFJlY3Vyc2l2ZUZ1bmN0aW9uLAogICAgICBpc09iamVjdDogaXNPYmplY3QsCiAgICAgIGlzUHJpdmF0ZU5hbWU6IGlzUHJpdmF0ZU5hbWUsCiAgICAgIGlzU3ltYm9sU3RyaW5nOiBpc1N5bWJvbFN0cmluZywKICAgICAga2V5czogJGtleXMsCiAgICAgIG9wdGlvbnM6IHt9LAogICAgICBzZXR1cEdsb2JhbHM6IHNldHVwR2xvYmFscywKICAgICAgdG9PYmplY3Q6IHRvT2JqZWN0LAogICAgICB0b1Byb3BlcnR5OiB0b1Byb3BlcnR5LAogICAgICB0eXBlb2Y6IHR5cGVPZgogICAgfTsKICB9KSgpOwp9KSh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMpOwooZnVuY3Rpb24oKSB7CiAgZnVuY3Rpb24gYnVpbGRGcm9tRW5jb2RlZFBhcnRzKG9wdF9zY2hlbWUsIG9wdF91c2VySW5mbywgb3B0X2RvbWFpbiwgb3B0X3BvcnQsIG9wdF9wYXRoLCBvcHRfcXVlcnlEYXRhLCBvcHRfZnJhZ21lbnQpIHsKICAgIHZhciBvdXQgPSBbXTsKICAgIGlmIChvcHRfc2NoZW1lKSB7CiAgICAgIG91dC5wdXNoKG9wdF9zY2hlbWUsICc6Jyk7CiAgICB9CiAgICBpZiAob3B0X2RvbWFpbikgewogICAgICBvdXQucHVzaCgnLy8nKTsKICAgICAgaWYgKG9wdF91c2VySW5mbykgewogICAgICAgIG91dC5wdXNoKG9wdF91c2VySW5mbywgJ0AnKTsKICAgICAgfQogICAgICBvdXQucHVzaChvcHRfZG9tYWluKTsKICAgICAgaWYgKG9wdF9wb3J0KSB7CiAgICAgICAgb3V0LnB1c2goJzonLCBvcHRfcG9ydCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChvcHRfcGF0aCkgewogICAgICBvdXQucHVzaChvcHRfcGF0aCk7CiAgICB9CiAgICBpZiAob3B0X3F1ZXJ5RGF0YSkgewogICAgICBvdXQucHVzaCgnPycsIG9wdF9xdWVyeURhdGEpOwogICAgfQogICAgaWYgKG9wdF9mcmFnbWVudCkgewogICAgICBvdXQucHVzaCgnIycsIG9wdF9mcmFnbWVudCk7CiAgICB9CiAgICByZXR1cm4gb3V0LmpvaW4oJycpOwogIH0KICA7CiAgdmFyIHNwbGl0UmUgPSBuZXcgUmVnRXhwKCdeJyArICcoPzonICsgJyhbXjovPyMuXSspJyArICc6KT8nICsgJyg/Oi8vJyArICcoPzooW14vPyNdKilAKT8nICsgJyhbXFx3XFxkXFwtXFx1MDEwMC1cXHVmZmZmLiVdKiknICsgJyg/OjooWzAtOV0rKSk/JyArICcpPycgKyAnKFtePyNdKyk/JyArICcoPzpcXD8oW14jXSopKT8nICsgJyg/OiMoLiopKT8nICsgJyQnKTsKICB2YXIgQ29tcG9uZW50SW5kZXggPSB7CiAgICBTQ0hFTUU6IDEsCiAgICBVU0VSX0lORk86IDIsCiAgICBET01BSU46IDMsCiAgICBQT1JUOiA0LAogICAgUEFUSDogNSwKICAgIFFVRVJZX0RBVEE6IDYsCiAgICBGUkFHTUVOVDogNwogIH07CiAgZnVuY3Rpb24gc3BsaXQodXJpKSB7CiAgICByZXR1cm4gKHVyaS5tYXRjaChzcGxpdFJlKSk7CiAgfQogIGZ1bmN0aW9uIHJlbW92ZURvdFNlZ21lbnRzKHBhdGgpIHsKICAgIGlmIChwYXRoID09PSAnLycpCiAgICAgIHJldHVybiAnLyc7CiAgICB2YXIgbGVhZGluZ1NsYXNoID0gcGF0aFswXSA9PT0gJy8nID8gJy8nIDogJyc7CiAgICB2YXIgdHJhaWxpbmdTbGFzaCA9IHBhdGguc2xpY2UoLTEpID09PSAnLycgPyAnLycgOiAnJzsKICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoJy8nKTsKICAgIHZhciBvdXQgPSBbXTsKICAgIHZhciB1cCA9IDA7CiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBzZWdtZW50cy5sZW5ndGg7IHBvcysrKSB7CiAgICAgIHZhciBzZWdtZW50ID0gc2VnbWVudHNbcG9zXTsKICAgICAgc3dpdGNoIChzZWdtZW50KSB7CiAgICAgICAgY2FzZSAnJzoKICAgICAgICBjYXNlICcuJzoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJy4uJzoKICAgICAgICAgIGlmIChvdXQubGVuZ3RoKQogICAgICAgICAgICBvdXQucG9wKCk7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHVwKys7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgb3V0LnB1c2goc2VnbWVudCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghbGVhZGluZ1NsYXNoKSB7CiAgICAgIHdoaWxlICh1cC0tID4gMCkgewogICAgICAgIG91dC51bnNoaWZ0KCcuLicpOwogICAgICB9CiAgICAgIGlmIChvdXQubGVuZ3RoID09PSAwKQogICAgICAgIG91dC5wdXNoKCcuJyk7CiAgICB9CiAgICByZXR1cm4gbGVhZGluZ1NsYXNoICsgb3V0LmpvaW4oJy8nKSArIHRyYWlsaW5nU2xhc2g7CiAgfQogIGZ1bmN0aW9uIGpvaW5BbmRDYW5vbmljYWxpemVQYXRoKHBhcnRzKSB7CiAgICB2YXIgcGF0aCA9IHBhcnRzW0NvbXBvbmVudEluZGV4LlBBVEhdIHx8ICcnOwogICAgcGF0aCA9IHJlbW92ZURvdFNlZ21lbnRzKHBhdGgpOwogICAgcGFydHNbQ29tcG9uZW50SW5kZXguUEFUSF0gPSBwYXRoOwogICAgcmV0dXJuIGJ1aWxkRnJvbUVuY29kZWRQYXJ0cyhwYXJ0c1tDb21wb25lbnRJbmRleC5TQ0hFTUVdLCBwYXJ0c1tDb21wb25lbnRJbmRleC5VU0VSX0lORk9dLCBwYXJ0c1tDb21wb25lbnRJbmRleC5ET01BSU5dLCBwYXJ0c1tDb21wb25lbnRJbmRleC5QT1JUXSwgcGFydHNbQ29tcG9uZW50SW5kZXguUEFUSF0sIHBhcnRzW0NvbXBvbmVudEluZGV4LlFVRVJZX0RBVEFdLCBwYXJ0c1tDb21wb25lbnRJbmRleC5GUkFHTUVOVF0pOwogIH0KICBmdW5jdGlvbiBjYW5vbmljYWxpemVVcmwodXJsKSB7CiAgICB2YXIgcGFydHMgPSBzcGxpdCh1cmwpOwogICAgcmV0dXJuIGpvaW5BbmRDYW5vbmljYWxpemVQYXRoKHBhcnRzKTsKICB9CiAgZnVuY3Rpb24gcmVzb2x2ZVVybChiYXNlLCB1cmwpIHsKICAgIHZhciBwYXJ0cyA9IHNwbGl0KHVybCk7CiAgICB2YXIgYmFzZVBhcnRzID0gc3BsaXQoYmFzZSk7CiAgICBpZiAocGFydHNbQ29tcG9uZW50SW5kZXguU0NIRU1FXSkgewogICAgICByZXR1cm4gam9pbkFuZENhbm9uaWNhbGl6ZVBhdGgocGFydHMpOwogICAgfSBlbHNlIHsKICAgICAgcGFydHNbQ29tcG9uZW50SW5kZXguU0NIRU1FXSA9IGJhc2VQYXJ0c1tDb21wb25lbnRJbmRleC5TQ0hFTUVdOwogICAgfQogICAgZm9yICh2YXIgaSA9IENvbXBvbmVudEluZGV4LlNDSEVNRTsgaSA8PSBDb21wb25lbnRJbmRleC5QT1JUOyBpKyspIHsKICAgICAgaWYgKCFwYXJ0c1tpXSkgewogICAgICAgIHBhcnRzW2ldID0gYmFzZVBhcnRzW2ldOwogICAgICB9CiAgICB9CiAgICBpZiAocGFydHNbQ29tcG9uZW50SW5kZXguUEFUSF1bMF0gPT0gJy8nKSB7CiAgICAgIHJldHVybiBqb2luQW5kQ2Fub25pY2FsaXplUGF0aChwYXJ0cyk7CiAgICB9CiAgICB2YXIgcGF0aCA9IGJhc2VQYXJ0c1tDb21wb25lbnRJbmRleC5QQVRIXTsKICAgIHZhciBpbmRleCA9IHBhdGgubGFzdEluZGV4T2YoJy8nKTsKICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIGluZGV4ICsgMSkgKyBwYXJ0c1tDb21wb25lbnRJbmRleC5QQVRIXTsKICAgIHBhcnRzW0NvbXBvbmVudEluZGV4LlBBVEhdID0gcGF0aDsKICAgIHJldHVybiBqb2luQW5kQ2Fub25pY2FsaXplUGF0aChwYXJ0cyk7CiAgfQogIGZ1bmN0aW9uIGlzQWJzb2x1dGUobmFtZSkgewogICAgaWYgKCFuYW1lKQogICAgICByZXR1cm4gZmFsc2U7CiAgICBpZiAobmFtZVswXSA9PT0gJy8nKQogICAgICByZXR1cm4gdHJ1ZTsKICAgIHZhciBwYXJ0cyA9IHNwbGl0KG5hbWUpOwogICAgaWYgKHBhcnRzW0NvbXBvbmVudEluZGV4LlNDSEVNRV0pCiAgICAgIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICAkdHJhY2V1clJ1bnRpbWUuY2Fub25pY2FsaXplVXJsID0gY2Fub25pY2FsaXplVXJsOwogICR0cmFjZXVyUnVudGltZS5pc0Fic29sdXRlID0gaXNBYnNvbHV0ZTsKICAkdHJhY2V1clJ1bnRpbWUucmVtb3ZlRG90U2VnbWVudHMgPSByZW1vdmVEb3RTZWdtZW50czsKICAkdHJhY2V1clJ1bnRpbWUucmVzb2x2ZVVybCA9IHJlc29sdmVVcmw7Cn0pKCk7CihmdW5jdGlvbihnbG9iYWwpIHsKICAndXNlIHN0cmljdCc7CiAgdmFyICRfXzEgPSAkdHJhY2V1clJ1bnRpbWUsCiAgICAgIGNhbm9uaWNhbGl6ZVVybCA9ICRfXzEuY2Fub25pY2FsaXplVXJsLAogICAgICByZXNvbHZlVXJsID0gJF9fMS5yZXNvbHZlVXJsLAogICAgICBpc0Fic29sdXRlID0gJF9fMS5pc0Fic29sdXRlOwogIHZhciBtb2R1bGVJbnN0YW50aWF0b3JzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB2YXIgYmFzZVVSTDsKICBpZiAoZ2xvYmFsLmxvY2F0aW9uICYmIGdsb2JhbC5sb2NhdGlvbi5ocmVmKQogICAgYmFzZVVSTCA9IHJlc29sdmVVcmwoZ2xvYmFsLmxvY2F0aW9uLmhyZWYsICcuLycpOwogIGVsc2UKICAgIGJhc2VVUkwgPSAnJzsKICBmdW5jdGlvbiBVbmNvYXRlZE1vZHVsZUVudHJ5KHVybCwgdW5jb2F0ZWRNb2R1bGUpIHsKICAgIHRoaXMudXJsID0gdXJsOwogICAgdGhpcy52YWx1ZV8gPSB1bmNvYXRlZE1vZHVsZTsKICB9CiAgZnVuY3Rpb24gTW9kdWxlRXZhbHVhdGlvbkVycm9yKGVycm9uZW91c01vZHVsZU5hbWUsIGNhdXNlKSB7CiAgICB0aGlzLm1lc3NhZ2UgPSB0aGlzLmNvbnN0cnVjdG9yLm5hbWUgKyAnOiAnICsgdGhpcy5zdHJpcENhdXNlKGNhdXNlKSArICcgaW4gJyArIGVycm9uZW91c01vZHVsZU5hbWU7CiAgICBpZiAoIShjYXVzZSBpbnN0YW5jZW9mIE1vZHVsZUV2YWx1YXRpb25FcnJvcikgJiYgY2F1c2Uuc3RhY2spCiAgICAgIHRoaXMuc3RhY2sgPSB0aGlzLnN0cmlwU3RhY2soY2F1c2Uuc3RhY2spOwogICAgZWxzZQogICAgICB0aGlzLnN0YWNrID0gJyc7CiAgfQogIE1vZHVsZUV2YWx1YXRpb25FcnJvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7CiAgTW9kdWxlRXZhbHVhdGlvbkVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE1vZHVsZUV2YWx1YXRpb25FcnJvcjsKICBNb2R1bGVFdmFsdWF0aW9uRXJyb3IucHJvdG90eXBlLnN0cmlwRXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICByZXR1cm4gbWVzc2FnZS5yZXBsYWNlKC8uKkVycm9yOi8sIHRoaXMuY29uc3RydWN0b3IubmFtZSArICc6Jyk7CiAgfTsKICBNb2R1bGVFdmFsdWF0aW9uRXJyb3IucHJvdG90eXBlLnN0cmlwQ2F1c2UgPSBmdW5jdGlvbihjYXVzZSkgewogICAgaWYgKCFjYXVzZSkKICAgICAgcmV0dXJuICcnOwogICAgaWYgKCFjYXVzZS5tZXNzYWdlKQogICAgICByZXR1cm4gY2F1c2UgKyAnJzsKICAgIHJldHVybiB0aGlzLnN0cmlwRXJyb3IoY2F1c2UubWVzc2FnZSk7CiAgfTsKICBNb2R1bGVFdmFsdWF0aW9uRXJyb3IucHJvdG90eXBlLmxvYWRlZEJ5ID0gZnVuY3Rpb24obW9kdWxlTmFtZSkgewogICAgdGhpcy5zdGFjayArPSAnXG4gbG9hZGVkIGJ5ICcgKyBtb2R1bGVOYW1lOwogIH07CiAgTW9kdWxlRXZhbHVhdGlvbkVycm9yLnByb3RvdHlwZS5zdHJpcFN0YWNrID0gZnVuY3Rpb24oY2F1c2VTdGFjaykgewogICAgdmFyIHN0YWNrID0gW107CiAgICBjYXVzZVN0YWNrLnNwbGl0KCdcbicpLnNvbWUoKGZ1bmN0aW9uKGZyYW1lKSB7CiAgICAgIGlmICgvVW5jb2F0ZWRNb2R1bGVJbnN0YW50aWF0b3IvLnRlc3QoZnJhbWUpKQogICAgICAgIHJldHVybiB0cnVlOwogICAgICBzdGFjay5wdXNoKGZyYW1lKTsKICAgIH0pKTsKICAgIHN0YWNrWzBdID0gdGhpcy5zdHJpcEVycm9yKHN0YWNrWzBdKTsKICAgIHJldHVybiBzdGFjay5qb2luKCdcbicpOwogIH07CiAgZnVuY3Rpb24gYmVmb3JlTGluZXMobGluZXMsIG51bWJlcikgewogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIGZpcnN0ID0gbnVtYmVyIC0gMzsKICAgIGlmIChmaXJzdCA8IDApCiAgICAgIGZpcnN0ID0gMDsKICAgIGZvciAodmFyIGkgPSBmaXJzdDsgaSA8IG51bWJlcjsgaSsrKSB7CiAgICAgIHJlc3VsdC5wdXNoKGxpbmVzW2ldKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIGFmdGVyTGluZXMobGluZXMsIG51bWJlcikgewogICAgdmFyIGxhc3QgPSBudW1iZXIgKyAxOwogICAgaWYgKGxhc3QgPiBsaW5lcy5sZW5ndGggLSAxKQogICAgICBsYXN0ID0gbGluZXMubGVuZ3RoIC0gMTsKICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvciAodmFyIGkgPSBudW1iZXI7IGkgPD0gbGFzdDsgaSsrKSB7CiAgICAgIHJlc3VsdC5wdXNoKGxpbmVzW2ldKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIGNvbHVtblNwYWNpbmcoY29sdW1ucykgewogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2x1bW5zIC0gMTsgaSsrKSB7CiAgICAgIHJlc3VsdCArPSAnLSc7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBmdW5jdGlvbiBVbmNvYXRlZE1vZHVsZUluc3RhbnRpYXRvcih1cmwsIGZ1bmMpIHsKICAgIFVuY29hdGVkTW9kdWxlRW50cnkuY2FsbCh0aGlzLCB1cmwsIG51bGwpOwogICAgdGhpcy5mdW5jID0gZnVuYzsKICB9CiAgVW5jb2F0ZWRNb2R1bGVJbnN0YW50aWF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShVbmNvYXRlZE1vZHVsZUVudHJ5LnByb3RvdHlwZSk7CiAgVW5jb2F0ZWRNb2R1bGVJbnN0YW50aWF0b3IucHJvdG90eXBlLmdldFVuY29hdGVkTW9kdWxlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgJF9fMCA9IHRoaXM7CiAgICBpZiAodGhpcy52YWx1ZV8pCiAgICAgIHJldHVybiB0aGlzLnZhbHVlXzsKICAgIHRyeSB7CiAgICAgIHZhciByZWxhdGl2ZVJlcXVpcmU7CiAgICAgIGlmICh0eXBlb2YgJHRyYWNldXJSdW50aW1lICE9PSB1bmRlZmluZWQgJiYgJHRyYWNldXJSdW50aW1lLnJlcXVpcmUpIHsKICAgICAgICByZWxhdGl2ZVJlcXVpcmUgPSAkdHJhY2V1clJ1bnRpbWUucmVxdWlyZS5iaW5kKG51bGwsIHRoaXMudXJsKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy52YWx1ZV8gPSB0aGlzLmZ1bmMuY2FsbChnbG9iYWwsIHJlbGF0aXZlUmVxdWlyZSk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNb2R1bGVFdmFsdWF0aW9uRXJyb3IpIHsKICAgICAgICBleC5sb2FkZWRCeSh0aGlzLnVybCk7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgaWYgKGV4LnN0YWNrKSB7CiAgICAgICAgdmFyIGxpbmVzID0gdGhpcy5mdW5jLnRvU3RyaW5nKCkuc3BsaXQoJ1xuJyk7CiAgICAgICAgdmFyIGV2YWxlZCA9IFtdOwogICAgICAgIGV4LnN0YWNrLnNwbGl0KCdcbicpLnNvbWUoKGZ1bmN0aW9uKGZyYW1lLCBpbmRleCkgewogICAgICAgICAgaWYgKGZyYW1lLmluZGV4T2YoJ1VuY29hdGVkTW9kdWxlSW5zdGFudGlhdG9yLmdldFVuY29hdGVkTW9kdWxlJykgPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIHZhciBtID0gLyhhdFxzW15cc10qXHMpLio+OihcZCopOihcZCopXCkvLmV4ZWMoZnJhbWUpOwogICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgdmFyIGxpbmUgPSBwYXJzZUludChtWzJdLCAxMCk7CiAgICAgICAgICAgIGV2YWxlZCA9IGV2YWxlZC5jb25jYXQoYmVmb3JlTGluZXMobGluZXMsIGxpbmUpKTsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSAxKSB7CiAgICAgICAgICAgICAgZXZhbGVkLnB1c2goY29sdW1uU3BhY2luZyhtWzNdKSArICdeICcgKyAkX18wLnVybCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZXZhbGVkLnB1c2goY29sdW1uU3BhY2luZyhtWzNdKSArICdeJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZhbGVkID0gZXZhbGVkLmNvbmNhdChhZnRlckxpbmVzKGxpbmVzLCBsaW5lKSk7CiAgICAgICAgICAgIGV2YWxlZC5wdXNoKCc9ID0gPSA9ID0gPSA9ID0gPScpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXZhbGVkLnB1c2goZnJhbWUpOwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgICBleC5zdGFjayA9IGV2YWxlZC5qb2luKCdcbicpOwogICAgICB9CiAgICAgIHRocm93IG5ldyBNb2R1bGVFdmFsdWF0aW9uRXJyb3IodGhpcy51cmwsIGV4KTsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGdldFVuY29hdGVkTW9kdWxlSW5zdGFudGlhdG9yKG5hbWUpIHsKICAgIGlmICghbmFtZSkKICAgICAgcmV0dXJuIDsKICAgIHZhciB1cmwgPSBNb2R1bGVTdG9yZS5ub3JtYWxpemUobmFtZSk7CiAgICByZXR1cm4gbW9kdWxlSW5zdGFudGlhdG9yc1t1cmxdOwogIH0KICA7CiAgdmFyIG1vZHVsZUluc3RhbmNlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgdmFyIGxpdmVNb2R1bGVTZW50aW5lbCA9IHt9OwogIGZ1bmN0aW9uIE1vZHVsZSh1bmNvYXRlZE1vZHVsZSkgewogICAgdmFyIGlzTGl2ZSA9IGFyZ3VtZW50c1sxXTsKICAgIHZhciBjb2F0ZWRNb2R1bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModW5jb2F0ZWRNb2R1bGUpLmZvckVhY2goKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgdmFyIGdldHRlciwKICAgICAgICAgIHZhbHVlOwogICAgICBpZiAoaXNMaXZlID09PSBsaXZlTW9kdWxlU2VudGluZWwpIHsKICAgICAgICB2YXIgZGVzY3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHVuY29hdGVkTW9kdWxlLCBuYW1lKTsKICAgICAgICBpZiAoZGVzY3IuZ2V0KQogICAgICAgICAgZ2V0dGVyID0gZGVzY3IuZ2V0OwogICAgICB9CiAgICAgIGlmICghZ2V0dGVyKSB7CiAgICAgICAgdmFsdWUgPSB1bmNvYXRlZE1vZHVsZVtuYW1lXTsKICAgICAgICBnZXR0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9OwogICAgICB9CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb2F0ZWRNb2R1bGUsIG5hbWUsIHsKICAgICAgICBnZXQ6IGdldHRlciwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgfSkpOwogICAgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKGNvYXRlZE1vZHVsZSk7CiAgICByZXR1cm4gY29hdGVkTW9kdWxlOwogIH0KICB2YXIgTW9kdWxlU3RvcmUgPSB7CiAgICBub3JtYWxpemU6IGZ1bmN0aW9uKG5hbWUsIHJlZmVyZXJOYW1lLCByZWZlcmVyQWRkcmVzcykgewogICAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ21vZHVsZSBuYW1lIG11c3QgYmUgYSBzdHJpbmcsIG5vdCAnICsgdHlwZW9mIG5hbWUpOwogICAgICBpZiAoaXNBYnNvbHV0ZShuYW1lKSkKICAgICAgICByZXR1cm4gY2Fub25pY2FsaXplVXJsKG5hbWUpOwogICAgICBpZiAoL1teXC5dXC9cLlwuXC8vLnRlc3QobmFtZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21vZHVsZSBuYW1lIGVtYmVkcyAvLi4vOiAnICsgbmFtZSk7CiAgICAgIH0KICAgICAgaWYgKG5hbWVbMF0gPT09ICcuJyAmJiByZWZlcmVyTmFtZSkKICAgICAgICByZXR1cm4gcmVzb2x2ZVVybChyZWZlcmVyTmFtZSwgbmFtZSk7CiAgICAgIHJldHVybiBjYW5vbmljYWxpemVVcmwobmFtZSk7CiAgICB9LAogICAgZ2V0OiBmdW5jdGlvbihub3JtYWxpemVkTmFtZSkgewogICAgICB2YXIgbSA9IGdldFVuY29hdGVkTW9kdWxlSW5zdGFudGlhdG9yKG5vcm1hbGl6ZWROYW1lKTsKICAgICAgaWYgKCFtKQogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIHZhciBtb2R1bGVJbnN0YW5jZSA9IG1vZHVsZUluc3RhbmNlc1ttLnVybF07CiAgICAgIGlmIChtb2R1bGVJbnN0YW5jZSkKICAgICAgICByZXR1cm4gbW9kdWxlSW5zdGFuY2U7CiAgICAgIG1vZHVsZUluc3RhbmNlID0gTW9kdWxlKG0uZ2V0VW5jb2F0ZWRNb2R1bGUoKSwgbGl2ZU1vZHVsZVNlbnRpbmVsKTsKICAgICAgcmV0dXJuIG1vZHVsZUluc3RhbmNlc1ttLnVybF0gPSBtb2R1bGVJbnN0YW5jZTsKICAgIH0sCiAgICBzZXQ6IGZ1bmN0aW9uKG5vcm1hbGl6ZWROYW1lLCBtb2R1bGUpIHsKICAgICAgbm9ybWFsaXplZE5hbWUgPSBTdHJpbmcobm9ybWFsaXplZE5hbWUpOwogICAgICBtb2R1bGVJbnN0YW50aWF0b3JzW25vcm1hbGl6ZWROYW1lXSA9IG5ldyBVbmNvYXRlZE1vZHVsZUluc3RhbnRpYXRvcihub3JtYWxpemVkTmFtZSwgKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBtb2R1bGU7CiAgICAgIH0pKTsKICAgICAgbW9kdWxlSW5zdGFuY2VzW25vcm1hbGl6ZWROYW1lXSA9IG1vZHVsZTsKICAgIH0sCiAgICBnZXQgYmFzZVVSTCgpIHsKICAgICAgcmV0dXJuIGJhc2VVUkw7CiAgICB9LAogICAgc2V0IGJhc2VVUkwodikgewogICAgICBiYXNlVVJMID0gU3RyaW5nKHYpOwogICAgfSwKICAgIHJlZ2lzdGVyTW9kdWxlOiBmdW5jdGlvbihuYW1lLCBkZXBzLCBmdW5jKSB7CiAgICAgIHZhciBub3JtYWxpemVkTmFtZSA9IE1vZHVsZVN0b3JlLm5vcm1hbGl6ZShuYW1lKTsKICAgICAgaWYgKG1vZHVsZUluc3RhbnRpYXRvcnNbbm9ybWFsaXplZE5hbWVdKQogICAgICAgIHRocm93IG5ldyBFcnJvcignZHVwbGljYXRlIG1vZHVsZSBuYW1lZCAnICsgbm9ybWFsaXplZE5hbWUpOwogICAgICBtb2R1bGVJbnN0YW50aWF0b3JzW25vcm1hbGl6ZWROYW1lXSA9IG5ldyBVbmNvYXRlZE1vZHVsZUluc3RhbnRpYXRvcihub3JtYWxpemVkTmFtZSwgZnVuYyk7CiAgICB9LAogICAgYnVuZGxlU3RvcmU6IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICByZWdpc3RlcjogZnVuY3Rpb24obmFtZSwgZGVwcywgZnVuYykgewogICAgICBpZiAoIWRlcHMgfHwgIWRlcHMubGVuZ3RoICYmICFmdW5jLmxlbmd0aCkgewogICAgICAgIHRoaXMucmVnaXN0ZXJNb2R1bGUobmFtZSwgZGVwcywgZnVuYyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5idW5kbGVTdG9yZVtuYW1lXSA9IHsKICAgICAgICAgIGRlcHM6IGRlcHMsCiAgICAgICAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyICRfXzAgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHZhciBkZXBNYXAgPSB7fTsKICAgICAgICAgICAgZGVwcy5mb3JFYWNoKChmdW5jdGlvbihkZXAsIGluZGV4KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlcE1hcFtkZXBdID0gJF9fMFtpbmRleF07CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgdmFyIHJlZ2lzdHJ5RW50cnkgPSBmdW5jLmNhbGwodGhpcywgZGVwTWFwKTsKICAgICAgICAgICAgcmVnaXN0cnlFbnRyeS5leGVjdXRlLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5LmV4cG9ydHM7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIGdldEFub255bW91c01vZHVsZTogZnVuY3Rpb24oZnVuYykgewogICAgICByZXR1cm4gbmV3IE1vZHVsZShmdW5jLmNhbGwoZ2xvYmFsKSwgbGl2ZU1vZHVsZVNlbnRpbmVsKTsKICAgIH0sCiAgICBnZXRGb3JUZXN0aW5nOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHZhciAkX18wID0gdGhpczsKICAgICAgaWYgKCF0aGlzLnRlc3RpbmdQcmVmaXhfKSB7CiAgICAgICAgT2JqZWN0LmtleXMobW9kdWxlSW5zdGFuY2VzKS5zb21lKChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIHZhciBtID0gLyh0cmFjZXVyQFteXC9dKlwvKS8uZXhlYyhrZXkpOwogICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgJF9fMC50ZXN0aW5nUHJlZml4XyA9IG1bMV07CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5nZXQodGhpcy50ZXN0aW5nUHJlZml4XyArIG5hbWUpOwogICAgfQogIH07CiAgdmFyIG1vZHVsZVN0b3JlTW9kdWxlID0gbmV3IE1vZHVsZSh7TW9kdWxlU3RvcmU6IE1vZHVsZVN0b3JlfSk7CiAgTW9kdWxlU3RvcmUuc2V0KCdAdHJhY2V1ci9zcmMvcnVudGltZS9Nb2R1bGVTdG9yZS5qcycsIG1vZHVsZVN0b3JlTW9kdWxlKTsKICB2YXIgc2V0dXBHbG9iYWxzID0gJHRyYWNldXJSdW50aW1lLnNldHVwR2xvYmFsczsKICAkdHJhY2V1clJ1bnRpbWUuc2V0dXBHbG9iYWxzID0gZnVuY3Rpb24oZ2xvYmFsKSB7CiAgICBzZXR1cEdsb2JhbHMoZ2xvYmFsKTsKICB9OwogICR0cmFjZXVyUnVudGltZS5Nb2R1bGVTdG9yZSA9IE1vZHVsZVN0b3JlOwogIGdsb2JhbC5TeXN0ZW0gPSB7CiAgICByZWdpc3RlcjogTW9kdWxlU3RvcmUucmVnaXN0ZXIuYmluZChNb2R1bGVTdG9yZSksCiAgICByZWdpc3Rlck1vZHVsZTogTW9kdWxlU3RvcmUucmVnaXN0ZXJNb2R1bGUuYmluZChNb2R1bGVTdG9yZSksCiAgICBnZXQ6IE1vZHVsZVN0b3JlLmdldCwKICAgIHNldDogTW9kdWxlU3RvcmUuc2V0LAogICAgbm9ybWFsaXplOiBNb2R1bGVTdG9yZS5ub3JtYWxpemUKICB9Owp9KSh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMpOwpTeXN0ZW0ucmVnaXN0ZXJNb2R1bGUoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvYXN5bmMuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9hc3luYy5qcyI7CiAgaWYgKHR5cGVvZiAkdHJhY2V1clJ1bnRpbWUgIT09ICdvYmplY3QnKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3RyYWNldXIgcnVudGltZSBub3QgZm91bmQuJyk7CiAgfQogIHZhciAkY3JlYXRlUHJpdmF0ZU5hbWUgPSAkdHJhY2V1clJ1bnRpbWUuY3JlYXRlUHJpdmF0ZU5hbWU7CiAgdmFyICRkZWZpbmVQcm9wZXJ0eSA9ICR0cmFjZXVyUnVudGltZS5kZWZpbmVQcm9wZXJ0eTsKICB2YXIgJGRlZmluZVByb3BlcnRpZXMgPSAkdHJhY2V1clJ1bnRpbWUuZGVmaW5lUHJvcGVydGllczsKICB2YXIgJGNyZWF0ZSA9IE9iamVjdC5jcmVhdGU7CiAgdmFyIHRoaXNOYW1lID0gJGNyZWF0ZVByaXZhdGVOYW1lKCk7CiAgdmFyIGFyZ3NOYW1lID0gJGNyZWF0ZVByaXZhdGVOYW1lKCk7CiAgdmFyIG9ic2VydmVOYW1lID0gJGNyZWF0ZVByaXZhdGVOYW1lKCk7CiAgZnVuY3Rpb24gQXN5bmNHZW5lcmF0b3JGdW5jdGlvbigpIHt9CiAgZnVuY3Rpb24gQXN5bmNHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHt9CiAgQXN5bmNHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBBc3luY0dlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwogIEFzeW5jR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUuY29uc3RydWN0b3IgPSBBc3luY0dlbmVyYXRvckZ1bmN0aW9uOwogICRkZWZpbmVQcm9wZXJ0eShBc3luY0dlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAnY29uc3RydWN0b3InLCB7ZW51bWVyYWJsZTogZmFsc2V9KTsKICB2YXIgQXN5bmNHZW5lcmF0b3JDb250ZXh0ID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gQXN5bmNHZW5lcmF0b3JDb250ZXh0KG9ic2VydmVyKSB7CiAgICAgIHZhciAkX18wID0gdGhpczsKICAgICAgdGhpcy5kZWNvcmF0ZWRPYnNlcnZlciA9ICR0cmFjZXVyUnVudGltZS5jcmVhdGVEZWNvcmF0ZWRHZW5lcmF0b3Iob2JzZXJ2ZXIsIChmdW5jdGlvbigpIHsKICAgICAgICAkX18wLmRvbmUgPSB0cnVlOwogICAgICB9KSk7CiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICB0aGlzLmluUmV0dXJuID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoQXN5bmNHZW5lcmF0b3JDb250ZXh0LCB7CiAgICAgIHRocm93OiBmdW5jdGlvbihlcnJvcikgewogICAgICAgIGlmICghdGhpcy5pblJldHVybikgewogICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgICB9LAogICAgICB5aWVsZDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICB0aGlzLmluUmV0dXJuID0gdHJ1ZTsKICAgICAgICAgIHRocm93IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICB0cnkgewogICAgICAgICAgcmVzdWx0ID0gdGhpcy5kZWNvcmF0ZWRPYnNlcnZlci5uZXh0KHZhbHVlKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB0aGlzLmRvbmUgPSB0cnVlOwogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gOwogICAgICAgIH0KICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHsKICAgICAgICAgIHRoaXMuZG9uZSA9IHRydWU7CiAgICAgICAgICB0aGlzLmluUmV0dXJuID0gdHJ1ZTsKICAgICAgICAgIHRocm93IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdC52YWx1ZTsKICAgICAgfSwKICAgICAgeWllbGRGb3I6IGZ1bmN0aW9uKG9ic2VydmFibGUpIHsKICAgICAgICB2YXIgY3R4ID0gdGhpczsKICAgICAgICByZXR1cm4gJHRyYWNldXJSdW50aW1lLm9ic2VydmVGb3JFYWNoKG9ic2VydmFibGVbJHRyYWNldXJSdW50aW1lLnRvUHJvcGVydHkoU3ltYm9sLm9ic2VydmVyKV0uYmluZChvYnNlcnZhYmxlKSwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmIChjdHguZG9uZSkgewogICAgICAgICAgICB0aGlzLnJldHVybigpOwogICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGN0eC5kZWNvcmF0ZWRPYnNlcnZlci5uZXh0KHZhbHVlKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY3R4LmRvbmUgPSB0cnVlOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHsKICAgICAgICAgICAgY3R4LmRvbmUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwge30pOwogIH0oKSk7CiAgQXN5bmNHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGVbU3ltYm9sLm9ic2VydmVyXSA9IGZ1bmN0aW9uKG9ic2VydmVyKSB7CiAgICB2YXIgb2JzZXJ2ZSA9IHRoaXNbb2JzZXJ2ZU5hbWVdOwogICAgdmFyIGN0eCA9IG5ldyBBc3luY0dlbmVyYXRvckNvbnRleHQob2JzZXJ2ZXIpOwogICAgJHRyYWNldXJSdW50aW1lLnNjaGVkdWxlKChmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG9ic2VydmUoY3R4KTsKICAgIH0pKS50aGVuKChmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoIWN0eC5kb25lKSB7CiAgICAgICAgY3R4LmRlY29yYXRlZE9ic2VydmVyLnJldHVybih2YWx1ZSk7CiAgICAgIH0KICAgIH0pKS5jYXRjaCgoZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgaWYgKCFjdHguZG9uZSkgewogICAgICAgIGN0eC5kZWNvcmF0ZWRPYnNlcnZlci50aHJvdyhlcnJvcik7CiAgICAgIH0KICAgIH0pKTsKICAgIHJldHVybiBjdHguZGVjb3JhdGVkT2JzZXJ2ZXI7CiAgfTsKICAkZGVmaW5lUHJvcGVydHkoQXN5bmNHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUsIFN5bWJvbC5vYnNlcnZlciwge2VudW1lcmFibGU6IGZhbHNlfSk7CiAgZnVuY3Rpb24gaW5pdEFzeW5jR2VuZXJhdG9yRnVuY3Rpb24oZnVuY3Rpb25PYmplY3QpIHsKICAgIGZ1bmN0aW9uT2JqZWN0LnByb3RvdHlwZSA9ICRjcmVhdGUoQXN5bmNHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUpOwogICAgZnVuY3Rpb25PYmplY3QuX19wcm90b19fID0gQXN5bmNHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKICAgIHJldHVybiBmdW5jdGlvbk9iamVjdDsKICB9CiAgZnVuY3Rpb24gY3JlYXRlQXN5bmNHZW5lcmF0b3JJbnN0YW5jZShvYnNlcnZlLCBmdW5jdGlvbk9iamVjdCkgewogICAgZm9yICh2YXIgYXJncyA9IFtdLAogICAgICAgICRfXzIgPSAyOyAkX18yIDwgYXJndW1lbnRzLmxlbmd0aDsgJF9fMisrKQogICAgICBhcmdzWyRfXzIgLSAyXSA9IGFyZ3VtZW50c1skX18yXTsKICAgIHZhciBvYmplY3QgPSAkY3JlYXRlKGZ1bmN0aW9uT2JqZWN0LnByb3RvdHlwZSk7CiAgICBvYmplY3RbdGhpc05hbWVdID0gdGhpczsKICAgIG9iamVjdFthcmdzTmFtZV0gPSBhcmdzOwogICAgb2JqZWN0W29ic2VydmVOYW1lXSA9IG9ic2VydmU7CiAgICByZXR1cm4gb2JqZWN0OwogIH0KICBmdW5jdGlvbiBvYnNlcnZlRm9yRWFjaChvYnNlcnZlLCBuZXh0KSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuZXJhdG9yID0gb2JzZXJ2ZSh7CiAgICAgICAgbmV4dDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIHJldHVybiBuZXh0LmNhbGwoZ2VuZXJhdG9yLCB2YWx1ZSk7CiAgICAgICAgfSwKICAgICAgICB0aHJvdzogZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSwKICAgICAgICByZXR1cm46IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSkpOwogIH0KICBmdW5jdGlvbiBzY2hlZHVsZShhc3luY0YpIHsKICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGFzeW5jRik7CiAgfQogIHZhciBnZW5lcmF0b3IgPSBTeW1ib2woKTsKICB2YXIgb25Eb25lID0gU3ltYm9sKCk7CiAgdmFyIERlY29yYXRlZEdlbmVyYXRvciA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIERlY29yYXRlZEdlbmVyYXRvcihfZ2VuZXJhdG9yLCBfb25Eb25lKSB7CiAgICAgIHRoaXNbZ2VuZXJhdG9yXSA9IF9nZW5lcmF0b3I7CiAgICAgIHRoaXNbb25Eb25lXSA9IF9vbkRvbmU7CiAgICB9CiAgICByZXR1cm4gKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoRGVjb3JhdGVkR2VuZXJhdG9yLCB7CiAgICAgIG5leHQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXNbZ2VuZXJhdG9yXS5uZXh0KHZhbHVlKTsKICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0LmRvbmUpIHsKICAgICAgICAgIHRoaXNbb25Eb25lXS5jYWxsKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LAogICAgICB0aHJvdzogZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICB0aGlzW29uRG9uZV0uY2FsbCh0aGlzKTsKICAgICAgICByZXR1cm4gdGhpc1tnZW5lcmF0b3JdLnRocm93KGVycm9yKTsKICAgICAgfSwKICAgICAgcmV0dXJuOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHRoaXNbb25Eb25lXS5jYWxsKHRoaXMpOwogICAgICAgIHJldHVybiB0aGlzW2dlbmVyYXRvcl0ucmV0dXJuKHZhbHVlKTsKICAgICAgfQogICAgfSwge30pOwogIH0oKSk7CiAgZnVuY3Rpb24gY3JlYXRlRGVjb3JhdGVkR2VuZXJhdG9yKGdlbmVyYXRvciwgb25Eb25lKSB7CiAgICByZXR1cm4gbmV3IERlY29yYXRlZEdlbmVyYXRvcihnZW5lcmF0b3IsIG9uRG9uZSk7CiAgfQogICR0cmFjZXVyUnVudGltZS5pbml0QXN5bmNHZW5lcmF0b3JGdW5jdGlvbiA9IGluaXRBc3luY0dlbmVyYXRvckZ1bmN0aW9uOwogICR0cmFjZXVyUnVudGltZS5jcmVhdGVBc3luY0dlbmVyYXRvckluc3RhbmNlID0gY3JlYXRlQXN5bmNHZW5lcmF0b3JJbnN0YW5jZTsKICAkdHJhY2V1clJ1bnRpbWUub2JzZXJ2ZUZvckVhY2ggPSBvYnNlcnZlRm9yRWFjaDsKICAkdHJhY2V1clJ1bnRpbWUuc2NoZWR1bGUgPSBzY2hlZHVsZTsKICAkdHJhY2V1clJ1bnRpbWUuY3JlYXRlRGVjb3JhdGVkR2VuZXJhdG9yID0gY3JlYXRlRGVjb3JhdGVkR2VuZXJhdG9yOwogIHJldHVybiB7fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9jbGFzc2VzLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvY2xhc3Nlcy5qcyI7CiAgdmFyICRPYmplY3QgPSBPYmplY3Q7CiAgdmFyICRUeXBlRXJyb3IgPSBUeXBlRXJyb3I7CiAgdmFyICRjcmVhdGUgPSAkT2JqZWN0LmNyZWF0ZTsKICB2YXIgJGRlZmluZVByb3BlcnRpZXMgPSAkdHJhY2V1clJ1bnRpbWUuZGVmaW5lUHJvcGVydGllczsKICB2YXIgJGRlZmluZVByb3BlcnR5ID0gJHRyYWNldXJSdW50aW1lLmRlZmluZVByb3BlcnR5OwogIHZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gJHRyYWNldXJSdW50aW1lLmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICB2YXIgJGdldE93blByb3BlcnR5TmFtZXMgPSAkdHJhY2V1clJ1bnRpbWUuZ2V0T3duUHJvcGVydHlOYW1lczsKICB2YXIgJGdldFByb3RvdHlwZU9mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwogIHZhciAkX18wID0gT2JqZWN0LAogICAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzID0gJF9fMC5nZXRPd25Qcm9wZXJ0eU5hbWVzLAogICAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSAkX18wLmdldE93blByb3BlcnR5U3ltYm9sczsKICBmdW5jdGlvbiBzdXBlckRlc2NyaXB0b3IoaG9tZU9iamVjdCwgbmFtZSkgewogICAgdmFyIHByb3RvID0gJGdldFByb3RvdHlwZU9mKGhvbWVPYmplY3QpOwogICAgZG8gewogICAgICB2YXIgcmVzdWx0ID0gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcihwcm90bywgbmFtZSk7CiAgICAgIGlmIChyZXN1bHQpCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgcHJvdG8gPSAkZ2V0UHJvdG90eXBlT2YocHJvdG8pOwogICAgfSB3aGlsZSAocHJvdG8pOwogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgZnVuY3Rpb24gc3VwZXJDb25zdHJ1Y3RvcihjdG9yKSB7CiAgICByZXR1cm4gY3Rvci5fX3Byb3RvX187CiAgfQogIGZ1bmN0aW9uIHN1cGVyR2V0KHNlbGYsIGhvbWVPYmplY3QsIG5hbWUpIHsKICAgIHZhciBkZXNjcmlwdG9yID0gc3VwZXJEZXNjcmlwdG9yKGhvbWVPYmplY3QsIG5hbWUpOwogICAgaWYgKGRlc2NyaXB0b3IpIHsKICAgICAgaWYgKCFkZXNjcmlwdG9yLmdldCkKICAgICAgICByZXR1cm4gZGVzY3JpcHRvci52YWx1ZTsKICAgICAgcmV0dXJuIGRlc2NyaXB0b3IuZ2V0LmNhbGwoc2VsZik7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBmdW5jdGlvbiBzdXBlclNldChzZWxmLCBob21lT2JqZWN0LCBuYW1lLCB2YWx1ZSkgewogICAgdmFyIGRlc2NyaXB0b3IgPSBzdXBlckRlc2NyaXB0b3IoaG9tZU9iamVjdCwgbmFtZSk7CiAgICBpZiAoZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLnNldCkgewogICAgICBkZXNjcmlwdG9yLnNldC5jYWxsKHNlbGYsIHZhbHVlKTsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgdGhyb3cgJFR5cGVFcnJvcigoInN1cGVyIGhhcyBubyBzZXR0ZXIgJyIgKyBuYW1lICsgIicuIikpOwogIH0KICBmdW5jdGlvbiBmb3JFYWNoUHJvcGVydHlLZXkob2JqZWN0LCBmKSB7CiAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzKG9iamVjdCkuZm9yRWFjaChmKTsKICAgIGdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpLmZvckVhY2goZik7CiAgfQogIGZ1bmN0aW9uIGdldERlc2NyaXB0b3JzKG9iamVjdCkgewogICAgdmFyIGRlc2NyaXB0b3JzID0ge307CiAgICBmb3JFYWNoUHJvcGVydHlLZXkob2JqZWN0LCAoZnVuY3Rpb24oa2V5KSB7CiAgICAgIGRlc2NyaXB0b3JzW2tleV0gPSAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwga2V5KTsKICAgICAgZGVzY3JpcHRvcnNba2V5XS5lbnVtZXJhYmxlID0gZmFsc2U7CiAgICB9KSk7CiAgICByZXR1cm4gZGVzY3JpcHRvcnM7CiAgfQogIHZhciBub25FbnVtID0ge2VudW1lcmFibGU6IGZhbHNlfTsKICBmdW5jdGlvbiBtYWtlUHJvcGVydGllc05vbkVudW1lcmFibGUob2JqZWN0KSB7CiAgICBmb3JFYWNoUHJvcGVydHlLZXkob2JqZWN0LCAoZnVuY3Rpb24oa2V5KSB7CiAgICAgICRkZWZpbmVQcm9wZXJ0eShvYmplY3QsIGtleSwgbm9uRW51bSk7CiAgICB9KSk7CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZUNsYXNzKGN0b3IsIG9iamVjdCwgc3RhdGljT2JqZWN0LCBzdXBlckNsYXNzKSB7CiAgICAkZGVmaW5lUHJvcGVydHkob2JqZWN0LCAnY29uc3RydWN0b3InLCB7CiAgICAgIHZhbHVlOiBjdG9yLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDMpIHsKICAgICAgaWYgKHR5cGVvZiBzdXBlckNsYXNzID09PSAnZnVuY3Rpb24nKQogICAgICAgIGN0b3IuX19wcm90b19fID0gc3VwZXJDbGFzczsKICAgICAgY3Rvci5wcm90b3R5cGUgPSAkY3JlYXRlKGdldFByb3RvUGFyZW50KHN1cGVyQ2xhc3MpLCBnZXREZXNjcmlwdG9ycyhvYmplY3QpKTsKICAgIH0gZWxzZSB7CiAgICAgIG1ha2VQcm9wZXJ0aWVzTm9uRW51bWVyYWJsZShvYmplY3QpOwogICAgICBjdG9yLnByb3RvdHlwZSA9IG9iamVjdDsKICAgIH0KICAgICRkZWZpbmVQcm9wZXJ0eShjdG9yLCAncHJvdG90eXBlJywgewogICAgICBjb25maWd1cmFibGU6IGZhbHNlLAogICAgICB3cml0YWJsZTogZmFsc2UKICAgIH0pOwogICAgcmV0dXJuICRkZWZpbmVQcm9wZXJ0aWVzKGN0b3IsIGdldERlc2NyaXB0b3JzKHN0YXRpY09iamVjdCkpOwogIH0KICBmdW5jdGlvbiBnZXRQcm90b1BhcmVudChzdXBlckNsYXNzKSB7CiAgICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgPT09ICdmdW5jdGlvbicpIHsKICAgICAgdmFyIHByb3RvdHlwZSA9IHN1cGVyQ2xhc3MucHJvdG90eXBlOwogICAgICBpZiAoJE9iamVjdChwcm90b3R5cGUpID09PSBwcm90b3R5cGUgfHwgcHJvdG90eXBlID09PSBudWxsKQogICAgICAgIHJldHVybiBzdXBlckNsYXNzLnByb3RvdHlwZTsKICAgICAgdGhyb3cgbmV3ICRUeXBlRXJyb3IoJ3N1cGVyIHByb3RvdHlwZSBtdXN0IGJlIGFuIE9iamVjdCBvciBudWxsJyk7CiAgICB9CiAgICBpZiAoc3VwZXJDbGFzcyA9PT0gbnVsbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB0aHJvdyBuZXcgJFR5cGVFcnJvcigoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzICsgIi4iKSk7CiAgfQogICR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyA9IGNyZWF0ZUNsYXNzOwogICR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yID0gc3VwZXJDb25zdHJ1Y3RvcjsKICAkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQgPSBzdXBlckdldDsKICAkdHJhY2V1clJ1bnRpbWUuc3VwZXJTZXQgPSBzdXBlclNldDsKICByZXR1cm4ge307Cn0pOwpTeXN0ZW0ucmVnaXN0ZXJNb2R1bGUoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvZGVzdHJ1Y3R1cmluZy5qcyIsIFtdLCBmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL2Rlc3RydWN0dXJpbmcuanMiOwogIGZ1bmN0aW9uIGl0ZXJhdG9yVG9BcnJheShpdGVyKSB7CiAgICB2YXIgcnYgPSBbXTsKICAgIHZhciBpID0gMDsKICAgIHZhciB0bXA7CiAgICB3aGlsZSAoISh0bXAgPSBpdGVyLm5leHQoKSkuZG9uZSkgewogICAgICBydltpKytdID0gdG1wLnZhbHVlOwogICAgfQogICAgcmV0dXJuIHJ2OwogIH0KICAkdHJhY2V1clJ1bnRpbWUuaXRlcmF0b3JUb0FycmF5ID0gaXRlcmF0b3JUb0FycmF5OwogIHJldHVybiB7fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9nZW5lcmF0b3JzLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvZ2VuZXJhdG9ycy5qcyI7CiAgaWYgKHR5cGVvZiAkdHJhY2V1clJ1bnRpbWUgIT09ICdvYmplY3QnKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3RyYWNldXIgcnVudGltZSBub3QgZm91bmQuJyk7CiAgfQogIHZhciBjcmVhdGVQcml2YXRlTmFtZSA9ICR0cmFjZXVyUnVudGltZS5jcmVhdGVQcml2YXRlTmFtZTsKICB2YXIgJGRlZmluZVByb3BlcnRpZXMgPSAkdHJhY2V1clJ1bnRpbWUuZGVmaW5lUHJvcGVydGllczsKICB2YXIgJGRlZmluZVByb3BlcnR5ID0gJHRyYWNldXJSdW50aW1lLmRlZmluZVByb3BlcnR5OwogIHZhciAkY3JlYXRlID0gT2JqZWN0LmNyZWF0ZTsKICB2YXIgJFR5cGVFcnJvciA9IFR5cGVFcnJvcjsKICBmdW5jdGlvbiBub25FbnVtKHZhbHVlKSB7CiAgICByZXR1cm4gewogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9OwogIH0KICB2YXIgU1RfTkVXQk9STiA9IDA7CiAgdmFyIFNUX0VYRUNVVElORyA9IDE7CiAgdmFyIFNUX1NVU1BFTkRFRCA9IDI7CiAgdmFyIFNUX0NMT1NFRCA9IDM7CiAgdmFyIEVORF9TVEFURSA9IC0yOwogIHZhciBSRVRIUk9XX1NUQVRFID0gLTM7CiAgZnVuY3Rpb24gZ2V0SW50ZXJuYWxFcnJvcihzdGF0ZSkgewogICAgcmV0dXJuIG5ldyBFcnJvcignVHJhY2V1ciBjb21waWxlciBidWc6IGludmFsaWQgc3RhdGUgaW4gc3RhdGUgbWFjaGluZTogJyArIHN0YXRlKTsKICB9CiAgdmFyIFJFVFVSTl9TRU5USU5FTCA9IHt9OwogIGZ1bmN0aW9uIEdlbmVyYXRvckNvbnRleHQoKSB7CiAgICB0aGlzLnN0YXRlID0gMDsKICAgIHRoaXMuR1N0YXRlID0gU1RfTkVXQk9STjsKICAgIHRoaXMuc3RvcmVkRXhjZXB0aW9uID0gdW5kZWZpbmVkOwogICAgdGhpcy5maW5hbGx5RmFsbFRocm91Z2ggPSB1bmRlZmluZWQ7CiAgICB0aGlzLnNlbnRfID0gdW5kZWZpbmVkOwogICAgdGhpcy5yZXR1cm5WYWx1ZSA9IHVuZGVmaW5lZDsKICAgIHRoaXMub2xkUmV0dXJuVmFsdWUgPSB1bmRlZmluZWQ7CiAgICB0aGlzLnRyeVN0YWNrXyA9IFtdOwogIH0KICBHZW5lcmF0b3JDb250ZXh0LnByb3RvdHlwZSA9IHsKICAgIHB1c2hUcnk6IGZ1bmN0aW9uKGNhdGNoU3RhdGUsIGZpbmFsbHlTdGF0ZSkgewogICAgICBpZiAoZmluYWxseVN0YXRlICE9PSBudWxsKSB7CiAgICAgICAgdmFyIGZpbmFsbHlGYWxsVGhyb3VnaCA9IG51bGw7CiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5U3RhY2tfLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICBpZiAodGhpcy50cnlTdGFja19baV0uY2F0Y2ggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBmaW5hbGx5RmFsbFRocm91Z2ggPSB0aGlzLnRyeVN0YWNrX1tpXS5jYXRjaDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChmaW5hbGx5RmFsbFRocm91Z2ggPT09IG51bGwpCiAgICAgICAgICBmaW5hbGx5RmFsbFRocm91Z2ggPSBSRVRIUk9XX1NUQVRFOwogICAgICAgIHRoaXMudHJ5U3RhY2tfLnB1c2goewogICAgICAgICAgZmluYWxseTogZmluYWxseVN0YXRlLAogICAgICAgICAgZmluYWxseUZhbGxUaHJvdWdoOiBmaW5hbGx5RmFsbFRocm91Z2gKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAoY2F0Y2hTdGF0ZSAhPT0gbnVsbCkgewogICAgICAgIHRoaXMudHJ5U3RhY2tfLnB1c2goe2NhdGNoOiBjYXRjaFN0YXRlfSk7CiAgICAgIH0KICAgIH0sCiAgICBwb3BUcnk6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRyeVN0YWNrXy5wb3AoKTsKICAgIH0sCiAgICBtYXliZVVuY2F0Y2hhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuc3RvcmVkRXhjZXB0aW9uID09PSBSRVRVUk5fU0VOVElORUwpIHsKICAgICAgICB0aHJvdyBSRVRVUk5fU0VOVElORUw7CiAgICAgIH0KICAgIH0sCiAgICBnZXQgc2VudCgpIHsKICAgICAgdGhpcy5tYXliZVRocm93KCk7CiAgICAgIHJldHVybiB0aGlzLnNlbnRfOwogICAgfSwKICAgIHNldCBzZW50KHYpIHsKICAgICAgdGhpcy5zZW50XyA9IHY7CiAgICB9LAogICAgZ2V0IHNlbnRJZ25vcmVUaHJvdygpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VudF87CiAgICB9LAogICAgbWF5YmVUaHJvdzogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmFjdGlvbiA9PT0gJ3Rocm93JykgewogICAgICAgIHRoaXMuYWN0aW9uID0gJ25leHQnOwogICAgICAgIHRocm93IHRoaXMuc2VudF87CiAgICAgIH0KICAgIH0sCiAgICBlbmQ6IGZ1bmN0aW9uKCkgewogICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUpIHsKICAgICAgICBjYXNlIEVORF9TVEFURToKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIGNhc2UgUkVUSFJPV19TVEFURToKICAgICAgICAgIHRocm93IHRoaXMuc3RvcmVkRXhjZXB0aW9uOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBnZXRJbnRlcm5hbEVycm9yKHRoaXMuc3RhdGUpOwogICAgICB9CiAgICB9LAogICAgaGFuZGxlRXhjZXB0aW9uOiBmdW5jdGlvbihleCkgewogICAgICB0aGlzLkdTdGF0ZSA9IFNUX0NMT1NFRDsKICAgICAgdGhpcy5zdGF0ZSA9IEVORF9TVEFURTsKICAgICAgdGhyb3cgZXg7CiAgICB9LAogICAgd3JhcFlpZWxkU3RhcjogZnVuY3Rpb24oaXRlcmF0b3IpIHsKICAgICAgdmFyIGN0eCA9IHRoaXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmV4dDogZnVuY3Rpb24odikgewogICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yLm5leHQodik7CiAgICAgICAgfSwKICAgICAgICB0aHJvdzogZnVuY3Rpb24oZSkgewogICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgIGlmIChlID09PSBSRVRVUk5fU0VOVElORUwpIHsKICAgICAgICAgICAgaWYgKGl0ZXJhdG9yLnJldHVybikgewogICAgICAgICAgICAgIHJlc3VsdCA9IGl0ZXJhdG9yLnJldHVybihjdHgucmV0dXJuVmFsdWUpOwogICAgICAgICAgICAgIGlmICghcmVzdWx0LmRvbmUpIHsKICAgICAgICAgICAgICAgIGN0eC5yZXR1cm5WYWx1ZSA9IGN0eC5vbGRSZXR1cm5WYWx1ZTsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGN0eC5yZXR1cm5WYWx1ZSA9IHJlc3VsdC52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGl0ZXJhdG9yLnRocm93KSB7CiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvci50aHJvdyhlKTsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZXJhdG9yLnJldHVybiAmJiBpdGVyYXRvci5yZXR1cm4oKTsKICAgICAgICAgIHRocm93ICRUeXBlRXJyb3IoJ0lubmVyIGl0ZXJhdG9yIGRvZXMgbm90IGhhdmUgYSB0aHJvdyBtZXRob2QnKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfTsKICBmdW5jdGlvbiBuZXh0T3JUaHJvdyhjdHgsIG1vdmVOZXh0LCBhY3Rpb24sIHgpIHsKICAgIHN3aXRjaCAoY3R4LkdTdGF0ZSkgewogICAgICBjYXNlIFNUX0VYRUNVVElORzoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKCJcIiIgKyBhY3Rpb24gKyAiXCIgb24gZXhlY3V0aW5nIGdlbmVyYXRvciIpKTsKICAgICAgY2FzZSBTVF9DTE9TRUQ6CiAgICAgICAgaWYgKGFjdGlvbiA9PSAnbmV4dCcpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGlmICh4ID09PSBSRVRVUk5fU0VOVElORUwpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHZhbHVlOiBjdHgucmV0dXJuVmFsdWUsCiAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHRocm93IHg7CiAgICAgIGNhc2UgU1RfTkVXQk9STjoKICAgICAgICBpZiAoYWN0aW9uID09PSAndGhyb3cnKSB7CiAgICAgICAgICBjdHguR1N0YXRlID0gU1RfQ0xPU0VEOwogICAgICAgICAgaWYgKHggPT09IFJFVFVSTl9TRU5USU5FTCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHZhbHVlOiBjdHgucmV0dXJuVmFsdWUsCiAgICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgeDsKICAgICAgICB9CiAgICAgICAgaWYgKHggIT09IHVuZGVmaW5lZCkKICAgICAgICAgIHRocm93ICRUeXBlRXJyb3IoJ1NlbnQgdmFsdWUgdG8gbmV3Ym9ybiBnZW5lcmF0b3InKTsKICAgICAgY2FzZSBTVF9TVVNQRU5ERUQ6CiAgICAgICAgY3R4LkdTdGF0ZSA9IFNUX0VYRUNVVElORzsKICAgICAgICBjdHguYWN0aW9uID0gYWN0aW9uOwogICAgICAgIGN0eC5zZW50ID0geDsKICAgICAgICB2YXIgdmFsdWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhbHVlID0gbW92ZU5leHQoY3R4KTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgaWYgKGV4ID09PSBSRVRVUk5fU0VOVElORUwpIHsKICAgICAgICAgICAgdmFsdWUgPSBjdHg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIGRvbmUgPSB2YWx1ZSA9PT0gY3R4OwogICAgICAgIGlmIChkb25lKQogICAgICAgICAgdmFsdWUgPSBjdHgucmV0dXJuVmFsdWU7CiAgICAgICAgY3R4LkdTdGF0ZSA9IGRvbmUgPyBTVF9DTE9TRUQgOiBTVF9TVVNQRU5ERUQ7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgIGRvbmU6IGRvbmUKICAgICAgICB9OwogICAgfQogIH0KICB2YXIgY3R4TmFtZSA9IGNyZWF0ZVByaXZhdGVOYW1lKCk7CiAgdmFyIG1vdmVOZXh0TmFtZSA9IGNyZWF0ZVByaXZhdGVOYW1lKCk7CiAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fQogIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30KICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKICAkZGVmaW5lUHJvcGVydHkoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICdjb25zdHJ1Y3RvcicsIG5vbkVudW0oR2VuZXJhdG9yRnVuY3Rpb24pKTsKICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSB7CiAgICBjb25zdHJ1Y3RvcjogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsCiAgICBuZXh0OiBmdW5jdGlvbih2KSB7CiAgICAgIHJldHVybiBuZXh0T3JUaHJvdyh0aGlzW2N0eE5hbWVdLCB0aGlzW21vdmVOZXh0TmFtZV0sICduZXh0Jywgdik7CiAgICB9LAogICAgdGhyb3c6IGZ1bmN0aW9uKHYpIHsKICAgICAgcmV0dXJuIG5leHRPclRocm93KHRoaXNbY3R4TmFtZV0sIHRoaXNbbW92ZU5leHROYW1lXSwgJ3Rocm93Jywgdik7CiAgICB9LAogICAgcmV0dXJuOiBmdW5jdGlvbih2KSB7CiAgICAgIHRoaXNbY3R4TmFtZV0ub2xkUmV0dXJuVmFsdWUgPSB0aGlzW2N0eE5hbWVdLnJldHVyblZhbHVlOwogICAgICB0aGlzW2N0eE5hbWVdLnJldHVyblZhbHVlID0gdjsKICAgICAgcmV0dXJuIG5leHRPclRocm93KHRoaXNbY3R4TmFtZV0sIHRoaXNbbW92ZU5leHROYW1lXSwgJ3Rocm93JywgUkVUVVJOX1NFTlRJTkVMKTsKICAgIH0KICB9OwogICRkZWZpbmVQcm9wZXJ0aWVzKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHtlbnVtZXJhYmxlOiBmYWxzZX0sCiAgICBuZXh0OiB7ZW51bWVyYWJsZTogZmFsc2V9LAogICAgdGhyb3c6IHtlbnVtZXJhYmxlOiBmYWxzZX0sCiAgICByZXR1cm46IHtlbnVtZXJhYmxlOiBmYWxzZX0KICB9KTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlLCBTeW1ib2wuaXRlcmF0b3IsIG5vbkVudW0oZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpczsKICB9KSk7CiAgZnVuY3Rpb24gY3JlYXRlR2VuZXJhdG9ySW5zdGFuY2UoaW5uZXJGdW5jdGlvbiwgZnVuY3Rpb25PYmplY3QsIHNlbGYpIHsKICAgIHZhciBtb3ZlTmV4dCA9IGdldE1vdmVOZXh0KGlubmVyRnVuY3Rpb24sIHNlbGYpOwogICAgdmFyIGN0eCA9IG5ldyBHZW5lcmF0b3JDb250ZXh0KCk7CiAgICB2YXIgb2JqZWN0ID0gJGNyZWF0ZShmdW5jdGlvbk9iamVjdC5wcm90b3R5cGUpOwogICAgb2JqZWN0W2N0eE5hbWVdID0gY3R4OwogICAgb2JqZWN0W21vdmVOZXh0TmFtZV0gPSBtb3ZlTmV4dDsKICAgIHJldHVybiBvYmplY3Q7CiAgfQogIGZ1bmN0aW9uIGluaXRHZW5lcmF0b3JGdW5jdGlvbihmdW5jdGlvbk9iamVjdCkgewogICAgZnVuY3Rpb25PYmplY3QucHJvdG90eXBlID0gJGNyZWF0ZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUpOwogICAgZnVuY3Rpb25PYmplY3QuX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7CiAgICByZXR1cm4gZnVuY3Rpb25PYmplY3Q7CiAgfQogIGZ1bmN0aW9uIEFzeW5jRnVuY3Rpb25Db250ZXh0KCkgewogICAgR2VuZXJhdG9yQ29udGV4dC5jYWxsKHRoaXMpOwogICAgdGhpcy5lcnIgPSB1bmRlZmluZWQ7CiAgICB2YXIgY3R4ID0gdGhpczsKICAgIGN0eC5yZXN1bHQgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgY3R4LnJlc29sdmUgPSByZXNvbHZlOwogICAgICBjdHgucmVqZWN0ID0gcmVqZWN0OwogICAgfSk7CiAgfQogIEFzeW5jRnVuY3Rpb25Db250ZXh0LnByb3RvdHlwZSA9ICRjcmVhdGUoR2VuZXJhdG9yQ29udGV4dC5wcm90b3R5cGUpOwogIEFzeW5jRnVuY3Rpb25Db250ZXh0LnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbigpIHsKICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkgewogICAgICBjYXNlIEVORF9TVEFURToKICAgICAgICB0aGlzLnJlc29sdmUodGhpcy5yZXR1cm5WYWx1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgUkVUSFJPV19TVEFURToKICAgICAgICB0aGlzLnJlamVjdCh0aGlzLnN0b3JlZEV4Y2VwdGlvbik7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhpcy5yZWplY3QoZ2V0SW50ZXJuYWxFcnJvcih0aGlzLnN0YXRlKSk7CiAgICB9CiAgfTsKICBBc3luY0Z1bmN0aW9uQ29udGV4dC5wcm90b3R5cGUuaGFuZGxlRXhjZXB0aW9uID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnN0YXRlID0gUkVUSFJPV19TVEFURTsKICB9OwogIGZ1bmN0aW9uIGFzeW5jV3JhcChpbm5lckZ1bmN0aW9uLCBzZWxmKSB7CiAgICB2YXIgbW92ZU5leHQgPSBnZXRNb3ZlTmV4dChpbm5lckZ1bmN0aW9uLCBzZWxmKTsKICAgIHZhciBjdHggPSBuZXcgQXN5bmNGdW5jdGlvbkNvbnRleHQoKTsKICAgIGN0eC5jcmVhdGVDYWxsYmFjayA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGN0eC5zdGF0ZSA9IG5ld1N0YXRlOwogICAgICAgIGN0eC52YWx1ZSA9IHZhbHVlOwogICAgICAgIG1vdmVOZXh0KGN0eCk7CiAgICAgIH07CiAgICB9OwogICAgY3R4LmVycmJhY2sgPSBmdW5jdGlvbihlcnIpIHsKICAgICAgaGFuZGxlQ2F0Y2goY3R4LCBlcnIpOwogICAgICBtb3ZlTmV4dChjdHgpOwogICAgfTsKICAgIG1vdmVOZXh0KGN0eCk7CiAgICByZXR1cm4gY3R4LnJlc3VsdDsKICB9CiAgZnVuY3Rpb24gZ2V0TW92ZU5leHQoaW5uZXJGdW5jdGlvbiwgc2VsZikgewogICAgcmV0dXJuIGZ1bmN0aW9uKGN0eCkgewogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gaW5uZXJGdW5jdGlvbi5jYWxsKHNlbGYsIGN0eCk7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGhhbmRsZUNhdGNoKGN0eCwgZXgpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gaGFuZGxlQ2F0Y2goY3R4LCBleCkgewogICAgY3R4LnN0b3JlZEV4Y2VwdGlvbiA9IGV4OwogICAgdmFyIGxhc3QgPSBjdHgudHJ5U3RhY2tfW2N0eC50cnlTdGFja18ubGVuZ3RoIC0gMV07CiAgICBpZiAoIWxhc3QpIHsKICAgICAgY3R4LmhhbmRsZUV4Y2VwdGlvbihleCk7CiAgICAgIHJldHVybiA7CiAgICB9CiAgICBjdHguc3RhdGUgPSBsYXN0LmNhdGNoICE9PSB1bmRlZmluZWQgPyBsYXN0LmNhdGNoIDogbGFzdC5maW5hbGx5OwogICAgaWYgKGxhc3QuZmluYWxseUZhbGxUaHJvdWdoICE9PSB1bmRlZmluZWQpCiAgICAgIGN0eC5maW5hbGx5RmFsbFRocm91Z2ggPSBsYXN0LmZpbmFsbHlGYWxsVGhyb3VnaDsKICB9CiAgJHRyYWNldXJSdW50aW1lLmFzeW5jV3JhcCA9IGFzeW5jV3JhcDsKICAkdHJhY2V1clJ1bnRpbWUuaW5pdEdlbmVyYXRvckZ1bmN0aW9uID0gaW5pdEdlbmVyYXRvckZ1bmN0aW9uOwogICR0cmFjZXVyUnVudGltZS5jcmVhdGVHZW5lcmF0b3JJbnN0YW5jZSA9IGNyZWF0ZUdlbmVyYXRvckluc3RhbmNlOwogIHJldHVybiB7fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9yZWxhdGl2ZVJlcXVpcmUuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9yZWxhdGl2ZVJlcXVpcmUuanMiOwogIHZhciBwYXRoOwogIGZ1bmN0aW9uIHJlbGF0aXZlUmVxdWlyZShjYWxsZXJQYXRoLCByZXF1aXJlZFBhdGgpIHsKICAgIHBhdGggPSBwYXRoIHx8IHR5cGVvZiByZXF1aXJlICE9PSAndW5kZWZpbmVkJyAmJiByZXF1aXJlKCdwYXRoJyk7CiAgICBmdW5jdGlvbiBpc0RpcmVjdG9yeShwYXRoKSB7CiAgICAgIHJldHVybiBwYXRoLnNsaWNlKC0xKSA9PT0gJy8nOwogICAgfQogICAgZnVuY3Rpb24gaXNBYnNvbHV0ZShwYXRoKSB7CiAgICAgIHJldHVybiBwYXRoWzBdID09PSAnLyc7CiAgICB9CiAgICBmdW5jdGlvbiBpc1JlbGF0aXZlKHBhdGgpIHsKICAgICAgcmV0dXJuIHBhdGhbMF0gPT09ICcuJzsKICAgIH0KICAgIGlmIChpc0RpcmVjdG9yeShyZXF1aXJlZFBhdGgpIHx8IGlzQWJzb2x1dGUocmVxdWlyZWRQYXRoKSkKICAgICAgcmV0dXJuIDsKICAgIHJldHVybiBpc1JlbGF0aXZlKHJlcXVpcmVkUGF0aCkgPyByZXF1aXJlKHBhdGgucmVzb2x2ZShwYXRoLmRpcm5hbWUoY2FsbGVyUGF0aCksIHJlcXVpcmVkUGF0aCkpIDogcmVxdWlyZShyZXF1aXJlZFBhdGgpOwogIH0KICAkdHJhY2V1clJ1bnRpbWUucmVxdWlyZSA9IHJlbGF0aXZlUmVxdWlyZTsKICByZXR1cm4ge307Cn0pOwpTeXN0ZW0ucmVnaXN0ZXJNb2R1bGUoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvc3ByZWFkLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvc3ByZWFkLmpzIjsKICBmdW5jdGlvbiBzcHJlYWQoKSB7CiAgICB2YXIgcnYgPSBbXSwKICAgICAgICBqID0gMCwKICAgICAgICBpdGVyUmVzdWx0OwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHZhbHVlVG9TcHJlYWQgPSAkdHJhY2V1clJ1bnRpbWUuY2hlY2tPYmplY3RDb2VyY2libGUoYXJndW1lbnRzW2ldKTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZVRvU3ByZWFkWyR0cmFjZXVyUnVudGltZS50b1Byb3BlcnR5KFN5bWJvbC5pdGVyYXRvcildICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IHNwcmVhZCBub24taXRlcmFibGUgb2JqZWN0LicpOwogICAgICB9CiAgICAgIHZhciBpdGVyID0gdmFsdWVUb1NwcmVhZFskdHJhY2V1clJ1bnRpbWUudG9Qcm9wZXJ0eShTeW1ib2wuaXRlcmF0b3IpXSgpOwogICAgICB3aGlsZSAoIShpdGVyUmVzdWx0ID0gaXRlci5uZXh0KCkpLmRvbmUpIHsKICAgICAgICBydltqKytdID0gaXRlclJlc3VsdC52YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJ2OwogIH0KICAkdHJhY2V1clJ1bnRpbWUuc3ByZWFkID0gc3ByZWFkOwogIHJldHVybiB7fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS90ZW1wbGF0ZS5qcyIsIFtdLCBmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3RlbXBsYXRlLmpzIjsKICB2YXIgJF9fMCA9IE9iamVjdCwKICAgICAgZGVmaW5lUHJvcGVydHkgPSAkX18wLmRlZmluZVByb3BlcnR5LAogICAgICBmcmVlemUgPSAkX18wLmZyZWV6ZTsKICB2YXIgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CiAgdmFyIG1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVPYmplY3QocmF3KSB7CiAgICB2YXIgY29va2VkID0gYXJndW1lbnRzWzFdOwogICAgdmFyIGtleSA9IHJhdy5qb2luKCcke30nKTsKICAgIHZhciB0ZW1wbGF0ZU9iamVjdCA9IG1hcFtrZXldOwogICAgaWYgKHRlbXBsYXRlT2JqZWN0KQogICAgICByZXR1cm4gdGVtcGxhdGVPYmplY3Q7CiAgICBpZiAoIWNvb2tlZCkgewogICAgICBjb29rZWQgPSBzbGljZS5jYWxsKHJhdyk7CiAgICB9CiAgICByZXR1cm4gbWFwW2tleV0gPSBmcmVlemUoZGVmaW5lUHJvcGVydHkoY29va2VkLCAncmF3Jywge3ZhbHVlOiBmcmVlemUocmF3KX0pKTsKICB9CiAgJHRyYWNldXJSdW50aW1lLmdldFRlbXBsYXRlT2JqZWN0ID0gZ2V0VGVtcGxhdGVPYmplY3Q7CiAgcmV0dXJuIHt9Owp9KTsKU3lzdGVtLnJlZ2lzdGVyTW9kdWxlKCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3R5cGUtYXNzZXJ0aW9ucy5qcyIsIFtdLCBmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3R5cGUtYXNzZXJ0aW9ucy5qcyI7CiAgdmFyIHR5cGVzID0gewogICAgYW55OiB7bmFtZTogJ2FueSd9LAogICAgYm9vbGVhbjoge25hbWU6ICdib29sZWFuJ30sCiAgICBudW1iZXI6IHtuYW1lOiAnbnVtYmVyJ30sCiAgICBzdHJpbmc6IHtuYW1lOiAnc3RyaW5nJ30sCiAgICBzeW1ib2w6IHtuYW1lOiAnc3ltYm9sJ30sCiAgICB2b2lkOiB7bmFtZTogJ3ZvaWQnfQogIH07CiAgdmFyIEdlbmVyaWNUeXBlID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gR2VuZXJpY1R5cGUodHlwZSwgYXJndW1lbnRUeXBlcykgewogICAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmFyZ3VtZW50VHlwZXMgPSBhcmd1bWVudFR5cGVzOwogICAgfQogICAgcmV0dXJuICgkdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MpKEdlbmVyaWNUeXBlLCB7fSwge30pOwogIH0oKSk7CiAgdmFyIHR5cGVSZWdpc3RlciA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZnVuY3Rpb24gZ2VuZXJpY1R5cGUodHlwZSkgewogICAgZm9yICh2YXIgYXJndW1lbnRUeXBlcyA9IFtdLAogICAgICAgICRfXzEgPSAxOyAkX18xIDwgYXJndW1lbnRzLmxlbmd0aDsgJF9fMSsrKQogICAgICBhcmd1bWVudFR5cGVzWyRfXzEgLSAxXSA9IGFyZ3VtZW50c1skX18xXTsKICAgIHZhciB0eXBlTWFwID0gdHlwZVJlZ2lzdGVyOwogICAgdmFyIGtleSA9ICR0cmFjZXVyUnVudGltZS5nZXRPd25IYXNoT2JqZWN0KHR5cGUpLmhhc2g7CiAgICBpZiAoIXR5cGVNYXBba2V5XSkgewogICAgICB0eXBlTWFwW2tleV0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgdHlwZU1hcCA9IHR5cGVNYXBba2V5XTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRUeXBlcy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAga2V5ID0gJHRyYWNldXJSdW50aW1lLmdldE93bkhhc2hPYmplY3QoYXJndW1lbnRUeXBlc1tpXSkuaGFzaDsKICAgICAgaWYgKCF0eXBlTWFwW2tleV0pIHsKICAgICAgICB0eXBlTWFwW2tleV0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB9CiAgICAgIHR5cGVNYXAgPSB0eXBlTWFwW2tleV07CiAgICB9CiAgICB2YXIgdGFpbCA9IGFyZ3VtZW50VHlwZXNbYXJndW1lbnRUeXBlcy5sZW5ndGggLSAxXTsKICAgIGtleSA9ICR0cmFjZXVyUnVudGltZS5nZXRPd25IYXNoT2JqZWN0KHRhaWwpLmhhc2g7CiAgICBpZiAoIXR5cGVNYXBba2V5XSkgewogICAgICB0eXBlTWFwW2tleV0gPSBuZXcgR2VuZXJpY1R5cGUodHlwZSwgYXJndW1lbnRUeXBlcyk7CiAgICB9CiAgICByZXR1cm4gdHlwZU1hcFtrZXldOwogIH0KICAkdHJhY2V1clJ1bnRpbWUuR2VuZXJpY1R5cGUgPSBHZW5lcmljVHlwZTsKICAkdHJhY2V1clJ1bnRpbWUuZ2VuZXJpY1R5cGUgPSBnZW5lcmljVHlwZTsKICAkdHJhY2V1clJ1bnRpbWUudHlwZSA9IHR5cGVzOwogIHJldHVybiB7fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9ydW50aW1lLW1vZHVsZXMuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9ydW50aW1lLW1vZHVsZXMuanMiOwogIFN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcmVsYXRpdmVSZXF1aXJlLmpzIik7CiAgU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9zcHJlYWQuanMiKTsKICBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL2Rlc3RydWN0dXJpbmcuanMiKTsKICBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL2NsYXNzZXMuanMiKTsKICBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL2FzeW5jLmpzIik7CiAgU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9nZW5lcmF0b3JzLmpzIik7CiAgU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS90ZW1wbGF0ZS5qcyIpOwogIFN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvdHlwZS1hc3NlcnRpb25zLmpzIik7CiAgcmV0dXJuIHt9Owp9KTsKU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9ydW50aW1lLW1vZHVsZXMuanMiICsgJycpOwpTeXN0ZW0ucmVnaXN0ZXJNb2R1bGUoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3V0aWxzLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3V0aWxzLmpzIjsKICB2YXIgJGNlaWwgPSBNYXRoLmNlaWw7CiAgdmFyICRmbG9vciA9IE1hdGguZmxvb3I7CiAgdmFyICRpc0Zpbml0ZSA9IGlzRmluaXRlOwogIHZhciAkaXNOYU4gPSBpc05hTjsKICB2YXIgJHBvdyA9IE1hdGgucG93OwogIHZhciAkbWluID0gTWF0aC5taW47CiAgdmFyIHRvT2JqZWN0ID0gJHRyYWNldXJSdW50aW1lLnRvT2JqZWN0OwogIGZ1bmN0aW9uIHRvVWludDMyKHgpIHsKICAgIHJldHVybiB4ID4+PiAwOwogIH0KICBmdW5jdGlvbiBpc09iamVjdCh4KSB7CiAgICByZXR1cm4geCAmJiAodHlwZW9mIHggPT09ICdvYmplY3QnIHx8IHR5cGVvZiB4ID09PSAnZnVuY3Rpb24nKTsKICB9CiAgZnVuY3Rpb24gaXNDYWxsYWJsZSh4KSB7CiAgICByZXR1cm4gdHlwZW9mIHggPT09ICdmdW5jdGlvbic7CiAgfQogIGZ1bmN0aW9uIGlzTnVtYmVyKHgpIHsKICAgIHJldHVybiB0eXBlb2YgeCA9PT0gJ251bWJlcic7CiAgfQogIGZ1bmN0aW9uIHRvSW50ZWdlcih4KSB7CiAgICB4ID0gK3g7CiAgICBpZiAoJGlzTmFOKHgpKQogICAgICByZXR1cm4gMDsKICAgIGlmICh4ID09PSAwIHx8ICEkaXNGaW5pdGUoeCkpCiAgICAgIHJldHVybiB4OwogICAgcmV0dXJuIHggPiAwID8gJGZsb29yKHgpIDogJGNlaWwoeCk7CiAgfQogIHZhciBNQVhfU0FGRV9MRU5HVEggPSAkcG93KDIsIDUzKSAtIDE7CiAgZnVuY3Rpb24gdG9MZW5ndGgoeCkgewogICAgdmFyIGxlbiA9IHRvSW50ZWdlcih4KTsKICAgIHJldHVybiBsZW4gPCAwID8gMCA6ICRtaW4obGVuLCBNQVhfU0FGRV9MRU5HVEgpOwogIH0KICBmdW5jdGlvbiBjaGVja0l0ZXJhYmxlKHgpIHsKICAgIHJldHVybiAhaXNPYmplY3QoeCkgPyB1bmRlZmluZWQgOiB4W1N5bWJvbC5pdGVyYXRvcl07CiAgfQogIGZ1bmN0aW9uIGlzQ29uc3RydWN0b3IoeCkgewogICAgcmV0dXJuIGlzQ2FsbGFibGUoeCk7CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZUl0ZXJhdG9yUmVzdWx0T2JqZWN0KHZhbHVlLCBkb25lKSB7CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGRvbmU6IGRvbmUKICAgIH07CiAgfQogIGZ1bmN0aW9uIG1heWJlRGVmaW5lKG9iamVjdCwgbmFtZSwgZGVzY3IpIHsKICAgIGlmICghKG5hbWUgaW4gb2JqZWN0KSkgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBuYW1lLCBkZXNjcik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIG1heWJlRGVmaW5lTWV0aG9kKG9iamVjdCwgbmFtZSwgdmFsdWUpIHsKICAgIG1heWJlRGVmaW5lKG9iamVjdCwgbmFtZSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9CiAgZnVuY3Rpb24gbWF5YmVEZWZpbmVDb25zdChvYmplY3QsIG5hbWUsIHZhbHVlKSB7CiAgICBtYXliZURlZmluZShvYmplY3QsIG5hbWUsIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBjb25maWd1cmFibGU6IGZhbHNlLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICB9KTsKICB9CiAgZnVuY3Rpb24gbWF5YmVBZGRGdW5jdGlvbnMob2JqZWN0LCBmdW5jdGlvbnMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnVuY3Rpb25zLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHZhciBuYW1lID0gZnVuY3Rpb25zW2ldOwogICAgICB2YXIgdmFsdWUgPSBmdW5jdGlvbnNbaSArIDFdOwogICAgICBtYXliZURlZmluZU1ldGhvZChvYmplY3QsIG5hbWUsIHZhbHVlKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gbWF5YmVBZGRDb25zdHMob2JqZWN0LCBjb25zdHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uc3RzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHZhciBuYW1lID0gY29uc3RzW2ldOwogICAgICB2YXIgdmFsdWUgPSBjb25zdHNbaSArIDFdOwogICAgICBtYXliZURlZmluZUNvbnN0KG9iamVjdCwgbmFtZSwgdmFsdWUpOwogICAgfQogIH0KICBmdW5jdGlvbiBtYXliZUFkZEl0ZXJhdG9yKG9iamVjdCwgZnVuYywgU3ltYm9sKSB7CiAgICBpZiAoIVN5bWJvbCB8fCAhU3ltYm9sLml0ZXJhdG9yIHx8IG9iamVjdFtTeW1ib2wuaXRlcmF0b3JdKQogICAgICByZXR1cm4gOwogICAgaWYgKG9iamVjdFsnQEBpdGVyYXRvciddKQogICAgICBmdW5jID0gb2JqZWN0WydAQGl0ZXJhdG9yJ107CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCBTeW1ib2wuaXRlcmF0b3IsIHsKICAgICAgdmFsdWU6IGZ1bmMsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9CiAgdmFyIHBvbHlmaWxscyA9IFtdOwogIGZ1bmN0aW9uIHJlZ2lzdGVyUG9seWZpbGwoZnVuYykgewogICAgcG9seWZpbGxzLnB1c2goZnVuYyk7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsQWxsKGdsb2JhbCkgewogICAgcG9seWZpbGxzLmZvckVhY2goKGZ1bmN0aW9uKGYpIHsKICAgICAgcmV0dXJuIGYoZ2xvYmFsKTsKICAgIH0pKTsKICB9CiAgcmV0dXJuIHsKICAgIGdldCB0b09iamVjdCgpIHsKICAgICAgcmV0dXJuIHRvT2JqZWN0OwogICAgfSwKICAgIGdldCB0b1VpbnQzMigpIHsKICAgICAgcmV0dXJuIHRvVWludDMyOwogICAgfSwKICAgIGdldCBpc09iamVjdCgpIHsKICAgICAgcmV0dXJuIGlzT2JqZWN0OwogICAgfSwKICAgIGdldCBpc0NhbGxhYmxlKCkgewogICAgICByZXR1cm4gaXNDYWxsYWJsZTsKICAgIH0sCiAgICBnZXQgaXNOdW1iZXIoKSB7CiAgICAgIHJldHVybiBpc051bWJlcjsKICAgIH0sCiAgICBnZXQgdG9JbnRlZ2VyKCkgewogICAgICByZXR1cm4gdG9JbnRlZ2VyOwogICAgfSwKICAgIGdldCB0b0xlbmd0aCgpIHsKICAgICAgcmV0dXJuIHRvTGVuZ3RoOwogICAgfSwKICAgIGdldCBjaGVja0l0ZXJhYmxlKCkgewogICAgICByZXR1cm4gY2hlY2tJdGVyYWJsZTsKICAgIH0sCiAgICBnZXQgaXNDb25zdHJ1Y3RvcigpIHsKICAgICAgcmV0dXJuIGlzQ29uc3RydWN0b3I7CiAgICB9LAogICAgZ2V0IGNyZWF0ZUl0ZXJhdG9yUmVzdWx0T2JqZWN0KCkgewogICAgICByZXR1cm4gY3JlYXRlSXRlcmF0b3JSZXN1bHRPYmplY3Q7CiAgICB9LAogICAgZ2V0IG1heWJlRGVmaW5lKCkgewogICAgICByZXR1cm4gbWF5YmVEZWZpbmU7CiAgICB9LAogICAgZ2V0IG1heWJlRGVmaW5lTWV0aG9kKCkgewogICAgICByZXR1cm4gbWF5YmVEZWZpbmVNZXRob2Q7CiAgICB9LAogICAgZ2V0IG1heWJlRGVmaW5lQ29uc3QoKSB7CiAgICAgIHJldHVybiBtYXliZURlZmluZUNvbnN0OwogICAgfSwKICAgIGdldCBtYXliZUFkZEZ1bmN0aW9ucygpIHsKICAgICAgcmV0dXJuIG1heWJlQWRkRnVuY3Rpb25zOwogICAgfSwKICAgIGdldCBtYXliZUFkZENvbnN0cygpIHsKICAgICAgcmV0dXJuIG1heWJlQWRkQ29uc3RzOwogICAgfSwKICAgIGdldCBtYXliZUFkZEl0ZXJhdG9yKCkgewogICAgICByZXR1cm4gbWF5YmVBZGRJdGVyYXRvcjsKICAgIH0sCiAgICBnZXQgcmVnaXN0ZXJQb2x5ZmlsbCgpIHsKICAgICAgcmV0dXJuIHJlZ2lzdGVyUG9seWZpbGw7CiAgICB9LAogICAgZ2V0IHBvbHlmaWxsQWxsKCkgewogICAgICByZXR1cm4gcG9seWZpbGxBbGw7CiAgICB9CiAgfTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvTWFwLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL01hcC5qcyI7CiAgdmFyICRfXzAgPSBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy91dGlscy5qcyIpLAogICAgICBpc09iamVjdCA9ICRfXzAuaXNPYmplY3QsCiAgICAgIG1heWJlQWRkSXRlcmF0b3IgPSAkX18wLm1heWJlQWRkSXRlcmF0b3IsCiAgICAgIHJlZ2lzdGVyUG9seWZpbGwgPSAkX18wLnJlZ2lzdGVyUG9seWZpbGw7CiAgdmFyIGdldE93bkhhc2hPYmplY3QgPSAkdHJhY2V1clJ1bnRpbWUuZ2V0T3duSGFzaE9iamVjdDsKICB2YXIgJGhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKICB2YXIgZGVsZXRlZFNlbnRpbmVsID0ge307CiAgZnVuY3Rpb24gbG9va3VwSW5kZXgobWFwLCBrZXkpIHsKICAgIGlmIChpc09iamVjdChrZXkpKSB7CiAgICAgIHZhciBoYXNoT2JqZWN0ID0gZ2V0T3duSGFzaE9iamVjdChrZXkpOwogICAgICByZXR1cm4gaGFzaE9iamVjdCAmJiBtYXAub2JqZWN0SW5kZXhfW2hhc2hPYmplY3QuaGFzaF07CiAgICB9CiAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycpCiAgICAgIHJldHVybiBtYXAuc3RyaW5nSW5kZXhfW2tleV07CiAgICByZXR1cm4gbWFwLnByaW1pdGl2ZUluZGV4X1trZXldOwogIH0KICBmdW5jdGlvbiBpbml0TWFwKG1hcCkgewogICAgbWFwLmVudHJpZXNfID0gW107CiAgICBtYXAub2JqZWN0SW5kZXhfID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIG1hcC5zdHJpbmdJbmRleF8gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgbWFwLnByaW1pdGl2ZUluZGV4XyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBtYXAuZGVsZXRlZENvdW50XyA9IDA7CiAgfQogIHZhciBNYXAgPSAoZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBNYXAoKSB7CiAgICAgIHZhciAkX18xMCwKICAgICAgICAgICRfXzExOwogICAgICB2YXIgaXRlcmFibGUgPSBhcmd1bWVudHNbMF07CiAgICAgIGlmICghaXNPYmplY3QodGhpcykpCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignTWFwIGNhbGxlZCBvbiBpbmNvbXBhdGlibGUgdHlwZScpOwogICAgICBpZiAoJGhhc093blByb3BlcnR5LmNhbGwodGhpcywgJ2VudHJpZXNfJykpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdNYXAgY2FuIG5vdCBiZSByZWVudHJhbnRseSBpbml0aWFsaXNlZCcpOwogICAgICB9CiAgICAgIGluaXRNYXAodGhpcyk7CiAgICAgIGlmIChpdGVyYWJsZSAhPT0gbnVsbCAmJiBpdGVyYWJsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFyICRfXzUgPSB0cnVlOwogICAgICAgIHZhciAkX182ID0gZmFsc2U7CiAgICAgICAgdmFyICRfXzcgPSB1bmRlZmluZWQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAodmFyICRfXzMgPSB2b2lkIDAsCiAgICAgICAgICAgICAgJF9fMiA9IChpdGVyYWJsZSlbJHRyYWNldXJSdW50aW1lLnRvUHJvcGVydHkoU3ltYm9sLml0ZXJhdG9yKV0oKTsgISgkX181ID0gKCRfXzMgPSAkX18yLm5leHQoKSkuZG9uZSk7ICRfXzUgPSB0cnVlKSB7CiAgICAgICAgICAgIHZhciAkX185ID0gJF9fMy52YWx1ZSwKICAgICAgICAgICAgICAgIGtleSA9ICgkX18xMCA9ICRfXzlbJHRyYWNldXJSdW50aW1lLnRvUHJvcGVydHkoU3ltYm9sLml0ZXJhdG9yKV0oKSwgKCRfXzExID0gJF9fMTAubmV4dCgpKS5kb25lID8gdm9pZCAwIDogJF9fMTEudmFsdWUpLAogICAgICAgICAgICAgICAgdmFsdWUgPSAoJF9fMTEgPSAkX18xMC5uZXh0KCkpLmRvbmUgPyB2b2lkIDAgOiAkX18xMS52YWx1ZTsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHRoaXMuc2V0KGtleSwgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoJF9fOCkgewogICAgICAgICAgJF9fNiA9IHRydWU7CiAgICAgICAgICAkX183ID0gJF9fODsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCEkX181ICYmICRfXzIucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAkX18yLnJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoJF9fNikgewogICAgICAgICAgICAgIHRocm93ICRfXzc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAoJHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKShNYXAsIHsKICAgICAgZ2V0IHNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZW50cmllc18ubGVuZ3RoIC8gMiAtIHRoaXMuZGVsZXRlZENvdW50XzsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgICB2YXIgaW5kZXggPSBsb29rdXBJbmRleCh0aGlzLCBrZXkpOwogICAgICAgIGlmIChpbmRleCAhPT0gdW5kZWZpbmVkKQogICAgICAgICAgcmV0dXJuIHRoaXMuZW50cmllc19baW5kZXggKyAxXTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgdmFyIG9iamVjdE1vZGUgPSBpc09iamVjdChrZXkpOwogICAgICAgIHZhciBzdHJpbmdNb2RlID0gdHlwZW9mIGtleSA9PT0gJ3N0cmluZyc7CiAgICAgICAgdmFyIGluZGV4ID0gbG9va3VwSW5kZXgodGhpcywga2V5KTsKICAgICAgICBpZiAoaW5kZXggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5lbnRyaWVzX1tpbmRleCArIDFdID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluZGV4ID0gdGhpcy5lbnRyaWVzXy5sZW5ndGg7CiAgICAgICAgICB0aGlzLmVudHJpZXNfW2luZGV4XSA9IGtleTsKICAgICAgICAgIHRoaXMuZW50cmllc19baW5kZXggKyAxXSA9IHZhbHVlOwogICAgICAgICAgaWYgKG9iamVjdE1vZGUpIHsKICAgICAgICAgICAgdmFyIGhhc2hPYmplY3QgPSBnZXRPd25IYXNoT2JqZWN0KGtleSk7CiAgICAgICAgICAgIHZhciBoYXNoID0gaGFzaE9iamVjdC5oYXNoOwogICAgICAgICAgICB0aGlzLm9iamVjdEluZGV4X1toYXNoXSA9IGluZGV4OwogICAgICAgICAgfSBlbHNlIGlmIChzdHJpbmdNb2RlKSB7CiAgICAgICAgICAgIHRoaXMuc3RyaW5nSW5kZXhfW2tleV0gPSBpbmRleDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucHJpbWl0aXZlSW5kZXhfW2tleV0gPSBpbmRleDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGhhczogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgcmV0dXJuIGxvb2t1cEluZGV4KHRoaXMsIGtleSkgIT09IHVuZGVmaW5lZDsKICAgICAgfSwKICAgICAgZGVsZXRlOiBmdW5jdGlvbihrZXkpIHsKICAgICAgICB2YXIgb2JqZWN0TW9kZSA9IGlzT2JqZWN0KGtleSk7CiAgICAgICAgdmFyIHN0cmluZ01vZGUgPSB0eXBlb2Yga2V5ID09PSAnc3RyaW5nJzsKICAgICAgICB2YXIgaW5kZXg7CiAgICAgICAgdmFyIGhhc2g7CiAgICAgICAgaWYgKG9iamVjdE1vZGUpIHsKICAgICAgICAgIHZhciBoYXNoT2JqZWN0ID0gZ2V0T3duSGFzaE9iamVjdChrZXkpOwogICAgICAgICAgaWYgKGhhc2hPYmplY3QpIHsKICAgICAgICAgICAgaW5kZXggPSB0aGlzLm9iamVjdEluZGV4X1toYXNoID0gaGFzaE9iamVjdC5oYXNoXTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMub2JqZWN0SW5kZXhfW2hhc2hdOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoc3RyaW5nTW9kZSkgewogICAgICAgICAgaW5kZXggPSB0aGlzLnN0cmluZ0luZGV4X1trZXldOwogICAgICAgICAgZGVsZXRlIHRoaXMuc3RyaW5nSW5kZXhfW2tleV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluZGV4ID0gdGhpcy5wcmltaXRpdmVJbmRleF9ba2V5XTsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnByaW1pdGl2ZUluZGV4X1trZXldOwogICAgICAgIH0KICAgICAgICBpZiAoaW5kZXggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5lbnRyaWVzX1tpbmRleF0gPSBkZWxldGVkU2VudGluZWw7CiAgICAgICAgICB0aGlzLmVudHJpZXNfW2luZGV4ICsgMV0gPSB1bmRlZmluZWQ7CiAgICAgICAgICB0aGlzLmRlbGV0ZWRDb3VudF8rKzsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgICBpbml0TWFwKHRoaXMpOwogICAgICB9LAogICAgICBmb3JFYWNoOiBmdW5jdGlvbihjYWxsYmFja0ZuKSB7CiAgICAgICAgdmFyIHRoaXNBcmcgPSBhcmd1bWVudHNbMV07CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVudHJpZXNfLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgICB2YXIga2V5ID0gdGhpcy5lbnRyaWVzX1tpXTsKICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZW50cmllc19baSArIDFdOwogICAgICAgICAgaWYgKGtleSA9PT0gZGVsZXRlZFNlbnRpbmVsKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGNhbGxiYWNrRm4uY2FsbCh0aGlzQXJnLCB2YWx1ZSwga2V5LCB0aGlzKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGVudHJpZXM6ICR0cmFjZXVyUnVudGltZS5pbml0R2VuZXJhdG9yRnVuY3Rpb24oZnVuY3Rpb24gJF9fMTIoKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgdmFsdWU7CiAgICAgICAgcmV0dXJuICR0cmFjZXVyUnVudGltZS5jcmVhdGVHZW5lcmF0b3JJbnN0YW5jZShmdW5jdGlvbigkY3R4KSB7CiAgICAgICAgICB3aGlsZSAodHJ1ZSkKICAgICAgICAgICAgc3dpdGNoICgkY3R4LnN0YXRlKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IChpIDwgdGhpcy5lbnRyaWVzXy5sZW5ndGgpID8gOCA6IC0yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgaSArPSAyOwogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAga2V5ID0gdGhpcy5lbnRyaWVzX1tpXTsKICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5lbnRyaWVzX1tpICsgMV07CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAoa2V5ID09PSBkZWxldGVkU2VudGluZWwpID8gNCA6IDY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBba2V5LCB2YWx1ZV07CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgJGN0eC5tYXliZVRocm93KCk7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJGN0eC5lbmQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sICRfXzEyLCB0aGlzKTsKICAgICAgfSksCiAgICAgIGtleXM6ICR0cmFjZXVyUnVudGltZS5pbml0R2VuZXJhdG9yRnVuY3Rpb24oZnVuY3Rpb24gJF9fMTMoKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgdmFsdWU7CiAgICAgICAgcmV0dXJuICR0cmFjZXVyUnVudGltZS5jcmVhdGVHZW5lcmF0b3JJbnN0YW5jZShmdW5jdGlvbigkY3R4KSB7CiAgICAgICAgICB3aGlsZSAodHJ1ZSkKICAgICAgICAgICAgc3dpdGNoICgkY3R4LnN0YXRlKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaSA9IDA7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IChpIDwgdGhpcy5lbnRyaWVzXy5sZW5ndGgpID8gOCA6IC0yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgaSArPSAyOwogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAga2V5ID0gdGhpcy5lbnRyaWVzX1tpXTsKICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5lbnRyaWVzX1tpICsgMV07CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAoa2V5ID09PSBkZWxldGVkU2VudGluZWwpID8gNCA6IDY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgJGN0eC5tYXliZVRocm93KCk7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJGN0eC5lbmQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sICRfXzEzLCB0aGlzKTsKICAgICAgfSksCiAgICAgIHZhbHVlczogJHRyYWNldXJSdW50aW1lLmluaXRHZW5lcmF0b3JGdW5jdGlvbihmdW5jdGlvbiAkX18xNCgpIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAga2V5LAogICAgICAgICAgICB2YWx1ZTsKICAgICAgICByZXR1cm4gJHRyYWNldXJSdW50aW1lLmNyZWF0ZUdlbmVyYXRvckluc3RhbmNlKGZ1bmN0aW9uKCRjdHgpIHsKICAgICAgICAgIHdoaWxlICh0cnVlKQogICAgICAgICAgICBzd2l0Y2ggKCRjdHguc3RhdGUpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gKGkgPCB0aGlzLmVudHJpZXNfLmxlbmd0aCkgPyA4IDogLTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpICs9IDI7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBrZXkgPSB0aGlzLmVudHJpZXNfW2ldOwogICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmVudHJpZXNfW2kgKyAxXTsKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IChrZXkgPT09IGRlbGV0ZWRTZW50aW5lbCkgPyA0IDogNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICRjdHgubWF5YmVUaHJvdygpOwogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICRjdHguZW5kKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAkX18xNCwgdGhpcyk7CiAgICAgIH0pCiAgICB9LCB7fSk7CiAgfSgpKTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWFwLnByb3RvdHlwZSwgU3ltYm9sLml0ZXJhdG9yLCB7CiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB3cml0YWJsZTogdHJ1ZSwKICAgIHZhbHVlOiBNYXAucHJvdG90eXBlLmVudHJpZXMKICB9KTsKICBmdW5jdGlvbiBwb2x5ZmlsbE1hcChnbG9iYWwpIHsKICAgIHZhciAkX185ID0gZ2xvYmFsLAogICAgICAgIE9iamVjdCA9ICRfXzkuT2JqZWN0LAogICAgICAgIFN5bWJvbCA9ICRfXzkuU3ltYm9sOwogICAgaWYgKCFnbG9iYWwuTWFwKQogICAgICBnbG9iYWwuTWFwID0gTWFwOwogICAgdmFyIG1hcFByb3RvdHlwZSA9IGdsb2JhbC5NYXAucHJvdG90eXBlOwogICAgaWYgKG1hcFByb3RvdHlwZS5lbnRyaWVzID09PSB1bmRlZmluZWQpCiAgICAgIGdsb2JhbC5NYXAgPSBNYXA7CiAgICBpZiAobWFwUHJvdG90eXBlLmVudHJpZXMpIHsKICAgICAgbWF5YmVBZGRJdGVyYXRvcihtYXBQcm90b3R5cGUsIG1hcFByb3RvdHlwZS5lbnRyaWVzLCBTeW1ib2wpOwogICAgICBtYXliZUFkZEl0ZXJhdG9yKE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgZ2xvYmFsLk1hcCgpLmVudHJpZXMoKSksIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LCBTeW1ib2wpOwogICAgfQogIH0KICByZWdpc3RlclBvbHlmaWxsKHBvbHlmaWxsTWFwKTsKICByZXR1cm4gewogICAgZ2V0IE1hcCgpIHsKICAgICAgcmV0dXJuIE1hcDsKICAgIH0sCiAgICBnZXQgcG9seWZpbGxNYXAoKSB7CiAgICAgIHJldHVybiBwb2x5ZmlsbE1hcDsKICAgIH0KICB9Owp9KTsKU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvTWFwLmpzIiArICcnKTsKU3lzdGVtLnJlZ2lzdGVyTW9kdWxlKCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9TZXQuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvU2V0LmpzIjsKICB2YXIgJF9fMCA9IFN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3V0aWxzLmpzIiksCiAgICAgIGlzT2JqZWN0ID0gJF9fMC5pc09iamVjdCwKICAgICAgbWF5YmVBZGRJdGVyYXRvciA9ICRfXzAubWF5YmVBZGRJdGVyYXRvciwKICAgICAgcmVnaXN0ZXJQb2x5ZmlsbCA9ICRfXzAucmVnaXN0ZXJQb2x5ZmlsbDsKICB2YXIgTWFwID0gU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvTWFwLmpzIikuTWFwOwogIHZhciBnZXRPd25IYXNoT2JqZWN0ID0gJHRyYWNldXJSdW50aW1lLmdldE93bkhhc2hPYmplY3Q7CiAgdmFyICRoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CiAgZnVuY3Rpb24gaW5pdFNldChzZXQpIHsKICAgIHNldC5tYXBfID0gbmV3IE1hcCgpOwogIH0KICB2YXIgU2V0ID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gU2V0KCkgewogICAgICB2YXIgaXRlcmFibGUgPSBhcmd1bWVudHNbMF07CiAgICAgIGlmICghaXNPYmplY3QodGhpcykpCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignU2V0IGNhbGxlZCBvbiBpbmNvbXBhdGlibGUgdHlwZScpOwogICAgICBpZiAoJGhhc093blByb3BlcnR5LmNhbGwodGhpcywgJ21hcF8nKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1NldCBjYW4gbm90IGJlIHJlZW50cmFudGx5IGluaXRpYWxpc2VkJyk7CiAgICAgIH0KICAgICAgaW5pdFNldCh0aGlzKTsKICAgICAgaWYgKGl0ZXJhYmxlICE9PSBudWxsICYmIGl0ZXJhYmxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgJF9fNyA9IHRydWU7CiAgICAgICAgdmFyICRfXzggPSBmYWxzZTsKICAgICAgICB2YXIgJF9fOSA9IHVuZGVmaW5lZDsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgJF9fNSA9IHZvaWQgMCwKICAgICAgICAgICAgICAkX180ID0gKGl0ZXJhYmxlKVskdHJhY2V1clJ1bnRpbWUudG9Qcm9wZXJ0eShTeW1ib2wuaXRlcmF0b3IpXSgpOyAhKCRfXzcgPSAoJF9fNSA9ICRfXzQubmV4dCgpKS5kb25lKTsgJF9fNyA9IHRydWUpIHsKICAgICAgICAgICAgdmFyIGl0ZW0gPSAkX181LnZhbHVlOwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGhpcy5hZGQoaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoICgkX18xMCkgewogICAgICAgICAgJF9fOCA9IHRydWU7CiAgICAgICAgICAkX185ID0gJF9fMTA7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghJF9fNyAmJiAkX180LnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgJF9fNC5yZXR1cm4oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKCRfXzgpIHsKICAgICAgICAgICAgICB0aHJvdyAkX185OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoU2V0LCB7CiAgICAgIGdldCBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLm1hcF8uc2l6ZTsKICAgICAgfSwKICAgICAgaGFzOiBmdW5jdGlvbihrZXkpIHsKICAgICAgICByZXR1cm4gdGhpcy5tYXBfLmhhcyhrZXkpOwogICAgICB9LAogICAgICBhZGQ6IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHRoaXMubWFwXy5zZXQoa2V5LCBrZXkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBkZWxldGU6IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLm1hcF8uZGVsZXRlKGtleSk7CiAgICAgIH0sCiAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5tYXBfLmNsZWFyKCk7CiAgICAgIH0sCiAgICAgIGZvckVhY2g6IGZ1bmN0aW9uKGNhbGxiYWNrRm4pIHsKICAgICAgICB2YXIgdGhpc0FyZyA9IGFyZ3VtZW50c1sxXTsKICAgICAgICB2YXIgJF9fMiA9IHRoaXM7CiAgICAgICAgcmV0dXJuIHRoaXMubWFwXy5mb3JFYWNoKChmdW5jdGlvbih2YWx1ZSwga2V5KSB7CiAgICAgICAgICBjYWxsYmFja0ZuLmNhbGwodGhpc0FyZywga2V5LCBrZXksICRfXzIpOwogICAgICAgIH0pKTsKICAgICAgfSwKICAgICAgdmFsdWVzOiAkdHJhY2V1clJ1bnRpbWUuaW5pdEdlbmVyYXRvckZ1bmN0aW9uKGZ1bmN0aW9uICRfXzEyKCkgewogICAgICAgIHZhciAkX18xMywKICAgICAgICAgICAgJF9fMTQ7CiAgICAgICAgcmV0dXJuICR0cmFjZXVyUnVudGltZS5jcmVhdGVHZW5lcmF0b3JJbnN0YW5jZShmdW5jdGlvbigkY3R4KSB7CiAgICAgICAgICB3aGlsZSAodHJ1ZSkKICAgICAgICAgICAgc3dpdGNoICgkY3R4LnN0YXRlKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgJF9fMTMgPSAkY3R4LndyYXBZaWVsZFN0YXIodGhpcy5tYXBfLmtleXMoKVtTeW1ib2wuaXRlcmF0b3JdKCkpOwogICAgICAgICAgICAgICAgJGN0eC5zZW50ID0gdm9pZCAwOwogICAgICAgICAgICAgICAgJGN0eC5hY3Rpb24gPSAnbmV4dCc7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgJF9fMTQgPSAkX18xM1skY3R4LmFjdGlvbl0oJGN0eC5zZW50SWdub3JlVGhyb3cpOwogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gKCRfXzE0LmRvbmUpID8gMyA6IDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAkY3R4LnNlbnQgPSAkX18xNC52YWx1ZTsKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAtMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAxMjsKICAgICAgICAgICAgICAgIHJldHVybiAkX18xNC52YWx1ZTsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICRjdHguZW5kKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAkX18xMiwgdGhpcyk7CiAgICAgIH0pLAogICAgICBlbnRyaWVzOiAkdHJhY2V1clJ1bnRpbWUuaW5pdEdlbmVyYXRvckZ1bmN0aW9uKGZ1bmN0aW9uICRfXzE1KCkgewogICAgICAgIHZhciAkX18xNiwKICAgICAgICAgICAgJF9fMTc7CiAgICAgICAgcmV0dXJuICR0cmFjZXVyUnVudGltZS5jcmVhdGVHZW5lcmF0b3JJbnN0YW5jZShmdW5jdGlvbigkY3R4KSB7CiAgICAgICAgICB3aGlsZSAodHJ1ZSkKICAgICAgICAgICAgc3dpdGNoICgkY3R4LnN0YXRlKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgJF9fMTYgPSAkY3R4LndyYXBZaWVsZFN0YXIodGhpcy5tYXBfLmVudHJpZXMoKVtTeW1ib2wuaXRlcmF0b3JdKCkpOwogICAgICAgICAgICAgICAgJGN0eC5zZW50ID0gdm9pZCAwOwogICAgICAgICAgICAgICAgJGN0eC5hY3Rpb24gPSAnbmV4dCc7CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgJF9fMTcgPSAkX18xNlskY3R4LmFjdGlvbl0oJGN0eC5zZW50SWdub3JlVGhyb3cpOwogICAgICAgICAgICAgICAgJGN0eC5zdGF0ZSA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAkY3R4LnN0YXRlID0gKCRfXzE3LmRvbmUpID8gMyA6IDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAkY3R4LnNlbnQgPSAkX18xNy52YWx1ZTsKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAtMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAxMjsKICAgICAgICAgICAgICAgIHJldHVybiAkX18xNy52YWx1ZTsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICRjdHguZW5kKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAkX18xNSwgdGhpcyk7CiAgICAgIH0pCiAgICB9LCB7fSk7CiAgfSgpKTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2V0LnByb3RvdHlwZSwgU3ltYm9sLml0ZXJhdG9yLCB7CiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB3cml0YWJsZTogdHJ1ZSwKICAgIHZhbHVlOiBTZXQucHJvdG90eXBlLnZhbHVlcwogIH0pOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZXQucHJvdG90eXBlLCAna2V5cycsIHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIHdyaXRhYmxlOiB0cnVlLAogICAgdmFsdWU6IFNldC5wcm90b3R5cGUudmFsdWVzCiAgfSk7CiAgZnVuY3Rpb24gcG9seWZpbGxTZXQoZ2xvYmFsKSB7CiAgICB2YXIgJF9fMTEgPSBnbG9iYWwsCiAgICAgICAgT2JqZWN0ID0gJF9fMTEuT2JqZWN0LAogICAgICAgIFN5bWJvbCA9ICRfXzExLlN5bWJvbDsKICAgIGlmICghZ2xvYmFsLlNldCkKICAgICAgZ2xvYmFsLlNldCA9IFNldDsKICAgIHZhciBzZXRQcm90b3R5cGUgPSBnbG9iYWwuU2V0LnByb3RvdHlwZTsKICAgIGlmIChzZXRQcm90b3R5cGUudmFsdWVzKSB7CiAgICAgIG1heWJlQWRkSXRlcmF0b3Ioc2V0UHJvdG90eXBlLCBzZXRQcm90b3R5cGUudmFsdWVzLCBTeW1ib2wpOwogICAgICBtYXliZUFkZEl0ZXJhdG9yKE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgZ2xvYmFsLlNldCgpLnZhbHVlcygpKSwgZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIFN5bWJvbCk7CiAgICB9CiAgfQogIHJlZ2lzdGVyUG9seWZpbGwocG9seWZpbGxTZXQpOwogIHJldHVybiB7CiAgICBnZXQgU2V0KCkgewogICAgICByZXR1cm4gU2V0OwogICAgfSwKICAgIGdldCBwb2x5ZmlsbFNldCgpIHsKICAgICAgcmV0dXJuIHBvbHlmaWxsU2V0OwogICAgfQogIH07Cn0pOwpTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9TZXQuanMiICsgJycpOwpTeXN0ZW0ucmVnaXN0ZXJNb2R1bGUoInRyYWNldXItcnVudGltZUAwLjAuODgvbm9kZV9tb2R1bGVzL3JzdnAvbGliL3JzdnAvYXNhcC5qcyIsIFtdLCBmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L25vZGVfbW9kdWxlcy9yc3ZwL2xpYi9yc3ZwL2FzYXAuanMiOwogIHZhciBsZW4gPSAwOwogIGZ1bmN0aW9uIGFzYXAoY2FsbGJhY2ssIGFyZykgewogICAgcXVldWVbbGVuXSA9IGNhbGxiYWNrOwogICAgcXVldWVbbGVuICsgMV0gPSBhcmc7CiAgICBsZW4gKz0gMjsKICAgIGlmIChsZW4gPT09IDIpIHsKICAgICAgc2NoZWR1bGVGbHVzaCgpOwogICAgfQogIH0KICB2YXIgJF9fZGVmYXVsdCA9IGFzYXA7CiAgdmFyIGJyb3dzZXJHbG9iYWwgPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpID8gd2luZG93IDoge307CiAgdmFyIEJyb3dzZXJNdXRhdGlvbk9ic2VydmVyID0gYnJvd3Nlckdsb2JhbC5NdXRhdGlvbk9ic2VydmVyIHx8IGJyb3dzZXJHbG9iYWwuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjsKICB2YXIgaXNXb3JrZXIgPSB0eXBlb2YgVWludDhDbGFtcGVkQXJyYXkgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBpbXBvcnRTY3JpcHRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgTWVzc2FnZUNoYW5uZWwgIT09ICd1bmRlZmluZWQnOwogIGZ1bmN0aW9uIHVzZU5leHRUaWNrKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICBwcm9jZXNzLm5leHRUaWNrKGZsdXNoKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIHVzZU11dGF0aW9uT2JzZXJ2ZXIoKSB7CiAgICB2YXIgaXRlcmF0aW9ucyA9IDA7CiAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgQnJvd3Nlck11dGF0aW9uT2JzZXJ2ZXIoZmx1c2gpOwogICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyk7CiAgICBvYnNlcnZlci5vYnNlcnZlKG5vZGUsIHtjaGFyYWN0ZXJEYXRhOiB0cnVlfSk7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIG5vZGUuZGF0YSA9IChpdGVyYXRpb25zID0gKytpdGVyYXRpb25zICUgMik7CiAgICB9OwogIH0KICBmdW5jdGlvbiB1c2VNZXNzYWdlQ2hhbm5lbCgpIHsKICAgIHZhciBjaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7CiAgICBjaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGZsdXNoOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICBjaGFubmVsLnBvcnQyLnBvc3RNZXNzYWdlKDApOwogICAgfTsKICB9CiAgZnVuY3Rpb24gdXNlU2V0VGltZW91dCgpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgc2V0VGltZW91dChmbHVzaCwgMSk7CiAgICB9OwogIH0KICB2YXIgcXVldWUgPSBuZXcgQXJyYXkoMTAwMCk7CiAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IHF1ZXVlW2ldOwogICAgICB2YXIgYXJnID0gcXVldWVbaSArIDFdOwogICAgICBjYWxsYmFjayhhcmcpOwogICAgICBxdWV1ZVtpXSA9IHVuZGVmaW5lZDsKICAgICAgcXVldWVbaSArIDFdID0gdW5kZWZpbmVkOwogICAgfQogICAgbGVuID0gMDsKICB9CiAgdmFyIHNjaGVkdWxlRmx1c2g7CiAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXScpIHsKICAgIHNjaGVkdWxlRmx1c2ggPSB1c2VOZXh0VGljaygpOwogIH0gZWxzZSBpZiAoQnJvd3Nlck11dGF0aW9uT2JzZXJ2ZXIpIHsKICAgIHNjaGVkdWxlRmx1c2ggPSB1c2VNdXRhdGlvbk9ic2VydmVyKCk7CiAgfSBlbHNlIGlmIChpc1dvcmtlcikgewogICAgc2NoZWR1bGVGbHVzaCA9IHVzZU1lc3NhZ2VDaGFubmVsKCk7CiAgfSBlbHNlIHsKICAgIHNjaGVkdWxlRmx1c2ggPSB1c2VTZXRUaW1lb3V0KCk7CiAgfQogIHJldHVybiB7Z2V0IGRlZmF1bHQoKSB7CiAgICAgIHJldHVybiAkX19kZWZhdWx0OwogICAgfX07Cn0pOwpTeXN0ZW0ucmVnaXN0ZXJNb2R1bGUoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL1Byb21pc2UuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvUHJvbWlzZS5qcyI7CiAgdmFyIGFzeW5jID0gU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9ub2RlX21vZHVsZXMvcnN2cC9saWIvcnN2cC9hc2FwLmpzIikuZGVmYXVsdDsKICB2YXIgcmVnaXN0ZXJQb2x5ZmlsbCA9IFN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3V0aWxzLmpzIikucmVnaXN0ZXJQb2x5ZmlsbDsKICB2YXIgcHJvbWlzZVJhdyA9IHt9OwogIGZ1bmN0aW9uIGlzUHJvbWlzZSh4KSB7CiAgICByZXR1cm4geCAmJiB0eXBlb2YgeCA9PT0gJ29iamVjdCcgJiYgeC5zdGF0dXNfICE9PSB1bmRlZmluZWQ7CiAgfQogIGZ1bmN0aW9uIGlkUmVzb2x2ZUhhbmRsZXIoeCkgewogICAgcmV0dXJuIHg7CiAgfQogIGZ1bmN0aW9uIGlkUmVqZWN0SGFuZGxlcih4KSB7CiAgICB0aHJvdyB4OwogIH0KICBmdW5jdGlvbiBjaGFpbihwcm9taXNlKSB7CiAgICB2YXIgb25SZXNvbHZlID0gYXJndW1lbnRzWzFdICE9PSAodm9pZCAwKSA/IGFyZ3VtZW50c1sxXSA6IGlkUmVzb2x2ZUhhbmRsZXI7CiAgICB2YXIgb25SZWplY3QgPSBhcmd1bWVudHNbMl0gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzJdIDogaWRSZWplY3RIYW5kbGVyOwogICAgdmFyIGRlZmVycmVkID0gZ2V0RGVmZXJyZWQocHJvbWlzZS5jb25zdHJ1Y3Rvcik7CiAgICBzd2l0Y2ggKHByb21pc2Uuc3RhdHVzXykgewogICAgICBjYXNlIHVuZGVmaW5lZDoKICAgICAgICB0aHJvdyBUeXBlRXJyb3I7CiAgICAgIGNhc2UgMDoKICAgICAgICBwcm9taXNlLm9uUmVzb2x2ZV8ucHVzaChvblJlc29sdmUsIGRlZmVycmVkKTsKICAgICAgICBwcm9taXNlLm9uUmVqZWN0Xy5wdXNoKG9uUmVqZWN0LCBkZWZlcnJlZCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgKzE6CiAgICAgICAgcHJvbWlzZUVucXVldWUocHJvbWlzZS52YWx1ZV8sIFtvblJlc29sdmUsIGRlZmVycmVkXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgLTE6CiAgICAgICAgcHJvbWlzZUVucXVldWUocHJvbWlzZS52YWx1ZV8sIFtvblJlamVjdCwgZGVmZXJyZWRdKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOwogIH0KICBmdW5jdGlvbiBnZXREZWZlcnJlZChDKSB7CiAgICBpZiAodGhpcyA9PT0gJFByb21pc2UpIHsKICAgICAgdmFyIHByb21pc2UgPSBwcm9taXNlSW5pdChuZXcgJFByb21pc2UocHJvbWlzZVJhdykpOwogICAgICByZXR1cm4gewogICAgICAgIHByb21pc2U6IHByb21pc2UsCiAgICAgICAgcmVzb2x2ZTogKGZ1bmN0aW9uKHgpIHsKICAgICAgICAgIHByb21pc2VSZXNvbHZlKHByb21pc2UsIHgpOwogICAgICAgIH0pLAogICAgICAgIHJlamVjdDogKGZ1bmN0aW9uKHIpIHsKICAgICAgICAgIHByb21pc2VSZWplY3QocHJvbWlzZSwgcik7CiAgICAgICAgfSkKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgcmVzdWx0LnByb21pc2UgPSBuZXcgQygoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgcmVzdWx0LnJlc29sdmUgPSByZXNvbHZlOwogICAgICAgIHJlc3VsdC5yZWplY3QgPSByZWplY3Q7CiAgICAgIH0pKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9CiAgZnVuY3Rpb24gcHJvbWlzZVNldChwcm9taXNlLCBzdGF0dXMsIHZhbHVlLCBvblJlc29sdmUsIG9uUmVqZWN0KSB7CiAgICBwcm9taXNlLnN0YXR1c18gPSBzdGF0dXM7CiAgICBwcm9taXNlLnZhbHVlXyA9IHZhbHVlOwogICAgcHJvbWlzZS5vblJlc29sdmVfID0gb25SZXNvbHZlOwogICAgcHJvbWlzZS5vblJlamVjdF8gPSBvblJlamVjdDsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBmdW5jdGlvbiBwcm9taXNlSW5pdChwcm9taXNlKSB7CiAgICByZXR1cm4gcHJvbWlzZVNldChwcm9taXNlLCAwLCB1bmRlZmluZWQsIFtdLCBbXSk7CiAgfQogIHZhciBQcm9taXNlID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gUHJvbWlzZShyZXNvbHZlcikgewogICAgICBpZiAocmVzb2x2ZXIgPT09IHByb21pc2VSYXcpCiAgICAgICAgcmV0dXJuIDsKICAgICAgaWYgKHR5cGVvZiByZXNvbHZlciAhPT0gJ2Z1bmN0aW9uJykKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yOwogICAgICB2YXIgcHJvbWlzZSA9IHByb21pc2VJbml0KHRoaXMpOwogICAgICB0cnkgewogICAgICAgIHJlc29sdmVyKChmdW5jdGlvbih4KSB7CiAgICAgICAgICBwcm9taXNlUmVzb2x2ZShwcm9taXNlLCB4KTsKICAgICAgICB9KSwgKGZ1bmN0aW9uKHIpIHsKICAgICAgICAgIHByb21pc2VSZWplY3QocHJvbWlzZSwgcik7CiAgICAgICAgfSkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcHJvbWlzZVJlamVjdChwcm9taXNlLCBlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuICgkdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MpKFByb21pc2UsIHsKICAgICAgY2F0Y2g6IGZ1bmN0aW9uKG9uUmVqZWN0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGhlbih1bmRlZmluZWQsIG9uUmVqZWN0KTsKICAgICAgfSwKICAgICAgdGhlbjogZnVuY3Rpb24ob25SZXNvbHZlLCBvblJlamVjdCkgewogICAgICAgIGlmICh0eXBlb2Ygb25SZXNvbHZlICE9PSAnZnVuY3Rpb24nKQogICAgICAgICAgb25SZXNvbHZlID0gaWRSZXNvbHZlSGFuZGxlcjsKICAgICAgICBpZiAodHlwZW9mIG9uUmVqZWN0ICE9PSAnZnVuY3Rpb24nKQogICAgICAgICAgb25SZWplY3QgPSBpZFJlamVjdEhhbmRsZXI7CiAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgIHZhciBjb25zdHJ1Y3RvciA9IHRoaXMuY29uc3RydWN0b3I7CiAgICAgICAgcmV0dXJuIGNoYWluKHRoaXMsIGZ1bmN0aW9uKHgpIHsKICAgICAgICAgIHggPSBwcm9taXNlQ29lcmNlKGNvbnN0cnVjdG9yLCB4KTsKICAgICAgICAgIHJldHVybiB4ID09PSB0aGF0ID8gb25SZWplY3QobmV3IFR5cGVFcnJvcikgOiBpc1Byb21pc2UoeCkgPyB4LnRoZW4ob25SZXNvbHZlLCBvblJlamVjdCkgOiBvblJlc29sdmUoeCk7CiAgICAgICAgfSwgb25SZWplY3QpOwogICAgICB9CiAgICB9LCB7CiAgICAgIHJlc29sdmU6IGZ1bmN0aW9uKHgpIHsKICAgICAgICBpZiAodGhpcyA9PT0gJFByb21pc2UpIHsKICAgICAgICAgIGlmIChpc1Byb21pc2UoeCkpIHsKICAgICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHJvbWlzZVNldChuZXcgJFByb21pc2UocHJvbWlzZVJhdyksICsxLCB4KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG5ldyB0aGlzKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICByZXNvbHZlKHgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICByZWplY3Q6IGZ1bmN0aW9uKHIpIHsKICAgICAgICBpZiAodGhpcyA9PT0gJFByb21pc2UpIHsKICAgICAgICAgIHJldHVybiBwcm9taXNlU2V0KG5ldyAkUHJvbWlzZShwcm9taXNlUmF3KSwgLTEsIHIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gbmV3IHRoaXMoKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICByZWplY3Qocik7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhbGw6IGZ1bmN0aW9uKHZhbHVlcykgewogICAgICAgIHZhciBkZWZlcnJlZCA9IGdldERlZmVycmVkKHRoaXMpOwogICAgICAgIHZhciByZXNvbHV0aW9ucyA9IFtdOwogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgbWFrZUNvdW50ZG93bkZ1bmN0aW9uID0gZnVuY3Rpb24oaSkgewogICAgICAgICAgICByZXR1cm4gKGZ1bmN0aW9uKHgpIHsKICAgICAgICAgICAgICByZXNvbHV0aW9uc1tpXSA9IHg7CiAgICAgICAgICAgICAgaWYgKC0tY291bnQgPT09IDApCiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc29sdXRpb25zKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHZhciAkX182ID0gdHJ1ZTsKICAgICAgICAgIHZhciAkX183ID0gZmFsc2U7CiAgICAgICAgICB2YXIgJF9fOCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAodmFyICRfXzQgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAkX18zID0gKHZhbHVlcylbJHRyYWNldXJSdW50aW1lLnRvUHJvcGVydHkoU3ltYm9sLml0ZXJhdG9yKV0oKTsgISgkX182ID0gKCRfXzQgPSAkX18zLm5leHQoKSkuZG9uZSk7ICRfXzYgPSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJF9fNC52YWx1ZTsKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgY291bnRkb3duRnVuY3Rpb24gPSBtYWtlQ291bnRkb3duRnVuY3Rpb24oaSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmUodmFsdWUpLnRoZW4oY291bnRkb3duRnVuY3Rpb24sIChmdW5jdGlvbihyKSB7CiAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICsraTsKICAgICAgICAgICAgICAgICsrY291bnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoICgkX185KSB7CiAgICAgICAgICAgICRfXzcgPSB0cnVlOwogICAgICAgICAgICAkX184ID0gJF9fOTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKCEkX182ICYmICRfXzMucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICRfXzMucmV0dXJuKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIGlmICgkX183KSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkX184OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzb2x1dGlvbnMpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7CiAgICAgIH0sCiAgICAgIHJhY2U6IGZ1bmN0aW9uKHZhbHVlcykgewogICAgICAgIHZhciBkZWZlcnJlZCA9IGdldERlZmVycmVkKHRoaXMpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGlzLnJlc29sdmUodmFsdWVzW2ldKS50aGVuKChmdW5jdGlvbih4KSB7CiAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh4KTsKICAgICAgICAgICAgfSksIChmdW5jdGlvbihyKSB7CiAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHIpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTsKICAgICAgfQogICAgfSk7CiAgfSgpKTsKICB2YXIgJFByb21pc2UgPSBQcm9taXNlOwogIHZhciAkUHJvbWlzZVJlamVjdCA9ICRQcm9taXNlLnJlamVjdDsKICBmdW5jdGlvbiBwcm9taXNlUmVzb2x2ZShwcm9taXNlLCB4KSB7CiAgICBwcm9taXNlRG9uZShwcm9taXNlLCArMSwgeCwgcHJvbWlzZS5vblJlc29sdmVfKTsKICB9CiAgZnVuY3Rpb24gcHJvbWlzZVJlamVjdChwcm9taXNlLCByKSB7CiAgICBwcm9taXNlRG9uZShwcm9taXNlLCAtMSwgciwgcHJvbWlzZS5vblJlamVjdF8pOwogIH0KICBmdW5jdGlvbiBwcm9taXNlRG9uZShwcm9taXNlLCBzdGF0dXMsIHZhbHVlLCByZWFjdGlvbnMpIHsKICAgIGlmIChwcm9taXNlLnN0YXR1c18gIT09IDApCiAgICAgIHJldHVybiA7CiAgICBwcm9taXNlRW5xdWV1ZSh2YWx1ZSwgcmVhY3Rpb25zKTsKICAgIHByb21pc2VTZXQocHJvbWlzZSwgc3RhdHVzLCB2YWx1ZSk7CiAgfQogIGZ1bmN0aW9uIHByb21pc2VFbnF1ZXVlKHZhbHVlLCB0YXNrcykgewogICAgYXN5bmMoKGZ1bmN0aW9uKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhc2tzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgcHJvbWlzZUhhbmRsZSh2YWx1ZSwgdGFza3NbaV0sIHRhc2tzW2kgKyAxXSk7CiAgICAgIH0KICAgIH0pKTsKICB9CiAgZnVuY3Rpb24gcHJvbWlzZUhhbmRsZSh2YWx1ZSwgaGFuZGxlciwgZGVmZXJyZWQpIHsKICAgIHRyeSB7CiAgICAgIHZhciByZXN1bHQgPSBoYW5kbGVyKHZhbHVlKTsKICAgICAgaWYgKHJlc3VsdCA9PT0gZGVmZXJyZWQucHJvbWlzZSkKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yOwogICAgICBlbHNlIGlmIChpc1Byb21pc2UocmVzdWx0KSkKICAgICAgICBjaGFpbihyZXN1bHQsIGRlZmVycmVkLnJlc29sdmUsIGRlZmVycmVkLnJlamVjdCk7CiAgICAgIGVsc2UKICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZGVmZXJyZWQucmVqZWN0KGUpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogIH0KICB2YXIgdGhlbmFibGVTeW1ib2wgPSAnQEB0aGVuYWJsZSc7CiAgZnVuY3Rpb24gaXNPYmplY3QoeCkgewogICAgcmV0dXJuIHggJiYgKHR5cGVvZiB4ID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgeCA9PT0gJ2Z1bmN0aW9uJyk7CiAgfQogIGZ1bmN0aW9uIHByb21pc2VDb2VyY2UoY29uc3RydWN0b3IsIHgpIHsKICAgIGlmICghaXNQcm9taXNlKHgpICYmIGlzT2JqZWN0KHgpKSB7CiAgICAgIHZhciB0aGVuOwogICAgICB0cnkgewogICAgICAgIHRoZW4gPSB4LnRoZW47CiAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICB2YXIgcHJvbWlzZSA9ICRQcm9taXNlUmVqZWN0LmNhbGwoY29uc3RydWN0b3IsIHIpOwogICAgICAgIHhbdGhlbmFibGVTeW1ib2xdID0gcHJvbWlzZTsKICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIHRoZW4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB2YXIgcCA9IHhbdGhlbmFibGVTeW1ib2xdOwogICAgICAgIGlmIChwKSB7CiAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGRlZmVycmVkID0gZ2V0RGVmZXJyZWQoY29uc3RydWN0b3IpOwogICAgICAgICAgeFt0aGVuYWJsZVN5bWJvbF0gPSBkZWZlcnJlZC5wcm9taXNlOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhlbi5jYWxsKHgsIGRlZmVycmVkLnJlc29sdmUsIGRlZmVycmVkLnJlamVjdCk7CiAgICAgICAgICB9IGNhdGNoIChyKSB7CiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHg7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsUHJvbWlzZShnbG9iYWwpIHsKICAgIGlmICghZ2xvYmFsLlByb21pc2UpCiAgICAgIGdsb2JhbC5Qcm9taXNlID0gUHJvbWlzZTsKICB9CiAgcmVnaXN0ZXJQb2x5ZmlsbChwb2x5ZmlsbFByb21pc2UpOwogIHJldHVybiB7CiAgICBnZXQgUHJvbWlzZSgpIHsKICAgICAgcmV0dXJuIFByb21pc2U7CiAgICB9LAogICAgZ2V0IHBvbHlmaWxsUHJvbWlzZSgpIHsKICAgICAgcmV0dXJuIHBvbHlmaWxsUHJvbWlzZTsKICAgIH0KICB9Owp9KTsKU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvUHJvbWlzZS5qcyIgKyAnJyk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvU3RyaW5nSXRlcmF0b3IuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvU3RyaW5nSXRlcmF0b3IuanMiOwogIHZhciAkX18wID0gU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvdXRpbHMuanMiKSwKICAgICAgY3JlYXRlSXRlcmF0b3JSZXN1bHRPYmplY3QgPSAkX18wLmNyZWF0ZUl0ZXJhdG9yUmVzdWx0T2JqZWN0LAogICAgICBpc09iamVjdCA9ICRfXzAuaXNPYmplY3Q7CiAgdmFyIHRvUHJvcGVydHkgPSAkdHJhY2V1clJ1bnRpbWUudG9Qcm9wZXJ0eTsKICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIHZhciBpdGVyYXRlZFN0cmluZyA9IFN5bWJvbCgnaXRlcmF0ZWRTdHJpbmcnKTsKICB2YXIgc3RyaW5nSXRlcmF0b3JOZXh0SW5kZXggPSBTeW1ib2woJ3N0cmluZ0l0ZXJhdG9yTmV4dEluZGV4Jyk7CiAgdmFyIFN0cmluZ0l0ZXJhdG9yID0gKGZ1bmN0aW9uKCkgewogICAgdmFyICRfXzI7CiAgICBmdW5jdGlvbiBTdHJpbmdJdGVyYXRvcigpIHt9CiAgICByZXR1cm4gKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoU3RyaW5nSXRlcmF0b3IsICgkX18yID0ge30sIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSgkX18yLCAibmV4dCIsIHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBvID0gdGhpczsKICAgICAgICBpZiAoIWlzT2JqZWN0KG8pIHx8ICFoYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIGl0ZXJhdGVkU3RyaW5nKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigndGhpcyBtdXN0IGJlIGEgU3RyaW5nSXRlcmF0b3Igb2JqZWN0Jyk7CiAgICAgICAgfQogICAgICAgIHZhciBzID0gb1t0b1Byb3BlcnR5KGl0ZXJhdGVkU3RyaW5nKV07CiAgICAgICAgaWYgKHMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZXJhdG9yUmVzdWx0T2JqZWN0KHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIHZhciBwb3NpdGlvbiA9IG9bdG9Qcm9wZXJ0eShzdHJpbmdJdGVyYXRvck5leHRJbmRleCldOwogICAgICAgIHZhciBsZW4gPSBzLmxlbmd0aDsKICAgICAgICBpZiAocG9zaXRpb24gPj0gbGVuKSB7CiAgICAgICAgICBvW3RvUHJvcGVydHkoaXRlcmF0ZWRTdHJpbmcpXSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyYXRvclJlc3VsdE9iamVjdCh1bmRlZmluZWQsIHRydWUpOwogICAgICAgIH0KICAgICAgICB2YXIgZmlyc3QgPSBzLmNoYXJDb2RlQXQocG9zaXRpb24pOwogICAgICAgIHZhciByZXN1bHRTdHJpbmc7CiAgICAgICAgaWYgKGZpcnN0IDwgMHhEODAwIHx8IGZpcnN0ID4gMHhEQkZGIHx8IHBvc2l0aW9uICsgMSA9PT0gbGVuKSB7CiAgICAgICAgICByZXN1bHRTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZpcnN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHNlY29uZCA9IHMuY2hhckNvZGVBdChwb3NpdGlvbiArIDEpOwogICAgICAgICAgaWYgKHNlY29uZCA8IDB4REMwMCB8fCBzZWNvbmQgPiAweERGRkYpIHsKICAgICAgICAgICAgcmVzdWx0U3RyaW5nID0gU3RyaW5nLmZyb21DaGFyQ29kZShmaXJzdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHRTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZpcnN0KSArIFN0cmluZy5mcm9tQ2hhckNvZGUoc2Vjb25kKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb1t0b1Byb3BlcnR5KHN0cmluZ0l0ZXJhdG9yTmV4dEluZGV4KV0gPSBwb3NpdGlvbiArIHJlc3VsdFN0cmluZy5sZW5ndGg7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZXJhdG9yUmVzdWx0T2JqZWN0KHJlc3VsdFN0cmluZywgZmFsc2UpOwogICAgICB9LAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KCRfXzIsIFN5bWJvbC5pdGVyYXRvciwgewogICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pLCAkX18yKSwge30pOwogIH0oKSk7CiAgZnVuY3Rpb24gY3JlYXRlU3RyaW5nSXRlcmF0b3Ioc3RyaW5nKSB7CiAgICB2YXIgcyA9IFN0cmluZyhzdHJpbmcpOwogICAgdmFyIGl0ZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShTdHJpbmdJdGVyYXRvci5wcm90b3R5cGUpOwogICAgaXRlcmF0b3JbdG9Qcm9wZXJ0eShpdGVyYXRlZFN0cmluZyldID0gczsKICAgIGl0ZXJhdG9yW3RvUHJvcGVydHkoc3RyaW5nSXRlcmF0b3JOZXh0SW5kZXgpXSA9IDA7CiAgICByZXR1cm4gaXRlcmF0b3I7CiAgfQogIHJldHVybiB7Z2V0IGNyZWF0ZVN0cmluZ0l0ZXJhdG9yKCkgewogICAgICByZXR1cm4gY3JlYXRlU3RyaW5nSXRlcmF0b3I7CiAgICB9fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvU3RyaW5nLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL1N0cmluZy5qcyI7CiAgdmFyIGNyZWF0ZVN0cmluZ0l0ZXJhdG9yID0gU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvU3RyaW5nSXRlcmF0b3IuanMiKS5jcmVhdGVTdHJpbmdJdGVyYXRvcjsKICB2YXIgJF9fMSA9IFN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3V0aWxzLmpzIiksCiAgICAgIG1heWJlQWRkRnVuY3Rpb25zID0gJF9fMS5tYXliZUFkZEZ1bmN0aW9ucywKICAgICAgbWF5YmVBZGRJdGVyYXRvciA9ICRfXzEubWF5YmVBZGRJdGVyYXRvciwKICAgICAgcmVnaXN0ZXJQb2x5ZmlsbCA9ICRfXzEucmVnaXN0ZXJQb2x5ZmlsbDsKICB2YXIgJHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICB2YXIgJGluZGV4T2YgPSBTdHJpbmcucHJvdG90eXBlLmluZGV4T2Y7CiAgdmFyICRsYXN0SW5kZXhPZiA9IFN0cmluZy5wcm90b3R5cGUubGFzdEluZGV4T2Y7CiAgZnVuY3Rpb24gc3RhcnRzV2l0aChzZWFyY2gpIHsKICAgIHZhciBzdHJpbmcgPSBTdHJpbmcodGhpcyk7CiAgICBpZiAodGhpcyA9PSBudWxsIHx8ICR0b1N0cmluZy5jYWxsKHNlYXJjaCkgPT0gJ1tvYmplY3QgUmVnRXhwXScpIHsKICAgICAgdGhyb3cgVHlwZUVycm9yKCk7CiAgICB9CiAgICB2YXIgc3RyaW5nTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsKICAgIHZhciBzZWFyY2hTdHJpbmcgPSBTdHJpbmcoc2VhcmNoKTsKICAgIHZhciBzZWFyY2hMZW5ndGggPSBzZWFyY2hTdHJpbmcubGVuZ3RoOwogICAgdmFyIHBvc2l0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICB2YXIgcG9zID0gcG9zaXRpb24gPyBOdW1iZXIocG9zaXRpb24pIDogMDsKICAgIGlmIChpc05hTihwb3MpKSB7CiAgICAgIHBvcyA9IDA7CiAgICB9CiAgICB2YXIgc3RhcnQgPSBNYXRoLm1pbihNYXRoLm1heChwb3MsIDApLCBzdHJpbmdMZW5ndGgpOwogICAgcmV0dXJuICRpbmRleE9mLmNhbGwoc3RyaW5nLCBzZWFyY2hTdHJpbmcsIHBvcykgPT0gc3RhcnQ7CiAgfQogIGZ1bmN0aW9uIGVuZHNXaXRoKHNlYXJjaCkgewogICAgdmFyIHN0cmluZyA9IFN0cmluZyh0aGlzKTsKICAgIGlmICh0aGlzID09IG51bGwgfHwgJHRvU3RyaW5nLmNhbGwoc2VhcmNoKSA9PSAnW29iamVjdCBSZWdFeHBdJykgewogICAgICB0aHJvdyBUeXBlRXJyb3IoKTsKICAgIH0KICAgIHZhciBzdHJpbmdMZW5ndGggPSBzdHJpbmcubGVuZ3RoOwogICAgdmFyIHNlYXJjaFN0cmluZyA9IFN0cmluZyhzZWFyY2gpOwogICAgdmFyIHNlYXJjaExlbmd0aCA9IHNlYXJjaFN0cmluZy5sZW5ndGg7CiAgICB2YXIgcG9zID0gc3RyaW5nTGVuZ3RoOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgIHZhciBwb3NpdGlvbiA9IGFyZ3VtZW50c1sxXTsKICAgICAgaWYgKHBvc2l0aW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBwb3MgPSBwb3NpdGlvbiA/IE51bWJlcihwb3NpdGlvbikgOiAwOwogICAgICAgIGlmIChpc05hTihwb3MpKSB7CiAgICAgICAgICBwb3MgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdmFyIGVuZCA9IE1hdGgubWluKE1hdGgubWF4KHBvcywgMCksIHN0cmluZ0xlbmd0aCk7CiAgICB2YXIgc3RhcnQgPSBlbmQgLSBzZWFyY2hMZW5ndGg7CiAgICBpZiAoc3RhcnQgPCAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiAkbGFzdEluZGV4T2YuY2FsbChzdHJpbmcsIHNlYXJjaFN0cmluZywgc3RhcnQpID09IHN0YXJ0OwogIH0KICBmdW5jdGlvbiBpbmNsdWRlcyhzZWFyY2gpIHsKICAgIGlmICh0aGlzID09IG51bGwpIHsKICAgICAgdGhyb3cgVHlwZUVycm9yKCk7CiAgICB9CiAgICB2YXIgc3RyaW5nID0gU3RyaW5nKHRoaXMpOwogICAgaWYgKHNlYXJjaCAmJiAkdG9TdHJpbmcuY2FsbChzZWFyY2gpID09ICdbb2JqZWN0IFJlZ0V4cF0nKSB7CiAgICAgIHRocm93IFR5cGVFcnJvcigpOwogICAgfQogICAgdmFyIHN0cmluZ0xlbmd0aCA9IHN0cmluZy5sZW5ndGg7CiAgICB2YXIgc2VhcmNoU3RyaW5nID0gU3RyaW5nKHNlYXJjaCk7CiAgICB2YXIgc2VhcmNoTGVuZ3RoID0gc2VhcmNoU3RyaW5nLmxlbmd0aDsKICAgIHZhciBwb3NpdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgdmFyIHBvcyA9IHBvc2l0aW9uID8gTnVtYmVyKHBvc2l0aW9uKSA6IDA7CiAgICBpZiAocG9zICE9IHBvcykgewogICAgICBwb3MgPSAwOwogICAgfQogICAgdmFyIHN0YXJ0ID0gTWF0aC5taW4oTWF0aC5tYXgocG9zLCAwKSwgc3RyaW5nTGVuZ3RoKTsKICAgIGlmIChzZWFyY2hMZW5ndGggKyBzdGFydCA+IHN0cmluZ0xlbmd0aCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gJGluZGV4T2YuY2FsbChzdHJpbmcsIHNlYXJjaFN0cmluZywgcG9zKSAhPSAtMTsKICB9CiAgZnVuY3Rpb24gcmVwZWF0KGNvdW50KSB7CiAgICBpZiAodGhpcyA9PSBudWxsKSB7CiAgICAgIHRocm93IFR5cGVFcnJvcigpOwogICAgfQogICAgdmFyIHN0cmluZyA9IFN0cmluZyh0aGlzKTsKICAgIHZhciBuID0gY291bnQgPyBOdW1iZXIoY291bnQpIDogMDsKICAgIGlmIChpc05hTihuKSkgewogICAgICBuID0gMDsKICAgIH0KICAgIGlmIChuIDwgMCB8fCBuID09IEluZmluaXR5KSB7CiAgICAgIHRocm93IFJhbmdlRXJyb3IoKTsKICAgIH0KICAgIGlmIChuID09IDApIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgd2hpbGUgKG4tLSkgewogICAgICByZXN1bHQgKz0gc3RyaW5nOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgZnVuY3Rpb24gY29kZVBvaW50QXQocG9zaXRpb24pIHsKICAgIGlmICh0aGlzID09IG51bGwpIHsKICAgICAgdGhyb3cgVHlwZUVycm9yKCk7CiAgICB9CiAgICB2YXIgc3RyaW5nID0gU3RyaW5nKHRoaXMpOwogICAgdmFyIHNpemUgPSBzdHJpbmcubGVuZ3RoOwogICAgdmFyIGluZGV4ID0gcG9zaXRpb24gPyBOdW1iZXIocG9zaXRpb24pIDogMDsKICAgIGlmIChpc05hTihpbmRleCkpIHsKICAgICAgaW5kZXggPSAwOwogICAgfQogICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBzaXplKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB2YXIgZmlyc3QgPSBzdHJpbmcuY2hhckNvZGVBdChpbmRleCk7CiAgICB2YXIgc2Vjb25kOwogICAgaWYgKGZpcnN0ID49IDB4RDgwMCAmJiBmaXJzdCA8PSAweERCRkYgJiYgc2l6ZSA+IGluZGV4ICsgMSkgewogICAgICBzZWNvbmQgPSBzdHJpbmcuY2hhckNvZGVBdChpbmRleCArIDEpOwogICAgICBpZiAoc2Vjb25kID49IDB4REMwMCAmJiBzZWNvbmQgPD0gMHhERkZGKSB7CiAgICAgICAgcmV0dXJuIChmaXJzdCAtIDB4RDgwMCkgKiAweDQwMCArIHNlY29uZCAtIDB4REMwMCArIDB4MTAwMDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmaXJzdDsKICB9CiAgZnVuY3Rpb24gcmF3KGNhbGxzaXRlKSB7CiAgICB2YXIgcmF3ID0gY2FsbHNpdGUucmF3OwogICAgdmFyIGxlbiA9IHJhdy5sZW5ndGggPj4+IDA7CiAgICBpZiAobGVuID09PSAwKQogICAgICByZXR1cm4gJyc7CiAgICB2YXIgcyA9ICcnOwogICAgdmFyIGkgPSAwOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgcyArPSByYXdbaV07CiAgICAgIGlmIChpICsgMSA9PT0gbGVuKQogICAgICAgIHJldHVybiBzOwogICAgICBzICs9IGFyZ3VtZW50c1srK2ldOwogICAgfQogIH0KICBmdW5jdGlvbiBmcm9tQ29kZVBvaW50KF8pIHsKICAgIHZhciBjb2RlVW5pdHMgPSBbXTsKICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7CiAgICB2YXIgaGlnaFN1cnJvZ2F0ZTsKICAgIHZhciBsb3dTdXJyb2dhdGU7CiAgICB2YXIgaW5kZXggPSAtMTsKICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGNvZGVQb2ludCA9IE51bWJlcihhcmd1bWVudHNbaW5kZXhdKTsKICAgICAgaWYgKCFpc0Zpbml0ZShjb2RlUG9pbnQpIHx8IGNvZGVQb2ludCA8IDAgfHwgY29kZVBvaW50ID4gMHgxMEZGRkYgfHwgZmxvb3IoY29kZVBvaW50KSAhPSBjb2RlUG9pbnQpIHsKICAgICAgICB0aHJvdyBSYW5nZUVycm9yKCdJbnZhbGlkIGNvZGUgcG9pbnQ6ICcgKyBjb2RlUG9pbnQpOwogICAgICB9CiAgICAgIGlmIChjb2RlUG9pbnQgPD0gMHhGRkZGKSB7CiAgICAgICAgY29kZVVuaXRzLnB1c2goY29kZVBvaW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb2RlUG9pbnQgLT0gMHgxMDAwMDsKICAgICAgICBoaWdoU3Vycm9nYXRlID0gKGNvZGVQb2ludCA+PiAxMCkgKyAweEQ4MDA7CiAgICAgICAgbG93U3Vycm9nYXRlID0gKGNvZGVQb2ludCAlIDB4NDAwKSArIDB4REMwMDsKICAgICAgICBjb2RlVW5pdHMucHVzaChoaWdoU3Vycm9nYXRlLCBsb3dTdXJyb2dhdGUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBjb2RlVW5pdHMpOwogIH0KICBmdW5jdGlvbiBzdHJpbmdQcm90b3R5cGVJdGVyYXRvcigpIHsKICAgIHZhciBvID0gJHRyYWNldXJSdW50aW1lLmNoZWNrT2JqZWN0Q29lcmNpYmxlKHRoaXMpOwogICAgdmFyIHMgPSBTdHJpbmcobyk7CiAgICByZXR1cm4gY3JlYXRlU3RyaW5nSXRlcmF0b3Iocyk7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsU3RyaW5nKGdsb2JhbCkgewogICAgdmFyIFN0cmluZyA9IGdsb2JhbC5TdHJpbmc7CiAgICBtYXliZUFkZEZ1bmN0aW9ucyhTdHJpbmcucHJvdG90eXBlLCBbJ2NvZGVQb2ludEF0JywgY29kZVBvaW50QXQsICdlbmRzV2l0aCcsIGVuZHNXaXRoLCAnaW5jbHVkZXMnLCBpbmNsdWRlcywgJ3JlcGVhdCcsIHJlcGVhdCwgJ3N0YXJ0c1dpdGgnLCBzdGFydHNXaXRoXSk7CiAgICBtYXliZUFkZEZ1bmN0aW9ucyhTdHJpbmcsIFsnZnJvbUNvZGVQb2ludCcsIGZyb21Db2RlUG9pbnQsICdyYXcnLCByYXddKTsKICAgIG1heWJlQWRkSXRlcmF0b3IoU3RyaW5nLnByb3RvdHlwZSwgc3RyaW5nUHJvdG90eXBlSXRlcmF0b3IsIFN5bWJvbCk7CiAgfQogIHJlZ2lzdGVyUG9seWZpbGwocG9seWZpbGxTdHJpbmcpOwogIHJldHVybiB7CiAgICBnZXQgc3RhcnRzV2l0aCgpIHsKICAgICAgcmV0dXJuIHN0YXJ0c1dpdGg7CiAgICB9LAogICAgZ2V0IGVuZHNXaXRoKCkgewogICAgICByZXR1cm4gZW5kc1dpdGg7CiAgICB9LAogICAgZ2V0IGluY2x1ZGVzKCkgewogICAgICByZXR1cm4gaW5jbHVkZXM7CiAgICB9LAogICAgZ2V0IHJlcGVhdCgpIHsKICAgICAgcmV0dXJuIHJlcGVhdDsKICAgIH0sCiAgICBnZXQgY29kZVBvaW50QXQoKSB7CiAgICAgIHJldHVybiBjb2RlUG9pbnRBdDsKICAgIH0sCiAgICBnZXQgcmF3KCkgewogICAgICByZXR1cm4gcmF3OwogICAgfSwKICAgIGdldCBmcm9tQ29kZVBvaW50KCkgewogICAgICByZXR1cm4gZnJvbUNvZGVQb2ludDsKICAgIH0sCiAgICBnZXQgc3RyaW5nUHJvdG90eXBlSXRlcmF0b3IoKSB7CiAgICAgIHJldHVybiBzdHJpbmdQcm90b3R5cGVJdGVyYXRvcjsKICAgIH0sCiAgICBnZXQgcG9seWZpbGxTdHJpbmcoKSB7CiAgICAgIHJldHVybiBwb2x5ZmlsbFN0cmluZzsKICAgIH0KICB9Owp9KTsKU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvU3RyaW5nLmpzIiArICcnKTsKU3lzdGVtLnJlZ2lzdGVyTW9kdWxlKCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9BcnJheUl0ZXJhdG9yLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL0FycmF5SXRlcmF0b3IuanMiOwogIHZhciAkX18wID0gU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvdXRpbHMuanMiKSwKICAgICAgdG9PYmplY3QgPSAkX18wLnRvT2JqZWN0LAogICAgICB0b1VpbnQzMiA9ICRfXzAudG9VaW50MzIsCiAgICAgIGNyZWF0ZUl0ZXJhdG9yUmVzdWx0T2JqZWN0ID0gJF9fMC5jcmVhdGVJdGVyYXRvclJlc3VsdE9iamVjdDsKICB2YXIgQVJSQVlfSVRFUkFUT1JfS0lORF9LRVlTID0gMTsKICB2YXIgQVJSQVlfSVRFUkFUT1JfS0lORF9WQUxVRVMgPSAyOwogIHZhciBBUlJBWV9JVEVSQVRPUl9LSU5EX0VOVFJJRVMgPSAzOwogIHZhciBBcnJheUl0ZXJhdG9yID0gKGZ1bmN0aW9uKCkgewogICAgdmFyICRfXzI7CiAgICBmdW5jdGlvbiBBcnJheUl0ZXJhdG9yKCkge30KICAgIHJldHVybiAoJHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKShBcnJheUl0ZXJhdG9yLCAoJF9fMiA9IHt9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkoJF9fMiwgIm5leHQiLCB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaXRlcmF0b3IgPSB0b09iamVjdCh0aGlzKTsKICAgICAgICB2YXIgYXJyYXkgPSBpdGVyYXRvci5pdGVyYXRvck9iamVjdF87CiAgICAgICAgaWYgKCFhcnJheSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0IGlzIG5vdCBhbiBBcnJheUl0ZXJhdG9yJyk7CiAgICAgICAgfQogICAgICAgIHZhciBpbmRleCA9IGl0ZXJhdG9yLmFycmF5SXRlcmF0b3JOZXh0SW5kZXhfOwogICAgICAgIHZhciBpdGVtS2luZCA9IGl0ZXJhdG9yLmFycmF5SXRlcmF0aW9uS2luZF87CiAgICAgICAgdmFyIGxlbmd0aCA9IHRvVWludDMyKGFycmF5Lmxlbmd0aCk7CiAgICAgICAgaWYgKGluZGV4ID49IGxlbmd0aCkgewogICAgICAgICAgaXRlcmF0b3IuYXJyYXlJdGVyYXRvck5leHRJbmRleF8gPSBJbmZpbml0eTsKICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyYXRvclJlc3VsdE9iamVjdCh1bmRlZmluZWQsIHRydWUpOwogICAgICAgIH0KICAgICAgICBpdGVyYXRvci5hcnJheUl0ZXJhdG9yTmV4dEluZGV4XyA9IGluZGV4ICsgMTsKICAgICAgICBpZiAoaXRlbUtpbmQgPT0gQVJSQVlfSVRFUkFUT1JfS0lORF9WQUxVRVMpCiAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlcmF0b3JSZXN1bHRPYmplY3QoYXJyYXlbaW5kZXhdLCBmYWxzZSk7CiAgICAgICAgaWYgKGl0ZW1LaW5kID09IEFSUkFZX0lURVJBVE9SX0tJTkRfRU5UUklFUykKICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVyYXRvclJlc3VsdE9iamVjdChbaW5kZXgsIGFycmF5W2luZGV4XV0sIGZhbHNlKTsKICAgICAgICByZXR1cm4gY3JlYXRlSXRlcmF0b3JSZXN1bHRPYmplY3QoaW5kZXgsIGZhbHNlKTsKICAgICAgfSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSgkX18yLCBTeW1ib2wuaXRlcmF0b3IsIHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KSwgJF9fMiksIHt9KTsKICB9KCkpOwogIGZ1bmN0aW9uIGNyZWF0ZUFycmF5SXRlcmF0b3IoYXJyYXksIGtpbmQpIHsKICAgIHZhciBvYmplY3QgPSB0b09iamVjdChhcnJheSk7CiAgICB2YXIgaXRlcmF0b3IgPSBuZXcgQXJyYXlJdGVyYXRvcjsKICAgIGl0ZXJhdG9yLml0ZXJhdG9yT2JqZWN0XyA9IG9iamVjdDsKICAgIGl0ZXJhdG9yLmFycmF5SXRlcmF0b3JOZXh0SW5kZXhfID0gMDsKICAgIGl0ZXJhdG9yLmFycmF5SXRlcmF0aW9uS2luZF8gPSBraW5kOwogICAgcmV0dXJuIGl0ZXJhdG9yOwogIH0KICBmdW5jdGlvbiBlbnRyaWVzKCkgewogICAgcmV0dXJuIGNyZWF0ZUFycmF5SXRlcmF0b3IodGhpcywgQVJSQVlfSVRFUkFUT1JfS0lORF9FTlRSSUVTKTsKICB9CiAgZnVuY3Rpb24ga2V5cygpIHsKICAgIHJldHVybiBjcmVhdGVBcnJheUl0ZXJhdG9yKHRoaXMsIEFSUkFZX0lURVJBVE9SX0tJTkRfS0VZUyk7CiAgfQogIGZ1bmN0aW9uIHZhbHVlcygpIHsKICAgIHJldHVybiBjcmVhdGVBcnJheUl0ZXJhdG9yKHRoaXMsIEFSUkFZX0lURVJBVE9SX0tJTkRfVkFMVUVTKTsKICB9CiAgcmV0dXJuIHsKICAgIGdldCBlbnRyaWVzKCkgewogICAgICByZXR1cm4gZW50cmllczsKICAgIH0sCiAgICBnZXQga2V5cygpIHsKICAgICAgcmV0dXJuIGtleXM7CiAgICB9LAogICAgZ2V0IHZhbHVlcygpIHsKICAgICAgcmV0dXJuIHZhbHVlczsKICAgIH0KICB9Owp9KTsKU3lzdGVtLnJlZ2lzdGVyTW9kdWxlKCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9BcnJheS5qcyIsIFtdLCBmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9BcnJheS5qcyI7CiAgdmFyICRfXzAgPSBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9BcnJheUl0ZXJhdG9yLmpzIiksCiAgICAgIGVudHJpZXMgPSAkX18wLmVudHJpZXMsCiAgICAgIGtleXMgPSAkX18wLmtleXMsCiAgICAgIGpzVmFsdWVzID0gJF9fMC52YWx1ZXM7CiAgdmFyICRfXzEgPSBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy91dGlscy5qcyIpLAogICAgICBjaGVja0l0ZXJhYmxlID0gJF9fMS5jaGVja0l0ZXJhYmxlLAogICAgICBpc0NhbGxhYmxlID0gJF9fMS5pc0NhbGxhYmxlLAogICAgICBpc0NvbnN0cnVjdG9yID0gJF9fMS5pc0NvbnN0cnVjdG9yLAogICAgICBtYXliZUFkZEZ1bmN0aW9ucyA9ICRfXzEubWF5YmVBZGRGdW5jdGlvbnMsCiAgICAgIG1heWJlQWRkSXRlcmF0b3IgPSAkX18xLm1heWJlQWRkSXRlcmF0b3IsCiAgICAgIHJlZ2lzdGVyUG9seWZpbGwgPSAkX18xLnJlZ2lzdGVyUG9seWZpbGwsCiAgICAgIHRvSW50ZWdlciA9ICRfXzEudG9JbnRlZ2VyLAogICAgICB0b0xlbmd0aCA9ICRfXzEudG9MZW5ndGgsCiAgICAgIHRvT2JqZWN0ID0gJF9fMS50b09iamVjdDsKICBmdW5jdGlvbiBmcm9tKGFyckxpa2UpIHsKICAgIHZhciBtYXBGbiA9IGFyZ3VtZW50c1sxXTsKICAgIHZhciB0aGlzQXJnID0gYXJndW1lbnRzWzJdOwogICAgdmFyIEMgPSB0aGlzOwogICAgdmFyIGl0ZW1zID0gdG9PYmplY3QoYXJyTGlrZSk7CiAgICB2YXIgbWFwcGluZyA9IG1hcEZuICE9PSB1bmRlZmluZWQ7CiAgICB2YXIgayA9IDA7CiAgICB2YXIgYXJyLAogICAgICAgIGxlbjsKICAgIGlmIChtYXBwaW5nICYmICFpc0NhbGxhYmxlKG1hcEZuKSkgewogICAgICB0aHJvdyBUeXBlRXJyb3IoKTsKICAgIH0KICAgIGlmIChjaGVja0l0ZXJhYmxlKGl0ZW1zKSkgewogICAgICBhcnIgPSBpc0NvbnN0cnVjdG9yKEMpID8gbmV3IEMoKSA6IFtdOwogICAgICB2YXIgJF9fNSA9IHRydWU7CiAgICAgIHZhciAkX182ID0gZmFsc2U7CiAgICAgIHZhciAkX183ID0gdW5kZWZpbmVkOwogICAgICB0cnkgewogICAgICAgIGZvciAodmFyICRfXzMgPSB2b2lkIDAsCiAgICAgICAgICAgICRfXzIgPSAoaXRlbXMpWyR0cmFjZXVyUnVudGltZS50b1Byb3BlcnR5KFN5bWJvbC5pdGVyYXRvcildKCk7ICEoJF9fNSA9ICgkX18zID0gJF9fMi5uZXh0KCkpLmRvbmUpOyAkX181ID0gdHJ1ZSkgewogICAgICAgICAgdmFyIGl0ZW0gPSAkX18zLnZhbHVlOwogICAgICAgICAgewogICAgICAgICAgICBpZiAobWFwcGluZykgewogICAgICAgICAgICAgIGFycltrXSA9IG1hcEZuLmNhbGwodGhpc0FyZywgaXRlbSwgayk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYXJyW2tdID0gaXRlbTsKICAgICAgICAgICAgfQogICAgICAgICAgICBrKys7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoICgkX184KSB7CiAgICAgICAgJF9fNiA9IHRydWU7CiAgICAgICAgJF9fNyA9ICRfXzg7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghJF9fNSAmJiAkX18yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICRfXzIucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmICgkX182KSB7CiAgICAgICAgICAgIHRocm93ICRfXzc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGFyci5sZW5ndGggPSBrOwogICAgICByZXR1cm4gYXJyOwogICAgfQogICAgbGVuID0gdG9MZW5ndGgoaXRlbXMubGVuZ3RoKTsKICAgIGFyciA9IGlzQ29uc3RydWN0b3IoQykgPyBuZXcgQyhsZW4pIDogbmV3IEFycmF5KGxlbik7CiAgICBmb3IgKDsgayA8IGxlbjsgaysrKSB7CiAgICAgIGlmIChtYXBwaW5nKSB7CiAgICAgICAgYXJyW2tdID0gdHlwZW9mIHRoaXNBcmcgPT09ICd1bmRlZmluZWQnID8gbWFwRm4oaXRlbXNba10sIGspIDogbWFwRm4uY2FsbCh0aGlzQXJnLCBpdGVtc1trXSwgayk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJyW2tdID0gaXRlbXNba107CiAgICAgIH0KICAgIH0KICAgIGFyci5sZW5ndGggPSBsZW47CiAgICByZXR1cm4gYXJyOwogIH0KICBmdW5jdGlvbiBvZigpIHsKICAgIGZvciAodmFyIGl0ZW1zID0gW10sCiAgICAgICAgJF9fOSA9IDA7ICRfXzkgPCBhcmd1bWVudHMubGVuZ3RoOyAkX185KyspCiAgICAgIGl0ZW1zWyRfXzldID0gYXJndW1lbnRzWyRfXzldOwogICAgdmFyIEMgPSB0aGlzOwogICAgdmFyIGxlbiA9IGl0ZW1zLmxlbmd0aDsKICAgIHZhciBhcnIgPSBpc0NvbnN0cnVjdG9yKEMpID8gbmV3IEMobGVuKSA6IG5ldyBBcnJheShsZW4pOwogICAgZm9yICh2YXIgayA9IDA7IGsgPCBsZW47IGsrKykgewogICAgICBhcnJba10gPSBpdGVtc1trXTsKICAgIH0KICAgIGFyci5sZW5ndGggPSBsZW47CiAgICByZXR1cm4gYXJyOwogIH0KICBmdW5jdGlvbiBmaWxsKHZhbHVlKSB7CiAgICB2YXIgc3RhcnQgPSBhcmd1bWVudHNbMV0gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzFdIDogMDsKICAgIHZhciBlbmQgPSBhcmd1bWVudHNbMl07CiAgICB2YXIgb2JqZWN0ID0gdG9PYmplY3QodGhpcyk7CiAgICB2YXIgbGVuID0gdG9MZW5ndGgob2JqZWN0Lmxlbmd0aCk7CiAgICB2YXIgZmlsbFN0YXJ0ID0gdG9JbnRlZ2VyKHN0YXJ0KTsKICAgIHZhciBmaWxsRW5kID0gZW5kICE9PSB1bmRlZmluZWQgPyB0b0ludGVnZXIoZW5kKSA6IGxlbjsKICAgIGZpbGxTdGFydCA9IGZpbGxTdGFydCA8IDAgPyBNYXRoLm1heChsZW4gKyBmaWxsU3RhcnQsIDApIDogTWF0aC5taW4oZmlsbFN0YXJ0LCBsZW4pOwogICAgZmlsbEVuZCA9IGZpbGxFbmQgPCAwID8gTWF0aC5tYXgobGVuICsgZmlsbEVuZCwgMCkgOiBNYXRoLm1pbihmaWxsRW5kLCBsZW4pOwogICAgd2hpbGUgKGZpbGxTdGFydCA8IGZpbGxFbmQpIHsKICAgICAgb2JqZWN0W2ZpbGxTdGFydF0gPSB2YWx1ZTsKICAgICAgZmlsbFN0YXJ0Kys7CiAgICB9CiAgICByZXR1cm4gb2JqZWN0OwogIH0KICBmdW5jdGlvbiBmaW5kKHByZWRpY2F0ZSkgewogICAgdmFyIHRoaXNBcmcgPSBhcmd1bWVudHNbMV07CiAgICByZXR1cm4gZmluZEhlbHBlcih0aGlzLCBwcmVkaWNhdGUsIHRoaXNBcmcpOwogIH0KICBmdW5jdGlvbiBmaW5kSW5kZXgocHJlZGljYXRlKSB7CiAgICB2YXIgdGhpc0FyZyA9IGFyZ3VtZW50c1sxXTsKICAgIHJldHVybiBmaW5kSGVscGVyKHRoaXMsIHByZWRpY2F0ZSwgdGhpc0FyZywgdHJ1ZSk7CiAgfQogIGZ1bmN0aW9uIGZpbmRIZWxwZXIoc2VsZiwgcHJlZGljYXRlKSB7CiAgICB2YXIgdGhpc0FyZyA9IGFyZ3VtZW50c1syXTsKICAgIHZhciByZXR1cm5JbmRleCA9IGFyZ3VtZW50c1szXSAhPT0gKHZvaWQgMCkgPyBhcmd1bWVudHNbM10gOiBmYWxzZTsKICAgIHZhciBvYmplY3QgPSB0b09iamVjdChzZWxmKTsKICAgIHZhciBsZW4gPSB0b0xlbmd0aChvYmplY3QubGVuZ3RoKTsKICAgIGlmICghaXNDYWxsYWJsZShwcmVkaWNhdGUpKSB7CiAgICAgIHRocm93IFR5cGVFcnJvcigpOwogICAgfQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICB2YXIgdmFsdWUgPSBvYmplY3RbaV07CiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbCh0aGlzQXJnLCB2YWx1ZSwgaSwgb2JqZWN0KSkgewogICAgICAgIHJldHVybiByZXR1cm5JbmRleCA/IGkgOiB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJldHVybkluZGV4ID8gLTEgOiB1bmRlZmluZWQ7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsQXJyYXkoZ2xvYmFsKSB7CiAgICB2YXIgJF9fMTAgPSBnbG9iYWwsCiAgICAgICAgQXJyYXkgPSAkX18xMC5BcnJheSwKICAgICAgICBPYmplY3QgPSAkX18xMC5PYmplY3QsCiAgICAgICAgU3ltYm9sID0gJF9fMTAuU3ltYm9sOwogICAgdmFyIHZhbHVlcyA9IGpzVmFsdWVzOwogICAgaWYgKFN5bWJvbCAmJiBTeW1ib2wuaXRlcmF0b3IgJiYgQXJyYXkucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl0pIHsKICAgICAgdmFsdWVzID0gQXJyYXkucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl07CiAgICB9CiAgICBtYXliZUFkZEZ1bmN0aW9ucyhBcnJheS5wcm90b3R5cGUsIFsnZW50cmllcycsIGVudHJpZXMsICdrZXlzJywga2V5cywgJ3ZhbHVlcycsIHZhbHVlcywgJ2ZpbGwnLCBmaWxsLCAnZmluZCcsIGZpbmQsICdmaW5kSW5kZXgnLCBmaW5kSW5kZXhdKTsKICAgIG1heWJlQWRkRnVuY3Rpb25zKEFycmF5LCBbJ2Zyb20nLCBmcm9tLCAnb2YnLCBvZl0pOwogICAgbWF5YmVBZGRJdGVyYXRvcihBcnJheS5wcm90b3R5cGUsIHZhbHVlcywgU3ltYm9sKTsKICAgIG1heWJlQWRkSXRlcmF0b3IoT2JqZWN0LmdldFByb3RvdHlwZU9mKFtdLnZhbHVlcygpKSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwgU3ltYm9sKTsKICB9CiAgcmVnaXN0ZXJQb2x5ZmlsbChwb2x5ZmlsbEFycmF5KTsKICByZXR1cm4gewogICAgZ2V0IGZyb20oKSB7CiAgICAgIHJldHVybiBmcm9tOwogICAgfSwKICAgIGdldCBvZigpIHsKICAgICAgcmV0dXJuIG9mOwogICAgfSwKICAgIGdldCBmaWxsKCkgewogICAgICByZXR1cm4gZmlsbDsKICAgIH0sCiAgICBnZXQgZmluZCgpIHsKICAgICAgcmV0dXJuIGZpbmQ7CiAgICB9LAogICAgZ2V0IGZpbmRJbmRleCgpIHsKICAgICAgcmV0dXJuIGZpbmRJbmRleDsKICAgIH0sCiAgICBnZXQgcG9seWZpbGxBcnJheSgpIHsKICAgICAgcmV0dXJuIHBvbHlmaWxsQXJyYXk7CiAgICB9CiAgfTsKfSk7ClN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL0FycmF5LmpzIiArICcnKTsKU3lzdGVtLnJlZ2lzdGVyTW9kdWxlKCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9PYmplY3QuanMiLCBbXSwgZnVuY3Rpb24oKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvT2JqZWN0LmpzIjsKICB2YXIgJF9fMCA9IFN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3V0aWxzLmpzIiksCiAgICAgIG1heWJlQWRkRnVuY3Rpb25zID0gJF9fMC5tYXliZUFkZEZ1bmN0aW9ucywKICAgICAgcmVnaXN0ZXJQb2x5ZmlsbCA9ICRfXzAucmVnaXN0ZXJQb2x5ZmlsbDsKICB2YXIgJF9fMSA9ICR0cmFjZXVyUnVudGltZSwKICAgICAgZGVmaW5lUHJvcGVydHkgPSAkX18xLmRlZmluZVByb3BlcnR5LAogICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSAkX18xLmdldE93blByb3BlcnR5RGVzY3JpcHRvciwKICAgICAgZ2V0T3duUHJvcGVydHlOYW1lcyA9ICRfXzEuZ2V0T3duUHJvcGVydHlOYW1lcywKICAgICAgaXNQcml2YXRlTmFtZSA9ICRfXzEuaXNQcml2YXRlTmFtZSwKICAgICAga2V5cyA9ICRfXzEua2V5czsKICBmdW5jdGlvbiBpcyhsZWZ0LCByaWdodCkgewogICAgaWYgKGxlZnQgPT09IHJpZ2h0KQogICAgICByZXR1cm4gbGVmdCAhPT0gMCB8fCAxIC8gbGVmdCA9PT0gMSAvIHJpZ2h0OwogICAgcmV0dXJuIGxlZnQgIT09IGxlZnQgJiYgcmlnaHQgIT09IHJpZ2h0OwogIH0KICBmdW5jdGlvbiBhc3NpZ24odGFyZ2V0KSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwogICAgICB2YXIgcHJvcHMgPSBzb3VyY2UgPT0gbnVsbCA/IFtdIDoga2V5cyhzb3VyY2UpOwogICAgICB2YXIgcCA9IHZvaWQgMCwKICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsKICAgICAgZm9yIChwID0gMDsgcCA8IGxlbmd0aDsgcCsrKSB7CiAgICAgICAgdmFyIG5hbWUgPSBwcm9wc1twXTsKICAgICAgICBpZiAoaXNQcml2YXRlTmFtZShuYW1lKSkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIHRhcmdldFtuYW1lXSA9IHNvdXJjZVtuYW1lXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CiAgZnVuY3Rpb24gbWl4aW4odGFyZ2V0LCBzb3VyY2UpIHsKICAgIHZhciBwcm9wcyA9IGdldE93blByb3BlcnR5TmFtZXMoc291cmNlKTsKICAgIHZhciBwLAogICAgICAgIGRlc2NyaXB0b3IsCiAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwogICAgZm9yIChwID0gMDsgcCA8IGxlbmd0aDsgcCsrKSB7CiAgICAgIHZhciBuYW1lID0gcHJvcHNbcF07CiAgICAgIGlmIChpc1ByaXZhdGVOYW1lKG5hbWUpKQogICAgICAgIGNvbnRpbnVlOwogICAgICBkZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwgcHJvcHNbcF0pOwogICAgICBkZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BzW3BdLCBkZXNjcmlwdG9yKTsKICAgIH0KICAgIHJldHVybiB0YXJnZXQ7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsT2JqZWN0KGdsb2JhbCkgewogICAgdmFyIE9iamVjdCA9IGdsb2JhbC5PYmplY3Q7CiAgICBtYXliZUFkZEZ1bmN0aW9ucyhPYmplY3QsIFsnYXNzaWduJywgYXNzaWduLCAnaXMnLCBpcywgJ21peGluJywgbWl4aW5dKTsKICB9CiAgcmVnaXN0ZXJQb2x5ZmlsbChwb2x5ZmlsbE9iamVjdCk7CiAgcmV0dXJuIHsKICAgIGdldCBpcygpIHsKICAgICAgcmV0dXJuIGlzOwogICAgfSwKICAgIGdldCBhc3NpZ24oKSB7CiAgICAgIHJldHVybiBhc3NpZ247CiAgICB9LAogICAgZ2V0IG1peGluKCkgewogICAgICByZXR1cm4gbWl4aW47CiAgICB9LAogICAgZ2V0IHBvbHlmaWxsT2JqZWN0KCkgewogICAgICByZXR1cm4gcG9seWZpbGxPYmplY3Q7CiAgICB9CiAgfTsKfSk7ClN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL09iamVjdC5qcyIgKyAnJyk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvTnVtYmVyLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL051bWJlci5qcyI7CiAgdmFyICRfXzAgPSBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy91dGlscy5qcyIpLAogICAgICBpc051bWJlciA9ICRfXzAuaXNOdW1iZXIsCiAgICAgIG1heWJlQWRkQ29uc3RzID0gJF9fMC5tYXliZUFkZENvbnN0cywKICAgICAgbWF5YmVBZGRGdW5jdGlvbnMgPSAkX18wLm1heWJlQWRkRnVuY3Rpb25zLAogICAgICByZWdpc3RlclBvbHlmaWxsID0gJF9fMC5yZWdpc3RlclBvbHlmaWxsLAogICAgICB0b0ludGVnZXIgPSAkX18wLnRvSW50ZWdlcjsKICB2YXIgJGFicyA9IE1hdGguYWJzOwogIHZhciAkaXNGaW5pdGUgPSBpc0Zpbml0ZTsKICB2YXIgJGlzTmFOID0gaXNOYU47CiAgdmFyIE1BWF9TQUZFX0lOVEVHRVIgPSBNYXRoLnBvdygyLCA1MykgLSAxOwogIHZhciBNSU5fU0FGRV9JTlRFR0VSID0gLU1hdGgucG93KDIsIDUzKSArIDE7CiAgdmFyIEVQU0lMT04gPSBNYXRoLnBvdygyLCAtNTIpOwogIGZ1bmN0aW9uIE51bWJlcklzRmluaXRlKG51bWJlcikgewogICAgcmV0dXJuIGlzTnVtYmVyKG51bWJlcikgJiYgJGlzRmluaXRlKG51bWJlcik7CiAgfQogIGZ1bmN0aW9uIGlzSW50ZWdlcihudW1iZXIpIHsKICAgIHJldHVybiBOdW1iZXJJc0Zpbml0ZShudW1iZXIpICYmIHRvSW50ZWdlcihudW1iZXIpID09PSBudW1iZXI7CiAgfQogIGZ1bmN0aW9uIE51bWJlcklzTmFOKG51bWJlcikgewogICAgcmV0dXJuIGlzTnVtYmVyKG51bWJlcikgJiYgJGlzTmFOKG51bWJlcik7CiAgfQogIGZ1bmN0aW9uIGlzU2FmZUludGVnZXIobnVtYmVyKSB7CiAgICBpZiAoTnVtYmVySXNGaW5pdGUobnVtYmVyKSkgewogICAgICB2YXIgaW50ZWdyYWwgPSB0b0ludGVnZXIobnVtYmVyKTsKICAgICAgaWYgKGludGVncmFsID09PSBudW1iZXIpCiAgICAgICAgcmV0dXJuICRhYnMoaW50ZWdyYWwpIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsTnVtYmVyKGdsb2JhbCkgewogICAgdmFyIE51bWJlciA9IGdsb2JhbC5OdW1iZXI7CiAgICBtYXliZUFkZENvbnN0cyhOdW1iZXIsIFsnTUFYX1NBRkVfSU5URUdFUicsIE1BWF9TQUZFX0lOVEVHRVIsICdNSU5fU0FGRV9JTlRFR0VSJywgTUlOX1NBRkVfSU5URUdFUiwgJ0VQU0lMT04nLCBFUFNJTE9OXSk7CiAgICBtYXliZUFkZEZ1bmN0aW9ucyhOdW1iZXIsIFsnaXNGaW5pdGUnLCBOdW1iZXJJc0Zpbml0ZSwgJ2lzSW50ZWdlcicsIGlzSW50ZWdlciwgJ2lzTmFOJywgTnVtYmVySXNOYU4sICdpc1NhZmVJbnRlZ2VyJywgaXNTYWZlSW50ZWdlcl0pOwogIH0KICByZWdpc3RlclBvbHlmaWxsKHBvbHlmaWxsTnVtYmVyKTsKICByZXR1cm4gewogICAgZ2V0IE1BWF9TQUZFX0lOVEVHRVIoKSB7CiAgICAgIHJldHVybiBNQVhfU0FGRV9JTlRFR0VSOwogICAgfSwKICAgIGdldCBNSU5fU0FGRV9JTlRFR0VSKCkgewogICAgICByZXR1cm4gTUlOX1NBRkVfSU5URUdFUjsKICAgIH0sCiAgICBnZXQgRVBTSUxPTigpIHsKICAgICAgcmV0dXJuIEVQU0lMT047CiAgICB9LAogICAgZ2V0IGlzRmluaXRlKCkgewogICAgICByZXR1cm4gTnVtYmVySXNGaW5pdGU7CiAgICB9LAogICAgZ2V0IGlzSW50ZWdlcigpIHsKICAgICAgcmV0dXJuIGlzSW50ZWdlcjsKICAgIH0sCiAgICBnZXQgaXNOYU4oKSB7CiAgICAgIHJldHVybiBOdW1iZXJJc05hTjsKICAgIH0sCiAgICBnZXQgaXNTYWZlSW50ZWdlcigpIHsKICAgICAgcmV0dXJuIGlzU2FmZUludGVnZXI7CiAgICB9LAogICAgZ2V0IHBvbHlmaWxsTnVtYmVyKCkgewogICAgICByZXR1cm4gcG9seWZpbGxOdW1iZXI7CiAgICB9CiAgfTsKfSk7ClN5c3RlbS5nZXQoInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL051bWJlci5qcyIgKyAnJyk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvZnJvdW5kLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL2Zyb3VuZC5qcyI7CiAgdmFyICRpc0Zpbml0ZSA9IGlzRmluaXRlOwogIHZhciAkaXNOYU4gPSBpc05hTjsKICB2YXIgJF9fMCA9IE1hdGgsCiAgICAgIExOMiA9ICRfXzAuTE4yLAogICAgICBhYnMgPSAkX18wLmFicywKICAgICAgZmxvb3IgPSAkX18wLmZsb29yLAogICAgICBsb2cgPSAkX18wLmxvZywKICAgICAgbWluID0gJF9fMC5taW4sCiAgICAgIHBvdyA9ICRfXzAucG93OwogIGZ1bmN0aW9uIHBhY2tJRUVFNzU0KHYsIGViaXRzLCBmYml0cykgewogICAgdmFyIGJpYXMgPSAoMSA8PCAoZWJpdHMgLSAxKSkgLSAxLAogICAgICAgIHMsCiAgICAgICAgZSwKICAgICAgICBmLAogICAgICAgIGxuLAogICAgICAgIGksCiAgICAgICAgYml0cywKICAgICAgICBzdHIsCiAgICAgICAgYnl0ZXM7CiAgICBmdW5jdGlvbiByb3VuZFRvRXZlbihuKSB7CiAgICAgIHZhciB3ID0gZmxvb3IobiksCiAgICAgICAgICBmID0gbiAtIHc7CiAgICAgIGlmIChmIDwgMC41KQogICAgICAgIHJldHVybiB3OwogICAgICBpZiAoZiA+IDAuNSkKICAgICAgICByZXR1cm4gdyArIDE7CiAgICAgIHJldHVybiB3ICUgMiA/IHcgKyAxIDogdzsKICAgIH0KICAgIGlmICh2ICE9PSB2KSB7CiAgICAgIGUgPSAoMSA8PCBlYml0cykgLSAxOwogICAgICBmID0gcG93KDIsIGZiaXRzIC0gMSk7CiAgICAgIHMgPSAwOwogICAgfSBlbHNlIGlmICh2ID09PSBJbmZpbml0eSB8fCB2ID09PSAtSW5maW5pdHkpIHsKICAgICAgZSA9ICgxIDw8IGViaXRzKSAtIDE7CiAgICAgIGYgPSAwOwogICAgICBzID0gKHYgPCAwKSA/IDEgOiAwOwogICAgfSBlbHNlIGlmICh2ID09PSAwKSB7CiAgICAgIGUgPSAwOwogICAgICBmID0gMDsKICAgICAgcyA9ICgxIC8gdiA9PT0gLUluZmluaXR5KSA/IDEgOiAwOwogICAgfSBlbHNlIHsKICAgICAgcyA9IHYgPCAwOwogICAgICB2ID0gYWJzKHYpOwogICAgICBpZiAodiA+PSBwb3coMiwgMSAtIGJpYXMpKSB7CiAgICAgICAgZSA9IG1pbihmbG9vcihsb2codikgLyBMTjIpLCAxMDIzKTsKICAgICAgICBmID0gcm91bmRUb0V2ZW4odiAvIHBvdygyLCBlKSAqIHBvdygyLCBmYml0cykpOwogICAgICAgIGlmIChmIC8gcG93KDIsIGZiaXRzKSA+PSAyKSB7CiAgICAgICAgICBlID0gZSArIDE7CiAgICAgICAgICBmID0gMTsKICAgICAgICB9CiAgICAgICAgaWYgKGUgPiBiaWFzKSB7CiAgICAgICAgICBlID0gKDEgPDwgZWJpdHMpIC0gMTsKICAgICAgICAgIGYgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlID0gZSArIGJpYXM7CiAgICAgICAgICBmID0gZiAtIHBvdygyLCBmYml0cyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGUgPSAwOwogICAgICAgIGYgPSByb3VuZFRvRXZlbih2IC8gcG93KDIsIDEgLSBiaWFzIC0gZmJpdHMpKTsKICAgICAgfQogICAgfQogICAgYml0cyA9IFtdOwogICAgZm9yIChpID0gZmJpdHM7IGk7IGkgLT0gMSkgewogICAgICBiaXRzLnB1c2goZiAlIDIgPyAxIDogMCk7CiAgICAgIGYgPSBmbG9vcihmIC8gMik7CiAgICB9CiAgICBmb3IgKGkgPSBlYml0czsgaTsgaSAtPSAxKSB7CiAgICAgIGJpdHMucHVzaChlICUgMiA/IDEgOiAwKTsKICAgICAgZSA9IGZsb29yKGUgLyAyKTsKICAgIH0KICAgIGJpdHMucHVzaChzID8gMSA6IDApOwogICAgYml0cy5yZXZlcnNlKCk7CiAgICBzdHIgPSBiaXRzLmpvaW4oJycpOwogICAgYnl0ZXMgPSBbXTsKICAgIHdoaWxlIChzdHIubGVuZ3RoKSB7CiAgICAgIGJ5dGVzLnB1c2gocGFyc2VJbnQoc3RyLnN1YnN0cmluZygwLCA4KSwgMikpOwogICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDgpOwogICAgfQogICAgcmV0dXJuIGJ5dGVzOwogIH0KICBmdW5jdGlvbiB1bnBhY2tJRUVFNzU0KGJ5dGVzLCBlYml0cywgZmJpdHMpIHsKICAgIHZhciBiaXRzID0gW10sCiAgICAgICAgaSwKICAgICAgICBqLAogICAgICAgIGIsCiAgICAgICAgc3RyLAogICAgICAgIGJpYXMsCiAgICAgICAgcywKICAgICAgICBlLAogICAgICAgIGY7CiAgICBmb3IgKGkgPSBieXRlcy5sZW5ndGg7IGk7IGkgLT0gMSkgewogICAgICBiID0gYnl0ZXNbaSAtIDFdOwogICAgICBmb3IgKGogPSA4OyBqOyBqIC09IDEpIHsKICAgICAgICBiaXRzLnB1c2goYiAlIDIgPyAxIDogMCk7CiAgICAgICAgYiA9IGIgPj4gMTsKICAgICAgfQogICAgfQogICAgYml0cy5yZXZlcnNlKCk7CiAgICBzdHIgPSBiaXRzLmpvaW4oJycpOwogICAgYmlhcyA9ICgxIDw8IChlYml0cyAtIDEpKSAtIDE7CiAgICBzID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZygwLCAxKSwgMikgPyAtMSA6IDE7CiAgICBlID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZygxLCAxICsgZWJpdHMpLCAyKTsKICAgIGYgPSBwYXJzZUludChzdHIuc3Vic3RyaW5nKDEgKyBlYml0cyksIDIpOwogICAgaWYgKGUgPT09ICgxIDw8IGViaXRzKSAtIDEpIHsKICAgICAgcmV0dXJuIGYgIT09IDAgPyBOYU4gOiBzICogSW5maW5pdHk7CiAgICB9IGVsc2UgaWYgKGUgPiAwKSB7CiAgICAgIHJldHVybiBzICogcG93KDIsIGUgLSBiaWFzKSAqICgxICsgZiAvIHBvdygyLCBmYml0cykpOwogICAgfSBlbHNlIGlmIChmICE9PSAwKSB7CiAgICAgIHJldHVybiBzICogcG93KDIsIC0oYmlhcyAtIDEpKSAqIChmIC8gcG93KDIsIGZiaXRzKSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gcyA8IDAgPyAtMCA6IDA7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHVucGFja0YzMihiKSB7CiAgICByZXR1cm4gdW5wYWNrSUVFRTc1NChiLCA4LCAyMyk7CiAgfQogIGZ1bmN0aW9uIHBhY2tGMzIodikgewogICAgcmV0dXJuIHBhY2tJRUVFNzU0KHYsIDgsIDIzKTsKICB9CiAgZnVuY3Rpb24gZnJvdW5kKHgpIHsKICAgIGlmICh4ID09PSAwIHx8ICEkaXNGaW5pdGUoeCkgfHwgJGlzTmFOKHgpKSB7CiAgICAgIHJldHVybiB4OwogICAgfQogICAgcmV0dXJuIHVucGFja0YzMihwYWNrRjMyKE51bWJlcih4KSkpOwogIH0KICByZXR1cm4ge2dldCBmcm91bmQoKSB7CiAgICAgIHJldHVybiBmcm91bmQ7CiAgICB9fTsKfSk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvTWF0aC5qcyIsIFtdLCBmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9NYXRoLmpzIjsKICB2YXIganNGcm91bmQgPSBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy9mcm91bmQuanMiKS5mcm91bmQ7CiAgdmFyICRfXzEgPSBTeXN0ZW0uZ2V0KCJ0cmFjZXVyLXJ1bnRpbWVAMC4wLjg4L3NyYy9ydW50aW1lL3BvbHlmaWxscy91dGlscy5qcyIpLAogICAgICBtYXliZUFkZEZ1bmN0aW9ucyA9ICRfXzEubWF5YmVBZGRGdW5jdGlvbnMsCiAgICAgIHJlZ2lzdGVyUG9seWZpbGwgPSAkX18xLnJlZ2lzdGVyUG9seWZpbGwsCiAgICAgIHRvVWludDMyID0gJF9fMS50b1VpbnQzMjsKICB2YXIgJGlzRmluaXRlID0gaXNGaW5pdGU7CiAgdmFyICRpc05hTiA9IGlzTmFOOwogIHZhciAkX18yID0gTWF0aCwKICAgICAgYWJzID0gJF9fMi5hYnMsCiAgICAgIGNlaWwgPSAkX18yLmNlaWwsCiAgICAgIGV4cCA9ICRfXzIuZXhwLAogICAgICBmbG9vciA9ICRfXzIuZmxvb3IsCiAgICAgIGxvZyA9ICRfXzIubG9nLAogICAgICBwb3cgPSAkX18yLnBvdywKICAgICAgc3FydCA9ICRfXzIuc3FydDsKICBmdW5jdGlvbiBjbHozMih4KSB7CiAgICB4ID0gdG9VaW50MzIoK3gpOwogICAgaWYgKHggPT0gMCkKICAgICAgcmV0dXJuIDMyOwogICAgdmFyIHJlc3VsdCA9IDA7CiAgICBpZiAoKHggJiAweEZGRkYwMDAwKSA9PT0gMCkgewogICAgICB4IDw8PSAxNjsKICAgICAgcmVzdWx0ICs9IDE2OwogICAgfQogICAgOwogICAgaWYgKCh4ICYgMHhGRjAwMDAwMCkgPT09IDApIHsKICAgICAgeCA8PD0gODsKICAgICAgcmVzdWx0ICs9IDg7CiAgICB9CiAgICA7CiAgICBpZiAoKHggJiAweEYwMDAwMDAwKSA9PT0gMCkgewogICAgICB4IDw8PSA0OwogICAgICByZXN1bHQgKz0gNDsKICAgIH0KICAgIDsKICAgIGlmICgoeCAmIDB4QzAwMDAwMDApID09PSAwKSB7CiAgICAgIHggPDw9IDI7CiAgICAgIHJlc3VsdCArPSAyOwogICAgfQogICAgOwogICAgaWYgKCh4ICYgMHg4MDAwMDAwMCkgPT09IDApIHsKICAgICAgeCA8PD0gMTsKICAgICAgcmVzdWx0ICs9IDE7CiAgICB9CiAgICA7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBmdW5jdGlvbiBpbXVsKHgsIHkpIHsKICAgIHggPSB0b1VpbnQzMigreCk7CiAgICB5ID0gdG9VaW50MzIoK3kpOwogICAgdmFyIHhoID0gKHggPj4+IDE2KSAmIDB4ZmZmZjsKICAgIHZhciB4bCA9IHggJiAweGZmZmY7CiAgICB2YXIgeWggPSAoeSA+Pj4gMTYpICYgMHhmZmZmOwogICAgdmFyIHlsID0geSAmIDB4ZmZmZjsKICAgIHJldHVybiB4bCAqIHlsICsgKCgoeGggKiB5bCArIHhsICogeWgpIDw8IDE2KSA+Pj4gMCkgfCAwOwogIH0KICBmdW5jdGlvbiBzaWduKHgpIHsKICAgIHggPSAreDsKICAgIGlmICh4ID4gMCkKICAgICAgcmV0dXJuIDE7CiAgICBpZiAoeCA8IDApCiAgICAgIHJldHVybiAtMTsKICAgIHJldHVybiB4OwogIH0KICBmdW5jdGlvbiBsb2cxMCh4KSB7CiAgICByZXR1cm4gbG9nKHgpICogMC40MzQyOTQ0ODE5MDMyNTE4Mjg7CiAgfQogIGZ1bmN0aW9uIGxvZzIoeCkgewogICAgcmV0dXJuIGxvZyh4KSAqIDEuNDQyNjk1MDQwODg4OTYzNDA3OwogIH0KICBmdW5jdGlvbiBsb2cxcCh4KSB7CiAgICB4ID0gK3g7CiAgICBpZiAoeCA8IC0xIHx8ICRpc05hTih4KSkgewogICAgICByZXR1cm4gTmFOOwogICAgfQogICAgaWYgKHggPT09IDAgfHwgeCA9PT0gSW5maW5pdHkpIHsKICAgICAgcmV0dXJuIHg7CiAgICB9CiAgICBpZiAoeCA9PT0gLTEpIHsKICAgICAgcmV0dXJuIC1JbmZpbml0eTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAwOwogICAgdmFyIG4gPSA1MDsKICAgIGlmICh4IDwgMCB8fCB4ID4gMSkgewogICAgICByZXR1cm4gbG9nKDEgKyB4KTsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgbjsgaSsrKSB7CiAgICAgIGlmICgoaSAlIDIpID09PSAwKSB7CiAgICAgICAgcmVzdWx0IC09IHBvdyh4LCBpKSAvIGk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ICs9IHBvdyh4LCBpKSAvIGk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIGV4cG0xKHgpIHsKICAgIHggPSAreDsKICAgIGlmICh4ID09PSAtSW5maW5pdHkpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgaWYgKCEkaXNGaW5pdGUoeCkgfHwgeCA9PT0gMCkgewogICAgICByZXR1cm4geDsKICAgIH0KICAgIHJldHVybiBleHAoeCkgLSAxOwogIH0KICBmdW5jdGlvbiBjb3NoKHgpIHsKICAgIHggPSAreDsKICAgIGlmICh4ID09PSAwKSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgaWYgKCRpc05hTih4KSkgewogICAgICByZXR1cm4gTmFOOwogICAgfQogICAgaWYgKCEkaXNGaW5pdGUoeCkpIHsKICAgICAgcmV0dXJuIEluZmluaXR5OwogICAgfQogICAgaWYgKHggPCAwKSB7CiAgICAgIHggPSAteDsKICAgIH0KICAgIGlmICh4ID4gMjEpIHsKICAgICAgcmV0dXJuIGV4cCh4KSAvIDI7CiAgICB9CiAgICByZXR1cm4gKGV4cCh4KSArIGV4cCgteCkpIC8gMjsKICB9CiAgZnVuY3Rpb24gc2luaCh4KSB7CiAgICB4ID0gK3g7CiAgICBpZiAoISRpc0Zpbml0ZSh4KSB8fCB4ID09PSAwKSB7CiAgICAgIHJldHVybiB4OwogICAgfQogICAgcmV0dXJuIChleHAoeCkgLSBleHAoLXgpKSAvIDI7CiAgfQogIGZ1bmN0aW9uIHRhbmgoeCkgewogICAgeCA9ICt4OwogICAgaWYgKHggPT09IDApCiAgICAgIHJldHVybiB4OwogICAgaWYgKCEkaXNGaW5pdGUoeCkpCiAgICAgIHJldHVybiBzaWduKHgpOwogICAgdmFyIGV4cDEgPSBleHAoeCk7CiAgICB2YXIgZXhwMiA9IGV4cCgteCk7CiAgICByZXR1cm4gKGV4cDEgLSBleHAyKSAvIChleHAxICsgZXhwMik7CiAgfQogIGZ1bmN0aW9uIGFjb3NoKHgpIHsKICAgIHggPSAreDsKICAgIGlmICh4IDwgMSkKICAgICAgcmV0dXJuIE5hTjsKICAgIGlmICghJGlzRmluaXRlKHgpKQogICAgICByZXR1cm4geDsKICAgIHJldHVybiBsb2coeCArIHNxcnQoeCArIDEpICogc3FydCh4IC0gMSkpOwogIH0KICBmdW5jdGlvbiBhc2luaCh4KSB7CiAgICB4ID0gK3g7CiAgICBpZiAoeCA9PT0gMCB8fCAhJGlzRmluaXRlKHgpKQogICAgICByZXR1cm4geDsKICAgIGlmICh4ID4gMCkKICAgICAgcmV0dXJuIGxvZyh4ICsgc3FydCh4ICogeCArIDEpKTsKICAgIHJldHVybiAtbG9nKC14ICsgc3FydCh4ICogeCArIDEpKTsKICB9CiAgZnVuY3Rpb24gYXRhbmgoeCkgewogICAgeCA9ICt4OwogICAgaWYgKHggPT09IC0xKSB7CiAgICAgIHJldHVybiAtSW5maW5pdHk7CiAgICB9CiAgICBpZiAoeCA9PT0gMSkgewogICAgICByZXR1cm4gSW5maW5pdHk7CiAgICB9CiAgICBpZiAoeCA9PT0gMCkgewogICAgICByZXR1cm4geDsKICAgIH0KICAgIGlmICgkaXNOYU4oeCkgfHwgeCA8IC0xIHx8IHggPiAxKSB7CiAgICAgIHJldHVybiBOYU47CiAgICB9CiAgICByZXR1cm4gMC41ICogbG9nKCgxICsgeCkgLyAoMSAtIHgpKTsKICB9CiAgZnVuY3Rpb24gaHlwb3QoeCwgeSkgewogICAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgdmFyIG1heCA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBuID0gYXJndW1lbnRzW2ldOwogICAgICBuID0gK247CiAgICAgIGlmIChuID09PSBJbmZpbml0eSB8fCBuID09PSAtSW5maW5pdHkpCiAgICAgICAgcmV0dXJuIEluZmluaXR5OwogICAgICBuID0gYWJzKG4pOwogICAgICBpZiAobiA+IG1heCkKICAgICAgICBtYXggPSBuOwogICAgICBhcmdzW2ldID0gbjsKICAgIH0KICAgIGlmIChtYXggPT09IDApCiAgICAgIG1heCA9IDE7CiAgICB2YXIgc3VtID0gMDsKICAgIHZhciBjb21wZW5zYXRpb24gPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgbiA9IGFyZ3NbaV0gLyBtYXg7CiAgICAgIHZhciBzdW1tYW5kID0gbiAqIG4gLSBjb21wZW5zYXRpb247CiAgICAgIHZhciBwcmVsaW1pbmFyeSA9IHN1bSArIHN1bW1hbmQ7CiAgICAgIGNvbXBlbnNhdGlvbiA9IChwcmVsaW1pbmFyeSAtIHN1bSkgLSBzdW1tYW5kOwogICAgICBzdW0gPSBwcmVsaW1pbmFyeTsKICAgIH0KICAgIHJldHVybiBzcXJ0KHN1bSkgKiBtYXg7CiAgfQogIGZ1bmN0aW9uIHRydW5jKHgpIHsKICAgIHggPSAreDsKICAgIGlmICh4ID4gMCkKICAgICAgcmV0dXJuIGZsb29yKHgpOwogICAgaWYgKHggPCAwKQogICAgICByZXR1cm4gY2VpbCh4KTsKICAgIHJldHVybiB4OwogIH0KICB2YXIgZnJvdW5kLAogICAgICBmMzI7CiAgaWYgKHR5cGVvZiBGbG9hdDMyQXJyYXkgPT09ICdmdW5jdGlvbicpIHsKICAgIGYzMiA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICBmcm91bmQgPSBmdW5jdGlvbih4KSB7CiAgICAgIGYzMlswXSA9IE51bWJlcih4KTsKICAgICAgcmV0dXJuIGYzMlswXTsKICAgIH07CiAgfSBlbHNlIHsKICAgIGZyb3VuZCA9IGpzRnJvdW5kOwogIH0KICBmdW5jdGlvbiBjYnJ0KHgpIHsKICAgIHggPSAreDsKICAgIGlmICh4ID09PSAwKQogICAgICByZXR1cm4geDsKICAgIHZhciBuZWdhdGUgPSB4IDwgMDsKICAgIGlmIChuZWdhdGUpCiAgICAgIHggPSAteDsKICAgIHZhciByZXN1bHQgPSBwb3coeCwgMSAvIDMpOwogICAgcmV0dXJuIG5lZ2F0ZSA/IC1yZXN1bHQgOiByZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsTWF0aChnbG9iYWwpIHsKICAgIHZhciBNYXRoID0gZ2xvYmFsLk1hdGg7CiAgICBtYXliZUFkZEZ1bmN0aW9ucyhNYXRoLCBbJ2Fjb3NoJywgYWNvc2gsICdhc2luaCcsIGFzaW5oLCAnYXRhbmgnLCBhdGFuaCwgJ2NicnQnLCBjYnJ0LCAnY2x6MzInLCBjbHozMiwgJ2Nvc2gnLCBjb3NoLCAnZXhwbTEnLCBleHBtMSwgJ2Zyb3VuZCcsIGZyb3VuZCwgJ2h5cG90JywgaHlwb3QsICdpbXVsJywgaW11bCwgJ2xvZzEwJywgbG9nMTAsICdsb2cxcCcsIGxvZzFwLCAnbG9nMicsIGxvZzIsICdzaWduJywgc2lnbiwgJ3NpbmgnLCBzaW5oLCAndGFuaCcsIHRhbmgsICd0cnVuYycsIHRydW5jXSk7CiAgfQogIHJlZ2lzdGVyUG9seWZpbGwocG9seWZpbGxNYXRoKTsKICByZXR1cm4gewogICAgZ2V0IGNsejMyKCkgewogICAgICByZXR1cm4gY2x6MzI7CiAgICB9LAogICAgZ2V0IGltdWwoKSB7CiAgICAgIHJldHVybiBpbXVsOwogICAgfSwKICAgIGdldCBzaWduKCkgewogICAgICByZXR1cm4gc2lnbjsKICAgIH0sCiAgICBnZXQgbG9nMTAoKSB7CiAgICAgIHJldHVybiBsb2cxMDsKICAgIH0sCiAgICBnZXQgbG9nMigpIHsKICAgICAgcmV0dXJuIGxvZzI7CiAgICB9LAogICAgZ2V0IGxvZzFwKCkgewogICAgICByZXR1cm4gbG9nMXA7CiAgICB9LAogICAgZ2V0IGV4cG0xKCkgewogICAgICByZXR1cm4gZXhwbTE7CiAgICB9LAogICAgZ2V0IGNvc2goKSB7CiAgICAgIHJldHVybiBjb3NoOwogICAgfSwKICAgIGdldCBzaW5oKCkgewogICAgICByZXR1cm4gc2luaDsKICAgIH0sCiAgICBnZXQgdGFuaCgpIHsKICAgICAgcmV0dXJuIHRhbmg7CiAgICB9LAogICAgZ2V0IGFjb3NoKCkgewogICAgICByZXR1cm4gYWNvc2g7CiAgICB9LAogICAgZ2V0IGFzaW5oKCkgewogICAgICByZXR1cm4gYXNpbmg7CiAgICB9LAogICAgZ2V0IGF0YW5oKCkgewogICAgICByZXR1cm4gYXRhbmg7CiAgICB9LAogICAgZ2V0IGh5cG90KCkgewogICAgICByZXR1cm4gaHlwb3Q7CiAgICB9LAogICAgZ2V0IHRydW5jKCkgewogICAgICByZXR1cm4gdHJ1bmM7CiAgICB9LAogICAgZ2V0IGZyb3VuZCgpIHsKICAgICAgcmV0dXJuIGZyb3VuZDsKICAgIH0sCiAgICBnZXQgY2JydCgpIHsKICAgICAgcmV0dXJuIGNicnQ7CiAgICB9LAogICAgZ2V0IHBvbHlmaWxsTWF0aCgpIHsKICAgICAgcmV0dXJuIHBvbHlmaWxsTWF0aDsKICAgIH0KICB9Owp9KTsKU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvTWF0aC5qcyIgKyAnJyk7ClN5c3RlbS5yZWdpc3Rlck1vZHVsZSgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvcG9seWZpbGxzLmpzIiwgW10sIGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gInRyYWNldXItcnVudGltZUAwLjAuODgvc3JjL3J1bnRpbWUvcG9seWZpbGxzL3BvbHlmaWxscy5qcyI7CiAgdmFyIHBvbHlmaWxsQWxsID0gU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvdXRpbHMuanMiKS5wb2x5ZmlsbEFsbDsKICBwb2x5ZmlsbEFsbChSZWZsZWN0Lmdsb2JhbCk7CiAgdmFyIHNldHVwR2xvYmFscyA9ICR0cmFjZXVyUnVudGltZS5zZXR1cEdsb2JhbHM7CiAgJHRyYWNldXJSdW50aW1lLnNldHVwR2xvYmFscyA9IGZ1bmN0aW9uKGdsb2JhbCkgewogICAgc2V0dXBHbG9iYWxzKGdsb2JhbCk7CiAgICBwb2x5ZmlsbEFsbChnbG9iYWwpOwogIH07CiAgcmV0dXJuIHt9Owp9KTsKU3lzdGVtLmdldCgidHJhY2V1ci1ydW50aW1lQDAuMC44OC9zcmMvcnVudGltZS9wb2x5ZmlsbHMvcG9seWZpbGxzLmpzIiArICcnKTsKCihmdW5jdGlvbihnbG9iYWwpIHsKCiAgdmFyIGRlZmluZWQgPSB7fTsKCiAgLy8gaW5kZXhPZiBwb2x5ZmlsbCBmb3IgSUU4CiAgdmFyIGluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKQogICAgICBpZiAodGhpc1tpXSA9PT0gaXRlbSkKICAgICAgICByZXR1cm4gaTsKICAgIHJldHVybiAtMTsKICB9CgogIGZ1bmN0aW9uIGRlZHVwZShkZXBzKSB7CiAgICB2YXIgbmV3RGVwcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBkZXBzLmxlbmd0aDsgaSA8IGw7IGkrKykKICAgICAgaWYgKGluZGV4T2YuY2FsbChuZXdEZXBzLCBkZXBzW2ldKSA9PSAtMSkKICAgICAgICBuZXdEZXBzLnB1c2goZGVwc1tpXSkKICAgIHJldHVybiBuZXdEZXBzOwogIH0KCiAgZnVuY3Rpb24gcmVnaXN0ZXIobmFtZSwgZGVwcywgZGVjbGFyZSwgZXhlY3V0ZSkgewogICAgaWYgKHR5cGVvZiBuYW1lICE9ICdzdHJpbmcnKQogICAgICB0aHJvdyAiU3lzdGVtLnJlZ2lzdGVyIHByb3ZpZGVkIG5vIG1vZHVsZSBuYW1lIjsKCiAgICB2YXIgZW50cnk7CgogICAgLy8gZHluYW1pYwogICAgaWYgKHR5cGVvZiBkZWNsYXJlID09ICdib29sZWFuJykgewogICAgICBlbnRyeSA9IHsKICAgICAgICBkZWNsYXJhdGl2ZTogZmFsc2UsCiAgICAgICAgZGVwczogZGVwcywKICAgICAgICBleGVjdXRlOiBleGVjdXRlLAogICAgICAgIGV4ZWN1dGluZ1JlcXVpcmU6IGRlY2xhcmUKICAgICAgfTsKICAgIH0KICAgIGVsc2UgewogICAgICAvLyBFUzYgZGVjbGFyYXRpdmUKICAgICAgZW50cnkgPSB7CiAgICAgICAgZGVjbGFyYXRpdmU6IHRydWUsCiAgICAgICAgZGVwczogZGVwcywKICAgICAgICBkZWNsYXJlOiBkZWNsYXJlCiAgICAgIH07CiAgICB9CgogICAgZW50cnkubmFtZSA9IG5hbWU7CgogICAgLy8gd2UgbmV2ZXIgb3ZlcndyaXRlIGFuIGV4aXN0aW5nIGRlZmluZQogICAgaWYgKCEobmFtZSBpbiBkZWZpbmVkKSkKICAgICAgZGVmaW5lZFtuYW1lXSA9IGVudHJ5OwoKICAgIGVudHJ5LmRlcHMgPSBkZWR1cGUoZW50cnkuZGVwcyk7CgogICAgLy8gd2UgaGF2ZSB0byBub3JtYWxpemUgZGVwZW5kZW5jaWVzCiAgICAvLyAoYXNzdW1lIGRlcGVuZGVuY2llcyBhcmUgbm9ybWFsaXplZCBmb3Igbm93KQogICAgLy8gZW50cnkubm9ybWFsaXplZERlcHMgPSBlbnRyeS5kZXBzLm1hcChub3JtYWxpemUpOwogICAgZW50cnkubm9ybWFsaXplZERlcHMgPSBlbnRyeS5kZXBzOwogIH0KCiAgZnVuY3Rpb24gYnVpbGRHcm91cHMoZW50cnksIGdyb3VwcykgewogICAgZ3JvdXBzW2VudHJ5Lmdyb3VwSW5kZXhdID0gZ3JvdXBzW2VudHJ5Lmdyb3VwSW5kZXhdIHx8IFtdOwoKICAgIGlmIChpbmRleE9mLmNhbGwoZ3JvdXBzW2VudHJ5Lmdyb3VwSW5kZXhdLCBlbnRyeSkgIT0gLTEpCiAgICAgIHJldHVybjsKCiAgICBncm91cHNbZW50cnkuZ3JvdXBJbmRleF0ucHVzaChlbnRyeSk7CgogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBlbnRyeS5ub3JtYWxpemVkRGVwcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIGRlcE5hbWUgPSBlbnRyeS5ub3JtYWxpemVkRGVwc1tpXTsKICAgICAgdmFyIGRlcEVudHJ5ID0gZGVmaW5lZFtkZXBOYW1lXTsKCiAgICAgIC8vIG5vdCBpbiB0aGUgcmVnaXN0cnkgbWVhbnMgYWxyZWFkeSBsaW5rZWQgLyBFUzYKICAgICAgaWYgKCFkZXBFbnRyeSB8fCBkZXBFbnRyeS5ldmFsdWF0ZWQpCiAgICAgICAgY29udGludWU7CgogICAgICAvLyBub3cgd2Uga25vdyB0aGUgZW50cnkgaXMgaW4gb3VyIHVubGlua2VkIGxpbmthZ2UgZ3JvdXAKICAgICAgdmFyIGRlcEdyb3VwSW5kZXggPSBlbnRyeS5ncm91cEluZGV4ICsgKGRlcEVudHJ5LmRlY2xhcmF0aXZlICE9IGVudHJ5LmRlY2xhcmF0aXZlKTsKCiAgICAgIC8vIHRoZSBncm91cCBpbmRleCBvZiBhbiBlbnRyeSBpcyBhbHdheXMgdGhlIG1heGltdW0KICAgICAgaWYgKGRlcEVudHJ5Lmdyb3VwSW5kZXggPT09IHVuZGVmaW5lZCB8fCBkZXBFbnRyeS5ncm91cEluZGV4IDwgZGVwR3JvdXBJbmRleCkgewoKICAgICAgICAvLyBpZiBhbHJlYWR5IGluIGEgZ3JvdXAsIHJlbW92ZSBmcm9tIHRoZSBvbGQgZ3JvdXAKICAgICAgICBpZiAoZGVwRW50cnkuZ3JvdXBJbmRleCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBncm91cHNbZGVwRW50cnkuZ3JvdXBJbmRleF0uc3BsaWNlKGluZGV4T2YuY2FsbChncm91cHNbZGVwRW50cnkuZ3JvdXBJbmRleF0sIGRlcEVudHJ5KSwgMSk7CgogICAgICAgICAgLy8gaWYgdGhlIG9sZCBncm91cCBpcyBlbXB0eSwgdGhlbiB3ZSBoYXZlIGEgbWl4ZWQgZGVwbmRlbmN5IGN5Y2xlCiAgICAgICAgICBpZiAoZ3JvdXBzW2RlcEVudHJ5Lmdyb3VwSW5kZXhdLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJNaXhlZCBkZXBlbmRlbmN5IGN5Y2xlIGRldGVjdGVkIik7CiAgICAgICAgfQoKICAgICAgICBkZXBFbnRyeS5ncm91cEluZGV4ID0gZGVwR3JvdXBJbmRleDsKICAgICAgfQoKICAgICAgYnVpbGRHcm91cHMoZGVwRW50cnksIGdyb3Vwcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBsaW5rKG5hbWUpIHsKICAgIHZhciBzdGFydEVudHJ5ID0gZGVmaW5lZFtuYW1lXTsKCiAgICBzdGFydEVudHJ5Lmdyb3VwSW5kZXggPSAwOwoKICAgIHZhciBncm91cHMgPSBbXTsKCiAgICBidWlsZEdyb3VwcyhzdGFydEVudHJ5LCBncm91cHMpOwoKICAgIHZhciBjdXJHcm91cERlY2xhcmF0aXZlID0gISFzdGFydEVudHJ5LmRlY2xhcmF0aXZlID09IGdyb3Vwcy5sZW5ndGggJSAyOwogICAgZm9yICh2YXIgaSA9IGdyb3Vwcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICB2YXIgZ3JvdXAgPSBncm91cHNbaV07CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXAubGVuZ3RoOyBqKyspIHsKICAgICAgICB2YXIgZW50cnkgPSBncm91cFtqXTsKCiAgICAgICAgLy8gbGluayBlYWNoIGdyb3VwCiAgICAgICAgaWYgKGN1ckdyb3VwRGVjbGFyYXRpdmUpCiAgICAgICAgICBsaW5rRGVjbGFyYXRpdmVNb2R1bGUoZW50cnkpOwogICAgICAgIGVsc2UKICAgICAgICAgIGxpbmtEeW5hbWljTW9kdWxlKGVudHJ5KTsKICAgICAgfQogICAgICBjdXJHcm91cERlY2xhcmF0aXZlID0gIWN1ckdyb3VwRGVjbGFyYXRpdmU7CiAgICB9CiAgfQoKICAvLyBtb2R1bGUgYmluZGluZyByZWNvcmRzCiAgdmFyIG1vZHVsZVJlY29yZHMgPSB7fTsKICBmdW5jdGlvbiBnZXRPckNyZWF0ZU1vZHVsZVJlY29yZChuYW1lKSB7CiAgICByZXR1cm4gbW9kdWxlUmVjb3Jkc1tuYW1lXSB8fCAobW9kdWxlUmVjb3Jkc1tuYW1lXSA9IHsKICAgICAgbmFtZTogbmFtZSwKICAgICAgZGVwZW5kZW5jaWVzOiBbXSwKICAgICAgZXhwb3J0czoge30sIC8vIHN0YXJ0IGZyb20gYW4gZW1wdHkgbW9kdWxlIGFuZCBleHRlbmQKICAgICAgaW1wb3J0ZXJzOiBbXQogICAgfSkKICB9CgogIGZ1bmN0aW9uIGxpbmtEZWNsYXJhdGl2ZU1vZHVsZShlbnRyeSkgewogICAgLy8gb25seSBsaW5rIGlmIGFscmVhZHkgbm90IGFscmVhZHkgc3RhcnRlZCBsaW5raW5nIChzdG9wcyBhdCBjaXJjdWxhcikKICAgIGlmIChlbnRyeS5tb2R1bGUpCiAgICAgIHJldHVybjsKCiAgICB2YXIgbW9kdWxlID0gZW50cnkubW9kdWxlID0gZ2V0T3JDcmVhdGVNb2R1bGVSZWNvcmQoZW50cnkubmFtZSk7CiAgICB2YXIgZXhwb3J0cyA9IGVudHJ5Lm1vZHVsZS5leHBvcnRzOwoKICAgIHZhciBkZWNsYXJhdGlvbiA9IGVudHJ5LmRlY2xhcmUuY2FsbChnbG9iYWwsIGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgIG1vZHVsZS5sb2NrZWQgPSB0cnVlOwogICAgICBleHBvcnRzW25hbWVdID0gdmFsdWU7CgogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG1vZHVsZS5pbXBvcnRlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGltcG9ydGVyTW9kdWxlID0gbW9kdWxlLmltcG9ydGVyc1tpXTsKICAgICAgICBpZiAoIWltcG9ydGVyTW9kdWxlLmxvY2tlZCkgewogICAgICAgICAgdmFyIGltcG9ydGVySW5kZXggPSBpbmRleE9mLmNhbGwoaW1wb3J0ZXJNb2R1bGUuZGVwZW5kZW5jaWVzLCBtb2R1bGUpOwogICAgICAgICAgaW1wb3J0ZXJNb2R1bGUuc2V0dGVyc1tpbXBvcnRlckluZGV4XShleHBvcnRzKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1vZHVsZS5sb2NrZWQgPSBmYWxzZTsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSk7CgogICAgbW9kdWxlLnNldHRlcnMgPSBkZWNsYXJhdGlvbi5zZXR0ZXJzOwogICAgbW9kdWxlLmV4ZWN1dGUgPSBkZWNsYXJhdGlvbi5leGVjdXRlOwoKICAgIGlmICghbW9kdWxlLnNldHRlcnMgfHwgIW1vZHVsZS5leGVjdXRlKQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIFN5c3RlbS5yZWdpc3RlciBmb3JtIGZvciAiICsgZW50cnkubmFtZSk7CgogICAgLy8gbm93IGxpbmsgYWxsIHRoZSBtb2R1bGUgZGVwZW5kZW5jaWVzCiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVudHJ5Lm5vcm1hbGl6ZWREZXBzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgZGVwTmFtZSA9IGVudHJ5Lm5vcm1hbGl6ZWREZXBzW2ldOwogICAgICB2YXIgZGVwRW50cnkgPSBkZWZpbmVkW2RlcE5hbWVdOwogICAgICB2YXIgZGVwTW9kdWxlID0gbW9kdWxlUmVjb3Jkc1tkZXBOYW1lXTsKCiAgICAgIC8vIHdvcmsgb3V0IGhvdyB0byBzZXQgZGVwRXhwb3J0cyBiYXNlZCBvbiBzY2VuYXJpb3MuLi4KICAgICAgdmFyIGRlcEV4cG9ydHM7CgogICAgICBpZiAoZGVwTW9kdWxlKSB7CiAgICAgICAgZGVwRXhwb3J0cyA9IGRlcE1vZHVsZS5leHBvcnRzOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGRlcEVudHJ5ICYmICFkZXBFbnRyeS5kZWNsYXJhdGl2ZSkgewogICAgICAgIGlmIChkZXBFbnRyeS5tb2R1bGUuZXhwb3J0cyAmJiBkZXBFbnRyeS5tb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlKQogICAgICAgICAgZGVwRXhwb3J0cyA9IGRlcEVudHJ5Lm1vZHVsZS5leHBvcnRzOwogICAgICAgIGVsc2UKICAgICAgICAgIGRlcEV4cG9ydHMgPSB7ICdkZWZhdWx0JzogZGVwRW50cnkubW9kdWxlLmV4cG9ydHMsIF9fdXNlRGVmYXVsdDogdHJ1ZSB9OwogICAgICB9CiAgICAgIC8vIGluIHRoZSBtb2R1bGUgcmVnaXN0cnkKICAgICAgZWxzZSBpZiAoIWRlcEVudHJ5KSB7CiAgICAgICAgZGVwRXhwb3J0cyA9IGxvYWQoZGVwTmFtZSk7CiAgICAgIH0KICAgICAgLy8gd2UgaGF2ZSBhbiBlbnRyeSAtPiBsaW5rCiAgICAgIGVsc2UgewogICAgICAgIGxpbmtEZWNsYXJhdGl2ZU1vZHVsZShkZXBFbnRyeSk7CiAgICAgICAgZGVwTW9kdWxlID0gZGVwRW50cnkubW9kdWxlOwogICAgICAgIGRlcEV4cG9ydHMgPSBkZXBNb2R1bGUuZXhwb3J0czsKICAgICAgfQoKICAgICAgLy8gb25seSBkZWNsYXJhdGl2ZSBtb2R1bGVzIGhhdmUgZHluYW1pYyBiaW5kaW5ncwogICAgICBpZiAoZGVwTW9kdWxlICYmIGRlcE1vZHVsZS5pbXBvcnRlcnMpIHsKICAgICAgICBkZXBNb2R1bGUuaW1wb3J0ZXJzLnB1c2gobW9kdWxlKTsKICAgICAgICBtb2R1bGUuZGVwZW5kZW5jaWVzLnB1c2goZGVwTW9kdWxlKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgICAgbW9kdWxlLmRlcGVuZGVuY2llcy5wdXNoKG51bGwpOwoKICAgICAgLy8gcnVuIHRoZSBzZXR0ZXIgZm9yIHRoaXMgZGVwZW5kZW5jeQogICAgICBpZiAobW9kdWxlLnNldHRlcnNbaV0pCiAgICAgICAgbW9kdWxlLnNldHRlcnNbaV0oZGVwRXhwb3J0cyk7CiAgICB9CiAgfQoKICAvLyBBbiBhbmFsb2cgdG8gbG9hZGVyLmdldCBjb3ZlcmluZyBleGVjdXRpb24gb2YgYWxsIHRocmVlIGxheWVycyAocmVhbCBkZWNsYXJhdGl2ZSwgc2ltdWxhdGVkIGRlY2xhcmF0aXZlLCBzaW11bGF0ZWQgZHluYW1pYykKICBmdW5jdGlvbiBnZXRNb2R1bGUobmFtZSkgewogICAgdmFyIGV4cG9ydHM7CiAgICB2YXIgZW50cnkgPSBkZWZpbmVkW25hbWVdOwoKICAgIGlmICghZW50cnkpIHsKICAgICAgZXhwb3J0cyA9IGxvYWQobmFtZSk7CiAgICAgIGlmICghZXhwb3J0cykKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuYWJsZSB0byBsb2FkIGRlcGVuZGVuY3kgIiArIG5hbWUgKyAiLiIpOwogICAgfQoKICAgIGVsc2UgewogICAgICBpZiAoZW50cnkuZGVjbGFyYXRpdmUpCiAgICAgICAgZW5zdXJlRXZhbHVhdGVkKG5hbWUsIFtdKTsKCiAgICAgIGVsc2UgaWYgKCFlbnRyeS5ldmFsdWF0ZWQpCiAgICAgICAgbGlua0R5bmFtaWNNb2R1bGUoZW50cnkpOwoKICAgICAgZXhwb3J0cyA9IGVudHJ5Lm1vZHVsZS5leHBvcnRzOwogICAgfQoKICAgIGlmICgoIWVudHJ5IHx8IGVudHJ5LmRlY2xhcmF0aXZlKSAmJiBleHBvcnRzICYmIGV4cG9ydHMuX191c2VEZWZhdWx0KQogICAgICByZXR1cm4gZXhwb3J0c1snZGVmYXVsdCddOwoKICAgIHJldHVybiBleHBvcnRzOwogIH0KCiAgZnVuY3Rpb24gbGlua0R5bmFtaWNNb2R1bGUoZW50cnkpIHsKICAgIGlmIChlbnRyeS5tb2R1bGUpCiAgICAgIHJldHVybjsKCiAgICB2YXIgZXhwb3J0cyA9IHt9OwoKICAgIHZhciBtb2R1bGUgPSBlbnRyeS5tb2R1bGUgPSB7IGV4cG9ydHM6IGV4cG9ydHMsIGlkOiBlbnRyeS5uYW1lIH07CgogICAgLy8gQU1EIHJlcXVpcmVzIGV4ZWN1dGUgdGhlIHRyZWUgZmlyc3QKICAgIGlmICghZW50cnkuZXhlY3V0aW5nUmVxdWlyZSkgewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVudHJ5Lm5vcm1hbGl6ZWREZXBzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBkZXBOYW1lID0gZW50cnkubm9ybWFsaXplZERlcHNbaV07CiAgICAgICAgdmFyIGRlcEVudHJ5ID0gZGVmaW5lZFtkZXBOYW1lXTsKICAgICAgICBpZiAoZGVwRW50cnkpCiAgICAgICAgICBsaW5rRHluYW1pY01vZHVsZShkZXBFbnRyeSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBub3cgZXhlY3V0ZQogICAgZW50cnkuZXZhbHVhdGVkID0gdHJ1ZTsKICAgIHZhciBvdXRwdXQgPSBlbnRyeS5leGVjdXRlLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gZW50cnkuZGVwcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAoZW50cnkuZGVwc1tpXSAhPSBuYW1lKQogICAgICAgICAgY29udGludWU7CiAgICAgICAgcmV0dXJuIGdldE1vZHVsZShlbnRyeS5ub3JtYWxpemVkRGVwc1tpXSk7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignTW9kdWxlICcgKyBuYW1lICsgJyBub3QgZGVjbGFyZWQgYXMgYSBkZXBlbmRlbmN5LicpOwogICAgfSwgZXhwb3J0cywgbW9kdWxlKTsKCiAgICBpZiAob3V0cHV0KQogICAgICBtb2R1bGUuZXhwb3J0cyA9IG91dHB1dDsKICB9CgogIC8qCiAgICogR2l2ZW4gYSBtb2R1bGUsIGFuZCB0aGUgbGlzdCBvZiBtb2R1bGVzIGZvciB0aGlzIGN1cnJlbnQgYnJhbmNoLAogICAqICBlbnN1cmUgdGhhdCBlYWNoIG9mIHRoZSBkZXBlbmRlbmNpZXMgb2YgdGhpcyBtb2R1bGUgaXMgZXZhbHVhdGVkCiAgICogICh1bmxlc3Mgb25lIGlzIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSBhbHJlYWR5IGluIHRoZSBsaXN0IG9mIHNlZW4KICAgKiAgbW9kdWxlcywgaW4gd2hpY2ggY2FzZSB3ZSBleGVjdXRlIGl0KQogICAqCiAgICogVGhlbiB3ZSBldmFsdWF0ZSB0aGUgbW9kdWxlIGl0c2VsZiBkZXB0aC1maXJzdCBsZWZ0IHRvIHJpZ2h0CiAgICogZXhlY3V0aW9uIHRvIG1hdGNoIEVTNiBtb2R1bGVzCiAgICovCiAgZnVuY3Rpb24gZW5zdXJlRXZhbHVhdGVkKG1vZHVsZU5hbWUsIHNlZW4pIHsKICAgIHZhciBlbnRyeSA9IGRlZmluZWRbbW9kdWxlTmFtZV07CgogICAgLy8gaWYgYWxyZWFkeSBzZWVuLCB0aGF0IG1lYW5zIGl0J3MgYW4gYWxyZWFkeS1ldmFsdWF0ZWQgbm9uIGNpcmN1bGFyIGRlcGVuZGVuY3kKICAgIGlmICghZW50cnkgfHwgZW50cnkuZXZhbHVhdGVkIHx8ICFlbnRyeS5kZWNsYXJhdGl2ZSkKICAgICAgcmV0dXJuOwoKICAgIC8vIHRoaXMgb25seSBhcHBsaWVzIHRvIGRlY2xhcmF0aXZlIG1vZHVsZXMgd2hpY2ggbGF0ZS1leGVjdXRlCgogICAgc2Vlbi5wdXNoKG1vZHVsZU5hbWUpOwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gZW50cnkubm9ybWFsaXplZERlcHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBkZXBOYW1lID0gZW50cnkubm9ybWFsaXplZERlcHNbaV07CiAgICAgIGlmIChpbmRleE9mLmNhbGwoc2VlbiwgZGVwTmFtZSkgPT0gLTEpIHsKICAgICAgICBpZiAoIWRlZmluZWRbZGVwTmFtZV0pCiAgICAgICAgICBsb2FkKGRlcE5hbWUpOwogICAgICAgIGVsc2UKICAgICAgICAgIGVuc3VyZUV2YWx1YXRlZChkZXBOYW1lLCBzZWVuKTsKICAgICAgfQogICAgfQoKICAgIGlmIChlbnRyeS5ldmFsdWF0ZWQpCiAgICAgIHJldHVybjsKCiAgICBlbnRyeS5ldmFsdWF0ZWQgPSB0cnVlOwogICAgZW50cnkubW9kdWxlLmV4ZWN1dGUuY2FsbChnbG9iYWwpOwogIH0KCiAgLy8gbWFnaWNhbCBleGVjdXRpb24gZnVuY3Rpb24KICB2YXIgbW9kdWxlcyA9IHt9OwogIGZ1bmN0aW9uIGxvYWQobmFtZSkgewogICAgaWYgKG1vZHVsZXNbbmFtZV0pCiAgICAgIHJldHVybiBtb2R1bGVzW25hbWVdOwoKICAgIHZhciBlbnRyeSA9IGRlZmluZWRbbmFtZV07CgogICAgLy8gZmlyc3Qgd2UgY2hlY2sgaWYgdGhpcyBtb2R1bGUgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkIGluIHRoZSByZWdpc3RyeQogICAgaWYgKCFlbnRyeSkKICAgICAgdGhyb3cgIk1vZHVsZSAiICsgbmFtZSArICIgbm90IHByZXNlbnQuIjsKCiAgICAvLyByZWN1cnNpdmVseSBlbnN1cmUgdGhhdCB0aGUgbW9kdWxlIGFuZCBhbGwgaXRzCiAgICAvLyBkZXBlbmRlbmNpZXMgYXJlIGxpbmtlZCAod2l0aCBkZXBlbmRlbmN5IGdyb3VwIGhhbmRsaW5nKQogICAgbGluayhuYW1lKTsKCiAgICAvLyBub3cgaGFuZGxlIGRlcGVuZGVuY3kgZXhlY3V0aW9uIGluIGNvcnJlY3Qgb3JkZXIKICAgIGVuc3VyZUV2YWx1YXRlZChuYW1lLCBbXSk7CgogICAgLy8gcmVtb3ZlIGZyb20gdGhlIHJlZ2lzdHJ5CiAgICBkZWZpbmVkW25hbWVdID0gdW5kZWZpbmVkOwoKICAgIHZhciBtb2R1bGUgPSBlbnRyeS5tb2R1bGUuZXhwb3J0czsKCiAgICBpZiAoIW1vZHVsZSB8fCAhZW50cnkuZGVjbGFyYXRpdmUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgIT09IHRydWUpCiAgICAgIG1vZHVsZSA9IHsgJ2RlZmF1bHQnOiBtb2R1bGUsIF9fdXNlRGVmYXVsdDogdHJ1ZSB9OwoKICAgIC8vIHJldHVybiB0aGUgZGVmaW5lZCBtb2R1bGUgb2JqZWN0CiAgICByZXR1cm4gbW9kdWxlc1tuYW1lXSA9IG1vZHVsZTsKICB9OwoKICByZXR1cm4gZnVuY3Rpb24obWFpbnMsIGRlY2xhcmUpIHsKCiAgICB2YXIgU3lzdGVtOwogICAgdmFyIFN5c3RlbSA9IHsKICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLAogICAgICBnZXQ6IGxvYWQsCiAgICAgIHNldDogZnVuY3Rpb24obmFtZSwgbW9kdWxlKSB7CiAgICAgICAgbW9kdWxlc1tuYW1lXSA9IG1vZHVsZTsKICAgICAgfSwKICAgICAgbmV3TW9kdWxlOiBmdW5jdGlvbihtb2R1bGUpIHsKICAgICAgICByZXR1cm4gbW9kdWxlOwogICAgICB9LAogICAgICBnbG9iYWw6IGdsb2JhbAogICAgfTsKICAgIFN5c3RlbS5zZXQoJ0BlbXB0eScsIHt9KTsKCiAgICBkZWNsYXJlKFN5c3RlbSk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYWlucy5sZW5ndGg7IGkrKykKICAgICAgbG9hZChtYWluc1tpXSk7CiAgfQoKfSkodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IGdsb2JhbCkKLyogKFsnbWFpbk1vZHVsZSddLCBmdW5jdGlvbihTeXN0ZW0pIHsKICBTeXN0ZW0ucmVnaXN0ZXIoLi4uKTsKfSk7ICovCgooWydPcGVyYXRpb25zJ10sIGZ1bmN0aW9uKFN5c3RlbSkgewoKKGZ1bmN0aW9uKCkgewpmdW5jdGlvbiBkZWZpbmUoKXt9OyAgZGVmaW5lLmFtZCA9IHt9OwpTeXN0ZW0ucmVnaXN0ZXIoInhtbGpzIiwgW10sIGZhbHNlLCBmdW5jdGlvbihyZXF1aXJlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGNvbmZpZykgewogICAgJ3VzZSBzdHJpY3QnOwogICAgdmFyIFZFUlNJT04gPSAiMS4xLjYiOwogICAgY29uZmlnID0gY29uZmlnIHx8IHt9OwogICAgaW5pdENvbmZpZ0RlZmF1bHRzKCk7CiAgICBpbml0UmVxdWlyZWRQb2x5ZmlsbHMoKTsKICAgIGZ1bmN0aW9uIGluaXRDb25maWdEZWZhdWx0cygpIHsKICAgICAgaWYgKGNvbmZpZy5lc2NhcGVNb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjb25maWcuZXNjYXBlTW9kZSA9IHRydWU7CiAgICAgIH0KICAgICAgY29uZmlnLmF0dHJpYnV0ZVByZWZpeCA9IGNvbmZpZy5hdHRyaWJ1dGVQcmVmaXggfHwgIl8iOwogICAgICBjb25maWcuYXJyYXlBY2Nlc3NGb3JtID0gY29uZmlnLmFycmF5QWNjZXNzRm9ybSB8fCAibm9uZSI7CiAgICAgIGNvbmZpZy5lbXB0eU5vZGVGb3JtID0gY29uZmlnLmVtcHR5Tm9kZUZvcm0gfHwgInRleHQiOwogICAgICBpZiAoY29uZmlnLmVuYWJsZVRvU3RyaW5nRnVuYyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29uZmlnLmVuYWJsZVRvU3RyaW5nRnVuYyA9IHRydWU7CiAgICAgIH0KICAgICAgY29uZmlnLmFycmF5QWNjZXNzRm9ybVBhdGhzID0gY29uZmlnLmFycmF5QWNjZXNzRm9ybVBhdGhzIHx8IFtdOwogICAgICBpZiAoY29uZmlnLnNraXBFbXB0eVRleHROb2Rlc0Zvck9iaiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29uZmlnLnNraXBFbXB0eVRleHROb2Rlc0Zvck9iaiA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKGNvbmZpZy5zdHJpcFdoaXRlc3BhY2VzID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjb25maWcuc3RyaXBXaGl0ZXNwYWNlcyA9IHRydWU7CiAgICAgIH0KICAgICAgY29uZmlnLmRhdGV0aW1lQWNjZXNzRm9ybVBhdGhzID0gY29uZmlnLmRhdGV0aW1lQWNjZXNzRm9ybVBhdGhzIHx8IFtdOwogICAgfQogICAgdmFyIERPTU5vZGVUeXBlcyA9IHsKICAgICAgRUxFTUVOVF9OT0RFOiAxLAogICAgICBURVhUX05PREU6IDMsCiAgICAgIENEQVRBX1NFQ1RJT05fTk9ERTogNCwKICAgICAgQ09NTUVOVF9OT0RFOiA4LAogICAgICBET0NVTUVOVF9OT0RFOiA5CiAgICB9OwogICAgZnVuY3Rpb24gaW5pdFJlcXVpcmVkUG9seWZpbGxzKCkgewogICAgICBmdW5jdGlvbiBwYWQobnVtYmVyKSB7CiAgICAgICAgdmFyIHIgPSBTdHJpbmcobnVtYmVyKTsKICAgICAgICBpZiAoci5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIHIgPSAnMCcgKyByOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfQogICAgICBpZiAodHlwZW9mIFN0cmluZy5wcm90b3R5cGUudHJpbSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIFN0cmluZy5wcm90b3R5cGUudHJpbSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xeXG4rfChcc3xcbikrJC9nLCAnJyk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9JU09TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgKyAnLScgKyBwYWQodGhpcy5nZXRVVENNb250aCgpICsgMSkgKyAnLScgKyBwYWQodGhpcy5nZXRVVENEYXRlKCkpICsgJ1QnICsgcGFkKHRoaXMuZ2V0VVRDSG91cnMoKSkgKyAnOicgKyBwYWQodGhpcy5nZXRVVENNaW51dGVzKCkpICsgJzonICsgcGFkKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSArICcuJyArIFN0cmluZygodGhpcy5nZXRVVENNaWxsaXNlY29uZHMoKSAvIDEwMDApLnRvRml4ZWQoMykpLnNsaWNlKDIsIDUpICsgJ1onOwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGdldE5vZGVMb2NhbE5hbWUobm9kZSkgewogICAgICB2YXIgbm9kZUxvY2FsTmFtZSA9IG5vZGUubG9jYWxOYW1lOwogICAgICBpZiAobm9kZUxvY2FsTmFtZSA9PSBudWxsKQogICAgICAgIG5vZGVMb2NhbE5hbWUgPSBub2RlLmJhc2VOYW1lOwogICAgICBpZiAobm9kZUxvY2FsTmFtZSA9PSBudWxsIHx8IG5vZGVMb2NhbE5hbWUgPT0gIiIpCiAgICAgICAgbm9kZUxvY2FsTmFtZSA9IG5vZGUubm9kZU5hbWU7CiAgICAgIHJldHVybiBub2RlTG9jYWxOYW1lOwogICAgfQogICAgZnVuY3Rpb24gZ2V0Tm9kZVByZWZpeChub2RlKSB7CiAgICAgIHJldHVybiBub2RlLnByZWZpeDsKICAgIH0KICAgIGZ1bmN0aW9uIGVzY2FwZVhtbENoYXJzKHN0cikgewogICAgICBpZiAodHlwZW9mKHN0cikgPT0gInN0cmluZyIpCiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8mL2csICcmYW1wOycpLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykucmVwbGFjZSgvJy9nLCAnJiN4Mjc7Jyk7CiAgICAgIGVsc2UKICAgICAgICByZXR1cm4gc3RyOwogICAgfQogICAgZnVuY3Rpb24gdW5lc2NhcGVYbWxDaGFycyhzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8mYW1wOy9nLCAnJicpLnJlcGxhY2UoLyZsdDsvZywgJzwnKS5yZXBsYWNlKC8mZ3Q7L2csICc+JykucmVwbGFjZSgvJnF1b3Q7L2csICciJykucmVwbGFjZSgvJiN4Mjc7L2csICInIik7CiAgICB9CiAgICBmdW5jdGlvbiB0b0FycmF5QWNjZXNzRm9ybShvYmosIGNoaWxkTmFtZSwgcGF0aCkgewogICAgICBzd2l0Y2ggKGNvbmZpZy5hcnJheUFjY2Vzc0Zvcm0pIHsKICAgICAgICBjYXNlICJwcm9wZXJ0eSI6CiAgICAgICAgICBpZiAoIShvYmpbY2hpbGROYW1lXSBpbnN0YW5jZW9mIEFycmF5KSkKICAgICAgICAgICAgb2JqW2NoaWxkTmFtZSArICJfYXNBcnJheSJdID0gW29ialtjaGlsZE5hbWVdXTsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgb2JqW2NoaWxkTmFtZSArICJfYXNBcnJheSJdID0gb2JqW2NoaWxkTmFtZV07CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoIShvYmpbY2hpbGROYW1lXSBpbnN0YW5jZW9mIEFycmF5KSAmJiBjb25maWcuYXJyYXlBY2Nlc3NGb3JtUGF0aHMubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBpZHggPSAwOwogICAgICAgIGZvciAoOyBpZHggPCBjb25maWcuYXJyYXlBY2Nlc3NGb3JtUGF0aHMubGVuZ3RoOyBpZHgrKykgewogICAgICAgICAgdmFyIGFycmF5UGF0aCA9IGNvbmZpZy5hcnJheUFjY2Vzc0Zvcm1QYXRoc1tpZHhdOwogICAgICAgICAgaWYgKHR5cGVvZiBhcnJheVBhdGggPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChhcnJheVBhdGggPT0gcGF0aCkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSBpZiAoYXJyYXlQYXRoIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgIGlmIChhcnJheVBhdGgudGVzdChwYXRoKSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFycmF5UGF0aCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBpZiAoYXJyYXlQYXRoKG9iaiwgY2hpbGROYW1lLCBwYXRoKSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlkeCAhPSBjb25maWcuYXJyYXlBY2Nlc3NGb3JtUGF0aHMubGVuZ3RoKSB7CiAgICAgICAgICBvYmpbY2hpbGROYW1lXSA9IFtvYmpbY2hpbGROYW1lXV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBmcm9tWG1sRGF0ZVRpbWUocHJvcCkgewogICAgICB2YXIgYml0cyA9IHByb3Auc3BsaXQoL1stVDorWl0vZyk7CiAgICAgIHZhciBkID0gbmV3IERhdGUoYml0c1swXSwgYml0c1sxXSAtIDEsIGJpdHNbMl0pOwogICAgICB2YXIgc2Vjb25kQml0cyA9IGJpdHNbNV0uc3BsaXQoIlwuIik7CiAgICAgIGQuc2V0SG91cnMoYml0c1szXSwgYml0c1s0XSwgc2Vjb25kQml0c1swXSk7CiAgICAgIGlmIChzZWNvbmRCaXRzLmxlbmd0aCA+IDEpCiAgICAgICAgZC5zZXRNaWxsaXNlY29uZHMoc2Vjb25kQml0c1sxXSk7CiAgICAgIGlmIChiaXRzWzZdICYmIGJpdHNbN10pIHsKICAgICAgICB2YXIgb2Zmc2V0TWludXRlcyA9IGJpdHNbNl0gKiA2MCArIE51bWJlcihiaXRzWzddKTsKICAgICAgICB2YXIgc2lnbiA9IC9cZFxkLVxkXGQ6XGRcZCQvLnRlc3QocHJvcCkgPyAnLScgOiAnKyc7CiAgICAgICAgb2Zmc2V0TWludXRlcyA9IDAgKyAoc2lnbiA9PSAnLScgPyAtMSAqIG9mZnNldE1pbnV0ZXMgOiBvZmZzZXRNaW51dGVzKTsKICAgICAgICBkLnNldE1pbnV0ZXMoZC5nZXRNaW51dGVzKCkgLSBvZmZzZXRNaW51dGVzIC0gZC5nZXRUaW1lem9uZU9mZnNldCgpKTsKICAgICAgfSBlbHNlIGlmIChwcm9wLmluZGV4T2YoIloiLCBwcm9wLmxlbmd0aCAtIDEpICE9PSAtMSkgewogICAgICAgIGQgPSBuZXcgRGF0ZShEYXRlLlVUQyhkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCksIGQuZ2V0SG91cnMoKSwgZC5nZXRNaW51dGVzKCksIGQuZ2V0U2Vjb25kcygpLCBkLmdldE1pbGxpc2Vjb25kcygpKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGQ7CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja0Zyb21YbWxEYXRlVGltZVBhdGhzKHZhbHVlLCBjaGlsZE5hbWUsIGZ1bGxQYXRoKSB7CiAgICAgIGlmIChjb25maWcuZGF0ZXRpbWVBY2Nlc3NGb3JtUGF0aHMubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBwYXRoID0gZnVsbFBhdGguc3BsaXQoIlwuIyIpWzBdOwogICAgICAgIHZhciBpZHggPSAwOwogICAgICAgIGZvciAoOyBpZHggPCBjb25maWcuZGF0ZXRpbWVBY2Nlc3NGb3JtUGF0aHMubGVuZ3RoOyBpZHgrKykgewogICAgICAgICAgdmFyIGR0UGF0aCA9IGNvbmZpZy5kYXRldGltZUFjY2Vzc0Zvcm1QYXRoc1tpZHhdOwogICAgICAgICAgaWYgKHR5cGVvZiBkdFBhdGggPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChkdFBhdGggPT0gcGF0aCkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSBpZiAoZHRQYXRoIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgIGlmIChkdFBhdGgudGVzdChwYXRoKSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGR0UGF0aCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBpZiAoZHRQYXRoKG9iaiwgY2hpbGROYW1lLCBwYXRoKSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlkeCAhPSBjb25maWcuZGF0ZXRpbWVBY2Nlc3NGb3JtUGF0aHMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gZnJvbVhtbERhdGVUaW1lKHZhbHVlKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfSBlbHNlCiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VET01DaGlsZHJlbihub2RlLCBwYXRoKSB7CiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09IERPTU5vZGVUeXBlcy5ET0NVTUVOVF9OT0RFKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBPYmplY3Q7CiAgICAgICAgdmFyIG5vZGVDaGlsZHJlbiA9IG5vZGUuY2hpbGROb2RlczsKICAgICAgICBmb3IgKHZhciBjaWR4ID0gMDsgY2lkeCA8IG5vZGVDaGlsZHJlbi5sZW5ndGg7IGNpZHgrKykgewogICAgICAgICAgdmFyIGNoaWxkID0gbm9kZUNoaWxkcmVuLml0ZW0oY2lkeCk7CiAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT0gRE9NTm9kZVR5cGVzLkVMRU1FTlRfTk9ERSkgewogICAgICAgICAgICB2YXIgY2hpbGROYW1lID0gZ2V0Tm9kZUxvY2FsTmFtZShjaGlsZCk7CiAgICAgICAgICAgIHJlc3VsdFtjaGlsZE5hbWVdID0gcGFyc2VET01DaGlsZHJlbihjaGlsZCwgY2hpbGROYW1lKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09IERPTU5vZGVUeXBlcy5FTEVNRU5UX05PREUpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IE9iamVjdDsKICAgICAgICByZXN1bHQuX19jbnQgPSAwOwogICAgICAgIHZhciBub2RlQ2hpbGRyZW4gPSBub2RlLmNoaWxkTm9kZXM7CiAgICAgICAgZm9yICh2YXIgY2lkeCA9IDA7IGNpZHggPCBub2RlQ2hpbGRyZW4ubGVuZ3RoOyBjaWR4KyspIHsKICAgICAgICAgIHZhciBjaGlsZCA9IG5vZGVDaGlsZHJlbi5pdGVtKGNpZHgpOwogICAgICAgICAgdmFyIGNoaWxkTmFtZSA9IGdldE5vZGVMb2NhbE5hbWUoY2hpbGQpOwogICAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlICE9IERPTU5vZGVUeXBlcy5DT01NRU5UX05PREUpIHsKICAgICAgICAgICAgcmVzdWx0Ll9fY250Kys7CiAgICAgICAgICAgIGlmIChyZXN1bHRbY2hpbGROYW1lXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgcmVzdWx0W2NoaWxkTmFtZV0gPSBwYXJzZURPTUNoaWxkcmVuKGNoaWxkLCBwYXRoICsgIi4iICsgY2hpbGROYW1lKTsKICAgICAgICAgICAgICB0b0FycmF5QWNjZXNzRm9ybShyZXN1bHQsIGNoaWxkTmFtZSwgcGF0aCArICIuIiArIGNoaWxkTmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdFtjaGlsZE5hbWVdICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICghKHJlc3VsdFtjaGlsZE5hbWVdIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgICAgICAgICAgIHJlc3VsdFtjaGlsZE5hbWVdID0gW3Jlc3VsdFtjaGlsZE5hbWVdXTsKICAgICAgICAgICAgICAgICAgdG9BcnJheUFjY2Vzc0Zvcm0ocmVzdWx0LCBjaGlsZE5hbWUsIHBhdGggKyAiLiIgKyBjaGlsZE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAocmVzdWx0W2NoaWxkTmFtZV0pW3Jlc3VsdFtjaGlsZE5hbWVdLmxlbmd0aF0gPSBwYXJzZURPTUNoaWxkcmVuKGNoaWxkLCBwYXRoICsgIi4iICsgY2hpbGROYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBhaWR4ID0gMDsgYWlkeCA8IG5vZGUuYXR0cmlidXRlcy5sZW5ndGg7IGFpZHgrKykgewogICAgICAgICAgdmFyIGF0dHIgPSBub2RlLmF0dHJpYnV0ZXMuaXRlbShhaWR4KTsKICAgICAgICAgIHJlc3VsdC5fX2NudCsrOwogICAgICAgICAgcmVzdWx0W2NvbmZpZy5hdHRyaWJ1dGVQcmVmaXggKyBhdHRyLm5hbWVdID0gYXR0ci52YWx1ZTsKICAgICAgICB9CiAgICAgICAgdmFyIG5vZGVQcmVmaXggPSBnZXROb2RlUHJlZml4KG5vZGUpOwogICAgICAgIGlmIChub2RlUHJlZml4ICE9IG51bGwgJiYgbm9kZVByZWZpeCAhPSAiIikgewogICAgICAgICAgcmVzdWx0Ll9fY250Kys7CiAgICAgICAgICByZXN1bHQuX19wcmVmaXggPSBub2RlUHJlZml4OwogICAgICAgIH0KICAgICAgICBpZiAocmVzdWx0WyIjdGV4dCJdICE9IG51bGwpIHsKICAgICAgICAgIHJlc3VsdC5fX3RleHQgPSByZXN1bHRbIiN0ZXh0Il07CiAgICAgICAgICBpZiAocmVzdWx0Ll9fdGV4dCBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgIHJlc3VsdC5fX3RleHQgPSByZXN1bHQuX190ZXh0LmpvaW4oIlxuIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29uZmlnLmVzY2FwZU1vZGUpCiAgICAgICAgICAgIHJlc3VsdC5fX3RleHQgPSB1bmVzY2FwZVhtbENoYXJzKHJlc3VsdC5fX3RleHQpOwogICAgICAgICAgaWYgKGNvbmZpZy5zdHJpcFdoaXRlc3BhY2VzKQogICAgICAgICAgICByZXN1bHQuX190ZXh0ID0gcmVzdWx0Ll9fdGV4dC50cmltKCk7CiAgICAgICAgICBkZWxldGUgcmVzdWx0WyIjdGV4dCJdOwogICAgICAgICAgaWYgKGNvbmZpZy5hcnJheUFjY2Vzc0Zvcm0gPT0gInByb3BlcnR5IikKICAgICAgICAgICAgZGVsZXRlIHJlc3VsdFsiI3RleHRfYXNBcnJheSJdOwogICAgICAgICAgcmVzdWx0Ll9fdGV4dCA9IGNoZWNrRnJvbVhtbERhdGVUaW1lUGF0aHMocmVzdWx0Ll9fdGV4dCwgY2hpbGROYW1lLCBwYXRoICsgIi4iICsgY2hpbGROYW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3VsdFsiI2NkYXRhLXNlY3Rpb24iXSAhPSBudWxsKSB7CiAgICAgICAgICByZXN1bHQuX19jZGF0YSA9IHJlc3VsdFsiI2NkYXRhLXNlY3Rpb24iXTsKICAgICAgICAgIGRlbGV0ZSByZXN1bHRbIiNjZGF0YS1zZWN0aW9uIl07CiAgICAgICAgICBpZiAoY29uZmlnLmFycmF5QWNjZXNzRm9ybSA9PSAicHJvcGVydHkiKQogICAgICAgICAgICBkZWxldGUgcmVzdWx0WyIjY2RhdGEtc2VjdGlvbl9hc0FycmF5Il07CiAgICAgICAgfQogICAgICAgIGlmIChyZXN1bHQuX19jbnQgPT0gMSAmJiByZXN1bHQuX190ZXh0ICE9IG51bGwpIHsKICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5fX3RleHQ7CiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuX19jbnQgPT0gMCAmJiBjb25maWcuZW1wdHlOb2RlRm9ybSA9PSAidGV4dCIpIHsKICAgICAgICAgIHJlc3VsdCA9ICcnOwogICAgICAgIH0gZWxzZSBpZiAocmVzdWx0Ll9fY250ID4gMSAmJiByZXN1bHQuX190ZXh0ICE9IG51bGwgJiYgY29uZmlnLnNraXBFbXB0eVRleHROb2Rlc0Zvck9iaikgewogICAgICAgICAgaWYgKChjb25maWcuc3RyaXBXaGl0ZXNwYWNlcyAmJiByZXN1bHQuX190ZXh0ID09ICIiKSB8fCAocmVzdWx0Ll9fdGV4dC50cmltKCkgPT0gIiIpKSB7CiAgICAgICAgICAgIGRlbGV0ZSByZXN1bHQuX190ZXh0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkZWxldGUgcmVzdWx0Ll9fY250OwogICAgICAgIGlmIChjb25maWcuZW5hYmxlVG9TdHJpbmdGdW5jICYmIChyZXN1bHQuX190ZXh0ICE9IG51bGwgfHwgcmVzdWx0Ll9fY2RhdGEgIT0gbnVsbCkpIHsKICAgICAgICAgIHJlc3VsdC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX190ZXh0ICE9IG51bGwgPyB0aGlzLl9fdGV4dCA6ICcnKSArICh0aGlzLl9fY2RhdGEgIT0gbnVsbCA/IHRoaXMuX19jZGF0YSA6ICcnKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PSBET01Ob2RlVHlwZXMuVEVYVF9OT0RFIHx8IG5vZGUubm9kZVR5cGUgPT0gRE9NTm9kZVR5cGVzLkNEQVRBX1NFQ1RJT05fTk9ERSkgewogICAgICAgIHJldHVybiBub2RlLm5vZGVWYWx1ZTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc3RhcnRUYWcoanNvbk9iaiwgZWxlbWVudCwgYXR0ckxpc3QsIGNsb3NlZCkgewogICAgICB2YXIgcmVzdWx0U3RyID0gIjwiICsgKChqc29uT2JqICE9IG51bGwgJiYganNvbk9iai5fX3ByZWZpeCAhPSBudWxsKSA/IChqc29uT2JqLl9fcHJlZml4ICsgIjoiKSA6ICIiKSArIGVsZW1lbnQ7CiAgICAgIGlmIChhdHRyTGlzdCAhPSBudWxsKSB7CiAgICAgICAgZm9yICh2YXIgYWlkeCA9IDA7IGFpZHggPCBhdHRyTGlzdC5sZW5ndGg7IGFpZHgrKykgewogICAgICAgICAgdmFyIGF0dHJOYW1lID0gYXR0ckxpc3RbYWlkeF07CiAgICAgICAgICB2YXIgYXR0clZhbCA9IGpzb25PYmpbYXR0ck5hbWVdOwogICAgICAgICAgaWYgKGNvbmZpZy5lc2NhcGVNb2RlKQogICAgICAgICAgICBhdHRyVmFsID0gZXNjYXBlWG1sQ2hhcnMoYXR0clZhbCk7CiAgICAgICAgICByZXN1bHRTdHIgKz0gIiAiICsgYXR0ck5hbWUuc3Vic3RyKGNvbmZpZy5hdHRyaWJ1dGVQcmVmaXgubGVuZ3RoKSArICI9JyIgKyBhdHRyVmFsICsgIiciOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWNsb3NlZCkKICAgICAgICByZXN1bHRTdHIgKz0gIj4iOwogICAgICBlbHNlCiAgICAgICAgcmVzdWx0U3RyICs9ICIvPiI7CiAgICAgIHJldHVybiByZXN1bHRTdHI7CiAgICB9CiAgICBmdW5jdGlvbiBlbmRUYWcoanNvbk9iaiwgZWxlbWVudE5hbWUpIHsKICAgICAgcmV0dXJuICI8LyIgKyAoanNvbk9iai5fX3ByZWZpeCAhPSBudWxsID8gKGpzb25PYmouX19wcmVmaXggKyAiOiIpIDogIiIpICsgZWxlbWVudE5hbWUgKyAiPiI7CiAgICB9CiAgICBmdW5jdGlvbiBlbmRzV2l0aChzdHIsIHN1ZmZpeCkgewogICAgICByZXR1cm4gc3RyLmluZGV4T2Yoc3VmZml4LCBzdHIubGVuZ3RoIC0gc3VmZml4Lmxlbmd0aCkgIT09IC0xOwogICAgfQogICAgZnVuY3Rpb24ganNvblhtbFNwZWNpYWxFbGVtKGpzb25PYmosIGpzb25PYmpGaWVsZCkgewogICAgICBpZiAoKGNvbmZpZy5hcnJheUFjY2Vzc0Zvcm0gPT0gInByb3BlcnR5IiAmJiBlbmRzV2l0aChqc29uT2JqRmllbGQudG9TdHJpbmcoKSwgKCJfYXNBcnJheSIpKSkgfHwganNvbk9iakZpZWxkLnRvU3RyaW5nKCkuaW5kZXhPZihjb25maWcuYXR0cmlidXRlUHJlZml4KSA9PSAwIHx8IGpzb25PYmpGaWVsZC50b1N0cmluZygpLmluZGV4T2YoIl9fIikgPT0gMCB8fCAoanNvbk9ialtqc29uT2JqRmllbGRdIGluc3RhbmNlb2YgRnVuY3Rpb24pKQogICAgICAgIHJldHVybiB0cnVlOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgZnVuY3Rpb24ganNvblhtbEVsZW1Db3VudChqc29uT2JqKSB7CiAgICAgIHZhciBlbGVtZW50c0NudCA9IDA7CiAgICAgIGlmIChqc29uT2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgZm9yICh2YXIgaXQgaW4ganNvbk9iaikgewogICAgICAgICAgaWYgKGpzb25YbWxTcGVjaWFsRWxlbShqc29uT2JqLCBpdCkpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgZWxlbWVudHNDbnQrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGVsZW1lbnRzQ250OwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VKU09OQXR0cmlidXRlcyhqc29uT2JqKSB7CiAgICAgIHZhciBhdHRyTGlzdCA9IFtdOwogICAgICBpZiAoanNvbk9iaiBpbnN0YW5jZW9mIE9iamVjdCkgewogICAgICAgIGZvciAodmFyIGFpdCBpbiBqc29uT2JqKSB7CiAgICAgICAgICBpZiAoYWl0LnRvU3RyaW5nKCkuaW5kZXhPZigiX18iKSA9PSAtMSAmJiBhaXQudG9TdHJpbmcoKS5pbmRleE9mKGNvbmZpZy5hdHRyaWJ1dGVQcmVmaXgpID09IDApIHsKICAgICAgICAgICAgYXR0ckxpc3QucHVzaChhaXQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYXR0ckxpc3Q7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUpTT05UZXh0QXR0cnMoanNvblR4dE9iaikgewogICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgIGlmIChqc29uVHh0T2JqLl9fY2RhdGEgIT0gbnVsbCkgewogICAgICAgIHJlc3VsdCArPSAiPCFbQ0RBVEFbIiArIGpzb25UeHRPYmouX19jZGF0YSArICJdXT4iOwogICAgICB9CiAgICAgIGlmIChqc29uVHh0T2JqLl9fdGV4dCAhPSBudWxsKSB7CiAgICAgICAgaWYgKGNvbmZpZy5lc2NhcGVNb2RlKQogICAgICAgICAgcmVzdWx0ICs9IGVzY2FwZVhtbENoYXJzKGpzb25UeHRPYmouX190ZXh0KTsKICAgICAgICBlbHNlCiAgICAgICAgICByZXN1bHQgKz0ganNvblR4dE9iai5fX3RleHQ7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlSlNPTlRleHRPYmplY3QoanNvblR4dE9iaikgewogICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgIGlmIChqc29uVHh0T2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgcmVzdWx0ICs9IHBhcnNlSlNPTlRleHRBdHRycyhqc29uVHh0T2JqKTsKICAgICAgfSBlbHNlIGlmIChqc29uVHh0T2JqICE9IG51bGwpIHsKICAgICAgICBpZiAoY29uZmlnLmVzY2FwZU1vZGUpCiAgICAgICAgICByZXN1bHQgKz0gZXNjYXBlWG1sQ2hhcnMoanNvblR4dE9iaik7CiAgICAgICAgZWxzZQogICAgICAgICAgcmVzdWx0ICs9IGpzb25UeHRPYmo7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlSlNPTkFycmF5KGpzb25BcnJSb290LCBqc29uQXJyT2JqLCBhdHRyTGlzdCkgewogICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgIGlmIChqc29uQXJyUm9vdC5sZW5ndGggPT0gMCkgewogICAgICAgIHJlc3VsdCArPSBzdGFydFRhZyhqc29uQXJyUm9vdCwganNvbkFyck9iaiwgYXR0ckxpc3QsIHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodmFyIGFySWR4ID0gMDsgYXJJZHggPCBqc29uQXJyUm9vdC5sZW5ndGg7IGFySWR4KyspIHsKICAgICAgICAgIHJlc3VsdCArPSBzdGFydFRhZyhqc29uQXJyUm9vdFthcklkeF0sIGpzb25BcnJPYmosIHBhcnNlSlNPTkF0dHJpYnV0ZXMoanNvbkFyclJvb3RbYXJJZHhdKSwgZmFsc2UpOwogICAgICAgICAgcmVzdWx0ICs9IHBhcnNlSlNPTk9iamVjdChqc29uQXJyUm9vdFthcklkeF0pOwogICAgICAgICAgcmVzdWx0ICs9IGVuZFRhZyhqc29uQXJyUm9vdFthcklkeF0sIGpzb25BcnJPYmopOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VKU09OT2JqZWN0KGpzb25PYmopIHsKICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICB2YXIgZWxlbWVudHNDbnQgPSBqc29uWG1sRWxlbUNvdW50KGpzb25PYmopOwogICAgICBpZiAoZWxlbWVudHNDbnQgPiAwKSB7CiAgICAgICAgZm9yICh2YXIgaXQgaW4ganNvbk9iaikgewogICAgICAgICAgaWYgKGpzb25YbWxTcGVjaWFsRWxlbShqc29uT2JqLCBpdCkpCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgdmFyIHN1Yk9iaiA9IGpzb25PYmpbaXRdOwogICAgICAgICAgdmFyIGF0dHJMaXN0ID0gcGFyc2VKU09OQXR0cmlidXRlcyhzdWJPYmopOwogICAgICAgICAgaWYgKHN1Yk9iaiA9PSBudWxsIHx8IHN1Yk9iaiA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmVzdWx0ICs9IHN0YXJ0VGFnKHN1Yk9iaiwgaXQsIGF0dHJMaXN0LCB0cnVlKTsKICAgICAgICAgIH0gZWxzZSBpZiAoc3ViT2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgICAgIGlmIChzdWJPYmogaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICAgIHJlc3VsdCArPSBwYXJzZUpTT05BcnJheShzdWJPYmosIGl0LCBhdHRyTGlzdCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3ViT2JqIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgICAgIHJlc3VsdCArPSBzdGFydFRhZyhzdWJPYmosIGl0LCBhdHRyTGlzdCwgZmFsc2UpOwogICAgICAgICAgICAgIHJlc3VsdCArPSBzdWJPYmoudG9JU09TdHJpbmcoKTsKICAgICAgICAgICAgICByZXN1bHQgKz0gZW5kVGFnKHN1Yk9iaiwgaXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBzdWJPYmpFbGVtZW50c0NudCA9IGpzb25YbWxFbGVtQ291bnQoc3ViT2JqKTsKICAgICAgICAgICAgICBpZiAoc3ViT2JqRWxlbWVudHNDbnQgPiAwIHx8IHN1Yk9iai5fX3RleHQgIT0gbnVsbCB8fCBzdWJPYmouX19jZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgKz0gc3RhcnRUYWcoc3ViT2JqLCBpdCwgYXR0ckxpc3QsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSBwYXJzZUpTT05PYmplY3Qoc3ViT2JqKTsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlbmRUYWcoc3ViT2JqLCBpdCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSBzdGFydFRhZyhzdWJPYmosIGl0LCBhdHRyTGlzdCwgdHJ1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgKz0gc3RhcnRUYWcoc3ViT2JqLCBpdCwgYXR0ckxpc3QsIGZhbHNlKTsKICAgICAgICAgICAgcmVzdWx0ICs9IHBhcnNlSlNPTlRleHRPYmplY3Qoc3ViT2JqKTsKICAgICAgICAgICAgcmVzdWx0ICs9IGVuZFRhZyhzdWJPYmosIGl0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmVzdWx0ICs9IHBhcnNlSlNPTlRleHRPYmplY3QoanNvbk9iaik7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICB0aGlzLnBhcnNlWG1sU3RyaW5nID0gZnVuY3Rpb24oeG1sRG9jU3RyKSB7CiAgICAgIHZhciBpc0lFUGFyc2VyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgfHwgIkFjdGl2ZVhPYmplY3QiIGluIHdpbmRvdzsKICAgICAgaWYgKHhtbERvY1N0ciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdmFyIHhtbERvYzsKICAgICAgaWYgKHdpbmRvdy5ET01QYXJzZXIpIHsKICAgICAgICB2YXIgcGFyc2VyID0gbmV3IHdpbmRvdy5ET01QYXJzZXIoKTsKICAgICAgICB2YXIgcGFyc2VyZXJyb3JOUyA9IG51bGw7CiAgICAgICAgaWYgKCFpc0lFUGFyc2VyKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBwYXJzZXJlcnJvck5TID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZygiSU5WQUxJRCIsICJ0ZXh0L3htbCIpLmNoaWxkTm9kZXNbMF0ubmFtZXNwYWNlVVJJOwogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHBhcnNlcmVycm9yTlMgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgeG1sRG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh4bWxEb2NTdHIsICJ0ZXh0L3htbCIpOwogICAgICAgICAgaWYgKHBhcnNlcmVycm9yTlMgIT0gbnVsbCAmJiB4bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWVOUyhwYXJzZXJlcnJvck5TLCAicGFyc2VyZXJyb3IiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhtbERvYyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICB4bWxEb2MgPSBudWxsOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoeG1sRG9jU3RyLmluZGV4T2YoIjw/IikgPT0gMCkgewogICAgICAgICAgeG1sRG9jU3RyID0geG1sRG9jU3RyLnN1YnN0cih4bWxEb2NTdHIuaW5kZXhPZigiPz4iKSArIDIpOwogICAgICAgIH0KICAgICAgICB4bWxEb2MgPSBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTERPTSIpOwogICAgICAgIHhtbERvYy5hc3luYyA9ICJmYWxzZSI7CiAgICAgICAgeG1sRG9jLmxvYWRYTUwoeG1sRG9jU3RyKTsKICAgICAgfQogICAgICByZXR1cm4geG1sRG9jOwogICAgfTsKICAgIHRoaXMuYXNBcnJheSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgaWYgKHByb3AgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICByZXR1cm4gcHJvcDsKICAgICAgZWxzZQogICAgICAgIHJldHVybiBbcHJvcF07CiAgICB9OwogICAgdGhpcy50b1htbERhdGVUaW1lID0gZnVuY3Rpb24oZHQpIHsKICAgICAgaWYgKGR0IGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICByZXR1cm4gZHQudG9JU09TdHJpbmcoKTsKICAgICAgZWxzZSBpZiAodHlwZW9mKGR0KSA9PT0gJ251bWJlcicpCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGR0KS50b0lTT1N0cmluZygpOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogICAgdGhpcy5hc0RhdGVUaW1lID0gZnVuY3Rpb24ocHJvcCkgewogICAgICBpZiAodHlwZW9mKHByb3ApID09ICJzdHJpbmciKSB7CiAgICAgICAgcmV0dXJuIGZyb21YbWxEYXRlVGltZShwcm9wKTsKICAgICAgfSBlbHNlCiAgICAgICAgcmV0dXJuIHByb3A7CiAgICB9OwogICAgdGhpcy54bWwyanNvbiA9IGZ1bmN0aW9uKHhtbERvYykgewogICAgICByZXR1cm4gcGFyc2VET01DaGlsZHJlbih4bWxEb2MpOwogICAgfTsKICAgIHRoaXMueG1sX3N0cjJqc29uID0gZnVuY3Rpb24oeG1sRG9jU3RyKSB7CiAgICAgIHZhciB4bWxEb2MgPSB0aGlzLnBhcnNlWG1sU3RyaW5nKHhtbERvY1N0cik7CiAgICAgIGlmICh4bWxEb2MgIT0gbnVsbCkKICAgICAgICByZXR1cm4gdGhpcy54bWwyanNvbih4bWxEb2MpOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogICAgdGhpcy5qc29uMnhtbF9zdHIgPSBmdW5jdGlvbihqc29uT2JqKSB7CiAgICAgIHJldHVybiBwYXJzZUpTT05PYmplY3QoanNvbk9iaik7CiAgICB9OwogICAgdGhpcy5qc29uMnhtbCA9IGZ1bmN0aW9uKGpzb25PYmopIHsKICAgICAgdmFyIHhtbERvY1N0ciA9IHRoaXMuanNvbjJ4bWxfc3RyKGpzb25PYmopOwogICAgICByZXR1cm4gdGhpcy5wYXJzZVhtbFN0cmluZyh4bWxEb2NTdHIpOwogICAgfTsKICAgIHRoaXMuZ2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVkVSU0lPTjsKICAgIH07CiAgfTsKfSk7Cn0pKCk7ClN5c3RlbS5yZWdpc3RlcigibnBtOmV2ZW50c0AxLjAuMi9ldmVudHMiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHsKICAgIHRoaXMuX2V2ZW50cyA9IHRoaXMuX2V2ZW50cyB8fCB7fTsKICAgIHRoaXMuX21heExpc3RlbmVycyA9IHRoaXMuX21heExpc3RlbmVycyB8fCB1bmRlZmluZWQ7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyOwogIEV2ZW50RW1pdHRlci5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7CiAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzID0gdW5kZWZpbmVkOwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHVuZGVmaW5lZDsKICBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVycyA9IDEwOwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzID0gZnVuY3Rpb24obikgewogICAgaWYgKCFpc051bWJlcihuKSB8fCBuIDwgMCB8fCBpc05hTihuKSkKICAgICAgdGhyb3cgVHlwZUVycm9yKCduIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTsKICAgIHRoaXMuX21heExpc3RlbmVycyA9IG47CiAgICByZXR1cm4gdGhpczsKICB9OwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uKHR5cGUpIHsKICAgIHZhciBlciwKICAgICAgICBoYW5kbGVyLAogICAgICAgIGxlbiwKICAgICAgICBhcmdzLAogICAgICAgIGksCiAgICAgICAgbGlzdGVuZXJzOwogICAgaWYgKCF0aGlzLl9ldmVudHMpCiAgICAgIHRoaXMuX2V2ZW50cyA9IHt9OwogICAgaWYgKHR5cGUgPT09ICdlcnJvcicpIHsKICAgICAgaWYgKCF0aGlzLl9ldmVudHMuZXJyb3IgfHwgKGlzT2JqZWN0KHRoaXMuX2V2ZW50cy5lcnJvcikgJiYgIXRoaXMuX2V2ZW50cy5lcnJvci5sZW5ndGgpKSB7CiAgICAgICAgZXIgPSBhcmd1bWVudHNbMV07CiAgICAgICAgaWYgKGVyIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICAgIHRocm93IGVyOwogICAgICAgIH0KICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ1VuY2F1Z2h0LCB1bnNwZWNpZmllZCAiZXJyb3IiIGV2ZW50LicpOwogICAgICB9CiAgICB9CiAgICBoYW5kbGVyID0gdGhpcy5fZXZlbnRzW3R5cGVdOwogICAgaWYgKGlzVW5kZWZpbmVkKGhhbmRsZXIpKQogICAgICByZXR1cm4gZmFsc2U7CiAgICBpZiAoaXNGdW5jdGlvbihoYW5kbGVyKSkgewogICAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBoYW5kbGVyLmNhbGwodGhpcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBoYW5kbGVyLmNhbGwodGhpcywgYXJndW1lbnRzWzFdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIGhhbmRsZXIuY2FsbCh0aGlzLCBhcmd1bWVudHNbMV0sIGFyZ3VtZW50c1syXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgICAgIGFyZ3MgPSBuZXcgQXJyYXkobGVuIC0gMSk7CiAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgIGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldOwogICAgICAgICAgaGFuZGxlci5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc09iamVjdChoYW5kbGVyKSkgewogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICBhcmdzID0gbmV3IEFycmF5KGxlbiAtIDEpOwogICAgICBmb3IgKGkgPSAxOyBpIDwgbGVuOyBpKyspCiAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07CiAgICAgIGxpc3RlbmVycyA9IGhhbmRsZXIuc2xpY2UoKTsKICAgICAgbGVuID0gbGlzdGVuZXJzLmxlbmd0aDsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKQogICAgICAgIGxpc3RlbmVyc1tpXS5hcHBseSh0aGlzLCBhcmdzKTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH07CiAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICB2YXIgbTsKICAgIGlmICghaXNGdW5jdGlvbihsaXN0ZW5lcikpCiAgICAgIHRocm93IFR5cGVFcnJvcignbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7CiAgICBpZiAoIXRoaXMuX2V2ZW50cykKICAgICAgdGhpcy5fZXZlbnRzID0ge307CiAgICBpZiAodGhpcy5fZXZlbnRzLm5ld0xpc3RlbmVyKQogICAgICB0aGlzLmVtaXQoJ25ld0xpc3RlbmVyJywgdHlwZSwgaXNGdW5jdGlvbihsaXN0ZW5lci5saXN0ZW5lcikgPyBsaXN0ZW5lci5saXN0ZW5lciA6IGxpc3RlbmVyKTsKICAgIGlmICghdGhpcy5fZXZlbnRzW3R5cGVdKQogICAgICB0aGlzLl9ldmVudHNbdHlwZV0gPSBsaXN0ZW5lcjsKICAgIGVsc2UgaWYgKGlzT2JqZWN0KHRoaXMuX2V2ZW50c1t0eXBlXSkpCiAgICAgIHRoaXMuX2V2ZW50c1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgIGVsc2UKICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdID0gW3RoaXMuX2V2ZW50c1t0eXBlXSwgbGlzdGVuZXJdOwogICAgaWYgKGlzT2JqZWN0KHRoaXMuX2V2ZW50c1t0eXBlXSkgJiYgIXRoaXMuX2V2ZW50c1t0eXBlXS53YXJuZWQpIHsKICAgICAgdmFyIG07CiAgICAgIGlmICghaXNVbmRlZmluZWQodGhpcy5fbWF4TGlzdGVuZXJzKSkgewogICAgICAgIG0gPSB0aGlzLl9tYXhMaXN0ZW5lcnM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbSA9IEV2ZW50RW1pdHRlci5kZWZhdWx0TWF4TGlzdGVuZXJzOwogICAgICB9CiAgICAgIGlmIChtICYmIG0gPiAwICYmIHRoaXMuX2V2ZW50c1t0eXBlXS5sZW5ndGggPiBtKSB7CiAgICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdLndhcm5lZCA9IHRydWU7CiAgICAgICAgY29uc29sZS5lcnJvcignKG5vZGUpIHdhcm5pbmc6IHBvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgJyArICdsZWFrIGRldGVjdGVkLiAlZCBsaXN0ZW5lcnMgYWRkZWQuICcgKyAnVXNlIGVtaXR0ZXIuc2V0TWF4TGlzdGVuZXJzKCkgdG8gaW5jcmVhc2UgbGltaXQuJywgdGhpcy5fZXZlbnRzW3R5cGVdLmxlbmd0aCk7CiAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlLnRyYWNlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBjb25zb2xlLnRyYWNlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyOwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICBpZiAoIWlzRnVuY3Rpb24obGlzdGVuZXIpKQogICAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpOwogICAgdmFyIGZpcmVkID0gZmFsc2U7CiAgICBmdW5jdGlvbiBnKCkgewogICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGcpOwogICAgICBpZiAoIWZpcmVkKSB7CiAgICAgICAgZmlyZWQgPSB0cnVlOwogICAgICAgIGxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KICAgIGcubGlzdGVuZXIgPSBsaXN0ZW5lcjsKICAgIHRoaXMub24odHlwZSwgZyk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikgewogICAgdmFyIGxpc3QsCiAgICAgICAgcG9zaXRpb24sCiAgICAgICAgbGVuZ3RoLAogICAgICAgIGk7CiAgICBpZiAoIWlzRnVuY3Rpb24obGlzdGVuZXIpKQogICAgICB0aHJvdyBUeXBlRXJyb3IoJ2xpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpOwogICAgaWYgKCF0aGlzLl9ldmVudHMgfHwgIXRoaXMuX2V2ZW50c1t0eXBlXSkKICAgICAgcmV0dXJuIHRoaXM7CiAgICBsaXN0ID0gdGhpcy5fZXZlbnRzW3R5cGVdOwogICAgbGVuZ3RoID0gbGlzdC5sZW5ndGg7CiAgICBwb3NpdGlvbiA9IC0xOwogICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IChpc0Z1bmN0aW9uKGxpc3QubGlzdGVuZXIpICYmIGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSkgewogICAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdOwogICAgICBpZiAodGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKQogICAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0ZW5lcik7CiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KGxpc3QpKSB7CiAgICAgIGZvciAoaSA9IGxlbmd0aDsgaS0tID4gMDsgKSB7CiAgICAgICAgaWYgKGxpc3RbaV0gPT09IGxpc3RlbmVyIHx8IChsaXN0W2ldLmxpc3RlbmVyICYmIGxpc3RbaV0ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSkgewogICAgICAgICAgcG9zaXRpb24gPSBpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwb3NpdGlvbiA8IDApCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMSkgewogICAgICAgIGxpc3QubGVuZ3RoID0gMDsKICAgICAgICBkZWxldGUgdGhpcy5fZXZlbnRzW3R5cGVdOwogICAgICB9IGVsc2UgewogICAgICAgIGxpc3Quc3BsaWNlKHBvc2l0aW9uLCAxKTsKICAgICAgfQogICAgICBpZiAodGhpcy5fZXZlbnRzLnJlbW92ZUxpc3RlbmVyKQogICAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0ZW5lcik7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24odHlwZSkgewogICAgdmFyIGtleSwKICAgICAgICBsaXN0ZW5lcnM7CiAgICBpZiAoIXRoaXMuX2V2ZW50cykKICAgICAgcmV0dXJuIHRoaXM7CiAgICBpZiAoIXRoaXMuX2V2ZW50cy5yZW1vdmVMaXN0ZW5lcikgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkKICAgICAgICB0aGlzLl9ldmVudHMgPSB7fTsKICAgICAgZWxzZSBpZiAodGhpcy5fZXZlbnRzW3R5cGVdKQogICAgICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgZm9yIChrZXkgaW4gdGhpcy5fZXZlbnRzKSB7CiAgICAgICAgaWYgKGtleSA9PT0gJ3JlbW92ZUxpc3RlbmVyJykKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSk7CiAgICAgIH0KICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3JlbW92ZUxpc3RlbmVyJyk7CiAgICAgIHRoaXMuX2V2ZW50cyA9IHt9OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50c1t0eXBlXTsKICAgIGlmIChpc0Z1bmN0aW9uKGxpc3RlbmVycykpIHsKICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnMpOwogICAgfSBlbHNlIHsKICAgICAgd2hpbGUgKGxpc3RlbmVycy5sZW5ndGgpCiAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcnNbbGlzdGVuZXJzLmxlbmd0aCAtIDFdKTsKICAgIH0KICAgIGRlbGV0ZSB0aGlzLl9ldmVudHNbdHlwZV07CiAgICByZXR1cm4gdGhpczsKICB9OwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24odHlwZSkgewogICAgdmFyIHJldDsKICAgIGlmICghdGhpcy5fZXZlbnRzIHx8ICF0aGlzLl9ldmVudHNbdHlwZV0pCiAgICAgIHJldCA9IFtdOwogICAgZWxzZSBpZiAoaXNGdW5jdGlvbih0aGlzLl9ldmVudHNbdHlwZV0pKQogICAgICByZXQgPSBbdGhpcy5fZXZlbnRzW3R5cGVdXTsKICAgIGVsc2UKICAgICAgcmV0ID0gdGhpcy5fZXZlbnRzW3R5cGVdLnNsaWNlKCk7CiAgICByZXR1cm4gcmV0OwogIH07CiAgRXZlbnRFbWl0dGVyLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7CiAgICB2YXIgcmV0OwogICAgaWYgKCFlbWl0dGVyLl9ldmVudHMgfHwgIWVtaXR0ZXIuX2V2ZW50c1t0eXBlXSkKICAgICAgcmV0ID0gMDsKICAgIGVsc2UgaWYgKGlzRnVuY3Rpb24oZW1pdHRlci5fZXZlbnRzW3R5cGVdKSkKICAgICAgcmV0ID0gMTsKICAgIGVsc2UKICAgICAgcmV0ID0gZW1pdHRlci5fZXZlbnRzW3R5cGVdLmxlbmd0aDsKICAgIHJldHVybiByZXQ7CiAgfTsKICBmdW5jdGlvbiBpc0Z1bmN0aW9uKGFyZykgewogICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdmdW5jdGlvbic7CiAgfQogIGZ1bmN0aW9uIGlzTnVtYmVyKGFyZykgewogICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdudW1iZXInOwogIH0KICBmdW5jdGlvbiBpc09iamVjdChhcmcpIHsKICAgIHJldHVybiB0eXBlb2YgYXJnID09PSAnb2JqZWN0JyAmJiBhcmcgIT09IG51bGw7CiAgfQogIGZ1bmN0aW9uIGlzVW5kZWZpbmVkKGFyZykgewogICAgcmV0dXJuIGFyZyA9PT0gdm9pZCAwOwogIH0KICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmluaGVyaXRzQDIuMC4xL2luaGVyaXRzX2Jyb3dzZXIiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGlmICh0eXBlb2YgT2JqZWN0LmNyZWF0ZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsKICAgICAgY3Rvci5zdXBlcl8gPSBzdXBlckN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7Y29uc3RydWN0b3I6IHsKICAgICAgICAgIHZhbHVlOiBjdG9yLAogICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH19KTsKICAgIH07CiAgfSBlbHNlIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaW5oZXJpdHMoY3Rvciwgc3VwZXJDdG9yKSB7CiAgICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yOwogICAgICB2YXIgVGVtcEN0b3IgPSBmdW5jdGlvbigpIHt9OwogICAgICBUZW1wQ3Rvci5wcm90b3R5cGUgPSBzdXBlckN0b3IucHJvdG90eXBlOwogICAgICBjdG9yLnByb3RvdHlwZSA9IG5ldyBUZW1wQ3RvcigpOwogICAgICBjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGN0b3I7CiAgICB9OwogIH0KICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmlzYXJyYXlAMC4wLjEvaW5kZXgiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbihhcnIpIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PSAnW29iamVjdCBBcnJheV0nOwogIH07CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpiYXNlNjQtanNAMC4wLjgvbGliL2I2NCIsIFtdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGxvb2t1cCA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvJzsKICA7CiAgKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIHZhciBBcnIgPSAodHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnKSA/IFVpbnQ4QXJyYXkgOiBBcnJheTsKICAgIHZhciBQTFVTID0gJysnLmNoYXJDb2RlQXQoMCk7CiAgICB2YXIgU0xBU0ggPSAnLycuY2hhckNvZGVBdCgwKTsKICAgIHZhciBOVU1CRVIgPSAnMCcuY2hhckNvZGVBdCgwKTsKICAgIHZhciBMT1dFUiA9ICdhJy5jaGFyQ29kZUF0KDApOwogICAgdmFyIFVQUEVSID0gJ0EnLmNoYXJDb2RlQXQoMCk7CiAgICB2YXIgUExVU19VUkxfU0FGRSA9ICctJy5jaGFyQ29kZUF0KDApOwogICAgdmFyIFNMQVNIX1VSTF9TQUZFID0gJ18nLmNoYXJDb2RlQXQoMCk7CiAgICBmdW5jdGlvbiBkZWNvZGUoZWx0KSB7CiAgICAgIHZhciBjb2RlID0gZWx0LmNoYXJDb2RlQXQoMCk7CiAgICAgIGlmIChjb2RlID09PSBQTFVTIHx8IGNvZGUgPT09IFBMVVNfVVJMX1NBRkUpCiAgICAgICAgcmV0dXJuIDYyOwogICAgICBpZiAoY29kZSA9PT0gU0xBU0ggfHwgY29kZSA9PT0gU0xBU0hfVVJMX1NBRkUpCiAgICAgICAgcmV0dXJuIDYzOwogICAgICBpZiAoY29kZSA8IE5VTUJFUikKICAgICAgICByZXR1cm4gLTE7CiAgICAgIGlmIChjb2RlIDwgTlVNQkVSICsgMTApCiAgICAgICAgcmV0dXJuIGNvZGUgLSBOVU1CRVIgKyAyNiArIDI2OwogICAgICBpZiAoY29kZSA8IFVQUEVSICsgMjYpCiAgICAgICAgcmV0dXJuIGNvZGUgLSBVUFBFUjsKICAgICAgaWYgKGNvZGUgPCBMT1dFUiArIDI2KQogICAgICAgIHJldHVybiBjb2RlIC0gTE9XRVIgKyAyNjsKICAgIH0KICAgIGZ1bmN0aW9uIGI2NFRvQnl0ZUFycmF5KGI2NCkgewogICAgICB2YXIgaSwKICAgICAgICAgIGosCiAgICAgICAgICBsLAogICAgICAgICAgdG1wLAogICAgICAgICAgcGxhY2VIb2xkZXJzLAogICAgICAgICAgYXJyOwogICAgICBpZiAoYjY0Lmxlbmd0aCAlIDQgPiAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0Jyk7CiAgICAgIH0KICAgICAgdmFyIGxlbiA9IGI2NC5sZW5ndGg7CiAgICAgIHBsYWNlSG9sZGVycyA9ICc9JyA9PT0gYjY0LmNoYXJBdChsZW4gLSAyKSA/IDIgOiAnPScgPT09IGI2NC5jaGFyQXQobGVuIC0gMSkgPyAxIDogMDsKICAgICAgYXJyID0gbmV3IEFycihiNjQubGVuZ3RoICogMyAvIDQgLSBwbGFjZUhvbGRlcnMpOwogICAgICBsID0gcGxhY2VIb2xkZXJzID4gMCA/IGI2NC5sZW5ndGggLSA0IDogYjY0Lmxlbmd0aDsKICAgICAgdmFyIEwgPSAwOwogICAgICBmdW5jdGlvbiBwdXNoKHYpIHsKICAgICAgICBhcnJbTCsrXSA9IHY7CiAgICAgIH0KICAgICAgZm9yIChpID0gMCwgaiA9IDA7IGkgPCBsOyBpICs9IDQsIGogKz0gMykgewogICAgICAgIHRtcCA9IChkZWNvZGUoYjY0LmNoYXJBdChpKSkgPDwgMTgpIHwgKGRlY29kZShiNjQuY2hhckF0KGkgKyAxKSkgPDwgMTIpIHwgKGRlY29kZShiNjQuY2hhckF0KGkgKyAyKSkgPDwgNikgfCBkZWNvZGUoYjY0LmNoYXJBdChpICsgMykpOwogICAgICAgIHB1c2goKHRtcCAmIDB4RkYwMDAwKSA+PiAxNik7CiAgICAgICAgcHVzaCgodG1wICYgMHhGRjAwKSA+PiA4KTsKICAgICAgICBwdXNoKHRtcCAmIDB4RkYpOwogICAgICB9CiAgICAgIGlmIChwbGFjZUhvbGRlcnMgPT09IDIpIHsKICAgICAgICB0bXAgPSAoZGVjb2RlKGI2NC5jaGFyQXQoaSkpIDw8IDIpIHwgKGRlY29kZShiNjQuY2hhckF0KGkgKyAxKSkgPj4gNCk7CiAgICAgICAgcHVzaCh0bXAgJiAweEZGKTsKICAgICAgfSBlbHNlIGlmIChwbGFjZUhvbGRlcnMgPT09IDEpIHsKICAgICAgICB0bXAgPSAoZGVjb2RlKGI2NC5jaGFyQXQoaSkpIDw8IDEwKSB8IChkZWNvZGUoYjY0LmNoYXJBdChpICsgMSkpIDw8IDQpIHwgKGRlY29kZShiNjQuY2hhckF0KGkgKyAyKSkgPj4gMik7CiAgICAgICAgcHVzaCgodG1wID4+IDgpICYgMHhGRik7CiAgICAgICAgcHVzaCh0bXAgJiAweEZGKTsKICAgICAgfQogICAgICByZXR1cm4gYXJyOwogICAgfQogICAgZnVuY3Rpb24gdWludDhUb0Jhc2U2NCh1aW50OCkgewogICAgICB2YXIgaSwKICAgICAgICAgIGV4dHJhQnl0ZXMgPSB1aW50OC5sZW5ndGggJSAzLAogICAgICAgICAgb3V0cHV0ID0gIiIsCiAgICAgICAgICB0ZW1wLAogICAgICAgICAgbGVuZ3RoOwogICAgICBmdW5jdGlvbiBlbmNvZGUobnVtKSB7CiAgICAgICAgcmV0dXJuIGxvb2t1cC5jaGFyQXQobnVtKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQobnVtKSB7CiAgICAgICAgcmV0dXJuIGVuY29kZShudW0gPj4gMTggJiAweDNGKSArIGVuY29kZShudW0gPj4gMTIgJiAweDNGKSArIGVuY29kZShudW0gPj4gNiAmIDB4M0YpICsgZW5jb2RlKG51bSAmIDB4M0YpOwogICAgICB9CiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IHVpbnQ4Lmxlbmd0aCAtIGV4dHJhQnl0ZXM7IGkgPCBsZW5ndGg7IGkgKz0gMykgewogICAgICAgIHRlbXAgPSAodWludDhbaV0gPDwgMTYpICsgKHVpbnQ4W2kgKyAxXSA8PCA4KSArICh1aW50OFtpICsgMl0pOwogICAgICAgIG91dHB1dCArPSB0cmlwbGV0VG9CYXNlNjQodGVtcCk7CiAgICAgIH0KICAgICAgc3dpdGNoIChleHRyYUJ5dGVzKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgdGVtcCA9IHVpbnQ4W3VpbnQ4Lmxlbmd0aCAtIDFdOwogICAgICAgICAgb3V0cHV0ICs9IGVuY29kZSh0ZW1wID4+IDIpOwogICAgICAgICAgb3V0cHV0ICs9IGVuY29kZSgodGVtcCA8PCA0KSAmIDB4M0YpOwogICAgICAgICAgb3V0cHV0ICs9ICc9PSc7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICB0ZW1wID0gKHVpbnQ4W3VpbnQ4Lmxlbmd0aCAtIDJdIDw8IDgpICsgKHVpbnQ4W3VpbnQ4Lmxlbmd0aCAtIDFdKTsKICAgICAgICAgIG91dHB1dCArPSBlbmNvZGUodGVtcCA+PiAxMCk7CiAgICAgICAgICBvdXRwdXQgKz0gZW5jb2RlKCh0ZW1wID4+IDQpICYgMHgzRik7CiAgICAgICAgICBvdXRwdXQgKz0gZW5jb2RlKCh0ZW1wIDw8IDIpICYgMHgzRik7CiAgICAgICAgICBvdXRwdXQgKz0gJz0nOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcmV0dXJuIG91dHB1dDsKICAgIH0KICAgIGV4cG9ydHMudG9CeXRlQXJyYXkgPSBiNjRUb0J5dGVBcnJheTsKICAgIGV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IHVpbnQ4VG9CYXNlNjQ7CiAgfSh0eXBlb2YgZXhwb3J0cyA9PT0gJ3VuZGVmaW5lZCcgPyAodGhpcy5iYXNlNjRqcyA9IHt9KSA6IGV4cG9ydHMpKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmllZWU3NTRAMS4xLjYvaW5kZXgiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGV4cG9ydHMucmVhZCA9IGZ1bmN0aW9uKGJ1ZmZlciwgb2Zmc2V0LCBpc0xFLCBtTGVuLCBuQnl0ZXMpIHsKICAgIHZhciBlLAogICAgICAgIG07CiAgICB2YXIgZUxlbiA9IG5CeXRlcyAqIDggLSBtTGVuIC0gMTsKICAgIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxOwogICAgdmFyIGVCaWFzID0gZU1heCA+PiAxOwogICAgdmFyIG5CaXRzID0gLTc7CiAgICB2YXIgaSA9IGlzTEUgPyAobkJ5dGVzIC0gMSkgOiAwOwogICAgdmFyIGQgPSBpc0xFID8gLTEgOiAxOwogICAgdmFyIHMgPSBidWZmZXJbb2Zmc2V0ICsgaV07CiAgICBpICs9IGQ7CiAgICBlID0gcyAmICgoMSA8PCAoLW5CaXRzKSkgLSAxKTsKICAgIHMgPj49ICgtbkJpdHMpOwogICAgbkJpdHMgKz0gZUxlbjsKICAgIGZvciAoOyBuQml0cyA+IDA7IGUgPSBlICogMjU2ICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9CiAgICBtID0gZSAmICgoMSA8PCAoLW5CaXRzKSkgLSAxKTsKICAgIGUgPj49ICgtbkJpdHMpOwogICAgbkJpdHMgKz0gbUxlbjsKICAgIGZvciAoOyBuQml0cyA+IDA7IG0gPSBtICogMjU2ICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9CiAgICBpZiAoZSA9PT0gMCkgewogICAgICBlID0gMSAtIGVCaWFzOwogICAgfSBlbHNlIGlmIChlID09PSBlTWF4KSB7CiAgICAgIHJldHVybiBtID8gTmFOIDogKChzID8gLTEgOiAxKSAqIEluZmluaXR5KTsKICAgIH0gZWxzZSB7CiAgICAgIG0gPSBtICsgTWF0aC5wb3coMiwgbUxlbik7CiAgICAgIGUgPSBlIC0gZUJpYXM7CiAgICB9CiAgICByZXR1cm4gKHMgPyAtMSA6IDEpICogbSAqIE1hdGgucG93KDIsIGUgLSBtTGVuKTsKICB9OwogIGV4cG9ydHMud3JpdGUgPSBmdW5jdGlvbihidWZmZXIsIHZhbHVlLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykgewogICAgdmFyIGUsCiAgICAgICAgbSwKICAgICAgICBjOwogICAgdmFyIGVMZW4gPSBuQnl0ZXMgKiA4IC0gbUxlbiAtIDE7CiAgICB2YXIgZU1heCA9ICgxIDw8IGVMZW4pIC0gMTsKICAgIHZhciBlQmlhcyA9IGVNYXggPj4gMTsKICAgIHZhciBydCA9IChtTGVuID09PSAyMyA/IE1hdGgucG93KDIsIC0yNCkgLSBNYXRoLnBvdygyLCAtNzcpIDogMCk7CiAgICB2YXIgaSA9IGlzTEUgPyAwIDogKG5CeXRlcyAtIDEpOwogICAgdmFyIGQgPSBpc0xFID8gMSA6IC0xOwogICAgdmFyIHMgPSB2YWx1ZSA8IDAgfHwgKHZhbHVlID09PSAwICYmIDEgLyB2YWx1ZSA8IDApID8gMSA6IDA7CiAgICB2YWx1ZSA9IE1hdGguYWJzKHZhbHVlKTsKICAgIGlmIChpc05hTih2YWx1ZSkgfHwgdmFsdWUgPT09IEluZmluaXR5KSB7CiAgICAgIG0gPSBpc05hTih2YWx1ZSkgPyAxIDogMDsKICAgICAgZSA9IGVNYXg7CiAgICB9IGVsc2UgewogICAgICBlID0gTWF0aC5mbG9vcihNYXRoLmxvZyh2YWx1ZSkgLyBNYXRoLkxOMik7CiAgICAgIGlmICh2YWx1ZSAqIChjID0gTWF0aC5wb3coMiwgLWUpKSA8IDEpIHsKICAgICAgICBlLS07CiAgICAgICAgYyAqPSAyOwogICAgICB9CiAgICAgIGlmIChlICsgZUJpYXMgPj0gMSkgewogICAgICAgIHZhbHVlICs9IHJ0IC8gYzsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWx1ZSArPSBydCAqIE1hdGgucG93KDIsIDEgLSBlQmlhcyk7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlICogYyA+PSAyKSB7CiAgICAgICAgZSsrOwogICAgICAgIGMgLz0gMjsKICAgICAgfQogICAgICBpZiAoZSArIGVCaWFzID49IGVNYXgpIHsKICAgICAgICBtID0gMDsKICAgICAgICBlID0gZU1heDsKICAgICAgfSBlbHNlIGlmIChlICsgZUJpYXMgPj0gMSkgewogICAgICAgIG0gPSAodmFsdWUgKiBjIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKTsKICAgICAgICBlID0gZSArIGVCaWFzOwogICAgICB9IGVsc2UgewogICAgICAgIG0gPSB2YWx1ZSAqIE1hdGgucG93KDIsIGVCaWFzIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKTsKICAgICAgICBlID0gMDsKICAgICAgfQogICAgfQogICAgZm9yICg7IG1MZW4gPj0gODsgYnVmZmVyW29mZnNldCArIGldID0gbSAmIDB4ZmYsIGkgKz0gZCwgbSAvPSAyNTYsIG1MZW4gLT0gOCkge30KICAgIGUgPSAoZSA8PCBtTGVuKSB8IG07CiAgICBlTGVuICs9IG1MZW47CiAgICBmb3IgKDsgZUxlbiA+IDA7IGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGUgJiAweGZmLCBpICs9IGQsIGUgLz0gMjU2LCBlTGVuIC09IDgpIHt9CiAgICBidWZmZXJbb2Zmc2V0ICsgaSAtIGRdIHw9IHMgKiAxMjg7CiAgfTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmlzLWFycmF5QDEuMC4xL2luZGV4IiwgW10sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CiAgdmFyIHN0ciA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CiAgbW9kdWxlLmV4cG9ydHMgPSBpc0FycmF5IHx8IGZ1bmN0aW9uKHZhbCkgewogICAgcmV0dXJuICEhdmFsICYmICdbb2JqZWN0IEFycmF5XScgPT0gc3RyLmNhbGwodmFsKTsKICB9OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06Y29yZS11dGlsLWlzQDEuMC4xL2xpYi91dGlsIiwgWyJnaXRodWI6anNwbS9ub2RlbGlicy1idWZmZXJAMC4xLjAiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihCdWZmZXIpIHsKICAgIGZ1bmN0aW9uIGlzQXJyYXkoYXIpIHsKICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYXIpOwogICAgfQogICAgZXhwb3J0cy5pc0FycmF5ID0gaXNBcnJheTsKICAgIGZ1bmN0aW9uIGlzQm9vbGVhbihhcmcpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdib29sZWFuJzsKICAgIH0KICAgIGV4cG9ydHMuaXNCb29sZWFuID0gaXNCb29sZWFuOwogICAgZnVuY3Rpb24gaXNOdWxsKGFyZykgewogICAgICByZXR1cm4gYXJnID09PSBudWxsOwogICAgfQogICAgZXhwb3J0cy5pc051bGwgPSBpc051bGw7CiAgICBmdW5jdGlvbiBpc051bGxPclVuZGVmaW5lZChhcmcpIHsKICAgICAgcmV0dXJuIGFyZyA9PSBudWxsOwogICAgfQogICAgZXhwb3J0cy5pc051bGxPclVuZGVmaW5lZCA9IGlzTnVsbE9yVW5kZWZpbmVkOwogICAgZnVuY3Rpb24gaXNOdW1iZXIoYXJnKSB7CiAgICAgIHJldHVybiB0eXBlb2YgYXJnID09PSAnbnVtYmVyJzsKICAgIH0KICAgIGV4cG9ydHMuaXNOdW1iZXIgPSBpc051bWJlcjsKICAgIGZ1bmN0aW9uIGlzU3RyaW5nKGFyZykgewogICAgICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ3N0cmluZyc7CiAgICB9CiAgICBleHBvcnRzLmlzU3RyaW5nID0gaXNTdHJpbmc7CiAgICBmdW5jdGlvbiBpc1N5bWJvbChhcmcpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdzeW1ib2wnOwogICAgfQogICAgZXhwb3J0cy5pc1N5bWJvbCA9IGlzU3ltYm9sOwogICAgZnVuY3Rpb24gaXNVbmRlZmluZWQoYXJnKSB7CiAgICAgIHJldHVybiBhcmcgPT09IHZvaWQgMDsKICAgIH0KICAgIGV4cG9ydHMuaXNVbmRlZmluZWQgPSBpc1VuZGVmaW5lZDsKICAgIGZ1bmN0aW9uIGlzUmVnRXhwKHJlKSB7CiAgICAgIHJldHVybiBpc09iamVjdChyZSkgJiYgb2JqZWN0VG9TdHJpbmcocmUpID09PSAnW29iamVjdCBSZWdFeHBdJzsKICAgIH0KICAgIGV4cG9ydHMuaXNSZWdFeHAgPSBpc1JlZ0V4cDsKICAgIGZ1bmN0aW9uIGlzT2JqZWN0KGFyZykgewogICAgICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ29iamVjdCcgJiYgYXJnICE9PSBudWxsOwogICAgfQogICAgZXhwb3J0cy5pc09iamVjdCA9IGlzT2JqZWN0OwogICAgZnVuY3Rpb24gaXNEYXRlKGQpIHsKICAgICAgcmV0dXJuIGlzT2JqZWN0KGQpICYmIG9iamVjdFRvU3RyaW5nKGQpID09PSAnW29iamVjdCBEYXRlXSc7CiAgICB9CiAgICBleHBvcnRzLmlzRGF0ZSA9IGlzRGF0ZTsKICAgIGZ1bmN0aW9uIGlzRXJyb3IoZSkgewogICAgICByZXR1cm4gaXNPYmplY3QoZSkgJiYgKG9iamVjdFRvU3RyaW5nKGUpID09PSAnW29iamVjdCBFcnJvcl0nIHx8IGUgaW5zdGFuY2VvZiBFcnJvcik7CiAgICB9CiAgICBleHBvcnRzLmlzRXJyb3IgPSBpc0Vycm9yOwogICAgZnVuY3Rpb24gaXNGdW5jdGlvbihhcmcpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICdmdW5jdGlvbic7CiAgICB9CiAgICBleHBvcnRzLmlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uOwogICAgZnVuY3Rpb24gaXNQcmltaXRpdmUoYXJnKSB7CiAgICAgIHJldHVybiBhcmcgPT09IG51bGwgfHwgdHlwZW9mIGFyZyA9PT0gJ2Jvb2xlYW4nIHx8IHR5cGVvZiBhcmcgPT09ICdudW1iZXInIHx8IHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBhcmcgPT09ICdzeW1ib2wnIHx8IHR5cGVvZiBhcmcgPT09ICd1bmRlZmluZWQnOwogICAgfQogICAgZXhwb3J0cy5pc1ByaW1pdGl2ZSA9IGlzUHJpbWl0aXZlOwogICAgZnVuY3Rpb24gaXNCdWZmZXIoYXJnKSB7CiAgICAgIHJldHVybiBCdWZmZXIuaXNCdWZmZXIoYXJnKTsKICAgIH0KICAgIGV4cG9ydHMuaXNCdWZmZXIgPSBpc0J1ZmZlcjsKICAgIGZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKG8pIHsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKTsKICAgIH0KICB9KShyZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1idWZmZXJAMC4xLjAiKS5CdWZmZXIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06cHJvY2Vzc0AwLjEwLjEvYnJvd3NlciIsIFtdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9OwogIHZhciBxdWV1ZSA9IFtdOwogIHZhciBkcmFpbmluZyA9IGZhbHNlOwogIGZ1bmN0aW9uIGRyYWluUXVldWUoKSB7CiAgICBpZiAoZHJhaW5pbmcpIHsKICAgICAgcmV0dXJuIDsKICAgIH0KICAgIGRyYWluaW5nID0gdHJ1ZTsKICAgIHZhciBjdXJyZW50UXVldWU7CiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoOwogICAgd2hpbGUgKGxlbikgewogICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTsKICAgICAgcXVldWUgPSBbXTsKICAgICAgdmFyIGkgPSAtMTsKICAgICAgd2hpbGUgKCsraSA8IGxlbikgewogICAgICAgIGN1cnJlbnRRdWV1ZVtpXSgpOwogICAgICB9CiAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDsKICAgIH0KICAgIGRyYWluaW5nID0gZmFsc2U7CiAgfQogIHByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbihmdW4pIHsKICAgIHF1ZXVlLnB1c2goZnVuKTsKICAgIGlmICghZHJhaW5pbmcpIHsKICAgICAgc2V0VGltZW91dChkcmFpblF1ZXVlLCAwKTsKICAgIH0KICB9OwogIHByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7CiAgcHJvY2Vzcy5icm93c2VyID0gdHJ1ZTsKICBwcm9jZXNzLmVudiA9IHt9OwogIHByb2Nlc3MuYXJndiA9IFtdOwogIHByb2Nlc3MudmVyc2lvbiA9ICcnOwogIHByb2Nlc3MudmVyc2lvbnMgPSB7fTsKICBmdW5jdGlvbiBub29wKCkge30KICBwcm9jZXNzLm9uID0gbm9vcDsKICBwcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDsKICBwcm9jZXNzLm9uY2UgPSBub29wOwogIHByb2Nlc3Mub2ZmID0gbm9vcDsKICBwcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDsKICBwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CiAgcHJvY2Vzcy5lbWl0ID0gbm9vcDsKICBwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbihuYW1lKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgfTsKICBwcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICcvJzsKICB9OwogIHByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbihkaXIpIHsKICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgfTsKICBwcm9jZXNzLnVtYXNrID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gMDsKICB9OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06c3RyaW5nX2RlY29kZXJAMC4xMC4zMS9pbmRleCIsIFsiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wIiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLWJ1ZmZlckAwLjEuMCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKEJ1ZmZlcikgewogICAgdmFyIEJ1ZmZlciA9IHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLWJ1ZmZlckAwLjEuMCIpLkJ1ZmZlcjsKICAgIHZhciBpc0J1ZmZlckVuY29kaW5nID0gQnVmZmVyLmlzRW5jb2RpbmcgfHwgZnVuY3Rpb24oZW5jb2RpbmcpIHsKICAgICAgc3dpdGNoIChlbmNvZGluZyAmJiBlbmNvZGluZy50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgY2FzZSAnaGV4JzoKICAgICAgICBjYXNlICd1dGY4JzoKICAgICAgICBjYXNlICd1dGYtOCc6CiAgICAgICAgY2FzZSAnYXNjaWknOgogICAgICAgIGNhc2UgJ2JpbmFyeSc6CiAgICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgICBjYXNlICd1Y3MyJzoKICAgICAgICBjYXNlICd1Y3MtMic6CiAgICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgICAgY2FzZSAndXRmLTE2bGUnOgogICAgICAgIGNhc2UgJ3Jhdyc6CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9OwogICAgZnVuY3Rpb24gYXNzZXJ0RW5jb2RpbmcoZW5jb2RpbmcpIHsKICAgICAgaWYgKGVuY29kaW5nICYmICFpc0J1ZmZlckVuY29kaW5nKGVuY29kaW5nKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKTsKICAgICAgfQogICAgfQogICAgdmFyIFN0cmluZ0RlY29kZXIgPSBleHBvcnRzLlN0cmluZ0RlY29kZXIgPSBmdW5jdGlvbihlbmNvZGluZykgewogICAgICB0aGlzLmVuY29kaW5nID0gKGVuY29kaW5nIHx8ICd1dGY4JykudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bLV9dLywgJycpOwogICAgICBhc3NlcnRFbmNvZGluZyhlbmNvZGluZyk7CiAgICAgIHN3aXRjaCAodGhpcy5lbmNvZGluZykgewogICAgICAgIGNhc2UgJ3V0ZjgnOgogICAgICAgICAgdGhpcy5zdXJyb2dhdGVTaXplID0gMzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3VjczInOgogICAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICAgICAgdGhpcy5zdXJyb2dhdGVTaXplID0gMjsKICAgICAgICAgIHRoaXMuZGV0ZWN0SW5jb21wbGV0ZUNoYXIgPSB1dGYxNkRldGVjdEluY29tcGxldGVDaGFyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgICAgIHRoaXMuc3Vycm9nYXRlU2l6ZSA9IDM7CiAgICAgICAgICB0aGlzLmRldGVjdEluY29tcGxldGVDaGFyID0gYmFzZTY0RGV0ZWN0SW5jb21wbGV0ZUNoYXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhpcy53cml0ZSA9IHBhc3NUaHJvdWdoV3JpdGU7CiAgICAgICAgICByZXR1cm4gOwogICAgICB9CiAgICAgIHRoaXMuY2hhckJ1ZmZlciA9IG5ldyBCdWZmZXIoNik7CiAgICAgIHRoaXMuY2hhclJlY2VpdmVkID0gMDsKICAgICAgdGhpcy5jaGFyTGVuZ3RoID0gMDsKICAgIH07CiAgICBTdHJpbmdEZWNvZGVyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgICB2YXIgY2hhclN0ciA9ICcnOwogICAgICB3aGlsZSAodGhpcy5jaGFyTGVuZ3RoKSB7CiAgICAgICAgdmFyIGF2YWlsYWJsZSA9IChidWZmZXIubGVuZ3RoID49IHRoaXMuY2hhckxlbmd0aCAtIHRoaXMuY2hhclJlY2VpdmVkKSA/IHRoaXMuY2hhckxlbmd0aCAtIHRoaXMuY2hhclJlY2VpdmVkIDogYnVmZmVyLmxlbmd0aDsKICAgICAgICBidWZmZXIuY29weSh0aGlzLmNoYXJCdWZmZXIsIHRoaXMuY2hhclJlY2VpdmVkLCAwLCBhdmFpbGFibGUpOwogICAgICAgIHRoaXMuY2hhclJlY2VpdmVkICs9IGF2YWlsYWJsZTsKICAgICAgICBpZiAodGhpcy5jaGFyUmVjZWl2ZWQgPCB0aGlzLmNoYXJMZW5ndGgpIHsKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgYnVmZmVyID0gYnVmZmVyLnNsaWNlKGF2YWlsYWJsZSwgYnVmZmVyLmxlbmd0aCk7CiAgICAgICAgY2hhclN0ciA9IHRoaXMuY2hhckJ1ZmZlci5zbGljZSgwLCB0aGlzLmNoYXJMZW5ndGgpLnRvU3RyaW5nKHRoaXMuZW5jb2RpbmcpOwogICAgICAgIHZhciBjaGFyQ29kZSA9IGNoYXJTdHIuY2hhckNvZGVBdChjaGFyU3RyLmxlbmd0aCAtIDEpOwogICAgICAgIGlmIChjaGFyQ29kZSA+PSAweEQ4MDAgJiYgY2hhckNvZGUgPD0gMHhEQkZGKSB7CiAgICAgICAgICB0aGlzLmNoYXJMZW5ndGggKz0gdGhpcy5zdXJyb2dhdGVTaXplOwogICAgICAgICAgY2hhclN0ciA9ICcnOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuY2hhclJlY2VpdmVkID0gdGhpcy5jaGFyTGVuZ3RoID0gMDsKICAgICAgICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIGNoYXJTdHI7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMuZGV0ZWN0SW5jb21wbGV0ZUNoYXIoYnVmZmVyKTsKICAgICAgdmFyIGVuZCA9IGJ1ZmZlci5sZW5ndGg7CiAgICAgIGlmICh0aGlzLmNoYXJMZW5ndGgpIHsKICAgICAgICBidWZmZXIuY29weSh0aGlzLmNoYXJCdWZmZXIsIDAsIGJ1ZmZlci5sZW5ndGggLSB0aGlzLmNoYXJSZWNlaXZlZCwgZW5kKTsKICAgICAgICBlbmQgLT0gdGhpcy5jaGFyUmVjZWl2ZWQ7CiAgICAgIH0KICAgICAgY2hhclN0ciArPSBidWZmZXIudG9TdHJpbmcodGhpcy5lbmNvZGluZywgMCwgZW5kKTsKICAgICAgdmFyIGVuZCA9IGNoYXJTdHIubGVuZ3RoIC0gMTsKICAgICAgdmFyIGNoYXJDb2RlID0gY2hhclN0ci5jaGFyQ29kZUF0KGVuZCk7CiAgICAgIGlmIChjaGFyQ29kZSA+PSAweEQ4MDAgJiYgY2hhckNvZGUgPD0gMHhEQkZGKSB7CiAgICAgICAgdmFyIHNpemUgPSB0aGlzLnN1cnJvZ2F0ZVNpemU7CiAgICAgICAgdGhpcy5jaGFyTGVuZ3RoICs9IHNpemU7CiAgICAgICAgdGhpcy5jaGFyUmVjZWl2ZWQgKz0gc2l6ZTsKICAgICAgICB0aGlzLmNoYXJCdWZmZXIuY29weSh0aGlzLmNoYXJCdWZmZXIsIHNpemUsIDAsIHNpemUpOwogICAgICAgIGJ1ZmZlci5jb3B5KHRoaXMuY2hhckJ1ZmZlciwgMCwgMCwgc2l6ZSk7CiAgICAgICAgcmV0dXJuIGNoYXJTdHIuc3Vic3RyaW5nKDAsIGVuZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYXJTdHI7CiAgICB9OwogICAgU3RyaW5nRGVjb2Rlci5wcm90b3R5cGUuZGV0ZWN0SW5jb21wbGV0ZUNoYXIgPSBmdW5jdGlvbihidWZmZXIpIHsKICAgICAgdmFyIGkgPSAoYnVmZmVyLmxlbmd0aCA+PSAzKSA/IDMgOiBidWZmZXIubGVuZ3RoOwogICAgICBmb3IgKDsgaSA+IDA7IGktLSkgewogICAgICAgIHZhciBjID0gYnVmZmVyW2J1ZmZlci5sZW5ndGggLSBpXTsKICAgICAgICBpZiAoaSA9PSAxICYmIGMgPj4gNSA9PSAweDA2KSB7CiAgICAgICAgICB0aGlzLmNoYXJMZW5ndGggPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChpIDw9IDIgJiYgYyA+PiA0ID09IDB4MEUpIHsKICAgICAgICAgIHRoaXMuY2hhckxlbmd0aCA9IDM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPD0gMyAmJiBjID4+IDMgPT0gMHgxRSkgewogICAgICAgICAgdGhpcy5jaGFyTGVuZ3RoID0gNDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmNoYXJSZWNlaXZlZCA9IGk7CiAgICB9OwogICAgU3RyaW5nRGVjb2Rlci5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24oYnVmZmVyKSB7CiAgICAgIHZhciByZXMgPSAnJzsKICAgICAgaWYgKGJ1ZmZlciAmJiBidWZmZXIubGVuZ3RoKQogICAgICAgIHJlcyA9IHRoaXMud3JpdGUoYnVmZmVyKTsKICAgICAgaWYgKHRoaXMuY2hhclJlY2VpdmVkKSB7CiAgICAgICAgdmFyIGNyID0gdGhpcy5jaGFyUmVjZWl2ZWQ7CiAgICAgICAgdmFyIGJ1ZiA9IHRoaXMuY2hhckJ1ZmZlcjsKICAgICAgICB2YXIgZW5jID0gdGhpcy5lbmNvZGluZzsKICAgICAgICByZXMgKz0gYnVmLnNsaWNlKDAsIGNyKS50b1N0cmluZyhlbmMpOwogICAgICB9CiAgICAgIHJldHVybiByZXM7CiAgICB9OwogICAgZnVuY3Rpb24gcGFzc1Rocm91Z2hXcml0ZShidWZmZXIpIHsKICAgICAgcmV0dXJuIGJ1ZmZlci50b1N0cmluZyh0aGlzLmVuY29kaW5nKTsKICAgIH0KICAgIGZ1bmN0aW9uIHV0ZjE2RGV0ZWN0SW5jb21wbGV0ZUNoYXIoYnVmZmVyKSB7CiAgICAgIHRoaXMuY2hhclJlY2VpdmVkID0gYnVmZmVyLmxlbmd0aCAlIDI7CiAgICAgIHRoaXMuY2hhckxlbmd0aCA9IHRoaXMuY2hhclJlY2VpdmVkID8gMiA6IDA7CiAgICB9CiAgICBmdW5jdGlvbiBiYXNlNjREZXRlY3RJbmNvbXBsZXRlQ2hhcihidWZmZXIpIHsKICAgICAgdGhpcy5jaGFyUmVjZWl2ZWQgPSBidWZmZXIubGVuZ3RoICUgMzsKICAgICAgdGhpcy5jaGFyTGVuZ3RoID0gdGhpcy5jaGFyUmVjZWl2ZWQgPyAzIDogMDsKICAgIH0KICB9KShyZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1idWZmZXJAMC4xLjAiKS5CdWZmZXIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV90cmFuc2Zvcm0iLCBbIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX2R1cGxleCIsICJucG06Y29yZS11dGlsLWlzQDEuMC4xIiwgIm5wbTppbmhlcml0c0AyLjAuMSIsICJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24ocHJvY2VzcykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBUcmFuc2Zvcm07CiAgICB2YXIgRHVwbGV4ID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fZHVwbGV4Iik7CiAgICB2YXIgdXRpbCA9IHJlcXVpcmUoIm5wbTpjb3JlLXV0aWwtaXNAMS4wLjEiKTsKICAgIHV0aWwuaW5oZXJpdHMgPSByZXF1aXJlKCJucG06aW5oZXJpdHNAMi4wLjEiKTsKICAgIHV0aWwuaW5oZXJpdHMoVHJhbnNmb3JtLCBEdXBsZXgpOwogICAgZnVuY3Rpb24gVHJhbnNmb3JtU3RhdGUob3B0aW9ucywgc3RyZWFtKSB7CiAgICAgIHRoaXMuYWZ0ZXJUcmFuc2Zvcm0gPSBmdW5jdGlvbihlciwgZGF0YSkgewogICAgICAgIHJldHVybiBhZnRlclRyYW5zZm9ybShzdHJlYW0sIGVyLCBkYXRhKTsKICAgICAgfTsKICAgICAgdGhpcy5uZWVkVHJhbnNmb3JtID0gZmFsc2U7CiAgICAgIHRoaXMudHJhbnNmb3JtaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud3JpdGVjYiA9IG51bGw7CiAgICAgIHRoaXMud3JpdGVjaHVuayA9IG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiBhZnRlclRyYW5zZm9ybShzdHJlYW0sIGVyLCBkYXRhKSB7CiAgICAgIHZhciB0cyA9IHN0cmVhbS5fdHJhbnNmb3JtU3RhdGU7CiAgICAgIHRzLnRyYW5zZm9ybWluZyA9IGZhbHNlOwogICAgICB2YXIgY2IgPSB0cy53cml0ZWNiOwogICAgICBpZiAoIWNiKQogICAgICAgIHJldHVybiBzdHJlYW0uZW1pdCgnZXJyb3InLCBuZXcgRXJyb3IoJ25vIHdyaXRlY2IgaW4gVHJhbnNmb3JtIGNsYXNzJykpOwogICAgICB0cy53cml0ZWNodW5rID0gbnVsbDsKICAgICAgdHMud3JpdGVjYiA9IG51bGw7CiAgICAgIGlmICghdXRpbC5pc051bGxPclVuZGVmaW5lZChkYXRhKSkKICAgICAgICBzdHJlYW0ucHVzaChkYXRhKTsKICAgICAgaWYgKGNiKQogICAgICAgIGNiKGVyKTsKICAgICAgdmFyIHJzID0gc3RyZWFtLl9yZWFkYWJsZVN0YXRlOwogICAgICBycy5yZWFkaW5nID0gZmFsc2U7CiAgICAgIGlmIChycy5uZWVkUmVhZGFibGUgfHwgcnMubGVuZ3RoIDwgcnMuaGlnaFdhdGVyTWFyaykgewogICAgICAgIHN0cmVhbS5fcmVhZChycy5oaWdoV2F0ZXJNYXJrKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gVHJhbnNmb3JtKG9wdGlvbnMpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFRyYW5zZm9ybSkpCiAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2Zvcm0ob3B0aW9ucyk7CiAgICAgIER1cGxleC5jYWxsKHRoaXMsIG9wdGlvbnMpOwogICAgICB0aGlzLl90cmFuc2Zvcm1TdGF0ZSA9IG5ldyBUcmFuc2Zvcm1TdGF0ZShvcHRpb25zLCB0aGlzKTsKICAgICAgdmFyIHN0cmVhbSA9IHRoaXM7CiAgICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUubmVlZFJlYWRhYmxlID0gdHJ1ZTsKICAgICAgdGhpcy5fcmVhZGFibGVTdGF0ZS5zeW5jID0gZmFsc2U7CiAgICAgIHRoaXMub25jZSgncHJlZmluaXNoJywgZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHV0aWwuaXNGdW5jdGlvbih0aGlzLl9mbHVzaCkpCiAgICAgICAgICB0aGlzLl9mbHVzaChmdW5jdGlvbihlcikgewogICAgICAgICAgICBkb25lKHN0cmVhbSwgZXIpOwogICAgICAgICAgfSk7CiAgICAgICAgZWxzZQogICAgICAgICAgZG9uZShzdHJlYW0pOwogICAgICB9KTsKICAgIH0KICAgIFRyYW5zZm9ybS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uKGNodW5rLCBlbmNvZGluZykgewogICAgICB0aGlzLl90cmFuc2Zvcm1TdGF0ZS5uZWVkVHJhbnNmb3JtID0gZmFsc2U7CiAgICAgIHJldHVybiBEdXBsZXgucHJvdG90eXBlLnB1c2guY2FsbCh0aGlzLCBjaHVuaywgZW5jb2RpbmcpOwogICAgfTsKICAgIFRyYW5zZm9ybS5wcm90b3R5cGUuX3RyYW5zZm9ybSA9IGZ1bmN0aW9uKGNodW5rLCBlbmNvZGluZywgY2IpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsKICAgIH07CiAgICBUcmFuc2Zvcm0ucHJvdG90eXBlLl93cml0ZSA9IGZ1bmN0aW9uKGNodW5rLCBlbmNvZGluZywgY2IpIHsKICAgICAgdmFyIHRzID0gdGhpcy5fdHJhbnNmb3JtU3RhdGU7CiAgICAgIHRzLndyaXRlY2IgPSBjYjsKICAgICAgdHMud3JpdGVjaHVuayA9IGNodW5rOwogICAgICB0cy53cml0ZWVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICAgIGlmICghdHMudHJhbnNmb3JtaW5nKSB7CiAgICAgICAgdmFyIHJzID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICAgICAgICBpZiAodHMubmVlZFRyYW5zZm9ybSB8fCBycy5uZWVkUmVhZGFibGUgfHwgcnMubGVuZ3RoIDwgcnMuaGlnaFdhdGVyTWFyaykKICAgICAgICAgIHRoaXMuX3JlYWQocnMuaGlnaFdhdGVyTWFyayk7CiAgICAgIH0KICAgIH07CiAgICBUcmFuc2Zvcm0ucHJvdG90eXBlLl9yZWFkID0gZnVuY3Rpb24obikgewogICAgICB2YXIgdHMgPSB0aGlzLl90cmFuc2Zvcm1TdGF0ZTsKICAgICAgaWYgKCF1dGlsLmlzTnVsbCh0cy53cml0ZWNodW5rKSAmJiB0cy53cml0ZWNiICYmICF0cy50cmFuc2Zvcm1pbmcpIHsKICAgICAgICB0cy50cmFuc2Zvcm1pbmcgPSB0cnVlOwogICAgICAgIHRoaXMuX3RyYW5zZm9ybSh0cy53cml0ZWNodW5rLCB0cy53cml0ZWVuY29kaW5nLCB0cy5hZnRlclRyYW5zZm9ybSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHMubmVlZFRyYW5zZm9ybSA9IHRydWU7CiAgICAgIH0KICAgIH07CiAgICBmdW5jdGlvbiBkb25lKHN0cmVhbSwgZXIpIHsKICAgICAgaWYgKGVyKQogICAgICAgIHJldHVybiBzdHJlYW0uZW1pdCgnZXJyb3InLCBlcik7CiAgICAgIHZhciB3cyA9IHN0cmVhbS5fd3JpdGFibGVTdGF0ZTsKICAgICAgdmFyIHRzID0gc3RyZWFtLl90cmFuc2Zvcm1TdGF0ZTsKICAgICAgaWYgKHdzLmxlbmd0aCkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhbGxpbmcgdHJhbnNmb3JtIGRvbmUgd2hlbiB3cy5sZW5ndGggIT0gMCcpOwogICAgICBpZiAodHMudHJhbnNmb3JtaW5nKQogICAgICAgIHRocm93IG5ldyBFcnJvcignY2FsbGluZyB0cmFuc2Zvcm0gZG9uZSB3aGVuIHN0aWxsIHRyYW5zZm9ybWluZycpOwogICAgICByZXR1cm4gc3RyZWFtLnB1c2gobnVsbCk7CiAgICB9CiAgfSkocmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMSIpKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fcGFzc3Rocm91Z2giLCBbIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3RyYW5zZm9ybSIsICJucG06Y29yZS11dGlsLWlzQDEuMC4xIiwgIm5wbTppbmhlcml0c0AyLjAuMSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSBQYXNzVGhyb3VnaDsKICB2YXIgVHJhbnNmb3JtID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fdHJhbnNmb3JtIik7CiAgdmFyIHV0aWwgPSByZXF1aXJlKCJucG06Y29yZS11dGlsLWlzQDEuMC4xIik7CiAgdXRpbC5pbmhlcml0cyA9IHJlcXVpcmUoIm5wbTppbmhlcml0c0AyLjAuMSIpOwogIHV0aWwuaW5oZXJpdHMoUGFzc1Rocm91Z2gsIFRyYW5zZm9ybSk7CiAgZnVuY3Rpb24gUGFzc1Rocm91Z2gob3B0aW9ucykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFBhc3NUaHJvdWdoKSkKICAgICAgcmV0dXJuIG5ldyBQYXNzVGhyb3VnaChvcHRpb25zKTsKICAgIFRyYW5zZm9ybS5jYWxsKHRoaXMsIG9wdGlvbnMpOwogIH0KICBQYXNzVGhyb3VnaC5wcm90b3R5cGUuX3RyYW5zZm9ybSA9IGZ1bmN0aW9uKGNodW5rLCBlbmNvZGluZywgY2IpIHsKICAgIGNiKG51bGwsIGNodW5rKTsKICB9OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy93cml0YWJsZSIsIFsibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fd3JpdGFibGUiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fd3JpdGFibGUiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvZHVwbGV4IiwgWyJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9kdXBsZXgiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fZHVwbGV4Iik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL3RyYW5zZm9ybSIsIFsibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fdHJhbnNmb3JtIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3RyYW5zZm9ybSIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9wYXNzdGhyb3VnaCIsIFsibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fcGFzc3Rocm91Z2giXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fcGFzc3Rocm91Z2giKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigiZ2l0aHViOmpzcG0vbm9kZWxpYnMtc3RyaW5nX2RlY29kZXJAMC4xLjAvaW5kZXgiLCBbIm5wbTpzdHJpbmdfZGVjb2RlckAwLjEwLjMxIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IFN5c3RlbS5fbm9kZVJlcXVpcmUgPyBTeXN0ZW0uX25vZGVSZXF1aXJlKCdzdHJpbmdfZGVjb2RlcicpIDogcmVxdWlyZSgibnBtOnN0cmluZ19kZWNvZGVyQDAuMTAuMzEiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlVG9TdHJpbmciLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihwcm9jZXNzKSB7CiAgICBmdW5jdGlvbiBiYXNlVG9TdHJpbmcodmFsdWUpIHsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogKHZhbHVlICsgJycpOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlVG9TdHJpbmc7CiAgfSkocmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMSIpKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGZ1bmN0aW9uIGlzT2JqZWN0TGlrZSh2YWx1ZSkgewogICAgcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzT2JqZWN0TGlrZTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlUHJvcGVydHkiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGZ1bmN0aW9uIGJhc2VQcm9wZXJ0eShrZXkpIHsKICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W2tleV07CiAgICB9OwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VQcm9wZXJ0eTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIsIFtdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxOwogIGZ1bmN0aW9uIGlzTGVuZ3RoKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPD0gTUFYX1NBRkVfSU5URUdFUjsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBpc0xlbmd0aDsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0IiwgW10sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBmdW5jdGlvbiBpc09iamVjdCh2YWx1ZSkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZSA9PSAnb2JqZWN0JyB8fCB0eXBlID09ICdmdW5jdGlvbicpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzT2JqZWN0OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcmd1bWVudHMiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNBcnJheUxpa2UiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBpc0FycmF5TGlrZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNBcnJheUxpa2UiKSwKICAgICAgaXNPYmplY3RMaWtlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiKTsKICB2YXIgYXJnc1RhZyA9ICdbb2JqZWN0IEFyZ3VtZW50c10nOwogIHZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CiAgdmFyIG9ialRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7CiAgZnVuY3Rpb24gaXNBcmd1bWVudHModmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzQXJyYXlMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBhcmdzVGFnOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzQXJndW1lbnRzOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9nZXROYXRpdmUiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGdldE5hdGl2ZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZ2V0TmF0aXZlIiksCiAgICAgIGlzTGVuZ3RoID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIpLAogICAgICBpc09iamVjdExpa2UgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSIpOwogIHZhciBhcnJheVRhZyA9ICdbb2JqZWN0IEFycmF5XSc7CiAgdmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsKICB2YXIgb2JqVG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZzsKICB2YXIgbmF0aXZlSXNBcnJheSA9IGdldE5hdGl2ZShBcnJheSwgJ2lzQXJyYXknKTsKICB2YXIgaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzTGVuZ3RoKHZhbHVlLmxlbmd0aCkgJiYgb2JqVG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gYXJyYXlUYWc7CiAgfTsKICBtb2R1bGUuZXhwb3J0cyA9IGlzQXJyYXk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNJbmRleCIsIFtdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIHJlSXNVaW50ID0gL15cZCskLzsKICB2YXIgTUFYX1NBRkVfSU5URUdFUiA9IDkwMDcxOTkyNTQ3NDA5OTE7CiAgZnVuY3Rpb24gaXNJbmRleCh2YWx1ZSwgbGVuZ3RoKSB7CiAgICB2YWx1ZSA9ICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgfHwgcmVJc1VpbnQudGVzdCh2YWx1ZSkpID8gK3ZhbHVlIDogLTE7CiAgICBsZW5ndGggPSBsZW5ndGggPT0gbnVsbCA/IE1BWF9TQUZFX0lOVEVHRVIgOiBsZW5ndGg7CiAgICByZXR1cm4gdmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBpc0luZGV4OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9rZXlzSW4iLCBbIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FyZ3VtZW50cyIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzSW5kZXgiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBpc0FyZ3VtZW50cyA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FyZ3VtZW50cyIpLAogICAgICBpc0FycmF5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiKSwKICAgICAgaXNJbmRleCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNJbmRleCIpLAogICAgICBpc0xlbmd0aCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNMZW5ndGgiKSwKICAgICAgaXNPYmplY3QgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiKTsKICB2YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwogIGZ1bmN0aW9uIGtleXNJbihvYmplY3QpIHsKICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHsKICAgICAgb2JqZWN0ID0gT2JqZWN0KG9iamVjdCk7CiAgICB9CiAgICB2YXIgbGVuZ3RoID0gb2JqZWN0Lmxlbmd0aDsKICAgIGxlbmd0aCA9IChsZW5ndGggJiYgaXNMZW5ndGgobGVuZ3RoKSAmJiAoaXNBcnJheShvYmplY3QpIHx8IGlzQXJndW1lbnRzKG9iamVjdCkpICYmIGxlbmd0aCkgfHwgMDsKICAgIHZhciBDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLAogICAgICAgIGluZGV4ID0gLTEsCiAgICAgICAgaXNQcm90byA9IHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUgPT09IG9iamVjdCwKICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpLAogICAgICAgIHNraXBJbmRleGVzID0gbGVuZ3RoID4gMDsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHJlc3VsdFtpbmRleF0gPSAoaW5kZXggKyAnJyk7CiAgICB9CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgIGlmICghKHNraXBJbmRleGVzICYmIGlzSW5kZXgoa2V5LCBsZW5ndGgpKSAmJiAhKGtleSA9PSAnY29uc3RydWN0b3InICYmIChpc1Byb3RvIHx8ICFoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBrZXlzSW47CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUNvcHkiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGZ1bmN0aW9uIGJhc2VDb3B5KHNvdXJjZSwgcHJvcHMsIG9iamVjdCkgewogICAgb2JqZWN0IHx8IChvYmplY3QgPSB7fSk7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGg7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIga2V5ID0gcHJvcHNbaW5kZXhdOwogICAgICBvYmplY3Rba2V5XSA9IHNvdXJjZVtrZXldOwogICAgfQogICAgcmV0dXJuIG9iamVjdDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlQ29weTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy91dGlsaXR5L2lkZW50aXR5IiwgW10sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlkZW50aXR5OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzSXRlcmF0ZWVDYWxsIiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzQXJyYXlMaWtlIiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNJbmRleCIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBpc0FycmF5TGlrZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNBcnJheUxpa2UiKSwKICAgICAgaXNJbmRleCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNJbmRleCIpLAogICAgICBpc09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIpOwogIGZ1bmN0aW9uIGlzSXRlcmF0ZWVDYWxsKHZhbHVlLCBpbmRleCwgb2JqZWN0KSB7CiAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIHR5cGUgPSB0eXBlb2YgaW5kZXg7CiAgICBpZiAodHlwZSA9PSAnbnVtYmVyJyA/IChpc0FycmF5TGlrZShvYmplY3QpICYmIGlzSW5kZXgoaW5kZXgsIG9iamVjdC5sZW5ndGgpKSA6ICh0eXBlID09ICdzdHJpbmcnICYmIGluZGV4IGluIG9iamVjdCkpIHsKICAgICAgdmFyIG90aGVyID0gb2JqZWN0W2luZGV4XTsKICAgICAgcmV0dXJuIHZhbHVlID09PSB2YWx1ZSA/ICh2YWx1ZSA9PT0gb3RoZXIpIDogKG90aGVyICE9PSBvdGhlcik7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gaXNJdGVyYXRlZUNhbGw7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvZnVuY3Rpb24vcmVzdFBhcmFtIiwgW10sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgRlVOQ19FUlJPUl9URVhUID0gJ0V4cGVjdGVkIGEgZnVuY3Rpb24nOwogIHZhciBuYXRpdmVNYXggPSBNYXRoLm1heDsKICBmdW5jdGlvbiByZXN0UGFyYW0oZnVuYywgc3RhcnQpIHsKICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsKICAgIH0KICAgIHN0YXJ0ID0gbmF0aXZlTWF4KHN0YXJ0ID09PSB1bmRlZmluZWQgPyAoZnVuYy5sZW5ndGggLSAxKSA6ICgrc3RhcnQgfHwgMCksIDApOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywKICAgICAgICAgIGluZGV4ID0gLTEsCiAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoYXJncy5sZW5ndGggLSBzdGFydCwgMCksCiAgICAgICAgICByZXN0ID0gQXJyYXkobGVuZ3RoKTsKICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICByZXN0W2luZGV4XSA9IGFyZ3Nbc3RhcnQgKyBpbmRleF07CiAgICAgIH0KICAgICAgc3dpdGNoIChzdGFydCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpcywgcmVzdCk7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzLCBhcmdzWzBdLCByZXN0KTsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXMsIGFyZ3NbMF0sIGFyZ3NbMV0sIHJlc3QpOwogICAgICB9CiAgICAgIHZhciBvdGhlckFyZ3MgPSBBcnJheShzdGFydCArIDEpOwogICAgICBpbmRleCA9IC0xOwogICAgICB3aGlsZSAoKytpbmRleCA8IHN0YXJ0KSB7CiAgICAgICAgb3RoZXJBcmdzW2luZGV4XSA9IGFyZ3NbaW5kZXhdOwogICAgICB9CiAgICAgIG90aGVyQXJnc1tzdGFydF0gPSByZXN0OwogICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBvdGhlckFyZ3MpOwogICAgfTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSByZXN0UGFyYW07CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxTdHJpbmdpZmllciIsIFsiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKHByb2Nlc3MpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIFhNTFN0cmluZ2lmaWVyLAogICAgICAgICAgYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSkgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSwKICAgICAgICAgIGhhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxTdHJpbmdpZmllciA9IChmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBYTUxTdHJpbmdpZmllcihvcHRpb25zKSB7CiAgICAgICAgICB0aGlzLmFzc2VydExlZ2FsQ2hhciA9IGJpbmQodGhpcy5hc3NlcnRMZWdhbENoYXIsIHRoaXMpOwogICAgICAgICAgdmFyIGtleSwKICAgICAgICAgICAgICByZWYsCiAgICAgICAgICAgICAgdmFsdWU7CiAgICAgICAgICB0aGlzLmFsbG93U3Vycm9nYXRlQ2hhcnMgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLmFsbG93U3Vycm9nYXRlQ2hhcnMgOiB2b2lkIDA7CiAgICAgICAgICByZWYgPSAob3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5zdHJpbmdpZnkgOiB2b2lkIDApIHx8IHt9OwogICAgICAgICAgZm9yIChrZXkgaW4gcmVmKSB7CiAgICAgICAgICAgIGlmICghaGFzUHJvcC5jYWxsKHJlZiwga2V5KSkKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgdmFsdWUgPSByZWZba2V5XTsKICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5lbGVOYW1lID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICB2YWwgPSAnJyArIHZhbCB8fCAnJzsKICAgICAgICAgIHJldHVybiB0aGlzLmFzc2VydExlZ2FsQ2hhcih2YWwpOwogICAgICAgIH07CiAgICAgICAgWE1MU3RyaW5naWZpZXIucHJvdG90eXBlLmVsZVRleHQgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHZhbCA9ICcnICsgdmFsIHx8ICcnOwogICAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0TGVnYWxDaGFyKHRoaXMuZWxFc2NhcGUodmFsKSk7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuY2RhdGEgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHZhbCA9ICcnICsgdmFsIHx8ICcnOwogICAgICAgICAgaWYgKHZhbC5tYXRjaCgvXV0+LykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIENEQVRBIHRleHQ6ICIgKyB2YWwpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0TGVnYWxDaGFyKHZhbCk7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuY29tbWVudCA9IGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgdmFsID0gJycgKyB2YWwgfHwgJyc7CiAgICAgICAgICBpZiAodmFsLm1hdGNoKC8tLS8pKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ29tbWVudCB0ZXh0IGNhbm5vdCBjb250YWluIGRvdWJsZS1oeXBlbjogIiArIHZhbCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5hc3NlcnRMZWdhbENoYXIodmFsKTsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5yYXcgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHJldHVybiAnJyArIHZhbCB8fCAnJzsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5hdHROYW1lID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICByZXR1cm4gJycgKyB2YWwgfHwgJyc7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuYXR0VmFsdWUgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHZhbCA9ICcnICsgdmFsIHx8ICcnOwogICAgICAgICAgcmV0dXJuIHRoaXMuYXR0RXNjYXBlKHZhbCk7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuaW5zVGFyZ2V0ID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICByZXR1cm4gJycgKyB2YWwgfHwgJyc7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuaW5zVmFsdWUgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHZhbCA9ICcnICsgdmFsIHx8ICcnOwogICAgICAgICAgaWYgKHZhbC5tYXRjaCgvXD8+LykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb24gdmFsdWU6ICIgKyB2YWwpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS54bWxWZXJzaW9uID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICB2YWwgPSAnJyArIHZhbCB8fCAnJzsKICAgICAgICAgIGlmICghdmFsLm1hdGNoKC8xXC5bMC05XSsvKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdmVyc2lvbiBudW1iZXI6ICIgKyB2YWwpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS54bWxFbmNvZGluZyA9IGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgdmFsID0gJycgKyB2YWwgfHwgJyc7CiAgICAgICAgICBpZiAoIXZhbC5tYXRjaCgvW0EtWmEtel0oPzpbQS1aYS16MC05Ll8tXXwtKSovKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZW5jb2Rpbmc6ICIgKyB2YWwpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS54bWxTdGFuZGFsb25lID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgIHJldHVybiAieWVzIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAibm8iOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgWE1MU3RyaW5naWZpZXIucHJvdG90eXBlLmR0ZFB1YklEID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICByZXR1cm4gJycgKyB2YWwgfHwgJyc7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuZHRkU3lzSUQgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHJldHVybiAnJyArIHZhbCB8fCAnJzsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5kdGRFbGVtZW50VmFsdWUgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHJldHVybiAnJyArIHZhbCB8fCAnJzsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5kdGRBdHRUeXBlID0gZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICByZXR1cm4gJycgKyB2YWwgfHwgJyc7CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuZHRkQXR0RGVmYXVsdCA9IGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgaWYgKHZhbCAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiAnJyArIHZhbCB8fCAnJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuZHRkRW50aXR5VmFsdWUgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgICAgIHJldHVybiAnJyArIHZhbCB8fCAnJzsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5kdGRORGF0YSA9IGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgcmV0dXJuICcnICsgdmFsIHx8ICcnOwogICAgICAgIH07CiAgICAgICAgWE1MU3RyaW5naWZpZXIucHJvdG90eXBlLmNvbnZlcnRBdHRLZXkgPSAnQCc7CiAgICAgICAgWE1MU3RyaW5naWZpZXIucHJvdG90eXBlLmNvbnZlcnRQSUtleSA9ICc/JzsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuY29udmVydFRleHRLZXkgPSAnI3RleHQnOwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5jb252ZXJ0Q0RhdGFLZXkgPSAnI2NkYXRhJzsKICAgICAgICBYTUxTdHJpbmdpZmllci5wcm90b3R5cGUuY29udmVydENvbW1lbnRLZXkgPSAnI2NvbW1lbnQnOwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5jb252ZXJ0UmF3S2V5ID0gJyNyYXcnOwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5jb252ZXJ0TGlzdEtleSA9ICcjbGlzdCc7CiAgICAgICAgWE1MU3RyaW5naWZpZXIucHJvdG90eXBlLmFzc2VydExlZ2FsQ2hhciA9IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgdmFyIGNoYXJzLAogICAgICAgICAgICAgIGNocjsKICAgICAgICAgIGlmICh0aGlzLmFsbG93U3Vycm9nYXRlQ2hhcnMpIHsKICAgICAgICAgICAgY2hhcnMgPSAvW1x1MDAwMC1cdTAwMDhcdTAwMEItXHUwMDBDXHUwMDBFLVx1MDAxRlx1RkZGRS1cdUZGRkZdLzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoYXJzID0gL1tcdTAwMDAtXHUwMDA4XHUwMDBCLVx1MDAwQ1x1MDAwRS1cdTAwMUZcdUQ4MDAtXHVERkZGXHVGRkZFLVx1RkZGRl0vOwogICAgICAgICAgfQogICAgICAgICAgY2hyID0gc3RyLm1hdGNoKGNoYXJzKTsKICAgICAgICAgIGlmIChjaHIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGNoYXJhY3RlciAoIiArIGNociArICIpIGluIHN0cmluZzogIiArIHN0ciArICIgYXQgaW5kZXggIiArIGNoci5pbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgIH07CiAgICAgICAgWE1MU3RyaW5naWZpZXIucHJvdG90eXBlLmVsRXNjYXBlID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKS5yZXBsYWNlKC9cci9nLCAnJiN4RDsnKTsKICAgICAgICB9OwogICAgICAgIFhNTFN0cmluZ2lmaWVyLnByb3RvdHlwZS5hdHRFc2NhcGUgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykucmVwbGFjZSgvXHQvZywgJyYjeDk7JykucmVwbGFjZSgvXG4vZywgJyYjeEE7JykucmVwbGFjZSgvXHIvZywgJyYjeEQ7Jyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gWE1MU3RyaW5naWZpZXI7CiAgICAgIH0pKCk7CiAgICB9KS5jYWxsKHRoaXMpOwogIH0pKHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiKSk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUNyZWF0ZSIsIFsibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgaXNPYmplY3QgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiKTsKICB2YXIgYmFzZUNyZWF0ZSA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIG9iamVjdCgpIHt9CiAgICByZXR1cm4gZnVuY3Rpb24ocHJvdG90eXBlKSB7CiAgICAgIGlmIChpc09iamVjdChwcm90b3R5cGUpKSB7CiAgICAgICAgb2JqZWN0LnByb3RvdHlwZSA9IHByb3RvdHlwZTsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IG9iamVjdDsKICAgICAgICBvYmplY3QucHJvdG90eXBlID0gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0IHx8IHt9OwogICAgfTsKICB9KCkpOwogIG1vZHVsZS5leHBvcnRzID0gYmFzZUNyZWF0ZTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlSXNGdW5jdGlvbiIsIFtdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgZnVuY3Rpb24gYmFzZUlzRnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJyB8fCBmYWxzZTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlSXNGdW5jdGlvbjsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzU3RyaW5nIiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGlzT2JqZWN0TGlrZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNPYmplY3RMaWtlIik7CiAgdmFyIHN0cmluZ1RhZyA9ICdbb2JqZWN0IFN0cmluZ10nOwogIHZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CiAgdmFyIG9ialRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7CiAgZnVuY3Rpb24gaXNTdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgb2JqVG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gc3RyaW5nVGFnKTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBpc1N0cmluZzsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9hcnJheUV2ZXJ5IiwgW10sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBmdW5jdGlvbiBhcnJheUV2ZXJ5KGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGlmICghcHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gYXJyYXlFdmVyeTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9hcnJheVNvbWUiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGZ1bmN0aW9uIGFycmF5U29tZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gYXJyYXlTb21lOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2VxdWFsQnlUYWciLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBib29sVGFnID0gJ1tvYmplY3QgQm9vbGVhbl0nLAogICAgICBkYXRlVGFnID0gJ1tvYmplY3QgRGF0ZV0nLAogICAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsCiAgICAgIG51bWJlclRhZyA9ICdbb2JqZWN0IE51bWJlcl0nLAogICAgICByZWdleHBUYWcgPSAnW29iamVjdCBSZWdFeHBdJywKICAgICAgc3RyaW5nVGFnID0gJ1tvYmplY3QgU3RyaW5nXSc7CiAgZnVuY3Rpb24gZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCB0YWcpIHsKICAgIHN3aXRjaCAodGFnKSB7CiAgICAgIGNhc2UgYm9vbFRhZzoKICAgICAgY2FzZSBkYXRlVGFnOgogICAgICAgIHJldHVybiArb2JqZWN0ID09ICtvdGhlcjsKICAgICAgY2FzZSBlcnJvclRhZzoKICAgICAgICByZXR1cm4gb2JqZWN0Lm5hbWUgPT0gb3RoZXIubmFtZSAmJiBvYmplY3QubWVzc2FnZSA9PSBvdGhlci5tZXNzYWdlOwogICAgICBjYXNlIG51bWJlclRhZzoKICAgICAgICByZXR1cm4gKG9iamVjdCAhPSArb2JqZWN0KSA/IG90aGVyICE9ICtvdGhlciA6IG9iamVjdCA9PSArb3RoZXI7CiAgICAgIGNhc2UgcmVnZXhwVGFnOgogICAgICBjYXNlIHN0cmluZ1RhZzoKICAgICAgICByZXR1cm4gb2JqZWN0ID09IChvdGhlciArICcnKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBlcXVhbEJ5VGFnOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2VxdWFsT2JqZWN0cyIsIFsibnBtOmxvZGFzaEAzLjkuMy9vYmplY3Qva2V5cyJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGtleXMgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9rZXlzIik7CiAgdmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsKICB2YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTsKICBmdW5jdGlvbiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgZXF1YWxGdW5jLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQikgewogICAgdmFyIG9ialByb3BzID0ga2V5cyhvYmplY3QpLAogICAgICAgIG9iakxlbmd0aCA9IG9ialByb3BzLmxlbmd0aCwKICAgICAgICBvdGhQcm9wcyA9IGtleXMob3RoZXIpLAogICAgICAgIG90aExlbmd0aCA9IG90aFByb3BzLmxlbmd0aDsKICAgIGlmIChvYmpMZW5ndGggIT0gb3RoTGVuZ3RoICYmICFpc0xvb3NlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBpbmRleCA9IG9iakxlbmd0aDsKICAgIHdoaWxlIChpbmRleC0tKSB7CiAgICAgIHZhciBrZXkgPSBvYmpQcm9wc1tpbmRleF07CiAgICAgIGlmICghKGlzTG9vc2UgPyBrZXkgaW4gb3RoZXIgOiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG90aGVyLCBrZXkpKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgdmFyIHNraXBDdG9yID0gaXNMb29zZTsKICAgIHdoaWxlICgrK2luZGV4IDwgb2JqTGVuZ3RoKSB7CiAgICAgIGtleSA9IG9ialByb3BzW2luZGV4XTsKICAgICAgdmFyIG9ialZhbHVlID0gb2JqZWN0W2tleV0sCiAgICAgICAgICBvdGhWYWx1ZSA9IG90aGVyW2tleV0sCiAgICAgICAgICByZXN1bHQgPSBjdXN0b21pemVyID8gY3VzdG9taXplcihpc0xvb3NlID8gb3RoVmFsdWUgOiBvYmpWYWx1ZSwgaXNMb29zZSA/IG9ialZhbHVlIDogb3RoVmFsdWUsIGtleSkgOiB1bmRlZmluZWQ7CiAgICAgIGlmICghKHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gZXF1YWxGdW5jKG9ialZhbHVlLCBvdGhWYWx1ZSwgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpIDogcmVzdWx0KSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBza2lwQ3RvciB8fCAoc2tpcEN0b3IgPSBrZXkgPT0gJ2NvbnN0cnVjdG9yJyk7CiAgICB9CiAgICBpZiAoIXNraXBDdG9yKSB7CiAgICAgIHZhciBvYmpDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLAogICAgICAgICAgb3RoQ3RvciA9IG90aGVyLmNvbnN0cnVjdG9yOwogICAgICBpZiAob2JqQ3RvciAhPSBvdGhDdG9yICYmICgnY29uc3RydWN0b3InIGluIG9iamVjdCAmJiAnY29uc3RydWN0b3InIGluIG90aGVyKSAmJiAhKHR5cGVvZiBvYmpDdG9yID09ICdmdW5jdGlvbicgJiYgb2JqQ3RvciBpbnN0YW5jZW9mIG9iakN0b3IgJiYgdHlwZW9mIG90aEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvdGhDdG9yIGluc3RhbmNlb2Ygb3RoQ3RvcikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGVxdWFsT2JqZWN0czsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzVHlwZWRBcnJheSIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGlzTGVuZ3RoID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIpLAogICAgICBpc09iamVjdExpa2UgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSIpOwogIHZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsCiAgICAgIGFycmF5VGFnID0gJ1tvYmplY3QgQXJyYXldJywKICAgICAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJywKICAgICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJywKICAgICAgZXJyb3JUYWcgPSAnW29iamVjdCBFcnJvcl0nLAogICAgICBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJywKICAgICAgbWFwVGFnID0gJ1tvYmplY3QgTWFwXScsCiAgICAgIG51bWJlclRhZyA9ICdbb2JqZWN0IE51bWJlcl0nLAogICAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJywKICAgICAgcmVnZXhwVGFnID0gJ1tvYmplY3QgUmVnRXhwXScsCiAgICAgIHNldFRhZyA9ICdbb2JqZWN0IFNldF0nLAogICAgICBzdHJpbmdUYWcgPSAnW29iamVjdCBTdHJpbmddJywKICAgICAgd2Vha01hcFRhZyA9ICdbb2JqZWN0IFdlYWtNYXBdJzsKICB2YXIgYXJyYXlCdWZmZXJUYWcgPSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nLAogICAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsCiAgICAgIGZsb2F0NjRUYWcgPSAnW29iamVjdCBGbG9hdDY0QXJyYXldJywKICAgICAgaW50OFRhZyA9ICdbb2JqZWN0IEludDhBcnJheV0nLAogICAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJywKICAgICAgaW50MzJUYWcgPSAnW29iamVjdCBJbnQzMkFycmF5XScsCiAgICAgIHVpbnQ4VGFnID0gJ1tvYmplY3QgVWludDhBcnJheV0nLAogICAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLAogICAgICB1aW50MTZUYWcgPSAnW29iamVjdCBVaW50MTZBcnJheV0nLAogICAgICB1aW50MzJUYWcgPSAnW29iamVjdCBVaW50MzJBcnJheV0nOwogIHZhciB0eXBlZEFycmF5VGFncyA9IHt9OwogIHR5cGVkQXJyYXlUYWdzW2Zsb2F0MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbZmxvYXQ2NFRhZ10gPSB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50MTZUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgdHlwZWRBcnJheVRhZ3NbYXJnc1RhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheVRhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheUJ1ZmZlclRhZ10gPSB0eXBlZEFycmF5VGFnc1tib29sVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2RhdGVUYWddID0gdHlwZWRBcnJheVRhZ3NbZXJyb3JUYWddID0gdHlwZWRBcnJheVRhZ3NbZnVuY1RhZ10gPSB0eXBlZEFycmF5VGFnc1ttYXBUYWddID0gdHlwZWRBcnJheVRhZ3NbbnVtYmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW29iamVjdFRhZ10gPSB0eXBlZEFycmF5VGFnc1tyZWdleHBUYWddID0gdHlwZWRBcnJheVRhZ3Nbc2V0VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3N0cmluZ1RhZ10gPSB0eXBlZEFycmF5VGFnc1t3ZWFrTWFwVGFnXSA9IGZhbHNlOwogIHZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CiAgdmFyIG9ialRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7CiAgZnVuY3Rpb24gaXNUeXBlZEFycmF5KHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBpc0xlbmd0aCh2YWx1ZS5sZW5ndGgpICYmICEhdHlwZWRBcnJheVRhZ3Nbb2JqVG9TdHJpbmcuY2FsbCh2YWx1ZSldOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzVHlwZWRBcnJheTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCIsIFsibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0IiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihwcm9jZXNzKSB7CiAgICB2YXIgaXNPYmplY3QgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiKTsKICAgIGZ1bmN0aW9uIHRvT2JqZWN0KHZhbHVlKSB7CiAgICAgIHJldHVybiBpc09iamVjdCh2YWx1ZSkgPyB2YWx1ZSA6IE9iamVjdCh2YWx1ZSk7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHRvT2JqZWN0OwogIH0pKHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiKSk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNTdHJpY3RDb21wYXJhYmxlIiwgWyJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBpc09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIpOwogIGZ1bmN0aW9uIGlzU3RyaWN0Q29tcGFyYWJsZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlID09PSB2YWx1ZSAmJiAhaXNPYmplY3QodmFsdWUpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzU3RyaWN0Q29tcGFyYWJsZTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvcGFpcnMiLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2tleXMiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGtleXMgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9rZXlzIiksCiAgICAgIHRvT2JqZWN0ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCIpOwogIGZ1bmN0aW9uIHBhaXJzKG9iamVjdCkgewogICAgb2JqZWN0ID0gdG9PYmplY3Qob2JqZWN0KTsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHByb3BzID0ga2V5cyhvYmplY3QpLAogICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpOwogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsKICAgICAgcmVzdWx0W2luZGV4XSA9IFtrZXksIG9iamVjdFtrZXldXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gcGFpcnM7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUdldCIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIHRvT2JqZWN0ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCIpOwogIGZ1bmN0aW9uIGJhc2VHZXQob2JqZWN0LCBwYXRoLCBwYXRoS2V5KSB7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuIDsKICAgIH0KICAgIGlmIChwYXRoS2V5ICE9PSB1bmRlZmluZWQgJiYgcGF0aEtleSBpbiB0b09iamVjdChvYmplY3QpKSB7CiAgICAgIHBhdGggPSBbcGF0aEtleV07CiAgICB9CiAgICB2YXIgaW5kZXggPSAwLAogICAgICAgIGxlbmd0aCA9IHBhdGgubGVuZ3RoOwogICAgd2hpbGUgKG9iamVjdCAhPSBudWxsICYmIGluZGV4IDwgbGVuZ3RoKSB7CiAgICAgIG9iamVjdCA9IG9iamVjdFtwYXRoW2luZGV4KytdXTsKICAgIH0KICAgIHJldHVybiAoaW5kZXggJiYgaW5kZXggPT0gbGVuZ3RoKSA/IG9iamVjdCA6IHVuZGVmaW5lZDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlR2V0OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VTbGljZSIsIFtdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgZnVuY3Rpb24gYmFzZVNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICBzdGFydCA9IHN0YXJ0ID09IG51bGwgPyAwIDogKCtzdGFydCB8fCAwKTsKICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTsKICAgIH0KICAgIGVuZCA9IChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiBsZW5ndGgpID8gbGVuZ3RoIDogKCtlbmQgfHwgMCk7CiAgICBpZiAoZW5kIDwgMCkgewogICAgICBlbmQgKz0gbGVuZ3RoOwogICAgfQogICAgbGVuZ3RoID0gc3RhcnQgPiBlbmQgPyAwIDogKChlbmQgLSBzdGFydCkgPj4+IDApOwogICAgc3RhcnQgPj4+PSAwOwogICAgdmFyIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gYXJyYXlbaW5kZXggKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VTbGljZTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0tleSIsIFsibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGlzQXJyYXkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIpLAogICAgICB0b09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvdG9PYmplY3QiKTsKICB2YXIgcmVJc0RlZXBQcm9wID0gL1wufFxbKD86W15bXF1dKnwoWyInXSkoPzooPyFcMSlbXlxuXFxdfFxcLikqP1wxKVxdLywKICAgICAgcmVJc1BsYWluUHJvcCA9IC9eXHcqJC87CiAgZnVuY3Rpb24gaXNLZXkodmFsdWUsIG9iamVjdCkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgICBpZiAoKHR5cGUgPT0gJ3N0cmluZycgJiYgcmVJc1BsYWluUHJvcC50ZXN0KHZhbHVlKSkgfHwgdHlwZSA9PSAnbnVtYmVyJykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gIXJlSXNEZWVwUHJvcC50ZXN0KHZhbHVlKTsKICAgIHJldHVybiByZXN1bHQgfHwgKG9iamVjdCAhPSBudWxsICYmIHZhbHVlIGluIHRvT2JqZWN0KG9iamVjdCkpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzS2V5OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2FycmF5L2xhc3QiLCBbXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIGZ1bmN0aW9uIGxhc3QoYXJyYXkpIHsKICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7CiAgICByZXR1cm4gbGVuZ3RoID8gYXJyYXlbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gbGFzdDsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b1BhdGgiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZVRvU3RyaW5nIiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FycmF5IiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihwcm9jZXNzKSB7CiAgICB2YXIgYmFzZVRvU3RyaW5nID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlVG9TdHJpbmciKSwKICAgICAgICBpc0FycmF5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiKTsKICAgIHZhciByZVByb3BOYW1lID0gL1teLltcXV0rfFxbKD86KC0/XGQrKD86XC5cZCspPyl8KFsiJ10pKCg/Oig/IVwyKVteXG5cXF18XFwuKSo/KVwyKVxdL2c7CiAgICB2YXIgcmVFc2NhcGVDaGFyID0gL1xcKFxcKT8vZzsKICAgIGZ1bmN0aW9uIHRvUGF0aCh2YWx1ZSkgewogICAgICBpZiAoaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0KICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICBiYXNlVG9TdHJpbmcodmFsdWUpLnJlcGxhY2UocmVQcm9wTmFtZSwgZnVuY3Rpb24obWF0Y2gsIG51bWJlciwgcXVvdGUsIHN0cmluZykgewogICAgICAgIHJlc3VsdC5wdXNoKHF1b3RlID8gc3RyaW5nLnJlcGxhY2UocmVFc2NhcGVDaGFyLCAnJDEnKSA6IChudW1iZXIgfHwgbWF0Y2gpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IHRvUGF0aDsKICB9KShyZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIikpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VQcm9wZXJ0eURlZXAiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUdldCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL3RvUGF0aCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJhc2VHZXQgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VHZXQiKSwKICAgICAgdG9QYXRoID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b1BhdGgiKTsKICBmdW5jdGlvbiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpIHsKICAgIHZhciBwYXRoS2V5ID0gKHBhdGggKyAnJyk7CiAgICBwYXRoID0gdG9QYXRoKHBhdGgpOwogICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICByZXR1cm4gYmFzZUdldChvYmplY3QsIHBhdGgsIHBhdGhLZXkpOwogICAgfTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlUHJvcGVydHlEZWVwOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2NyZWF0ZUJhc2VGb3IiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvdG9PYmplY3QiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciB0b09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvdG9PYmplY3QiKTsKICBmdW5jdGlvbiBjcmVhdGVCYXNlRm9yKGZyb21SaWdodCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCwgaXRlcmF0ZWUsIGtleXNGdW5jKSB7CiAgICAgIHZhciBpdGVyYWJsZSA9IHRvT2JqZWN0KG9iamVjdCksCiAgICAgICAgICBwcm9wcyA9IGtleXNGdW5jKG9iamVjdCksCiAgICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsCiAgICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xOwogICAgICB3aGlsZSAoKGZyb21SaWdodCA/IGluZGV4LS0gOiArK2luZGV4IDwgbGVuZ3RoKSkgewogICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07CiAgICAgICAgaWYgKGl0ZXJhdGVlKGl0ZXJhYmxlW2tleV0sIGtleSwgaXRlcmFibGUpID09PSBmYWxzZSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9OwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZUJhc2VGb3I7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvY3JlYXRlQmFzZUVhY2giLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZ2V0TGVuZ3RoIiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNMZW5ndGgiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGdldExlbmd0aCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZ2V0TGVuZ3RoIiksCiAgICAgIGlzTGVuZ3RoID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIpLAogICAgICB0b09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvdG9PYmplY3QiKTsKICBmdW5jdGlvbiBjcmVhdGVCYXNlRWFjaChlYWNoRnVuYywgZnJvbVJpZ2h0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24oY29sbGVjdGlvbiwgaXRlcmF0ZWUpIHsKICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBnZXRMZW5ndGgoY29sbGVjdGlvbikgOiAwOwogICAgICBpZiAoIWlzTGVuZ3RoKGxlbmd0aCkpIHsKICAgICAgICByZXR1cm4gZWFjaEZ1bmMoY29sbGVjdGlvbiwgaXRlcmF0ZWUpOwogICAgICB9CiAgICAgIHZhciBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xLAogICAgICAgICAgaXRlcmFibGUgPSB0b09iamVjdChjb2xsZWN0aW9uKTsKICAgICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVbaW5kZXhdLCBpbmRleCwgaXRlcmFibGUpID09PSBmYWxzZSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjb2xsZWN0aW9uOwogICAgfTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVCYXNlRWFjaDsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTEF0dHJpYnV0ZSIsIFsibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgWE1MQXR0cmlidXRlLAogICAgICAgIGNyZWF0ZTsKICAgIGNyZWF0ZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxBdHRyaWJ1dGUgPSAoZnVuY3Rpb24oKSB7CiAgICAgIGZ1bmN0aW9uIFhNTEF0dHJpYnV0ZShwYXJlbnQsIG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdGhpcy5zdHJpbmdpZnkgPSBwYXJlbnQuc3RyaW5naWZ5OwogICAgICAgIGlmIChuYW1lID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBhdHRyaWJ1dGUgbmFtZSBvZiBlbGVtZW50ICIgKyBwYXJlbnQubmFtZSk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1pc3NpbmcgYXR0cmlidXRlIHZhbHVlIGZvciBhdHRyaWJ1dGUgIiArIG5hbWUgKyAiIG9mIGVsZW1lbnQgIiArIHBhcmVudC5uYW1lKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5zdHJpbmdpZnkuYXR0TmFtZShuYW1lKTsKICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5zdHJpbmdpZnkuYXR0VmFsdWUodmFsdWUpOwogICAgICB9CiAgICAgIFhNTEF0dHJpYnV0ZS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKFhNTEF0dHJpYnV0ZS5wcm90b3R5cGUsIHRoaXMpOwogICAgICB9OwogICAgICBYTUxBdHRyaWJ1dGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24ob3B0aW9ucywgbGV2ZWwpIHsKICAgICAgICByZXR1cm4gJyAnICsgdGhpcy5uYW1lICsgJz0iJyArIHRoaXMudmFsdWUgKyAnIic7CiAgICAgIH07CiAgICAgIHJldHVybiBYTUxBdHRyaWJ1dGU7CiAgICB9KSgpOwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24iLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTFByb2Nlc3NpbmdJbnN0cnVjdGlvbiwKICAgICAgICBjcmVhdGU7CiAgICBjcmVhdGUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiKTsKICAgIG1vZHVsZS5leHBvcnRzID0gWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uID0gKGZ1bmN0aW9uKCkgewogICAgICBmdW5jdGlvbiBYTUxQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ocGFyZW50LCB0YXJnZXQsIHZhbHVlKSB7CiAgICAgICAgdGhpcy5zdHJpbmdpZnkgPSBwYXJlbnQuc3RyaW5naWZ5OwogICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIGluc3RydWN0aW9uIHRhcmdldCIpOwogICAgICAgIH0KICAgICAgICB0aGlzLnRhcmdldCA9IHRoaXMuc3RyaW5naWZ5Lmluc1RhcmdldCh0YXJnZXQpOwogICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuc3RyaW5naWZ5Lmluc1ZhbHVlKHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uLnByb3RvdHlwZSwgdGhpcyk7CiAgICAgIH07CiAgICAgIFhNTFByb2Nlc3NpbmdJbnN0cnVjdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBpbmRlbnQsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gJzw/JzsKICAgICAgICByICs9IHRoaXMudGFyZ2V0OwogICAgICAgIGlmICh0aGlzLnZhbHVlKSB7CiAgICAgICAgICByICs9ICcgJyArIHRoaXMudmFsdWU7CiAgICAgICAgfQogICAgICAgIHIgKz0gJz8+JzsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IG5ld2xpbmU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgICB9OwogICAgICByZXR1cm4gWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uOwogICAgfSkoKTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MQ0RhdGEiLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MTm9kZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTENEYXRhLAogICAgICAgIFhNTE5vZGUsCiAgICAgICAgY3JlYXRlLAogICAgICAgIGV4dGVuZCA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsKICAgICAgICAgICAgaWYgKGhhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpCiAgICAgICAgICAgICAgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gY3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOwogICAgICAgICAgfQogICAgICAgICAgY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOwogICAgICAgICAgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsKICAgICAgICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CiAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgfSwKICAgICAgICBoYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHk7CiAgICBjcmVhdGUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiKTsKICAgIFhNTE5vZGUgPSByZXF1aXJlKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MTm9kZSIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxDRGF0YSA9IChmdW5jdGlvbihzdXBlckNsYXNzKSB7CiAgICAgIGV4dGVuZChYTUxDRGF0YSwgc3VwZXJDbGFzcyk7CiAgICAgIGZ1bmN0aW9uIFhNTENEYXRhKHBhcmVudCwgdGV4dCkgewogICAgICAgIFhNTENEYXRhLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmVudCk7CiAgICAgICAgaWYgKHRleHQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIENEQVRBIHRleHQiKTsKICAgICAgICB9CiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy5zdHJpbmdpZnkuY2RhdGEodGV4dCk7CiAgICAgIH0KICAgICAgWE1MQ0RhdGEucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZShYTUxDRGF0YS5wcm90b3R5cGUsIHRoaXMpOwogICAgICB9OwogICAgICBYTUxDRGF0YS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBpbmRlbnQsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gJzwhW0NEQVRBWycgKyB0aGlzLnRleHQgKyAnXV0+JzsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IG5ld2xpbmU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgICB9OwogICAgICByZXR1cm4gWE1MQ0RhdGE7CiAgICB9KShYTUxOb2RlKTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MQ29tbWVudCIsIFsibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxOb2RlIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgWE1MQ29tbWVudCwKICAgICAgICBYTUxOb2RlLAogICAgICAgIGNyZWF0ZSwKICAgICAgICBleHRlbmQgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7CiAgICAgICAgICAgIGlmIChoYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKQogICAgICAgICAgICAgIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsKICAgICAgICAgIH0KICAgICAgICAgIGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsKICAgICAgICAgIGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7CiAgICAgICAgICBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOwogICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgIH0sCiAgICAgICAgaGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5OwogICAgY3JlYXRlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIik7CiAgICBYTUxOb2RlID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTE5vZGUiKTsKICAgIG1vZHVsZS5leHBvcnRzID0gWE1MQ29tbWVudCA9IChmdW5jdGlvbihzdXBlckNsYXNzKSB7CiAgICAgIGV4dGVuZChYTUxDb21tZW50LCBzdXBlckNsYXNzKTsKICAgICAgZnVuY3Rpb24gWE1MQ29tbWVudChwYXJlbnQsIHRleHQpIHsKICAgICAgICBYTUxDb21tZW50Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmVudCk7CiAgICAgICAgaWYgKHRleHQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIGNvbW1lbnQgdGV4dCIpOwogICAgICAgIH0KICAgICAgICB0aGlzLnRleHQgPSB0aGlzLnN0cmluZ2lmeS5jb21tZW50KHRleHQpOwogICAgICB9CiAgICAgIFhNTENvbW1lbnQucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZShYTUxDb21tZW50LnByb3RvdHlwZSwgdGhpcyk7CiAgICAgIH07CiAgICAgIFhNTENvbW1lbnQucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24ob3B0aW9ucywgbGV2ZWwpIHsKICAgICAgICB2YXIgaW5kZW50LAogICAgICAgICAgICBuZXdsaW5lLAogICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgIHByZXR0eSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcmVmLAogICAgICAgICAgICByZWYxLAogICAgICAgICAgICByZWYyLAogICAgICAgICAgICBzcGFjZTsKICAgICAgICBwcmV0dHkgPSAob3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5wcmV0dHkgOiB2b2lkIDApIHx8IGZhbHNlOwogICAgICAgIGluZGVudCA9IChyZWYgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLmluZGVudCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZiA6ICcgICc7CiAgICAgICAgb2Zmc2V0ID0gKHJlZjEgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLm9mZnNldCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjEgOiAwOwogICAgICAgIG5ld2xpbmUgPSAocmVmMiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMubmV3bGluZSA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjIgOiAnXG4nOwogICAgICAgIGxldmVsIHx8IChsZXZlbCA9IDApOwogICAgICAgIHNwYWNlID0gbmV3IEFycmF5KGxldmVsICsgb2Zmc2V0ICsgMSkuam9pbihpbmRlbnQpOwogICAgICAgIHIgPSAnJzsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IHNwYWNlOwogICAgICAgIH0KICAgICAgICByICs9ICc8IS0tICcgKyB0aGlzLnRleHQgKyAnIC0tPic7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfTsKICAgICAgcmV0dXJuIFhNTENvbW1lbnQ7CiAgICB9KShYTUxOb2RlKTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRFREQXR0TGlzdCIsIFsibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgWE1MRFREQXR0TGlzdCwKICAgICAgICBjcmVhdGU7CiAgICBjcmVhdGUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiKTsKICAgIG1vZHVsZS5leHBvcnRzID0gWE1MRFREQXR0TGlzdCA9IChmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gWE1MRFREQXR0TGlzdChwYXJlbnQsIGVsZW1lbnROYW1lLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVUeXBlLCBkZWZhdWx0VmFsdWVUeXBlLCBkZWZhdWx0VmFsdWUpIHsKICAgICAgICB0aGlzLnN0cmluZ2lmeSA9IHBhcmVudC5zdHJpbmdpZnk7CiAgICAgICAgaWYgKGVsZW1lbnROYW1lID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBEVEQgZWxlbWVudCBuYW1lIik7CiAgICAgICAgfQogICAgICAgIGlmIChhdHRyaWJ1dGVOYW1lID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBEVEQgYXR0cmlidXRlIG5hbWUiKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFhdHRyaWJ1dGVUeXBlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1pc3NpbmcgRFREIGF0dHJpYnV0ZSB0eXBlIik7CiAgICAgICAgfQogICAgICAgIGlmICghZGVmYXVsdFZhbHVlVHlwZSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIERURCBhdHRyaWJ1dGUgZGVmYXVsdCIpOwogICAgICAgIH0KICAgICAgICBpZiAoZGVmYXVsdFZhbHVlVHlwZS5pbmRleE9mKCcjJykgIT09IDApIHsKICAgICAgICAgIGRlZmF1bHRWYWx1ZVR5cGUgPSAnIycgKyBkZWZhdWx0VmFsdWVUeXBlOwogICAgICAgIH0KICAgICAgICBpZiAoIWRlZmF1bHRWYWx1ZVR5cGUubWF0Y2goL14oI1JFUVVJUkVEfCNJTVBMSUVEfCNGSVhFRHwjREVGQVVMVCkkLykpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBkZWZhdWx0IHZhbHVlIHR5cGU7IGV4cGVjdGVkOiAjUkVRVUlSRUQsICNJTVBMSUVELCAjRklYRUQgb3IgI0RFRkFVTFQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAmJiAhZGVmYXVsdFZhbHVlVHlwZS5tYXRjaCgvXigjRklYRUR8I0RFRkFVTFQpJC8pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkRlZmF1bHQgdmFsdWUgb25seSBhcHBsaWVzIHRvICNGSVhFRCBvciAjREVGQVVMVCIpOwogICAgICAgIH0KICAgICAgICB0aGlzLmVsZW1lbnROYW1lID0gdGhpcy5zdHJpbmdpZnkuZWxlTmFtZShlbGVtZW50TmFtZSk7CiAgICAgICAgdGhpcy5hdHRyaWJ1dGVOYW1lID0gdGhpcy5zdHJpbmdpZnkuYXR0TmFtZShhdHRyaWJ1dGVOYW1lKTsKICAgICAgICB0aGlzLmF0dHJpYnV0ZVR5cGUgPSB0aGlzLnN0cmluZ2lmeS5kdGRBdHRUeXBlKGF0dHJpYnV0ZVR5cGUpOwogICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gdGhpcy5zdHJpbmdpZnkuZHRkQXR0RGVmYXVsdChkZWZhdWx0VmFsdWUpOwogICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlVHlwZSA9IGRlZmF1bHRWYWx1ZVR5cGU7CiAgICAgIH0KICAgICAgWE1MRFREQXR0TGlzdC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKFhNTERUREF0dExpc3QucHJvdG90eXBlLCB0aGlzKTsKICAgICAgfTsKICAgICAgWE1MRFREQXR0TGlzdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBpbmRlbnQsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gJzwhQVRUTElTVCAnICsgdGhpcy5lbGVtZW50TmFtZSArICcgJyArIHRoaXMuYXR0cmlidXRlTmFtZSArICcgJyArIHRoaXMuYXR0cmlidXRlVHlwZTsKICAgICAgICBpZiAodGhpcy5kZWZhdWx0VmFsdWVUeXBlICE9PSAnI0RFRkFVTFQnKSB7CiAgICAgICAgICByICs9ICcgJyArIHRoaXMuZGVmYXVsdFZhbHVlVHlwZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgICByICs9ICcgIicgKyB0aGlzLmRlZmF1bHRWYWx1ZSArICciJzsKICAgICAgICB9CiAgICAgICAgciArPSAnPic7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfTsKICAgICAgcmV0dXJuIFhNTERUREF0dExpc3Q7CiAgICB9KSgpOwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEVERFbnRpdHkiLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbigpIHsKICAgIHZhciBYTUxEVERFbnRpdHksCiAgICAgICAgY3JlYXRlLAogICAgICAgIGlzT2JqZWN0OwogICAgY3JlYXRlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIik7CiAgICBpc09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxEVERFbnRpdHkgPSAoZnVuY3Rpb24oKSB7CiAgICAgIGZ1bmN0aW9uIFhNTERUREVudGl0eShwYXJlbnQsIHBlLCBuYW1lLCB2YWx1ZSkgewogICAgICAgIHRoaXMuc3RyaW5naWZ5ID0gcGFyZW50LnN0cmluZ2lmeTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1pc3NpbmcgZW50aXR5IG5hbWUiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBlbnRpdHkgdmFsdWUiKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wZSA9ICEhcGU7CiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5zdHJpbmdpZnkuZWxlTmFtZShuYW1lKTsKICAgICAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkgewogICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuc3RyaW5naWZ5LmR0ZEVudGl0eVZhbHVlKHZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCF2YWx1ZS5wdWJJRCAmJiAhdmFsdWUuc3lzSUQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQdWJsaWMgYW5kL29yIHN5c3RlbSBpZGVudGlmaWVycyBhcmUgcmVxdWlyZWQgZm9yIGFuIGV4dGVybmFsIGVudGl0eSIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlLnB1YklEICYmICF2YWx1ZS5zeXNJRCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlN5c3RlbSBpZGVudGlmaWVyIGlzIHJlcXVpcmVkIGZvciBhIHB1YmxpYyBleHRlcm5hbCBlbnRpdHkiKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZS5wdWJJRCAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMucHViSUQgPSB0aGlzLnN0cmluZ2lmeS5kdGRQdWJJRCh2YWx1ZS5wdWJJRCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUuc3lzSUQgIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLnN5c0lEID0gdGhpcy5zdHJpbmdpZnkuZHRkU3lzSUQodmFsdWUuc3lzSUQpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlLm5EYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5uRGF0YSA9IHRoaXMuc3RyaW5naWZ5LmR0ZE5EYXRhKHZhbHVlLm5EYXRhKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLnBlICYmIHRoaXMubkRhdGEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3RhdGlvbiBkZWNsYXJhdGlvbiBpcyBub3QgYWxsb3dlZCBpbiBhIHBhcmFtZXRlciBlbnRpdHkiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgWE1MRFRERW50aXR5LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoWE1MRFRERW50aXR5LnByb3RvdHlwZSwgdGhpcyk7CiAgICAgIH07CiAgICAgIFhNTERUREVudGl0eS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBpbmRlbnQsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gJzwhRU5USVRZJzsKICAgICAgICBpZiAodGhpcy5wZSkgewogICAgICAgICAgciArPSAnICUnOwogICAgICAgIH0KICAgICAgICByICs9ICcgJyArIHRoaXMubmFtZTsKICAgICAgICBpZiAodGhpcy52YWx1ZSkgewogICAgICAgICAgciArPSAnICInICsgdGhpcy52YWx1ZSArICciJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMucHViSUQgJiYgdGhpcy5zeXNJRCkgewogICAgICAgICAgICByICs9ICcgUFVCTElDICInICsgdGhpcy5wdWJJRCArICciICInICsgdGhpcy5zeXNJRCArICciJzsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zeXNJRCkgewogICAgICAgICAgICByICs9ICcgU1lTVEVNICInICsgdGhpcy5zeXNJRCArICciJzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLm5EYXRhKSB7CiAgICAgICAgICAgIHIgKz0gJyBOREFUQSAnICsgdGhpcy5uRGF0YTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgciArPSAnPic7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfTsKICAgICAgcmV0dXJuIFhNTERUREVudGl0eTsKICAgIH0pKCk7CiAgfSkuY2FsbCh0aGlzKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERUREVsZW1lbnQiLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTERUREVsZW1lbnQsCiAgICAgICAgY3JlYXRlLAogICAgICAgIGlzQXJyYXk7CiAgICBjcmVhdGUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiKTsKICAgIGlzQXJyYXkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxEVERFbGVtZW50ID0gKGZ1bmN0aW9uKCkgewogICAgICBmdW5jdGlvbiBYTUxEVERFbGVtZW50KHBhcmVudCwgbmFtZSwgdmFsdWUpIHsKICAgICAgICB0aGlzLnN0cmluZ2lmeSA9IHBhcmVudC5zdHJpbmdpZnk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIERURCBlbGVtZW50IG5hbWUiKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF2YWx1ZSkgewogICAgICAgICAgdmFsdWUgPSAnKCNQQ0RBVEEpJzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICB2YWx1ZSA9ICcoJyArIHZhbHVlLmpvaW4oJywnKSArICcpJzsKICAgICAgICB9CiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5zdHJpbmdpZnkuZWxlTmFtZShuYW1lKTsKICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5zdHJpbmdpZnkuZHRkRWxlbWVudFZhbHVlKHZhbHVlKTsKICAgICAgfQogICAgICBYTUxEVERFbGVtZW50LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoWE1MRFRERWxlbWVudC5wcm90b3R5cGUsIHRoaXMpOwogICAgICB9OwogICAgICBYTUxEVERFbGVtZW50LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKG9wdGlvbnMsIGxldmVsKSB7CiAgICAgICAgdmFyIGluZGVudCwKICAgICAgICAgICAgbmV3bGluZSwKICAgICAgICAgICAgb2Zmc2V0LAogICAgICAgICAgICBwcmV0dHksCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgcmVmMSwKICAgICAgICAgICAgcmVmMiwKICAgICAgICAgICAgc3BhY2U7CiAgICAgICAgcHJldHR5ID0gKG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMucHJldHR5IDogdm9pZCAwKSB8fCBmYWxzZTsKICAgICAgICBpbmRlbnQgPSAocmVmID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5pbmRlbnQgOiB2b2lkIDApICE9IG51bGwgPyByZWYgOiAnICAnOwogICAgICAgIG9mZnNldCA9IChyZWYxID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5vZmZzZXQgOiB2b2lkIDApICE9IG51bGwgPyByZWYxIDogMDsKICAgICAgICBuZXdsaW5lID0gKHJlZjIgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLm5ld2xpbmUgOiB2b2lkIDApICE9IG51bGwgPyByZWYyIDogJ1xuJzsKICAgICAgICBsZXZlbCB8fCAobGV2ZWwgPSAwKTsKICAgICAgICBzcGFjZSA9IG5ldyBBcnJheShsZXZlbCArIG9mZnNldCArIDEpLmpvaW4oaW5kZW50KTsKICAgICAgICByID0gJyc7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBzcGFjZTsKICAgICAgICB9CiAgICAgICAgciArPSAnPCFFTEVNRU5UICcgKyB0aGlzLm5hbWUgKyAnICcgKyB0aGlzLnZhbHVlICsgJz4nOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gbmV3bGluZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH07CiAgICAgIHJldHVybiBYTUxEVERFbGVtZW50OwogICAgfSkoKTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRFRETm90YXRpb24iLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTERURE5vdGF0aW9uLAogICAgICAgIGNyZWF0ZTsKICAgIGNyZWF0ZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxEVEROb3RhdGlvbiA9IChmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gWE1MRFRETm90YXRpb24ocGFyZW50LCBuYW1lLCB2YWx1ZSkgewogICAgICAgIHRoaXMuc3RyaW5naWZ5ID0gcGFyZW50LnN0cmluZ2lmeTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1pc3Npbmcgbm90YXRpb24gbmFtZSIpOwogICAgICAgIH0KICAgICAgICBpZiAoIXZhbHVlLnB1YklEICYmICF2YWx1ZS5zeXNJRCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQdWJsaWMgb3Igc3lzdGVtIGlkZW50aWZpZXJzIGFyZSByZXF1aXJlZCBmb3IgYW4gZXh0ZXJuYWwgZW50aXR5Iik7CiAgICAgICAgfQogICAgICAgIHRoaXMubmFtZSA9IHRoaXMuc3RyaW5naWZ5LmVsZU5hbWUobmFtZSk7CiAgICAgICAgaWYgKHZhbHVlLnB1YklEICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMucHViSUQgPSB0aGlzLnN0cmluZ2lmeS5kdGRQdWJJRCh2YWx1ZS5wdWJJRCk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZS5zeXNJRCAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLnN5c0lEID0gdGhpcy5zdHJpbmdpZnkuZHRkU3lzSUQodmFsdWUuc3lzSUQpOwogICAgICAgIH0KICAgICAgfQogICAgICBYTUxEVEROb3RhdGlvbi5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKFhNTERURE5vdGF0aW9uLnByb3RvdHlwZSwgdGhpcyk7CiAgICAgIH07CiAgICAgIFhNTERURE5vdGF0aW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKG9wdGlvbnMsIGxldmVsKSB7CiAgICAgICAgdmFyIGluZGVudCwKICAgICAgICAgICAgbmV3bGluZSwKICAgICAgICAgICAgb2Zmc2V0LAogICAgICAgICAgICBwcmV0dHksCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgcmVmMSwKICAgICAgICAgICAgcmVmMiwKICAgICAgICAgICAgc3BhY2U7CiAgICAgICAgcHJldHR5ID0gKG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMucHJldHR5IDogdm9pZCAwKSB8fCBmYWxzZTsKICAgICAgICBpbmRlbnQgPSAocmVmID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5pbmRlbnQgOiB2b2lkIDApICE9IG51bGwgPyByZWYgOiAnICAnOwogICAgICAgIG9mZnNldCA9IChyZWYxID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5vZmZzZXQgOiB2b2lkIDApICE9IG51bGwgPyByZWYxIDogMDsKICAgICAgICBuZXdsaW5lID0gKHJlZjIgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLm5ld2xpbmUgOiB2b2lkIDApICE9IG51bGwgPyByZWYyIDogJ1xuJzsKICAgICAgICBsZXZlbCB8fCAobGV2ZWwgPSAwKTsKICAgICAgICBzcGFjZSA9IG5ldyBBcnJheShsZXZlbCArIG9mZnNldCArIDEpLmpvaW4oaW5kZW50KTsKICAgICAgICByID0gJyc7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBzcGFjZTsKICAgICAgICB9CiAgICAgICAgciArPSAnPCFOT1RBVElPTiAnICsgdGhpcy5uYW1lOwogICAgICAgIGlmICh0aGlzLnB1YklEICYmIHRoaXMuc3lzSUQpIHsKICAgICAgICAgIHIgKz0gJyBQVUJMSUMgIicgKyB0aGlzLnB1YklEICsgJyIgIicgKyB0aGlzLnN5c0lEICsgJyInOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5wdWJJRCkgewogICAgICAgICAgciArPSAnIFBVQkxJQyAiJyArIHRoaXMucHViSUQgKyAnIic7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN5c0lEKSB7CiAgICAgICAgICByICs9ICcgU1lTVEVNICInICsgdGhpcy5zeXNJRCArICciJzsKICAgICAgICB9CiAgICAgICAgciArPSAnPic7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfTsKICAgICAgcmV0dXJuIFhNTERURE5vdGF0aW9uOwogICAgfSkoKTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MUmF3IiwgWyJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiLCAibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTE5vZGUiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbigpIHsKICAgIHZhciBYTUxOb2RlLAogICAgICAgIFhNTFJhdywKICAgICAgICBjcmVhdGUsCiAgICAgICAgZXh0ZW5kID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIHBhcmVudCkgewogICAgICAgICAgICBpZiAoaGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkKICAgICAgICAgICAgICBjaGlsZFtrZXldID0gcGFyZW50W2tleV07CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjdG9yKCkgewogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICAgICAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOwogICAgICAgICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKICAgICAgICAgIHJldHVybiBjaGlsZDsKICAgICAgICB9LAogICAgICAgIGhhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKICAgIGNyZWF0ZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIpOwogICAgWE1MTm9kZSA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxOb2RlIik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFhNTFJhdyA9IChmdW5jdGlvbihzdXBlckNsYXNzKSB7CiAgICAgIGV4dGVuZChYTUxSYXcsIHN1cGVyQ2xhc3MpOwogICAgICBmdW5jdGlvbiBYTUxSYXcocGFyZW50LCB0ZXh0KSB7CiAgICAgICAgWE1MUmF3Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmVudCk7CiAgICAgICAgaWYgKHRleHQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIHJhdyB0ZXh0Iik7CiAgICAgICAgfQogICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnN0cmluZ2lmeS5yYXcodGV4dCk7CiAgICAgIH0KICAgICAgWE1MUmF3LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoWE1MUmF3LnByb3RvdHlwZSwgdGhpcyk7CiAgICAgIH07CiAgICAgIFhNTFJhdy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBpbmRlbnQsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gdGhpcy52YWx1ZTsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IG5ld2xpbmU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgICB9OwogICAgICByZXR1cm4gWE1MUmF3OwogICAgfSkoWE1MTm9kZSk7CiAgfSkuY2FsbCh0aGlzKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTFRleHQiLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MTm9kZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTE5vZGUsCiAgICAgICAgWE1MVGV4dCwKICAgICAgICBjcmVhdGUsCiAgICAgICAgZXh0ZW5kID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIHBhcmVudCkgewogICAgICAgICAgICBpZiAoaGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkKICAgICAgICAgICAgICBjaGlsZFtrZXldID0gcGFyZW50W2tleV07CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjdG9yKCkgewogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICAgICAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOwogICAgICAgICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKICAgICAgICAgIHJldHVybiBjaGlsZDsKICAgICAgICB9LAogICAgICAgIGhhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKICAgIGNyZWF0ZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIpOwogICAgWE1MTm9kZSA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxOb2RlIik7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFhNTFRleHQgPSAoZnVuY3Rpb24oc3VwZXJDbGFzcykgewogICAgICBleHRlbmQoWE1MVGV4dCwgc3VwZXJDbGFzcyk7CiAgICAgIGZ1bmN0aW9uIFhNTFRleHQocGFyZW50LCB0ZXh0KSB7CiAgICAgICAgWE1MVGV4dC5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwYXJlbnQpOwogICAgICAgIGlmICh0ZXh0ID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBlbGVtZW50IHRleHQiKTsKICAgICAgICB9CiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuc3RyaW5naWZ5LmVsZVRleHQodGV4dCk7CiAgICAgIH0KICAgICAgWE1MVGV4dC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKFhNTFRleHQucHJvdG90eXBlLCB0aGlzKTsKICAgICAgfTsKICAgICAgWE1MVGV4dC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBpbmRlbnQsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gdGhpcy52YWx1ZTsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IG5ld2xpbmU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgICB9OwogICAgICByZXR1cm4gWE1MVGV4dDsKICAgIH0pKFhNTE5vZGUpOwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTp4bWwyanNAMC40LjkvbGliL2JvbSIsIFsibnBtOnhtbDJqc0AwLjQuOS9saWIveG1sMmpzIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgeG1sMmpzOwogICAgeG1sMmpzID0gcmVxdWlyZSgibnBtOnhtbDJqc0AwLjQuOS9saWIveG1sMmpzIik7CiAgICBleHBvcnRzLnN0cmlwQk9NID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgIGlmIChzdHJbMF0gPT09ICdcdUZFRkYnKSB7CiAgICAgICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgfQogICAgfTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sMmpzQDAuNC45L2xpYi9wcm9jZXNzb3JzIiwgW10sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJlZml4TWF0Y2g7CiAgICBwcmVmaXhNYXRjaCA9IG5ldyBSZWdFeHAoLyg/IXhtbG5zKV4uKjovKTsKICAgIGV4cG9ydHMubm9ybWFsaXplID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgIHJldHVybiBzdHIudG9Mb3dlckNhc2UoKTsKICAgIH07CiAgICBleHBvcnRzLmZpcnN0Q2hhckxvd2VyQ2FzZSA9IGZ1bmN0aW9uKHN0cikgewogICAgICByZXR1cm4gc3RyLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgc3RyLnNsaWNlKDEpOwogICAgfTsKICAgIGV4cG9ydHMuc3RyaXBQcmVmaXggPSBmdW5jdGlvbihzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKHByZWZpeE1hdGNoLCAnJyk7CiAgICB9OwogICAgZXhwb3J0cy5wYXJzZU51bWJlcnMgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgaWYgKCFpc05hTihzdHIpKSB7CiAgICAgICAgc3RyID0gc3RyICUgMSA9PT0gMCA/IHBhcnNlSW50KHN0ciwgMTApIDogcGFyc2VGbG9hdChzdHIpOwogICAgICB9CiAgICAgIHJldHVybiBzdHI7CiAgICB9OwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW5kZXgiLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogICJmb3JtYXQgY2pzIjsKICAoZnVuY3Rpb24ocHJvY2VzcykgewogICAgOwogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgdW5kZWZpbmVkOwogICAgICB2YXIgVkVSU0lPTiA9ICczLjkuMyc7CiAgICAgIHZhciBCSU5EX0ZMQUcgPSAxLAogICAgICAgICAgQklORF9LRVlfRkxBRyA9IDIsCiAgICAgICAgICBDVVJSWV9CT1VORF9GTEFHID0gNCwKICAgICAgICAgIENVUlJZX0ZMQUcgPSA4LAogICAgICAgICAgQ1VSUllfUklHSFRfRkxBRyA9IDE2LAogICAgICAgICAgUEFSVElBTF9GTEFHID0gMzIsCiAgICAgICAgICBQQVJUSUFMX1JJR0hUX0ZMQUcgPSA2NCwKICAgICAgICAgIEFSWV9GTEFHID0gMTI4LAogICAgICAgICAgUkVBUkdfRkxBRyA9IDI1NjsKICAgICAgdmFyIERFRkFVTFRfVFJVTkNfTEVOR1RIID0gMzAsCiAgICAgICAgICBERUZBVUxUX1RSVU5DX09NSVNTSU9OID0gJy4uLic7CiAgICAgIHZhciBIT1RfQ09VTlQgPSAxNTAsCiAgICAgICAgICBIT1RfU1BBTiA9IDE2OwogICAgICB2YXIgTEFaWV9EUk9QX1dISUxFX0ZMQUcgPSAwLAogICAgICAgICAgTEFaWV9GSUxURVJfRkxBRyA9IDEsCiAgICAgICAgICBMQVpZX01BUF9GTEFHID0gMjsKICAgICAgdmFyIEZVTkNfRVJST1JfVEVYVCA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJzsKICAgICAgdmFyIFBMQUNFSE9MREVSID0gJ19fbG9kYXNoX3BsYWNlaG9sZGVyX18nOwogICAgICB2YXIgYXJnc1RhZyA9ICdbb2JqZWN0IEFyZ3VtZW50c10nLAogICAgICAgICAgYXJyYXlUYWcgPSAnW29iamVjdCBBcnJheV0nLAogICAgICAgICAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJywKICAgICAgICAgIGRhdGVUYWcgPSAnW29iamVjdCBEYXRlXScsCiAgICAgICAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsCiAgICAgICAgICBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJywKICAgICAgICAgIG1hcFRhZyA9ICdbb2JqZWN0IE1hcF0nLAogICAgICAgICAgbnVtYmVyVGFnID0gJ1tvYmplY3QgTnVtYmVyXScsCiAgICAgICAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJywKICAgICAgICAgIHJlZ2V4cFRhZyA9ICdbb2JqZWN0IFJlZ0V4cF0nLAogICAgICAgICAgc2V0VGFnID0gJ1tvYmplY3QgU2V0XScsCiAgICAgICAgICBzdHJpbmdUYWcgPSAnW29iamVjdCBTdHJpbmddJywKICAgICAgICAgIHdlYWtNYXBUYWcgPSAnW29iamVjdCBXZWFrTWFwXSc7CiAgICAgIHZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsCiAgICAgICAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsCiAgICAgICAgICBmbG9hdDY0VGFnID0gJ1tvYmplY3QgRmxvYXQ2NEFycmF5XScsCiAgICAgICAgICBpbnQ4VGFnID0gJ1tvYmplY3QgSW50OEFycmF5XScsCiAgICAgICAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJywKICAgICAgICAgIGludDMyVGFnID0gJ1tvYmplY3QgSW50MzJBcnJheV0nLAogICAgICAgICAgdWludDhUYWcgPSAnW29iamVjdCBVaW50OEFycmF5XScsCiAgICAgICAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLAogICAgICAgICAgdWludDE2VGFnID0gJ1tvYmplY3QgVWludDE2QXJyYXldJywKICAgICAgICAgIHVpbnQzMlRhZyA9ICdbb2JqZWN0IFVpbnQzMkFycmF5XSc7CiAgICAgIHZhciByZUVtcHR5U3RyaW5nTGVhZGluZyA9IC9cYl9fcCBcKz0gJyc7L2csCiAgICAgICAgICByZUVtcHR5U3RyaW5nTWlkZGxlID0gL1xiKF9fcCBcKz0pICcnIFwrL2csCiAgICAgICAgICByZUVtcHR5U3RyaW5nVHJhaWxpbmcgPSAvKF9fZVwoLio/XCl8XGJfX3RcKSkgXCtcbicnOy9nOwogICAgICB2YXIgcmVFc2NhcGVkSHRtbCA9IC8mKD86YW1wfGx0fGd0fHF1b3R8IzM5fCM5Nik7L2csCiAgICAgICAgICByZVVuZXNjYXBlZEh0bWwgPSAvWyY8PiInYF0vZywKICAgICAgICAgIHJlSGFzRXNjYXBlZEh0bWwgPSBSZWdFeHAocmVFc2NhcGVkSHRtbC5zb3VyY2UpLAogICAgICAgICAgcmVIYXNVbmVzY2FwZWRIdG1sID0gUmVnRXhwKHJlVW5lc2NhcGVkSHRtbC5zb3VyY2UpOwogICAgICB2YXIgcmVFc2NhcGUgPSAvPCUtKFtcc1xTXSs/KSU+L2csCiAgICAgICAgICByZUV2YWx1YXRlID0gLzwlKFtcc1xTXSs/KSU+L2csCiAgICAgICAgICByZUludGVycG9sYXRlID0gLzwlPShbXHNcU10rPyklPi9nOwogICAgICB2YXIgcmVJc0RlZXBQcm9wID0gL1wufFxbKD86W15bXF1dKnwoWyInXSkoPzooPyFcMSlbXlxuXFxdfFxcLikqP1wxKVxdLywKICAgICAgICAgIHJlSXNQbGFpblByb3AgPSAvXlx3KiQvLAogICAgICAgICAgcmVQcm9wTmFtZSA9IC9bXi5bXF1dK3xcWyg/OigtP1xkKyg/OlwuXGQrKT8pfChbIiddKSgoPzooPyFcMilbXlxuXFxdfFxcLikqPylcMilcXS9nOwogICAgICB2YXIgcmVSZWdFeHBDaGFycyA9IC9bLiorP14ke30oKXxbXF1cL1xcXS9nLAogICAgICAgICAgcmVIYXNSZWdFeHBDaGFycyA9IFJlZ0V4cChyZVJlZ0V4cENoYXJzLnNvdXJjZSk7CiAgICAgIHZhciByZUNvbWJvTWFyayA9IC9bXHUwMzAwLVx1MDM2Zlx1ZmUyMC1cdWZlMjNdL2c7CiAgICAgIHZhciByZUVzY2FwZUNoYXIgPSAvXFwoXFwpPy9nOwogICAgICB2YXIgcmVFc1RlbXBsYXRlID0gL1wkXHsoW15cXH1dKig/OlxcLlteXFx9XSopKilcfS9nOwogICAgICB2YXIgcmVGbGFncyA9IC9cdyokLzsKICAgICAgdmFyIHJlSGFzSGV4UHJlZml4ID0gL14wW3hYXS87CiAgICAgIHZhciByZUlzSG9zdEN0b3IgPSAvXlxbb2JqZWN0IC4rP0NvbnN0cnVjdG9yXF0kLzsKICAgICAgdmFyIHJlSXNVaW50ID0gL15cZCskLzsKICAgICAgdmFyIHJlTGF0aW4xID0gL1tceGMwLVx4ZDZceGQ4LVx4ZGVceGRmLVx4ZjZceGY4LVx4ZmZdL2c7CiAgICAgIHZhciByZU5vTWF0Y2ggPSAvKCReKS87CiAgICAgIHZhciByZVVuZXNjYXBlZFN0cmluZyA9IC9bJ1xuXHJcdTIwMjhcdTIwMjlcXF0vZzsKICAgICAgdmFyIHJlV29yZHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHVwcGVyID0gJ1tBLVpcXHhjMC1cXHhkNlxceGQ4LVxceGRlXScsCiAgICAgICAgICAgIGxvd2VyID0gJ1thLXpcXHhkZi1cXHhmNlxceGY4LVxceGZmXSsnOwogICAgICAgIHJldHVybiBSZWdFeHAodXBwZXIgKyAnKyg/PScgKyB1cHBlciArIGxvd2VyICsgJyl8JyArIHVwcGVyICsgJz8nICsgbG93ZXIgKyAnfCcgKyB1cHBlciArICcrfFswLTldKycsICdnJyk7CiAgICAgIH0oKSk7CiAgICAgIHZhciB3aGl0ZXNwYWNlID0gKCcgXHRceDBiXGZceGEwXHVmZWZmJyArICdcblxyXHUyMDI4XHUyMDI5JyArICdcdTE2ODBcdTE4MGVcdTIwMDBcdTIwMDFcdTIwMDJcdTIwMDNcdTIwMDRcdTIwMDVcdTIwMDZcdTIwMDdcdTIwMDhcdTIwMDlcdTIwMGFcdTIwMmZcdTIwNWZcdTMwMDAnKTsKICAgICAgdmFyIGNvbnRleHRQcm9wcyA9IFsnQXJyYXknLCAnQXJyYXlCdWZmZXInLCAnRGF0ZScsICdFcnJvcicsICdGbG9hdDMyQXJyYXknLCAnRmxvYXQ2NEFycmF5JywgJ0Z1bmN0aW9uJywgJ0ludDhBcnJheScsICdJbnQxNkFycmF5JywgJ0ludDMyQXJyYXknLCAnTWF0aCcsICdOdW1iZXInLCAnT2JqZWN0JywgJ1JlZ0V4cCcsICdTZXQnLCAnU3RyaW5nJywgJ18nLCAnY2xlYXJUaW1lb3V0JywgJ2RvY3VtZW50JywgJ2lzRmluaXRlJywgJ3BhcnNlRmxvYXQnLCAncGFyc2VJbnQnLCAnc2V0VGltZW91dCcsICdUeXBlRXJyb3InLCAnVWludDhBcnJheScsICdVaW50OENsYW1wZWRBcnJheScsICdVaW50MTZBcnJheScsICdVaW50MzJBcnJheScsICdXZWFrTWFwJywgJ3dpbmRvdyddOwogICAgICB2YXIgdGVtcGxhdGVDb3VudGVyID0gLTE7CiAgICAgIHZhciB0eXBlZEFycmF5VGFncyA9IHt9OwogICAgICB0eXBlZEFycmF5VGFnc1tmbG9hdDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Zsb2F0NjRUYWddID0gdHlwZWRBcnJheVRhZ3NbaW50OFRhZ10gPSB0eXBlZEFycmF5VGFnc1tpbnQxNlRhZ10gPSB0eXBlZEFycmF5VGFnc1tpbnQzMlRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50OFRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50OENsYW1wZWRUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDE2VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQzMlRhZ10gPSB0cnVlOwogICAgICB0eXBlZEFycmF5VGFnc1thcmdzVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2FycmF5VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2FycmF5QnVmZmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Jvb2xUYWddID0gdHlwZWRBcnJheVRhZ3NbZGF0ZVRhZ10gPSB0eXBlZEFycmF5VGFnc1tlcnJvclRhZ10gPSB0eXBlZEFycmF5VGFnc1tmdW5jVGFnXSA9IHR5cGVkQXJyYXlUYWdzW21hcFRhZ10gPSB0eXBlZEFycmF5VGFnc1tudW1iZXJUYWddID0gdHlwZWRBcnJheVRhZ3Nbb2JqZWN0VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3JlZ2V4cFRhZ10gPSB0eXBlZEFycmF5VGFnc1tzZXRUYWddID0gdHlwZWRBcnJheVRhZ3Nbc3RyaW5nVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CiAgICAgIHZhciBjbG9uZWFibGVUYWdzID0ge307CiAgICAgIGNsb25lYWJsZVRhZ3NbYXJnc1RhZ10gPSBjbG9uZWFibGVUYWdzW2FycmF5VGFnXSA9IGNsb25lYWJsZVRhZ3NbYXJyYXlCdWZmZXJUYWddID0gY2xvbmVhYmxlVGFnc1tib29sVGFnXSA9IGNsb25lYWJsZVRhZ3NbZGF0ZVRhZ10gPSBjbG9uZWFibGVUYWdzW2Zsb2F0MzJUYWddID0gY2xvbmVhYmxlVGFnc1tmbG9hdDY0VGFnXSA9IGNsb25lYWJsZVRhZ3NbaW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW2ludDE2VGFnXSA9IGNsb25lYWJsZVRhZ3NbaW50MzJUYWddID0gY2xvbmVhYmxlVGFnc1tudW1iZXJUYWddID0gY2xvbmVhYmxlVGFnc1tvYmplY3RUYWddID0gY2xvbmVhYmxlVGFnc1tyZWdleHBUYWddID0gY2xvbmVhYmxlVGFnc1tzdHJpbmdUYWddID0gY2xvbmVhYmxlVGFnc1t1aW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQxNlRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQzMlRhZ10gPSB0cnVlOwogICAgICBjbG9uZWFibGVUYWdzW2Vycm9yVGFnXSA9IGNsb25lYWJsZVRhZ3NbZnVuY1RhZ10gPSBjbG9uZWFibGVUYWdzW21hcFRhZ10gPSBjbG9uZWFibGVUYWdzW3NldFRhZ10gPSBjbG9uZWFibGVUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CiAgICAgIHZhciBkZWJvdW5jZU9wdGlvbnMgPSB7CiAgICAgICAgJ2xlYWRpbmcnOiBmYWxzZSwKICAgICAgICAnbWF4V2FpdCc6IDAsCiAgICAgICAgJ3RyYWlsaW5nJzogZmFsc2UKICAgICAgfTsKICAgICAgdmFyIGRlYnVycmVkTGV0dGVycyA9IHsKICAgICAgICAnXHhjMCc6ICdBJywKICAgICAgICAnXHhjMSc6ICdBJywKICAgICAgICAnXHhjMic6ICdBJywKICAgICAgICAnXHhjMyc6ICdBJywKICAgICAgICAnXHhjNCc6ICdBJywKICAgICAgICAnXHhjNSc6ICdBJywKICAgICAgICAnXHhlMCc6ICdhJywKICAgICAgICAnXHhlMSc6ICdhJywKICAgICAgICAnXHhlMic6ICdhJywKICAgICAgICAnXHhlMyc6ICdhJywKICAgICAgICAnXHhlNCc6ICdhJywKICAgICAgICAnXHhlNSc6ICdhJywKICAgICAgICAnXHhjNyc6ICdDJywKICAgICAgICAnXHhlNyc6ICdjJywKICAgICAgICAnXHhkMCc6ICdEJywKICAgICAgICAnXHhmMCc6ICdkJywKICAgICAgICAnXHhjOCc6ICdFJywKICAgICAgICAnXHhjOSc6ICdFJywKICAgICAgICAnXHhjYSc6ICdFJywKICAgICAgICAnXHhjYic6ICdFJywKICAgICAgICAnXHhlOCc6ICdlJywKICAgICAgICAnXHhlOSc6ICdlJywKICAgICAgICAnXHhlYSc6ICdlJywKICAgICAgICAnXHhlYic6ICdlJywKICAgICAgICAnXHhjQyc6ICdJJywKICAgICAgICAnXHhjZCc6ICdJJywKICAgICAgICAnXHhjZSc6ICdJJywKICAgICAgICAnXHhjZic6ICdJJywKICAgICAgICAnXHhlQyc6ICdpJywKICAgICAgICAnXHhlZCc6ICdpJywKICAgICAgICAnXHhlZSc6ICdpJywKICAgICAgICAnXHhlZic6ICdpJywKICAgICAgICAnXHhkMSc6ICdOJywKICAgICAgICAnXHhmMSc6ICduJywKICAgICAgICAnXHhkMic6ICdPJywKICAgICAgICAnXHhkMyc6ICdPJywKICAgICAgICAnXHhkNCc6ICdPJywKICAgICAgICAnXHhkNSc6ICdPJywKICAgICAgICAnXHhkNic6ICdPJywKICAgICAgICAnXHhkOCc6ICdPJywKICAgICAgICAnXHhmMic6ICdvJywKICAgICAgICAnXHhmMyc6ICdvJywKICAgICAgICAnXHhmNCc6ICdvJywKICAgICAgICAnXHhmNSc6ICdvJywKICAgICAgICAnXHhmNic6ICdvJywKICAgICAgICAnXHhmOCc6ICdvJywKICAgICAgICAnXHhkOSc6ICdVJywKICAgICAgICAnXHhkYSc6ICdVJywKICAgICAgICAnXHhkYic6ICdVJywKICAgICAgICAnXHhkYyc6ICdVJywKICAgICAgICAnXHhmOSc6ICd1JywKICAgICAgICAnXHhmYSc6ICd1JywKICAgICAgICAnXHhmYic6ICd1JywKICAgICAgICAnXHhmYyc6ICd1JywKICAgICAgICAnXHhkZCc6ICdZJywKICAgICAgICAnXHhmZCc6ICd5JywKICAgICAgICAnXHhmZic6ICd5JywKICAgICAgICAnXHhjNic6ICdBZScsCiAgICAgICAgJ1x4ZTYnOiAnYWUnLAogICAgICAgICdceGRlJzogJ1RoJywKICAgICAgICAnXHhmZSc6ICd0aCcsCiAgICAgICAgJ1x4ZGYnOiAnc3MnCiAgICAgIH07CiAgICAgIHZhciBodG1sRXNjYXBlcyA9IHsKICAgICAgICAnJic6ICcmYW1wOycsCiAgICAgICAgJzwnOiAnJmx0OycsCiAgICAgICAgJz4nOiAnJmd0OycsCiAgICAgICAgJyInOiAnJnF1b3Q7JywKICAgICAgICAiJyI6ICcmIzM5OycsCiAgICAgICAgJ2AnOiAnJiM5NjsnCiAgICAgIH07CiAgICAgIHZhciBodG1sVW5lc2NhcGVzID0gewogICAgICAgICcmYW1wOyc6ICcmJywKICAgICAgICAnJmx0Oyc6ICc8JywKICAgICAgICAnJmd0Oyc6ICc+JywKICAgICAgICAnJnF1b3Q7JzogJyInLAogICAgICAgICcmIzM5Oyc6ICInIiwKICAgICAgICAnJiM5NjsnOiAnYCcKICAgICAgfTsKICAgICAgdmFyIG9iamVjdFR5cGVzID0gewogICAgICAgICdmdW5jdGlvbic6IHRydWUsCiAgICAgICAgJ29iamVjdCc6IHRydWUKICAgICAgfTsKICAgICAgdmFyIHN0cmluZ0VzY2FwZXMgPSB7CiAgICAgICAgJ1xcJzogJ1xcJywKICAgICAgICAiJyI6ICInIiwKICAgICAgICAnXG4nOiAnbicsCiAgICAgICAgJ1xyJzogJ3InLAogICAgICAgICdcdTIwMjgnOiAndTIwMjgnLAogICAgICAgICdcdTIwMjknOiAndTIwMjknCiAgICAgIH07CiAgICAgIHZhciBmcmVlRXhwb3J0cyA9IG9iamVjdFR5cGVzW3R5cGVvZiBleHBvcnRzXSAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHM7CiAgICAgIHZhciBmcmVlTW9kdWxlID0gb2JqZWN0VHlwZXNbdHlwZW9mIG1vZHVsZV0gJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlOwogICAgICB2YXIgZnJlZUdsb2JhbCA9IGZyZWVFeHBvcnRzICYmIGZyZWVNb2R1bGUgJiYgdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCAmJiBnbG9iYWw7CiAgICAgIHZhciBmcmVlU2VsZiA9IG9iamVjdFR5cGVzW3R5cGVvZiBzZWxmXSAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ICYmIHNlbGY7CiAgICAgIHZhciBmcmVlV2luZG93ID0gb2JqZWN0VHlwZXNbdHlwZW9mIHdpbmRvd10gJiYgd2luZG93ICYmIHdpbmRvdy5PYmplY3QgJiYgd2luZG93OwogICAgICB2YXIgbW9kdWxlRXhwb3J0cyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5leHBvcnRzID09PSBmcmVlRXhwb3J0cyAmJiBmcmVlRXhwb3J0czsKICAgICAgdmFyIHJvb3QgPSBmcmVlR2xvYmFsIHx8ICgoZnJlZVdpbmRvdyAhPT0gKHRoaXMgJiYgdGhpcy53aW5kb3cpKSAmJiBmcmVlV2luZG93KSB8fCBmcmVlU2VsZiB8fCB0aGlzOwogICAgICBmdW5jdGlvbiBiYXNlQ29tcGFyZUFzY2VuZGluZyh2YWx1ZSwgb3RoZXIpIHsKICAgICAgICBpZiAodmFsdWUgIT09IG90aGVyKSB7CiAgICAgICAgICB2YXIgdmFsSXNOdWxsID0gdmFsdWUgPT09IG51bGwsCiAgICAgICAgICAgICAgdmFsSXNVbmRlZiA9IHZhbHVlID09PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgdmFsSXNSZWZsZXhpdmUgPSB2YWx1ZSA9PT0gdmFsdWU7CiAgICAgICAgICB2YXIgb3RoSXNOdWxsID0gb3RoZXIgPT09IG51bGwsCiAgICAgICAgICAgICAgb3RoSXNVbmRlZiA9IG90aGVyID09PSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgb3RoSXNSZWZsZXhpdmUgPSBvdGhlciA9PT0gb3RoZXI7CiAgICAgICAgICBpZiAoKHZhbHVlID4gb3RoZXIgJiYgIW90aElzTnVsbCkgfHwgIXZhbElzUmVmbGV4aXZlIHx8ICh2YWxJc051bGwgJiYgIW90aElzVW5kZWYgJiYgb3RoSXNSZWZsZXhpdmUpIHx8ICh2YWxJc1VuZGVmICYmIG90aElzUmVmbGV4aXZlKSkgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgodmFsdWUgPCBvdGhlciAmJiAhdmFsSXNOdWxsKSB8fCAhb3RoSXNSZWZsZXhpdmUgfHwgKG90aElzTnVsbCAmJiAhdmFsSXNVbmRlZiAmJiB2YWxJc1JlZmxleGl2ZSkgfHwgKG90aElzVW5kZWYgJiYgdmFsSXNSZWZsZXhpdmUpKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmFzZUZpbmRJbmRleChhcnJheSwgcHJlZGljYXRlLCBmcm9tUmlnaHQpIHsKICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xOwogICAgICAgIHdoaWxlICgoZnJvbVJpZ2h0ID8gaW5kZXgtLSA6ICsraW5kZXggPCBsZW5ndGgpKSB7CiAgICAgICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBiYXNlSW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkgewogICAgICAgIGlmICh2YWx1ZSAhPT0gdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBpbmRleE9mTmFOKGFycmF5LCBmcm9tSW5kZXgpOwogICAgICAgIH0KICAgICAgICB2YXIgaW5kZXggPSBmcm9tSW5kZXggLSAxLAogICAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgIGlmIChhcnJheVtpbmRleF0gPT09IHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJhc2VJc0Z1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nIHx8IGZhbHNlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJhc2VUb1N0cmluZyh2YWx1ZSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyAnJyA6ICh2YWx1ZSArICcnKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjaGFyc0xlZnRJbmRleChzdHJpbmcsIGNoYXJzKSB7CiAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgIGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7CiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGggJiYgY2hhcnMuaW5kZXhPZihzdHJpbmcuY2hhckF0KGluZGV4KSkgPiAtMSkge30KICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2hhcnNSaWdodEluZGV4KHN0cmluZywgY2hhcnMpIHsKICAgICAgICB2YXIgaW5kZXggPSBzdHJpbmcubGVuZ3RoOwogICAgICAgIHdoaWxlIChpbmRleC0tICYmIGNoYXJzLmluZGV4T2Yoc3RyaW5nLmNoYXJBdChpbmRleCkpID4gLTEpIHt9CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNvbXBhcmVBc2NlbmRpbmcob2JqZWN0LCBvdGhlcikgewogICAgICAgIHJldHVybiBiYXNlQ29tcGFyZUFzY2VuZGluZyhvYmplY3QuY3JpdGVyaWEsIG90aGVyLmNyaXRlcmlhKSB8fCAob2JqZWN0LmluZGV4IC0gb3RoZXIuaW5kZXgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNvbXBhcmVNdWx0aXBsZShvYmplY3QsIG90aGVyLCBvcmRlcnMpIHsKICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgb2JqQ3JpdGVyaWEgPSBvYmplY3QuY3JpdGVyaWEsCiAgICAgICAgICAgIG90aENyaXRlcmlhID0gb3RoZXIuY3JpdGVyaWEsCiAgICAgICAgICAgIGxlbmd0aCA9IG9iakNyaXRlcmlhLmxlbmd0aCwKICAgICAgICAgICAgb3JkZXJzTGVuZ3RoID0gb3JkZXJzLmxlbmd0aDsKICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IGJhc2VDb21wYXJlQXNjZW5kaW5nKG9iakNyaXRlcmlhW2luZGV4XSwgb3RoQ3JpdGVyaWFbaW5kZXhdKTsKICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKGluZGV4ID49IG9yZGVyc0xlbmd0aCkgewogICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCAqIChvcmRlcnNbaW5kZXhdID8gMSA6IC0xKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9iamVjdC5pbmRleCAtIG90aGVyLmluZGV4OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlYnVyckxldHRlcihsZXR0ZXIpIHsKICAgICAgICByZXR1cm4gZGVidXJyZWRMZXR0ZXJzW2xldHRlcl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXNjYXBlSHRtbENoYXIoY2hyKSB7CiAgICAgICAgcmV0dXJuIGh0bWxFc2NhcGVzW2Nocl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXNjYXBlU3RyaW5nQ2hhcihjaHIpIHsKICAgICAgICByZXR1cm4gJ1xcJyArIHN0cmluZ0VzY2FwZXNbY2hyXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbmRleE9mTmFOKGFycmF5LCBmcm9tSW5kZXgsIGZyb21SaWdodCkgewogICAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgICAgIGluZGV4ID0gZnJvbUluZGV4ICsgKGZyb21SaWdodCA/IDAgOiAtMSk7CiAgICAgICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgICAgIHZhciBvdGhlciA9IGFycmF5W2luZGV4XTsKICAgICAgICAgIGlmIChvdGhlciAhPT0gb3RoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGlzU3BhY2UoY2hhckNvZGUpIHsKICAgICAgICByZXR1cm4gKChjaGFyQ29kZSA8PSAxNjAgJiYgKGNoYXJDb2RlID49IDkgJiYgY2hhckNvZGUgPD0gMTMpIHx8IGNoYXJDb2RlID09IDMyIHx8IGNoYXJDb2RlID09IDE2MCkgfHwgY2hhckNvZGUgPT0gNTc2MCB8fCBjaGFyQ29kZSA9PSA2MTU4IHx8IChjaGFyQ29kZSA+PSA4MTkyICYmIChjaGFyQ29kZSA8PSA4MjAyIHx8IGNoYXJDb2RlID09IDgyMzIgfHwgY2hhckNvZGUgPT0gODIzMyB8fCBjaGFyQ29kZSA9PSA4MjM5IHx8IGNoYXJDb2RlID09IDgyODcgfHwgY2hhckNvZGUgPT0gMTIyODggfHwgY2hhckNvZGUgPT0gNjUyNzkpKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcmVwbGFjZUhvbGRlcnMoYXJyYXksIHBsYWNlaG9sZGVyKSB7CiAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICAgICAgcmVzSW5kZXggPSAtMSwKICAgICAgICAgICAgcmVzdWx0ID0gW107CiAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgIGlmIChhcnJheVtpbmRleF0gPT09IHBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAgIGFycmF5W2luZGV4XSA9IFBMQUNFSE9MREVSOwogICAgICAgICAgICByZXN1bHRbKytyZXNJbmRleF0gPSBpbmRleDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICBmdW5jdGlvbiBzb3J0ZWRVbmlxKGFycmF5LCBpdGVyYXRlZSkgewogICAgICAgIHZhciBzZWVuLAogICAgICAgICAgICBpbmRleCA9IC0xLAogICAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgICAgIHJlc0luZGV4ID0gLTEsCiAgICAgICAgICAgIHJlc3VsdCA9IFtdOwogICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA/IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgYXJyYXkpIDogdmFsdWU7CiAgICAgICAgICBpZiAoIWluZGV4IHx8IHNlZW4gIT09IGNvbXB1dGVkKSB7CiAgICAgICAgICAgIHNlZW4gPSBjb21wdXRlZDsKICAgICAgICAgICAgcmVzdWx0WysrcmVzSW5kZXhdID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdHJpbW1lZExlZnRJbmRleChzdHJpbmcpIHsKICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsKICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCAmJiBpc1NwYWNlKHN0cmluZy5jaGFyQ29kZUF0KGluZGV4KSkpIHt9CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHRyaW1tZWRSaWdodEluZGV4KHN0cmluZykgewogICAgICAgIHZhciBpbmRleCA9IHN0cmluZy5sZW5ndGg7CiAgICAgICAgd2hpbGUgKGluZGV4LS0gJiYgaXNTcGFjZShzdHJpbmcuY2hhckNvZGVBdChpbmRleCkpKSB7fQogICAgICAgIHJldHVybiBpbmRleDsKICAgICAgfQogICAgICBmdW5jdGlvbiB1bmVzY2FwZUh0bWxDaGFyKGNocikgewogICAgICAgIHJldHVybiBodG1sVW5lc2NhcGVzW2Nocl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcnVuSW5Db250ZXh0KGNvbnRleHQpIHsKICAgICAgICBjb250ZXh0ID0gY29udGV4dCA/IF8uZGVmYXVsdHMocm9vdC5PYmplY3QoKSwgY29udGV4dCwgXy5waWNrKHJvb3QsIGNvbnRleHRQcm9wcykpIDogcm9vdDsKICAgICAgICB2YXIgQXJyYXkgPSBjb250ZXh0LkFycmF5LAogICAgICAgICAgICBEYXRlID0gY29udGV4dC5EYXRlLAogICAgICAgICAgICBFcnJvciA9IGNvbnRleHQuRXJyb3IsCiAgICAgICAgICAgIEZ1bmN0aW9uID0gY29udGV4dC5GdW5jdGlvbiwKICAgICAgICAgICAgTWF0aCA9IGNvbnRleHQuTWF0aCwKICAgICAgICAgICAgTnVtYmVyID0gY29udGV4dC5OdW1iZXIsCiAgICAgICAgICAgIE9iamVjdCA9IGNvbnRleHQuT2JqZWN0LAogICAgICAgICAgICBSZWdFeHAgPSBjb250ZXh0LlJlZ0V4cCwKICAgICAgICAgICAgU3RyaW5nID0gY29udGV4dC5TdHJpbmcsCiAgICAgICAgICAgIFR5cGVFcnJvciA9IGNvbnRleHQuVHlwZUVycm9yOwogICAgICAgIHZhciBhcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlLAogICAgICAgICAgICBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGUsCiAgICAgICAgICAgIHN0cmluZ1Byb3RvID0gU3RyaW5nLnByb3RvdHlwZTsKICAgICAgICB2YXIgZG9jdW1lbnQgPSAoZG9jdW1lbnQgPSBjb250ZXh0LndpbmRvdykgPyBkb2N1bWVudC5kb2N1bWVudCA6IG51bGw7CiAgICAgICAgdmFyIGZuVG9TdHJpbmcgPSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmc7CiAgICAgICAgdmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7CiAgICAgICAgdmFyIGlkQ291bnRlciA9IDA7CiAgICAgICAgdmFyIG9ialRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7CiAgICAgICAgdmFyIG9sZERhc2ggPSBjb250ZXh0Ll87CiAgICAgICAgdmFyIHJlSXNOYXRpdmUgPSBSZWdFeHAoJ14nICsgZXNjYXBlUmVnRXhwKGZuVG9TdHJpbmcuY2FsbChoYXNPd25Qcm9wZXJ0eSkpLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csICckMS4qPycpICsgJyQnKTsKICAgICAgICB2YXIgQXJyYXlCdWZmZXIgPSBnZXROYXRpdmUoY29udGV4dCwgJ0FycmF5QnVmZmVyJyksCiAgICAgICAgICAgIGJ1ZmZlclNsaWNlID0gZ2V0TmF0aXZlKEFycmF5QnVmZmVyICYmIG5ldyBBcnJheUJ1ZmZlcigwKSwgJ3NsaWNlJyksCiAgICAgICAgICAgIGNlaWwgPSBNYXRoLmNlaWwsCiAgICAgICAgICAgIGNsZWFyVGltZW91dCA9IGNvbnRleHQuY2xlYXJUaW1lb3V0LAogICAgICAgICAgICBmbG9vciA9IE1hdGguZmxvb3IsCiAgICAgICAgICAgIGdldFByb3RvdHlwZU9mID0gZ2V0TmF0aXZlKE9iamVjdCwgJ2dldFByb3RvdHlwZU9mJyksCiAgICAgICAgICAgIHBhcnNlRmxvYXQgPSBjb250ZXh0LnBhcnNlRmxvYXQsCiAgICAgICAgICAgIHB1c2ggPSBhcnJheVByb3RvLnB1c2gsCiAgICAgICAgICAgIFNldCA9IGdldE5hdGl2ZShjb250ZXh0LCAnU2V0JyksCiAgICAgICAgICAgIHNldFRpbWVvdXQgPSBjb250ZXh0LnNldFRpbWVvdXQsCiAgICAgICAgICAgIHNwbGljZSA9IGFycmF5UHJvdG8uc3BsaWNlLAogICAgICAgICAgICBVaW50OEFycmF5ID0gZ2V0TmF0aXZlKGNvbnRleHQsICdVaW50OEFycmF5JyksCiAgICAgICAgICAgIFdlYWtNYXAgPSBnZXROYXRpdmUoY29udGV4dCwgJ1dlYWtNYXAnKTsKICAgICAgICB2YXIgRmxvYXQ2NEFycmF5ID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGZ1bmMgPSBnZXROYXRpdmUoY29udGV4dCwgJ0Zsb2F0NjRBcnJheScpLAogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IGZ1bmMobmV3IEFycmF5QnVmZmVyKDEwKSwgMCwgMSkgJiYgZnVuYzsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICByZXR1cm4gcmVzdWx0IHx8IG51bGw7CiAgICAgICAgfSgpKTsKICAgICAgICB2YXIgbmF0aXZlQ3JlYXRlID0gZ2V0TmF0aXZlKE9iamVjdCwgJ2NyZWF0ZScpLAogICAgICAgICAgICBuYXRpdmVJc0FycmF5ID0gZ2V0TmF0aXZlKEFycmF5LCAnaXNBcnJheScpLAogICAgICAgICAgICBuYXRpdmVJc0Zpbml0ZSA9IGNvbnRleHQuaXNGaW5pdGUsCiAgICAgICAgICAgIG5hdGl2ZUtleXMgPSBnZXROYXRpdmUoT2JqZWN0LCAna2V5cycpLAogICAgICAgICAgICBuYXRpdmVNYXggPSBNYXRoLm1heCwKICAgICAgICAgICAgbmF0aXZlTWluID0gTWF0aC5taW4sCiAgICAgICAgICAgIG5hdGl2ZU5vdyA9IGdldE5hdGl2ZShEYXRlLCAnbm93JyksCiAgICAgICAgICAgIG5hdGl2ZU51bUlzRmluaXRlID0gZ2V0TmF0aXZlKE51bWJlciwgJ2lzRmluaXRlJyksCiAgICAgICAgICAgIG5hdGl2ZVBhcnNlSW50ID0gY29udGV4dC5wYXJzZUludCwKICAgICAgICAgICAgbmF0aXZlUmFuZG9tID0gTWF0aC5yYW5kb207CiAgICAgICAgdmFyIE5FR0FUSVZFX0lORklOSVRZID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLAogICAgICAgICAgICBQT1NJVElWRV9JTkZJTklUWSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsKICAgICAgICB2YXIgTUFYX0FSUkFZX0xFTkdUSCA9IDQyOTQ5NjcyOTUsCiAgICAgICAgICAgIE1BWF9BUlJBWV9JTkRFWCA9IE1BWF9BUlJBWV9MRU5HVEggLSAxLAogICAgICAgICAgICBIQUxGX01BWF9BUlJBWV9MRU5HVEggPSBNQVhfQVJSQVlfTEVOR1RIID4+PiAxOwogICAgICAgIHZhciBGTE9BVDY0X0JZVEVTX1BFUl9FTEVNRU5UID0gRmxvYXQ2NEFycmF5ID8gRmxvYXQ2NEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UIDogMDsKICAgICAgICB2YXIgTUFYX1NBRkVfSU5URUdFUiA9IDkwMDcxOTkyNTQ3NDA5OTE7CiAgICAgICAgdmFyIG1ldGFNYXAgPSBXZWFrTWFwICYmIG5ldyBXZWFrTWFwOwogICAgICAgIHZhciByZWFsTmFtZXMgPSB7fTsKICAgICAgICBmdW5jdGlvbiBsb2Rhc2godmFsdWUpIHsKICAgICAgICAgIGlmIChpc09iamVjdExpa2UodmFsdWUpICYmICFpc0FycmF5KHZhbHVlKSAmJiAhKHZhbHVlIGluc3RhbmNlb2YgTGF6eVdyYXBwZXIpKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExvZGFzaFdyYXBwZXIpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdfX2NoYWluX18nKSAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCAnX193cmFwcGVkX18nKSkgewogICAgICAgICAgICAgIHJldHVybiB3cmFwcGVyQ2xvbmUodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IExvZGFzaFdyYXBwZXIodmFsdWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlTG9kYXNoKCkge30KICAgICAgICBmdW5jdGlvbiBMb2Rhc2hXcmFwcGVyKHZhbHVlLCBjaGFpbkFsbCwgYWN0aW9ucykgewogICAgICAgICAgdGhpcy5fX3dyYXBwZWRfXyA9IHZhbHVlOwogICAgICAgICAgdGhpcy5fX2FjdGlvbnNfXyA9IGFjdGlvbnMgfHwgW107CiAgICAgICAgICB0aGlzLl9fY2hhaW5fXyA9ICEhY2hhaW5BbGw7CiAgICAgICAgfQogICAgICAgIHZhciBzdXBwb3J0ID0gbG9kYXNoLnN1cHBvcnQgPSB7fTsKICAgICAgICAoZnVuY3Rpb24oeCkgewogICAgICAgICAgdmFyIEN0b3IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy54ID0geDsKICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb2JqZWN0ID0gewogICAgICAgICAgICAgICAgJzAnOiB4LAogICAgICAgICAgICAgICAgJ2xlbmd0aCc6IHgKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHByb3BzID0gW107CiAgICAgICAgICBDdG9yLnByb3RvdHlwZSA9IHsKICAgICAgICAgICAgJ3ZhbHVlT2YnOiB4LAogICAgICAgICAgICAneSc6IHgKICAgICAgICAgIH07CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbmV3IEN0b3IpIHsKICAgICAgICAgICAgcHJvcHMucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3VwcG9ydC5kb20gPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkubm9kZVR5cGUgPT09IDExOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBzdXBwb3J0LmRvbSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0oMSwgMCkpOwogICAgICAgIGxvZGFzaC50ZW1wbGF0ZVNldHRpbmdzID0gewogICAgICAgICAgJ2VzY2FwZSc6IHJlRXNjYXBlLAogICAgICAgICAgJ2V2YWx1YXRlJzogcmVFdmFsdWF0ZSwKICAgICAgICAgICdpbnRlcnBvbGF0ZSc6IHJlSW50ZXJwb2xhdGUsCiAgICAgICAgICAndmFyaWFibGUnOiAnJywKICAgICAgICAgICdpbXBvcnRzJzogeydfJzogbG9kYXNofQogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gTGF6eVdyYXBwZXIodmFsdWUpIHsKICAgICAgICAgIHRoaXMuX193cmFwcGVkX18gPSB2YWx1ZTsKICAgICAgICAgIHRoaXMuX19hY3Rpb25zX18gPSBudWxsOwogICAgICAgICAgdGhpcy5fX2Rpcl9fID0gMTsKICAgICAgICAgIHRoaXMuX19kcm9wQ291bnRfXyA9IDA7CiAgICAgICAgICB0aGlzLl9fZmlsdGVyZWRfXyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5fX2l0ZXJhdGVlc19fID0gbnVsbDsKICAgICAgICAgIHRoaXMuX190YWtlQ291bnRfXyA9IFBPU0lUSVZFX0lORklOSVRZOwogICAgICAgICAgdGhpcy5fX3ZpZXdzX18gPSBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsYXp5Q2xvbmUoKSB7CiAgICAgICAgICB2YXIgYWN0aW9ucyA9IHRoaXMuX19hY3Rpb25zX18sCiAgICAgICAgICAgICAgaXRlcmF0ZWVzID0gdGhpcy5fX2l0ZXJhdGVlc19fLAogICAgICAgICAgICAgIHZpZXdzID0gdGhpcy5fX3ZpZXdzX18sCiAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IExhenlXcmFwcGVyKHRoaXMuX193cmFwcGVkX18pOwogICAgICAgICAgcmVzdWx0Ll9fYWN0aW9uc19fID0gYWN0aW9ucyA/IGFycmF5Q29weShhY3Rpb25zKSA6IG51bGw7CiAgICAgICAgICByZXN1bHQuX19kaXJfXyA9IHRoaXMuX19kaXJfXzsKICAgICAgICAgIHJlc3VsdC5fX2ZpbHRlcmVkX18gPSB0aGlzLl9fZmlsdGVyZWRfXzsKICAgICAgICAgIHJlc3VsdC5fX2l0ZXJhdGVlc19fID0gaXRlcmF0ZWVzID8gYXJyYXlDb3B5KGl0ZXJhdGVlcykgOiBudWxsOwogICAgICAgICAgcmVzdWx0Ll9fdGFrZUNvdW50X18gPSB0aGlzLl9fdGFrZUNvdW50X187CiAgICAgICAgICByZXN1bHQuX192aWV3c19fID0gdmlld3MgPyBhcnJheUNvcHkodmlld3MpIDogbnVsbDsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGxhenlSZXZlcnNlKCkgewogICAgICAgICAgaWYgKHRoaXMuX19maWx0ZXJlZF9fKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgTGF6eVdyYXBwZXIodGhpcyk7CiAgICAgICAgICAgIHJlc3VsdC5fX2Rpcl9fID0gLTE7CiAgICAgICAgICAgIHJlc3VsdC5fX2ZpbHRlcmVkX18gPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jbG9uZSgpOwogICAgICAgICAgICByZXN1bHQuX19kaXJfXyAqPSAtMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGxhenlWYWx1ZSgpIHsKICAgICAgICAgIHZhciBhcnJheSA9IHRoaXMuX193cmFwcGVkX18udmFsdWUoKTsKICAgICAgICAgIGlmICghaXNBcnJheShhcnJheSkpIHsKICAgICAgICAgICAgcmV0dXJuIGJhc2VXcmFwcGVyVmFsdWUoYXJyYXksIHRoaXMuX19hY3Rpb25zX18pOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGRpciA9IHRoaXMuX19kaXJfXywKICAgICAgICAgICAgICBpc1JpZ2h0ID0gZGlyIDwgMCwKICAgICAgICAgICAgICB2aWV3ID0gZ2V0VmlldygwLCBhcnJheS5sZW5ndGgsIHRoaXMuX192aWV3c19fKSwKICAgICAgICAgICAgICBzdGFydCA9IHZpZXcuc3RhcnQsCiAgICAgICAgICAgICAgZW5kID0gdmlldy5lbmQsCiAgICAgICAgICAgICAgbGVuZ3RoID0gZW5kIC0gc3RhcnQsCiAgICAgICAgICAgICAgaW5kZXggPSBpc1JpZ2h0ID8gZW5kIDogKHN0YXJ0IC0gMSksCiAgICAgICAgICAgICAgdGFrZUNvdW50ID0gbmF0aXZlTWluKGxlbmd0aCwgdGhpcy5fX3Rha2VDb3VudF9fKSwKICAgICAgICAgICAgICBpdGVyYXRlZXMgPSB0aGlzLl9faXRlcmF0ZWVzX18sCiAgICAgICAgICAgICAgaXRlckxlbmd0aCA9IGl0ZXJhdGVlcyA/IGl0ZXJhdGVlcy5sZW5ndGggOiAwLAogICAgICAgICAgICAgIHJlc0luZGV4ID0gMCwKICAgICAgICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgICAgIG91dGVyOiB3aGlsZSAobGVuZ3RoLS0gJiYgcmVzSW5kZXggPCB0YWtlQ291bnQpIHsKICAgICAgICAgICAgaW5kZXggKz0gZGlyOwogICAgICAgICAgICB2YXIgaXRlckluZGV4ID0gLTEsCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGFycmF5W2luZGV4XTsKICAgICAgICAgICAgd2hpbGUgKCsraXRlckluZGV4IDwgaXRlckxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gaXRlcmF0ZWVzW2l0ZXJJbmRleF0sCiAgICAgICAgICAgICAgICAgIGl0ZXJhdGVlID0gZGF0YS5pdGVyYXRlZSwKICAgICAgICAgICAgICAgICAgdHlwZSA9IGRhdGEudHlwZTsKICAgICAgICAgICAgICBpZiAodHlwZSA9PSBMQVpZX0RST1BfV0hJTEVfRkxBRykgewogICAgICAgICAgICAgICAgaWYgKGRhdGEuZG9uZSAmJiAoaXNSaWdodCA/IChpbmRleCA+IGRhdGEuaW5kZXgpIDogKGluZGV4IDwgZGF0YS5pbmRleCkpKSB7CiAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQgPSAwOwogICAgICAgICAgICAgICAgICBkYXRhLmRvbmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGEuaW5kZXggPSBpbmRleDsKICAgICAgICAgICAgICAgIGlmICghZGF0YS5kb25lKSB7CiAgICAgICAgICAgICAgICAgIHZhciBsaW1pdCA9IGRhdGEubGltaXQ7CiAgICAgICAgICAgICAgICAgIGlmICghKGRhdGEuZG9uZSA9IGxpbWl0ID4gLTEgPyAoZGF0YS5jb3VudCsrID49IGxpbWl0KSA6ICFpdGVyYXRlZSh2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0ZWUodmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gTEFaWV9NQVBfRkxBRykgewogICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNvbXB1dGVkOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghY29tcHV0ZWQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gTEFaWV9GSUxURVJfRkxBRykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc3VsdFtyZXNJbmRleCsrXSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTWFwQ2FjaGUoKSB7CiAgICAgICAgICB0aGlzLl9fZGF0YV9fID0ge307CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1hcERlbGV0ZShrZXkpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmhhcyhrZXkpICYmIGRlbGV0ZSB0aGlzLl9fZGF0YV9fW2tleV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1hcEdldChrZXkpIHsKICAgICAgICAgIHJldHVybiBrZXkgPT0gJ19fcHJvdG9fXycgPyB1bmRlZmluZWQgOiB0aGlzLl9fZGF0YV9fW2tleV07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1hcEhhcyhrZXkpIHsKICAgICAgICAgIHJldHVybiBrZXkgIT0gJ19fcHJvdG9fXycgJiYgaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9fZGF0YV9fLCBrZXkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBtYXBTZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgaWYgKGtleSAhPSAnX19wcm90b19fJykgewogICAgICAgICAgICB0aGlzLl9fZGF0YV9fW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBTZXRDYWNoZSh2YWx1ZXMpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSB2YWx1ZXMgPyB2YWx1ZXMubGVuZ3RoIDogMDsKICAgICAgICAgIHRoaXMuZGF0YSA9IHsKICAgICAgICAgICAgJ2hhc2gnOiBuYXRpdmVDcmVhdGUobnVsbCksCiAgICAgICAgICAgICdzZXQnOiBuZXcgU2V0CiAgICAgICAgICB9OwogICAgICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgICAgIHRoaXMucHVzaCh2YWx1ZXNbbGVuZ3RoXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNhY2hlSW5kZXhPZihjYWNoZSwgdmFsdWUpIHsKICAgICAgICAgIHZhciBkYXRhID0gY2FjaGUuZGF0YSwKICAgICAgICAgICAgICByZXN1bHQgPSAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IGlzT2JqZWN0KHZhbHVlKSkgPyBkYXRhLnNldC5oYXModmFsdWUpIDogZGF0YS5oYXNoW3ZhbHVlXTsKICAgICAgICAgIHJldHVybiByZXN1bHQgPyAwIDogLTE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNhY2hlUHVzaCh2YWx1ZSkgewogICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IGlzT2JqZWN0KHZhbHVlKSkgewogICAgICAgICAgICBkYXRhLnNldC5hZGQodmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YS5oYXNoW3ZhbHVlXSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFycmF5Q29weShzb3VyY2UsIGFycmF5KSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBzb3VyY2UubGVuZ3RoOwogICAgICAgICAgYXJyYXkgfHwgKGFycmF5ID0gQXJyYXkobGVuZ3RoKSk7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICBhcnJheVtpbmRleF0gPSBzb3VyY2VbaW5kZXhdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhcnJheUVhY2goYXJyYXksIGl0ZXJhdGVlKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICBpZiAoaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFycmF5RWFjaFJpZ2h0KGFycmF5LCBpdGVyYXRlZSkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgICAgICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAgICAgICBpZiAoaXRlcmF0ZWUoYXJyYXlbbGVuZ3RoXSwgbGVuZ3RoLCBhcnJheSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYXJyYXlFdmVyeShhcnJheSwgcHJlZGljYXRlKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICBpZiAoIXByZWRpY2F0ZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhcnJheUV4dHJlbXVtKGFycmF5LCBpdGVyYXRlZSwgY29tcGFyYXRvciwgZXhWYWx1ZSkgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgICAgICAgIGNvbXB1dGVkID0gZXhWYWx1ZSwKICAgICAgICAgICAgICByZXN1bHQgPSBjb21wdXRlZDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XSwKICAgICAgICAgICAgICAgIGN1cnJlbnQgPSAraXRlcmF0ZWUodmFsdWUpOwogICAgICAgICAgICBpZiAoY29tcGFyYXRvcihjdXJyZW50LCBjb21wdXRlZCkpIHsKICAgICAgICAgICAgICBjb21wdXRlZCA9IGN1cnJlbnQ7CiAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFycmF5RmlsdGVyKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICAgICAgICByZXNJbmRleCA9IC0xLAogICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdOwogICAgICAgICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgYXJyYXkpKSB7CiAgICAgICAgICAgICAgcmVzdWx0WysrcmVzSW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFycmF5TWFwKGFycmF5LCBpdGVyYXRlZSkgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYXJyYXlSZWR1Y2UoYXJyYXksIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgaW5pdEZyb21BcnJheSkgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgICAgICAgaWYgKGluaXRGcm9tQXJyYXkgJiYgbGVuZ3RoKSB7CiAgICAgICAgICAgIGFjY3VtdWxhdG9yID0gYXJyYXlbKytpbmRleF07CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICBhY2N1bXVsYXRvciA9IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCBhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFycmF5UmVkdWNlUmlnaHQoYXJyYXksIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgaW5pdEZyb21BcnJheSkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgICAgICAgIGlmIChpbml0RnJvbUFycmF5ICYmIGxlbmd0aCkgewogICAgICAgICAgICBhY2N1bXVsYXRvciA9IGFycmF5Wy0tbGVuZ3RoXTsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAgICAgICBhY2N1bXVsYXRvciA9IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCBhcnJheVtsZW5ndGhdLCBsZW5ndGgsIGFycmF5KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvcjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYXJyYXlTb21lKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYXJyYXlTdW0oYXJyYXkpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgICAgICAgcmVzdWx0ID0gMDsKICAgICAgICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAgICAgICByZXN1bHQgKz0gK2FycmF5W2xlbmd0aF0gfHwgMDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFzc2lnbkRlZmF1bHRzKG9iamVjdFZhbHVlLCBzb3VyY2VWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIG9iamVjdFZhbHVlID09PSB1bmRlZmluZWQgPyBzb3VyY2VWYWx1ZSA6IG9iamVjdFZhbHVlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhc3NpZ25Pd25EZWZhdWx0cyhvYmplY3RWYWx1ZSwgc291cmNlVmFsdWUsIGtleSwgb2JqZWN0KSB7CiAgICAgICAgICByZXR1cm4gKG9iamVjdFZhbHVlID09PSB1bmRlZmluZWQgfHwgIWhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpKSA/IHNvdXJjZVZhbHVlIDogb2JqZWN0VmFsdWU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFzc2lnbldpdGgob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpIHsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIHByb3BzID0ga2V5cyhzb3VyY2UpLAogICAgICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF0sCiAgICAgICAgICAgICAgICB2YWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgICAgICAgcmVzdWx0ID0gY3VzdG9taXplcih2YWx1ZSwgc291cmNlW2tleV0sIGtleSwgb2JqZWN0LCBzb3VyY2UpOwogICAgICAgICAgICBpZiAoKHJlc3VsdCA9PT0gcmVzdWx0ID8gKHJlc3VsdCAhPT0gdmFsdWUpIDogKHZhbHVlID09PSB2YWx1ZSkpIHx8ICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICEoa2V5IGluIG9iamVjdCkpKSB7CiAgICAgICAgICAgICAgb2JqZWN0W2tleV0gPSByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpIHsKICAgICAgICAgIHJldHVybiBzb3VyY2UgPT0gbnVsbCA/IG9iamVjdCA6IGJhc2VDb3B5KHNvdXJjZSwga2V5cyhzb3VyY2UpLCBvYmplY3QpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlQXQoY29sbGVjdGlvbiwgcHJvcHMpIHsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGlzTmlsID0gY29sbGVjdGlvbiA9PSBudWxsLAogICAgICAgICAgICAgIGlzQXJyID0gIWlzTmlsICYmIGlzQXJyYXlMaWtlKGNvbGxlY3Rpb24pLAogICAgICAgICAgICAgIGxlbmd0aCA9IGlzQXJyID8gY29sbGVjdGlvbi5sZW5ndGggOiAwLAogICAgICAgICAgICAgIHByb3BzTGVuZ3RoID0gcHJvcHMubGVuZ3RoLAogICAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KHByb3BzTGVuZ3RoKTsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgcHJvcHNMZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsKICAgICAgICAgICAgaWYgKGlzQXJyKSB7CiAgICAgICAgICAgICAgcmVzdWx0W2luZGV4XSA9IGlzSW5kZXgoa2V5LCBsZW5ndGgpID8gY29sbGVjdGlvbltrZXldIDogdW5kZWZpbmVkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc3VsdFtpbmRleF0gPSBpc05pbCA/IHVuZGVmaW5lZCA6IGNvbGxlY3Rpb25ba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUNvcHkoc291cmNlLCBwcm9wcywgb2JqZWN0KSB7CiAgICAgICAgICBvYmplY3QgfHwgKG9iamVjdCA9IHt9KTsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07CiAgICAgICAgICAgIG9iamVjdFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlQ2FsbGJhY2soZnVuYywgdGhpc0FyZywgYXJnQ291bnQpIHsKICAgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIGZ1bmM7CiAgICAgICAgICBpZiAodHlwZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzQXJnID09PSB1bmRlZmluZWQgPyBmdW5jIDogYmluZENhbGxiYWNrKGZ1bmMsIHRoaXNBcmcsIGFyZ0NvdW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChmdW5jID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGlkZW50aXR5OwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGUgPT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgcmV0dXJuIGJhc2VNYXRjaGVzKGZ1bmMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXNBcmcgPT09IHVuZGVmaW5lZCA/IHByb3BlcnR5KGZ1bmMpIDogYmFzZU1hdGNoZXNQcm9wZXJ0eShmdW5jLCB0aGlzQXJnKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUNsb25lKHZhbHVlLCBpc0RlZXAsIGN1c3RvbWl6ZXIsIGtleSwgb2JqZWN0LCBzdGFja0EsIHN0YWNrQikgewogICAgICAgICAgdmFyIHJlc3VsdDsKICAgICAgICAgIGlmIChjdXN0b21pemVyKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IG9iamVjdCA/IGN1c3RvbWl6ZXIodmFsdWUsIGtleSwgb2JqZWN0KSA6IGN1c3RvbWl6ZXIodmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHZhbHVlKTsKICAgICAgICAgIGlmIChpc0FycikgewogICAgICAgICAgICByZXN1bHQgPSBpbml0Q2xvbmVBcnJheSh2YWx1ZSk7CiAgICAgICAgICAgIGlmICghaXNEZWVwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFycmF5Q29weSh2YWx1ZSwgcmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHRhZyA9IG9ialRvU3RyaW5nLmNhbGwodmFsdWUpLAogICAgICAgICAgICAgICAgaXNGdW5jID0gdGFnID09IGZ1bmNUYWc7CiAgICAgICAgICAgIGlmICh0YWcgPT0gb2JqZWN0VGFnIHx8IHRhZyA9PSBhcmdzVGFnIHx8IChpc0Z1bmMgJiYgIW9iamVjdCkpIHsKICAgICAgICAgICAgICByZXN1bHQgPSBpbml0Q2xvbmVPYmplY3QoaXNGdW5jID8ge30gOiB2YWx1ZSk7CiAgICAgICAgICAgICAgaWYgKCFpc0RlZXApIHsKICAgICAgICAgICAgICAgIHJldHVybiBiYXNlQXNzaWduKHJlc3VsdCwgdmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gY2xvbmVhYmxlVGFnc1t0YWddID8gaW5pdENsb25lQnlUYWcodmFsdWUsIHRhZywgaXNEZWVwKSA6IChvYmplY3QgPyB2YWx1ZSA6IHt9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3RhY2tBIHx8IChzdGFja0EgPSBbXSk7CiAgICAgICAgICBzdGFja0IgfHwgKHN0YWNrQiA9IFtdKTsKICAgICAgICAgIHZhciBsZW5ndGggPSBzdGFja0EubGVuZ3RoOwogICAgICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgICAgIGlmIChzdGFja0FbbGVuZ3RoXSA9PSB2YWx1ZSkgewogICAgICAgICAgICAgIHJldHVybiBzdGFja0JbbGVuZ3RoXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3RhY2tBLnB1c2godmFsdWUpOwogICAgICAgICAgc3RhY2tCLnB1c2gocmVzdWx0KTsKICAgICAgICAgIChpc0FyciA/IGFycmF5RWFjaCA6IGJhc2VGb3JPd24pKHZhbHVlLCBmdW5jdGlvbihzdWJWYWx1ZSwga2V5KSB7CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gYmFzZUNsb25lKHN1YlZhbHVlLCBpc0RlZXAsIGN1c3RvbWl6ZXIsIGtleSwgdmFsdWUsIHN0YWNrQSwgc3RhY2tCKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgdmFyIGJhc2VDcmVhdGUgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICBmdW5jdGlvbiBvYmplY3QoKSB7fQogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHByb3RvdHlwZSkgewogICAgICAgICAgICBpZiAoaXNPYmplY3QocHJvdG90eXBlKSkgewogICAgICAgICAgICAgIG9iamVjdC5wcm90b3R5cGUgPSBwcm90b3R5cGU7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBvYmplY3Q7CiAgICAgICAgICAgICAgb2JqZWN0LnByb3RvdHlwZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCB8fCB7fTsKICAgICAgICAgIH07CiAgICAgICAgfSgpKTsKICAgICAgICBmdW5jdGlvbiBiYXNlRGVsYXkoZnVuYywgd2FpdCwgYXJncykgewogICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZ1bmMuYXBwbHkodW5kZWZpbmVkLCBhcmdzKTsKICAgICAgICAgIH0sIHdhaXQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlRGlmZmVyZW5jZShhcnJheSwgdmFsdWVzKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLAogICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwogICAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGluZGV4T2YgPSBnZXRJbmRleE9mKCksCiAgICAgICAgICAgICAgaXNDb21tb24gPSBpbmRleE9mID09IGJhc2VJbmRleE9mLAogICAgICAgICAgICAgIGNhY2hlID0gKGlzQ29tbW9uICYmIHZhbHVlcy5sZW5ndGggPj0gMjAwKSA/IGNyZWF0ZUNhY2hlKHZhbHVlcykgOiBudWxsLAogICAgICAgICAgICAgIHZhbHVlc0xlbmd0aCA9IHZhbHVlcy5sZW5ndGg7CiAgICAgICAgICBpZiAoY2FjaGUpIHsKICAgICAgICAgICAgaW5kZXhPZiA9IGNhY2hlSW5kZXhPZjsKICAgICAgICAgICAgaXNDb21tb24gPSBmYWxzZTsKICAgICAgICAgICAgdmFsdWVzID0gY2FjaGU7CiAgICAgICAgICB9CiAgICAgICAgICBvdXRlcjogd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaW5kZXhdOwogICAgICAgICAgICBpZiAoaXNDb21tb24gJiYgdmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgICAgICAgdmFyIHZhbHVlc0luZGV4ID0gdmFsdWVzTGVuZ3RoOwogICAgICAgICAgICAgIHdoaWxlICh2YWx1ZXNJbmRleC0tKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWVzW3ZhbHVlc0luZGV4XSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleE9mKHZhbHVlcywgdmFsdWUsIDApIDwgMCkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgdmFyIGJhc2VFYWNoID0gY3JlYXRlQmFzZUVhY2goYmFzZUZvck93bik7CiAgICAgICAgdmFyIGJhc2VFYWNoUmlnaHQgPSBjcmVhdGVCYXNlRWFjaChiYXNlRm9yT3duUmlnaHQsIHRydWUpOwogICAgICAgIGZ1bmN0aW9uIGJhc2VFdmVyeShjb2xsZWN0aW9uLCBwcmVkaWNhdGUpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgICAgICAgYmFzZUVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7CiAgICAgICAgICAgIHJlc3VsdCA9ICEhcHJlZGljYXRlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJhc2VFeHRyZW11bShjb2xsZWN0aW9uLCBpdGVyYXRlZSwgY29tcGFyYXRvciwgZXhWYWx1ZSkgewogICAgICAgICAgdmFyIGNvbXB1dGVkID0gZXhWYWx1ZSwKICAgICAgICAgICAgICByZXN1bHQgPSBjb21wdXRlZDsKICAgICAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgICAgICB2YXIgY3VycmVudCA9ICtpdGVyYXRlZSh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pOwogICAgICAgICAgICBpZiAoY29tcGFyYXRvcihjdXJyZW50LCBjb21wdXRlZCkgfHwgKGN1cnJlbnQgPT09IGV4VmFsdWUgJiYgY3VycmVudCA9PT0gcmVzdWx0KSkgewogICAgICAgICAgICAgIGNvbXB1dGVkID0gY3VycmVudDsKICAgICAgICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlRmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAgICBzdGFydCA9IHN0YXJ0ID09IG51bGwgPyAwIDogKCtzdGFydCB8fCAwKTsKICAgICAgICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTsKICAgICAgICAgIH0KICAgICAgICAgIGVuZCA9IChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiBsZW5ndGgpID8gbGVuZ3RoIDogKCtlbmQgfHwgMCk7CiAgICAgICAgICBpZiAoZW5kIDwgMCkgewogICAgICAgICAgICBlbmQgKz0gbGVuZ3RoOwogICAgICAgICAgfQogICAgICAgICAgbGVuZ3RoID0gc3RhcnQgPiBlbmQgPyAwIDogKGVuZCA+Pj4gMCk7CiAgICAgICAgICBzdGFydCA+Pj49IDA7CiAgICAgICAgICB3aGlsZSAoc3RhcnQgPCBsZW5ndGgpIHsKICAgICAgICAgICAgYXJyYXlbc3RhcnQrK10gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUZpbHRlcihjb2xsZWN0aW9uLCBwcmVkaWNhdGUpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikpIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUZpbmQoY29sbGVjdGlvbiwgcHJlZGljYXRlLCBlYWNoRnVuYywgcmV0S2V5KSB7CiAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgZWFjaEZ1bmMoY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGtleSwgY29sbGVjdGlvbikgewogICAgICAgICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gcmV0S2V5ID8ga2V5IDogdmFsdWU7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJhc2VGbGF0dGVuKGFycmF5LCBpc0RlZXAsIGlzU3RyaWN0KSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgICAgICAgcmVzSW5kZXggPSAtMSwKICAgICAgICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsKICAgICAgICAgICAgaWYgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNBcnJheUxpa2UodmFsdWUpICYmIChpc1N0cmljdCB8fCBpc0FycmF5KHZhbHVlKSB8fCBpc0FyZ3VtZW50cyh2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgaWYgKGlzRGVlcCkgewogICAgICAgICAgICAgICAgdmFsdWUgPSBiYXNlRmxhdHRlbih2YWx1ZSwgaXNEZWVwLCBpc1N0cmljdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciB2YWxJbmRleCA9IC0xLAogICAgICAgICAgICAgICAgICB2YWxMZW5ndGggPSB2YWx1ZS5sZW5ndGg7CiAgICAgICAgICAgICAgd2hpbGUgKCsrdmFsSW5kZXggPCB2YWxMZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJlc3VsdFsrK3Jlc0luZGV4XSA9IHZhbHVlW3ZhbEluZGV4XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzU3RyaWN0KSB7CiAgICAgICAgICAgICAgcmVzdWx0WysrcmVzSW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBiYXNlRm9yID0gY3JlYXRlQmFzZUZvcigpOwogICAgICAgIHZhciBiYXNlRm9yUmlnaHQgPSBjcmVhdGVCYXNlRm9yKHRydWUpOwogICAgICAgIGZ1bmN0aW9uIGJhc2VGb3JJbihvYmplY3QsIGl0ZXJhdGVlKSB7CiAgICAgICAgICByZXR1cm4gYmFzZUZvcihvYmplY3QsIGl0ZXJhdGVlLCBrZXlzSW4pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlRm9yT3duKG9iamVjdCwgaXRlcmF0ZWUpIHsKICAgICAgICAgIHJldHVybiBiYXNlRm9yKG9iamVjdCwgaXRlcmF0ZWUsIGtleXMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlRm9yT3duUmlnaHQob2JqZWN0LCBpdGVyYXRlZSkgewogICAgICAgICAgcmV0dXJuIGJhc2VGb3JSaWdodChvYmplY3QsIGl0ZXJhdGVlLCBrZXlzKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUZ1bmN0aW9ucyhvYmplY3QsIHByb3BzKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGgsCiAgICAgICAgICAgICAgcmVzSW5kZXggPSAtMSwKICAgICAgICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07CiAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKG9iamVjdFtrZXldKSkgewogICAgICAgICAgICAgIHJlc3VsdFsrK3Jlc0luZGV4XSA9IGtleTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUdldChvYmplY3QsIHBhdGgsIHBhdGhLZXkpIHsKICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHBhdGhLZXkgIT09IHVuZGVmaW5lZCAmJiBwYXRoS2V5IGluIHRvT2JqZWN0KG9iamVjdCkpIHsKICAgICAgICAgICAgcGF0aCA9IFtwYXRoS2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpbmRleCA9IDAsCiAgICAgICAgICAgICAgbGVuZ3RoID0gcGF0aC5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAob2JqZWN0ICE9IG51bGwgJiYgaW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W3BhdGhbaW5kZXgrK11dOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIChpbmRleCAmJiBpbmRleCA9PSBsZW5ndGgpID8gb2JqZWN0IDogdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT09IG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgb3RoZXIgPT0gbnVsbCB8fCAoIWlzT2JqZWN0KHZhbHVlKSAmJiAhaXNPYmplY3RMaWtlKG90aGVyKSkpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmFzZUlzRXF1YWxEZWVwKHZhbHVlLCBvdGhlciwgYmFzZUlzRXF1YWwsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZUlzRXF1YWxEZWVwKG9iamVjdCwgb3RoZXIsIGVxdWFsRnVuYywgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpIHsKICAgICAgICAgIHZhciBvYmpJc0FyciA9IGlzQXJyYXkob2JqZWN0KSwKICAgICAgICAgICAgICBvdGhJc0FyciA9IGlzQXJyYXkob3RoZXIpLAogICAgICAgICAgICAgIG9ialRhZyA9IGFycmF5VGFnLAogICAgICAgICAgICAgIG90aFRhZyA9IGFycmF5VGFnOwogICAgICAgICAgaWYgKCFvYmpJc0FycikgewogICAgICAgICAgICBvYmpUYWcgPSBvYmpUb1N0cmluZy5jYWxsKG9iamVjdCk7CiAgICAgICAgICAgIGlmIChvYmpUYWcgPT0gYXJnc1RhZykgewogICAgICAgICAgICAgIG9ialRhZyA9IG9iamVjdFRhZzsKICAgICAgICAgICAgfSBlbHNlIGlmIChvYmpUYWcgIT0gb2JqZWN0VGFnKSB7CiAgICAgICAgICAgICAgb2JqSXNBcnIgPSBpc1R5cGVkQXJyYXkob2JqZWN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFvdGhJc0FycikgewogICAgICAgICAgICBvdGhUYWcgPSBvYmpUb1N0cmluZy5jYWxsKG90aGVyKTsKICAgICAgICAgICAgaWYgKG90aFRhZyA9PSBhcmdzVGFnKSB7CiAgICAgICAgICAgICAgb3RoVGFnID0gb2JqZWN0VGFnOwogICAgICAgICAgICB9IGVsc2UgaWYgKG90aFRhZyAhPSBvYmplY3RUYWcpIHsKICAgICAgICAgICAgICBvdGhJc0FyciA9IGlzVHlwZWRBcnJheShvdGhlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHZhciBvYmpJc09iaiA9IG9ialRhZyA9PSBvYmplY3RUYWcsCiAgICAgICAgICAgICAgb3RoSXNPYmogPSBvdGhUYWcgPT0gb2JqZWN0VGFnLAogICAgICAgICAgICAgIGlzU2FtZVRhZyA9IG9ialRhZyA9PSBvdGhUYWc7CiAgICAgICAgICBpZiAoaXNTYW1lVGFnICYmICEob2JqSXNBcnIgfHwgb2JqSXNPYmopKSB7CiAgICAgICAgICAgIHJldHVybiBlcXVhbEJ5VGFnKG9iamVjdCwgb3RoZXIsIG9ialRhZyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWlzTG9vc2UpIHsKICAgICAgICAgICAgdmFyIG9iaklzV3JhcHBlZCA9IG9iaklzT2JqICYmIGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCAnX193cmFwcGVkX18nKSwKICAgICAgICAgICAgICAgIG90aElzV3JhcHBlZCA9IG90aElzT2JqICYmIGhhc093blByb3BlcnR5LmNhbGwob3RoZXIsICdfX3dyYXBwZWRfXycpOwogICAgICAgICAgICBpZiAob2JqSXNXcmFwcGVkIHx8IG90aElzV3JhcHBlZCkgewogICAgICAgICAgICAgIHJldHVybiBlcXVhbEZ1bmMob2JqSXNXcmFwcGVkID8gb2JqZWN0LnZhbHVlKCkgOiBvYmplY3QsIG90aElzV3JhcHBlZCA/IG90aGVyLnZhbHVlKCkgOiBvdGhlciwgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWlzU2FtZVRhZykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFja0EgfHwgKHN0YWNrQSA9IFtdKTsKICAgICAgICAgIHN0YWNrQiB8fCAoc3RhY2tCID0gW10pOwogICAgICAgICAgdmFyIGxlbmd0aCA9IHN0YWNrQS5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgICAgICAgaWYgKHN0YWNrQVtsZW5ndGhdID09IG9iamVjdCkgewogICAgICAgICAgICAgIHJldHVybiBzdGFja0JbbGVuZ3RoXSA9PSBvdGhlcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3RhY2tBLnB1c2gob2JqZWN0KTsKICAgICAgICAgIHN0YWNrQi5wdXNoKG90aGVyKTsKICAgICAgICAgIHZhciByZXN1bHQgPSAob2JqSXNBcnIgPyBlcXVhbEFycmF5cyA6IGVxdWFsT2JqZWN0cykob2JqZWN0LCBvdGhlciwgZXF1YWxGdW5jLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQik7CiAgICAgICAgICBzdGFja0EucG9wKCk7CiAgICAgICAgICBzdGFja0IucG9wKCk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlSXNNYXRjaChvYmplY3QsIG1hdGNoRGF0YSwgY3VzdG9taXplcikgewogICAgICAgICAgdmFyIGluZGV4ID0gbWF0Y2hEYXRhLmxlbmd0aCwKICAgICAgICAgICAgICBsZW5ndGggPSBpbmRleCwKICAgICAgICAgICAgICBub0N1c3RvbWl6ZXIgPSAhY3VzdG9taXplcjsKICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gIWxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICAgIG9iamVjdCA9IHRvT2JqZWN0KG9iamVjdCk7CiAgICAgICAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICAgICAgICB2YXIgZGF0YSA9IG1hdGNoRGF0YVtpbmRleF07CiAgICAgICAgICAgIGlmICgobm9DdXN0b21pemVyICYmIGRhdGFbMl0pID8gZGF0YVsxXSAhPT0gb2JqZWN0W2RhdGFbMF1dIDogIShkYXRhWzBdIGluIG9iamVjdCkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIGRhdGEgPSBtYXRjaERhdGFbaW5kZXhdOwogICAgICAgICAgICB2YXIga2V5ID0gZGF0YVswXSwKICAgICAgICAgICAgICAgIG9ialZhbHVlID0gb2JqZWN0W2tleV0sCiAgICAgICAgICAgICAgICBzcmNWYWx1ZSA9IGRhdGFbMV07CiAgICAgICAgICAgIGlmIChub0N1c3RvbWl6ZXIgJiYgZGF0YVsyXSkgewogICAgICAgICAgICAgIGlmIChvYmpWYWx1ZSA9PT0gdW5kZWZpbmVkICYmICEoa2V5IGluIG9iamVjdCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKG9ialZhbHVlLCBzcmNWYWx1ZSwga2V5KSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBpZiAoIShyZXN1bHQgPT09IHVuZGVmaW5lZCA/IGJhc2VJc0VxdWFsKHNyY1ZhbHVlLCBvYmpWYWx1ZSwgY3VzdG9taXplciwgdHJ1ZSkgOiByZXN1bHQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZU1hcChjb2xsZWN0aW9uLCBpdGVyYXRlZSkgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgcmVzdWx0ID0gaXNBcnJheUxpa2UoY29sbGVjdGlvbikgPyBBcnJheShjb2xsZWN0aW9uLmxlbmd0aCkgOiBbXTsKICAgICAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgcmVzdWx0WysraW5kZXhdID0gaXRlcmF0ZWUodmFsdWUsIGtleSwgY29sbGVjdGlvbik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJhc2VNYXRjaGVzKHNvdXJjZSkgewogICAgICAgICAgdmFyIG1hdGNoRGF0YSA9IGdldE1hdGNoRGF0YShzb3VyY2UpOwogICAgICAgICAgaWYgKG1hdGNoRGF0YS5sZW5ndGggPT0gMSAmJiBtYXRjaERhdGFbMF1bMl0pIHsKICAgICAgICAgICAgdmFyIGtleSA9IG1hdGNoRGF0YVswXVswXSwKICAgICAgICAgICAgICAgIHZhbHVlID0gbWF0Y2hEYXRhWzBdWzFdOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBvYmplY3Rba2V5XSA9PT0gdmFsdWUgJiYgKHZhbHVlICE9PSB1bmRlZmluZWQgfHwgKGtleSBpbiB0b09iamVjdChvYmplY3QpKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBiYXNlSXNNYXRjaChvYmplY3QsIG1hdGNoRGF0YSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlTWF0Y2hlc1Byb3BlcnR5KHBhdGgsIHNyY1ZhbHVlKSB7CiAgICAgICAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHBhdGgpLAogICAgICAgICAgICAgIGlzQ29tbW9uID0gaXNLZXkocGF0aCkgJiYgaXNTdHJpY3RDb21wYXJhYmxlKHNyY1ZhbHVlKSwKICAgICAgICAgICAgICBwYXRoS2V5ID0gKHBhdGggKyAnJyk7CiAgICAgICAgICBwYXRoID0gdG9QYXRoKHBhdGgpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGtleSA9IHBhdGhLZXk7CiAgICAgICAgICAgIG9iamVjdCA9IHRvT2JqZWN0KG9iamVjdCk7CiAgICAgICAgICAgIGlmICgoaXNBcnIgfHwgIWlzQ29tbW9uKSAmJiAhKGtleSBpbiBvYmplY3QpKSB7CiAgICAgICAgICAgICAgb2JqZWN0ID0gcGF0aC5sZW5ndGggPT0gMSA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsKICAgICAgICAgICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAga2V5ID0gbGFzdChwYXRoKTsKICAgICAgICAgICAgICBvYmplY3QgPSB0b09iamVjdChvYmplY3QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvYmplY3Rba2V5XSA9PT0gc3JjVmFsdWUgPyAoc3JjVmFsdWUgIT09IHVuZGVmaW5lZCB8fCAoa2V5IGluIG9iamVjdCkpIDogYmFzZUlzRXF1YWwoc3JjVmFsdWUsIG9iamVjdFtrZXldLCB1bmRlZmluZWQsIHRydWUpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZU1lcmdlKG9iamVjdCwgc291cmNlLCBjdXN0b21pemVyLCBzdGFja0EsIHN0YWNrQikgewogICAgICAgICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7CiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaXNTcmNBcnIgPSBpc0FycmF5TGlrZShzb3VyY2UpICYmIChpc0FycmF5KHNvdXJjZSkgfHwgaXNUeXBlZEFycmF5KHNvdXJjZSkpLAogICAgICAgICAgICAgIHByb3BzID0gaXNTcmNBcnIgPyBudWxsIDoga2V5cyhzb3VyY2UpOwogICAgICAgICAgYXJyYXlFYWNoKHByb3BzIHx8IHNvdXJjZSwgZnVuY3Rpb24oc3JjVmFsdWUsIGtleSkgewogICAgICAgICAgICBpZiAocHJvcHMpIHsKICAgICAgICAgICAgICBrZXkgPSBzcmNWYWx1ZTsKICAgICAgICAgICAgICBzcmNWYWx1ZSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc09iamVjdExpa2Uoc3JjVmFsdWUpKSB7CiAgICAgICAgICAgICAgc3RhY2tBIHx8IChzdGFja0EgPSBbXSk7CiAgICAgICAgICAgICAgc3RhY2tCIHx8IChzdGFja0IgPSBbXSk7CiAgICAgICAgICAgICAgYmFzZU1lcmdlRGVlcChvYmplY3QsIHNvdXJjZSwga2V5LCBiYXNlTWVyZ2UsIGN1c3RvbWl6ZXIsIHN0YWNrQSwgc3RhY2tCKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBvYmplY3Rba2V5XSwKICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY3VzdG9taXplciA/IGN1c3RvbWl6ZXIodmFsdWUsIHNyY1ZhbHVlLCBrZXksIG9iamVjdCwgc291cmNlKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgaXNDb21tb24gPSByZXN1bHQgPT09IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBpZiAoaXNDb21tb24pIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNyY1ZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoKHJlc3VsdCAhPT0gdW5kZWZpbmVkIHx8IChpc1NyY0FyciAmJiAhKGtleSBpbiBvYmplY3QpKSkgJiYgKGlzQ29tbW9uIHx8IChyZXN1bHQgPT09IHJlc3VsdCA/IChyZXN1bHQgIT09IHZhbHVlKSA6ICh2YWx1ZSA9PT0gdmFsdWUpKSkpIHsKICAgICAgICAgICAgICAgIG9iamVjdFtrZXldID0gcmVzdWx0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlTWVyZ2VEZWVwKG9iamVjdCwgc291cmNlLCBrZXksIG1lcmdlRnVuYywgY3VzdG9taXplciwgc3RhY2tBLCBzdGFja0IpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBzdGFja0EubGVuZ3RoLAogICAgICAgICAgICAgIHNyY1ZhbHVlID0gc291cmNlW2tleV07CiAgICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgICAgICAgaWYgKHN0YWNrQVtsZW5ndGhdID09IHNyY1ZhbHVlKSB7CiAgICAgICAgICAgICAgb2JqZWN0W2tleV0gPSBzdGFja0JbbGVuZ3RoXTsKICAgICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgdmFsdWUgPSBvYmplY3Rba2V5XSwKICAgICAgICAgICAgICByZXN1bHQgPSBjdXN0b21pemVyID8gY3VzdG9taXplcih2YWx1ZSwgc3JjVmFsdWUsIGtleSwgb2JqZWN0LCBzb3VyY2UpIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgIGlzQ29tbW9uID0gcmVzdWx0ID09PSB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAoaXNDb21tb24pIHsKICAgICAgICAgICAgcmVzdWx0ID0gc3JjVmFsdWU7CiAgICAgICAgICAgIGlmIChpc0FycmF5TGlrZShzcmNWYWx1ZSkgJiYgKGlzQXJyYXkoc3JjVmFsdWUpIHx8IGlzVHlwZWRBcnJheShzcmNWYWx1ZSkpKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IChpc0FycmF5TGlrZSh2YWx1ZSkgPyBhcnJheUNvcHkodmFsdWUpIDogW10pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3Qoc3JjVmFsdWUpIHx8IGlzQXJndW1lbnRzKHNyY1ZhbHVlKSkgewogICAgICAgICAgICAgIHJlc3VsdCA9IGlzQXJndW1lbnRzKHZhbHVlKSA/IHRvUGxhaW5PYmplY3QodmFsdWUpIDogKGlzUGxhaW5PYmplY3QodmFsdWUpID8gdmFsdWUgOiB7fSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaXNDb21tb24gPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3RhY2tBLnB1c2goc3JjVmFsdWUpOwogICAgICAgICAgc3RhY2tCLnB1c2gocmVzdWx0KTsKICAgICAgICAgIGlmIChpc0NvbW1vbikgewogICAgICAgICAgICBvYmplY3Rba2V5XSA9IG1lcmdlRnVuYyhyZXN1bHQsIHNyY1ZhbHVlLCBjdXN0b21pemVyLCBzdGFja0EsIHN0YWNrQik7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PT0gcmVzdWx0ID8gKHJlc3VsdCAhPT0gdmFsdWUpIDogKHZhbHVlID09PSB2YWx1ZSkpIHsKICAgICAgICAgICAgb2JqZWN0W2tleV0gPSByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJhc2VQcm9wZXJ0eShrZXkpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W2tleV07CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpIHsKICAgICAgICAgIHZhciBwYXRoS2V5ID0gKHBhdGggKyAnJyk7CiAgICAgICAgICBwYXRoID0gdG9QYXRoKHBhdGgpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gYmFzZUdldChvYmplY3QsIHBhdGgsIHBhdGhLZXkpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcykgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gaW5kZXhlcy5sZW5ndGggOiAwOwogICAgICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGluZGV4ZXNbbGVuZ3RoXTsKICAgICAgICAgICAgaWYgKGluZGV4ICE9IHByZXZpb3VzICYmIGlzSW5kZXgoaW5kZXgpKSB7CiAgICAgICAgICAgICAgdmFyIHByZXZpb3VzID0gaW5kZXg7CiAgICAgICAgICAgICAgc3BsaWNlLmNhbGwoYXJyYXksIGluZGV4LCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlUmFuZG9tKG1pbiwgbWF4KSB7CiAgICAgICAgICByZXR1cm4gbWluICsgZmxvb3IobmF0aXZlUmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlUmVkdWNlKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgaW5pdEZyb21Db2xsZWN0aW9uLCBlYWNoRnVuYykgewogICAgICAgICAgZWFjaEZ1bmMoY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7CiAgICAgICAgICAgIGFjY3VtdWxhdG9yID0gaW5pdEZyb21Db2xsZWN0aW9uID8gKGluaXRGcm9tQ29sbGVjdGlvbiA9IGZhbHNlLCB2YWx1ZSkgOiBpdGVyYXRlZShhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yOwogICAgICAgIH0KICAgICAgICB2YXIgYmFzZVNldERhdGEgPSAhbWV0YU1hcCA/IGlkZW50aXR5IDogZnVuY3Rpb24oZnVuYywgZGF0YSkgewogICAgICAgICAgbWV0YU1hcC5zZXQoZnVuYywgZGF0YSk7CiAgICAgICAgICByZXR1cm4gZnVuYzsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCkgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgICAgICAgc3RhcnQgPSBzdGFydCA9PSBudWxsID8gMCA6ICgrc3RhcnQgfHwgMCk7CiAgICAgICAgICBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgICAgIHN0YXJ0ID0gLXN0YXJ0ID4gbGVuZ3RoID8gMCA6IChsZW5ndGggKyBzdGFydCk7CiAgICAgICAgICB9CiAgICAgICAgICBlbmQgPSAoZW5kID09PSB1bmRlZmluZWQgfHwgZW5kID4gbGVuZ3RoKSA/IGxlbmd0aCA6ICgrZW5kIHx8IDApOwogICAgICAgICAgaWYgKGVuZCA8IDApIHsKICAgICAgICAgICAgZW5kICs9IGxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICAgIGxlbmd0aCA9IHN0YXJ0ID4gZW5kID8gMCA6ICgoZW5kIC0gc3RhcnQpID4+PiAwKTsKICAgICAgICAgIHN0YXJ0ID4+Pj0gMDsKICAgICAgICAgIHZhciByZXN1bHQgPSBBcnJheShsZW5ndGgpOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgcmVzdWx0W2luZGV4XSA9IGFycmF5W2luZGV4ICsgc3RhcnRdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZVNvbWUoY29sbGVjdGlvbiwgcHJlZGljYXRlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgYmFzZUVhY2goY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pOwogICAgICAgICAgICByZXR1cm4gIXJlc3VsdDsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlU29ydEJ5KGFycmF5LCBjb21wYXJlcikgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgICAgICAgIGFycmF5LnNvcnQoY29tcGFyZXIpOwogICAgICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgICAgIGFycmF5W2xlbmd0aF0gPSBhcnJheVtsZW5ndGhdLnZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlU29ydEJ5T3JkZXIoY29sbGVjdGlvbiwgaXRlcmF0ZWVzLCBvcmRlcnMpIHsKICAgICAgICAgIHZhciBjYWxsYmFjayA9IGdldENhbGxiYWNrKCksCiAgICAgICAgICAgICAgaW5kZXggPSAtMTsKICAgICAgICAgIGl0ZXJhdGVlcyA9IGFycmF5TWFwKGl0ZXJhdGVlcywgZnVuY3Rpb24oaXRlcmF0ZWUpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGl0ZXJhdGVlKTsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHJlc3VsdCA9IGJhc2VNYXAoY29sbGVjdGlvbiwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgdmFyIGNyaXRlcmlhID0gYXJyYXlNYXAoaXRlcmF0ZWVzLCBmdW5jdGlvbihpdGVyYXRlZSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVyYXRlZSh2YWx1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICdjcml0ZXJpYSc6IGNyaXRlcmlhLAogICAgICAgICAgICAgICdpbmRleCc6ICsraW5kZXgsCiAgICAgICAgICAgICAgJ3ZhbHVlJzogdmFsdWUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGJhc2VTb3J0QnkocmVzdWx0LCBmdW5jdGlvbihvYmplY3QsIG90aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBjb21wYXJlTXVsdGlwbGUob2JqZWN0LCBvdGhlciwgb3JkZXJzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlU3VtKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gMDsKICAgICAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgICAgICByZXN1bHQgKz0gK2l0ZXJhdGVlKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgfHwgMDsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzZVVuaXEoYXJyYXksIGl0ZXJhdGVlKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBpbmRleE9mID0gZ2V0SW5kZXhPZigpLAogICAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICAgICAgICBpc0NvbW1vbiA9IGluZGV4T2YgPT0gYmFzZUluZGV4T2YsCiAgICAgICAgICAgICAgaXNMYXJnZSA9IGlzQ29tbW9uICYmIGxlbmd0aCA+PSAyMDAsCiAgICAgICAgICAgICAgc2VlbiA9IGlzTGFyZ2UgPyBjcmVhdGVDYWNoZSgpIDogbnVsbCwKICAgICAgICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgICAgIGlmIChzZWVuKSB7CiAgICAgICAgICAgIGluZGV4T2YgPSBjYWNoZUluZGV4T2Y7CiAgICAgICAgICAgIGlzQ29tbW9uID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpc0xhcmdlID0gZmFsc2U7CiAgICAgICAgICAgIHNlZW4gPSBpdGVyYXRlZSA/IFtdIDogcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgb3V0ZXI6IHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XSwKICAgICAgICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUgPyBpdGVyYXRlZSh2YWx1ZSwgaW5kZXgsIGFycmF5KSA6IHZhbHVlOwogICAgICAgICAgICBpZiAoaXNDb21tb24gJiYgdmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgICAgICAgdmFyIHNlZW5JbmRleCA9IHNlZW4ubGVuZ3RoOwogICAgICAgICAgICAgIHdoaWxlIChzZWVuSW5kZXgtLSkgewogICAgICAgICAgICAgICAgaWYgKHNlZW5bc2VlbkluZGV4XSA9PT0gY29tcHV0ZWQpIHsKICAgICAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChpdGVyYXRlZSkgewogICAgICAgICAgICAgICAgc2Vlbi5wdXNoKGNvbXB1dGVkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4T2Yoc2VlbiwgY29tcHV0ZWQsIDApIDwgMCkgewogICAgICAgICAgICAgIGlmIChpdGVyYXRlZSB8fCBpc0xhcmdlKSB7CiAgICAgICAgICAgICAgICBzZWVuLnB1c2goY29tcHV0ZWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJhc2VWYWx1ZXMob2JqZWN0LCBwcm9wcykgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoLAogICAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gb2JqZWN0W3Byb3BzW2luZGV4XV07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlV2hpbGUoYXJyYXksIHByZWRpY2F0ZSwgaXNEcm9wLCBmcm9tUmlnaHQpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgICAgICAgaW5kZXggPSBmcm9tUmlnaHQgPyBsZW5ndGggOiAtMTsKICAgICAgICAgIHdoaWxlICgoZnJvbVJpZ2h0ID8gaW5kZXgtLSA6ICsraW5kZXggPCBsZW5ndGgpICYmIHByZWRpY2F0ZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkpIHt9CiAgICAgICAgICByZXR1cm4gaXNEcm9wID8gYmFzZVNsaWNlKGFycmF5LCAoZnJvbVJpZ2h0ID8gMCA6IGluZGV4KSwgKGZyb21SaWdodCA/IGluZGV4ICsgMSA6IGxlbmd0aCkpIDogYmFzZVNsaWNlKGFycmF5LCAoZnJvbVJpZ2h0ID8gaW5kZXggKyAxIDogMCksIChmcm9tUmlnaHQgPyBsZW5ndGggOiBpbmRleCkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiYXNlV3JhcHBlclZhbHVlKHZhbHVlLCBhY3Rpb25zKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgTGF6eVdyYXBwZXIpIHsKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnZhbHVlKCk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBhY3Rpb25zLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gW3Jlc3VsdF0sCiAgICAgICAgICAgICAgICBhY3Rpb24gPSBhY3Rpb25zW2luZGV4XTsKICAgICAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhY3Rpb24uYXJncyk7CiAgICAgICAgICAgIHJlc3VsdCA9IGFjdGlvbi5mdW5jLmFwcGx5KGFjdGlvbi50aGlzQXJnLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJpbmFyeUluZGV4KGFycmF5LCB2YWx1ZSwgcmV0SGlnaGVzdCkgewogICAgICAgICAgdmFyIGxvdyA9IDAsCiAgICAgICAgICAgICAgaGlnaCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogbG93OwogICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSA9PT0gdmFsdWUgJiYgaGlnaCA8PSBIQUxGX01BWF9BUlJBWV9MRU5HVEgpIHsKICAgICAgICAgICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgICAgICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+PiAxLAogICAgICAgICAgICAgICAgICBjb21wdXRlZCA9IGFycmF5W21pZF07CiAgICAgICAgICAgICAgaWYgKChyZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKSkgJiYgY29tcHV0ZWQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvdyA9IG1pZCArIDE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGhpZ2ggPSBtaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoaWdoOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGJpbmFyeUluZGV4QnkoYXJyYXksIHZhbHVlLCBpZGVudGl0eSwgcmV0SGlnaGVzdCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJpbmFyeUluZGV4QnkoYXJyYXksIHZhbHVlLCBpdGVyYXRlZSwgcmV0SGlnaGVzdCkgewogICAgICAgICAgdmFsdWUgPSBpdGVyYXRlZSh2YWx1ZSk7CiAgICAgICAgICB2YXIgbG93ID0gMCwKICAgICAgICAgICAgICBoaWdoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLAogICAgICAgICAgICAgIHZhbElzTmFOID0gdmFsdWUgIT09IHZhbHVlLAogICAgICAgICAgICAgIHZhbElzTnVsbCA9IHZhbHVlID09PSBudWxsLAogICAgICAgICAgICAgIHZhbElzVW5kZWYgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkOwogICAgICAgICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgICAgICAgdmFyIG1pZCA9IGZsb29yKChsb3cgKyBoaWdoKSAvIDIpLAogICAgICAgICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZShhcnJheVttaWRdKSwKICAgICAgICAgICAgICAgIGlzRGVmID0gY29tcHV0ZWQgIT09IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGlzUmVmbGV4aXZlID0gY29tcHV0ZWQgPT09IGNvbXB1dGVkOwogICAgICAgICAgICBpZiAodmFsSXNOYU4pIHsKICAgICAgICAgICAgICB2YXIgc2V0TG93ID0gaXNSZWZsZXhpdmUgfHwgcmV0SGlnaGVzdDsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWxJc051bGwpIHsKICAgICAgICAgICAgICBzZXRMb3cgPSBpc1JlZmxleGl2ZSAmJiBpc0RlZiAmJiAocmV0SGlnaGVzdCB8fCBjb21wdXRlZCAhPSBudWxsKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWxJc1VuZGVmKSB7CiAgICAgICAgICAgICAgc2V0TG93ID0gaXNSZWZsZXhpdmUgJiYgKHJldEhpZ2hlc3QgfHwgaXNEZWYpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXB1dGVkID09IG51bGwpIHsKICAgICAgICAgICAgICBzZXRMb3cgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZXRMb3cgPSByZXRIaWdoZXN0ID8gKGNvbXB1dGVkIDw9IHZhbHVlKSA6IChjb21wdXRlZCA8IHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2V0TG93KSB7CiAgICAgICAgICAgICAgbG93ID0gbWlkICsgMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBoaWdoID0gbWlkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmF0aXZlTWluKGhpZ2gsIE1BWF9BUlJBWV9JTkRFWCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJpbmRDYWxsYmFjayhmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkgewogICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgcmV0dXJuIGlkZW50aXR5OwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXNBcmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gZnVuYzsKICAgICAgICAgIH0KICAgICAgICAgIHN3aXRjaCAoYXJnQ291bnQpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCB2YWx1ZSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIsIGtleSwgb2JqZWN0LCBzb3VyY2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgdmFsdWUsIG90aGVyLCBrZXksIG9iamVjdCwgc291cmNlKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYnVmZmVyQ2xvbmUoYnVmZmVyKSB7CiAgICAgICAgICByZXR1cm4gYnVmZmVyU2xpY2UuY2FsbChidWZmZXIsIDApOwogICAgICAgIH0KICAgICAgICBpZiAoIWJ1ZmZlclNsaWNlKSB7CiAgICAgICAgICBidWZmZXJDbG9uZSA9ICEoQXJyYXlCdWZmZXIgJiYgVWludDhBcnJheSkgPyBjb25zdGFudChudWxsKSA6IGZ1bmN0aW9uKGJ1ZmZlcikgewogICAgICAgICAgICB2YXIgYnl0ZUxlbmd0aCA9IGJ1ZmZlci5ieXRlTGVuZ3RoLAogICAgICAgICAgICAgICAgZmxvYXRMZW5ndGggPSBGbG9hdDY0QXJyYXkgPyBmbG9vcihieXRlTGVuZ3RoIC8gRkxPQVQ2NF9CWVRFU19QRVJfRUxFTUVOVCkgOiAwLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gZmxvYXRMZW5ndGggKiBGTE9BVDY0X0JZVEVTX1BFUl9FTEVNRU5ULAogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IEFycmF5QnVmZmVyKGJ5dGVMZW5ndGgpOwogICAgICAgICAgICBpZiAoZmxvYXRMZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBGbG9hdDY0QXJyYXkocmVzdWx0LCAwLCBmbG9hdExlbmd0aCk7CiAgICAgICAgICAgICAgdmlldy5zZXQobmV3IEZsb2F0NjRBcnJheShidWZmZXIsIDAsIGZsb2F0TGVuZ3RoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJ5dGVMZW5ndGggIT0gb2Zmc2V0KSB7CiAgICAgICAgICAgICAgdmlldyA9IG5ldyBVaW50OEFycmF5KHJlc3VsdCwgb2Zmc2V0KTsKICAgICAgICAgICAgICB2aWV3LnNldChuZXcgVWludDhBcnJheShidWZmZXIsIG9mZnNldCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjb21wb3NlQXJncyhhcmdzLCBwYXJ0aWFscywgaG9sZGVycykgewogICAgICAgICAgdmFyIGhvbGRlcnNMZW5ndGggPSBob2xkZXJzLmxlbmd0aCwKICAgICAgICAgICAgICBhcmdzSW5kZXggPSAtMSwKICAgICAgICAgICAgICBhcmdzTGVuZ3RoID0gbmF0aXZlTWF4KGFyZ3MubGVuZ3RoIC0gaG9sZGVyc0xlbmd0aCwgMCksCiAgICAgICAgICAgICAgbGVmdEluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVmdExlbmd0aCA9IHBhcnRpYWxzLmxlbmd0aCwKICAgICAgICAgICAgICByZXN1bHQgPSBBcnJheShhcmdzTGVuZ3RoICsgbGVmdExlbmd0aCk7CiAgICAgICAgICB3aGlsZSAoKytsZWZ0SW5kZXggPCBsZWZ0TGVuZ3RoKSB7CiAgICAgICAgICAgIHJlc3VsdFtsZWZ0SW5kZXhdID0gcGFydGlhbHNbbGVmdEluZGV4XTsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlICgrK2FyZ3NJbmRleCA8IGhvbGRlcnNMZW5ndGgpIHsKICAgICAgICAgICAgcmVzdWx0W2hvbGRlcnNbYXJnc0luZGV4XV0gPSBhcmdzW2FyZ3NJbmRleF07CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aC0tKSB7CiAgICAgICAgICAgIHJlc3VsdFtsZWZ0SW5kZXgrK10gPSBhcmdzW2FyZ3NJbmRleCsrXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNvbXBvc2VBcmdzUmlnaHQoYXJncywgcGFydGlhbHMsIGhvbGRlcnMpIHsKICAgICAgICAgIHZhciBob2xkZXJzSW5kZXggPSAtMSwKICAgICAgICAgICAgICBob2xkZXJzTGVuZ3RoID0gaG9sZGVycy5sZW5ndGgsCiAgICAgICAgICAgICAgYXJnc0luZGV4ID0gLTEsCiAgICAgICAgICAgICAgYXJnc0xlbmd0aCA9IG5hdGl2ZU1heChhcmdzLmxlbmd0aCAtIGhvbGRlcnNMZW5ndGgsIDApLAogICAgICAgICAgICAgIHJpZ2h0SW5kZXggPSAtMSwKICAgICAgICAgICAgICByaWdodExlbmd0aCA9IHBhcnRpYWxzLmxlbmd0aCwKICAgICAgICAgICAgICByZXN1bHQgPSBBcnJheShhcmdzTGVuZ3RoICsgcmlnaHRMZW5ndGgpOwogICAgICAgICAgd2hpbGUgKCsrYXJnc0luZGV4IDwgYXJnc0xlbmd0aCkgewogICAgICAgICAgICByZXN1bHRbYXJnc0luZGV4XSA9IGFyZ3NbYXJnc0luZGV4XTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBvZmZzZXQgPSBhcmdzSW5kZXg7CiAgICAgICAgICB3aGlsZSAoKytyaWdodEluZGV4IDwgcmlnaHRMZW5ndGgpIHsKICAgICAgICAgICAgcmVzdWx0W29mZnNldCArIHJpZ2h0SW5kZXhdID0gcGFydGlhbHNbcmlnaHRJbmRleF07CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoKytob2xkZXJzSW5kZXggPCBob2xkZXJzTGVuZ3RoKSB7CiAgICAgICAgICAgIHJlc3VsdFtvZmZzZXQgKyBob2xkZXJzW2hvbGRlcnNJbmRleF1dID0gYXJnc1thcmdzSW5kZXgrK107CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVBZ2dyZWdhdG9yKHNldHRlciwgaW5pdGlhbGl6ZXIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZSwgdGhpc0FyZykgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gaW5pdGlhbGl6ZXIgPyBpbml0aWFsaXplcigpIDoge307CiAgICAgICAgICAgIGl0ZXJhdGVlID0gZ2V0Q2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOwogICAgICAgICAgICBpZiAoaXNBcnJheShjb2xsZWN0aW9uKSkgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgICAgICBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKICAgICAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY29sbGVjdGlvbltpbmRleF07CiAgICAgICAgICAgICAgICBzZXR0ZXIocmVzdWx0LCB2YWx1ZSwgaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSwgY29sbGVjdGlvbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHNldHRlcihyZXN1bHQsIHZhbHVlLCBpdGVyYXRlZSh2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSwgY29sbGVjdGlvbik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFzc2lnbmVyKGFzc2lnbmVyKSB7CiAgICAgICAgICByZXR1cm4gcmVzdFBhcmFtKGZ1bmN0aW9uKG9iamVjdCwgc291cmNlcykgewogICAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICAgIGxlbmd0aCA9IG9iamVjdCA9PSBudWxsID8gMCA6IHNvdXJjZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgY3VzdG9taXplciA9IGxlbmd0aCA+IDIgPyBzb3VyY2VzW2xlbmd0aCAtIDJdIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgZ3VhcmQgPSBsZW5ndGggPiAyID8gc291cmNlc1syXSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHRoaXNBcmcgPSBsZW5ndGggPiAxID8gc291cmNlc1tsZW5ndGggLSAxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICBjdXN0b21pemVyID0gYmluZENhbGxiYWNrKGN1c3RvbWl6ZXIsIHRoaXNBcmcsIDUpOwogICAgICAgICAgICAgIGxlbmd0aCAtPSAyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGN1c3RvbWl6ZXIgPSB0eXBlb2YgdGhpc0FyZyA9PSAnZnVuY3Rpb24nID8gdGhpc0FyZyA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBsZW5ndGggLT0gKGN1c3RvbWl6ZXIgPyAxIDogMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKHNvdXJjZXNbMF0sIHNvdXJjZXNbMV0sIGd1YXJkKSkgewogICAgICAgICAgICAgIGN1c3RvbWl6ZXIgPSBsZW5ndGggPCAzID8gdW5kZWZpbmVkIDogY3VzdG9taXplcjsKICAgICAgICAgICAgICBsZW5ndGggPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHNvdXJjZXNbaW5kZXhdOwogICAgICAgICAgICAgIGlmIChzb3VyY2UpIHsKICAgICAgICAgICAgICAgIGFzc2lnbmVyKG9iamVjdCwgc291cmNlLCBjdXN0b21pemVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVCYXNlRWFjaChlYWNoRnVuYywgZnJvbVJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY29sbGVjdGlvbiwgaXRlcmF0ZWUpIHsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBnZXRMZW5ndGgoY29sbGVjdGlvbikgOiAwOwogICAgICAgICAgICBpZiAoIWlzTGVuZ3RoKGxlbmd0aCkpIHsKICAgICAgICAgICAgICByZXR1cm4gZWFjaEZ1bmMoY29sbGVjdGlvbiwgaXRlcmF0ZWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xLAogICAgICAgICAgICAgICAgaXRlcmFibGUgPSB0b09iamVjdChjb2xsZWN0aW9uKTsKICAgICAgICAgICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgICAgICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVbaW5kZXhdLCBpbmRleCwgaXRlcmFibGUpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQmFzZUZvcihmcm9tUmlnaHQpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QsIGl0ZXJhdGVlLCBrZXlzRnVuYykgewogICAgICAgICAgICB2YXIgaXRlcmFibGUgPSB0b09iamVjdChvYmplY3QpLAogICAgICAgICAgICAgICAgcHJvcHMgPSBrZXlzRnVuYyhvYmplY3QpLAogICAgICAgICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoLAogICAgICAgICAgICAgICAgaW5kZXggPSBmcm9tUmlnaHQgPyBsZW5ndGggOiAtMTsKICAgICAgICAgICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgICAgICAgICB2YXIga2V5ID0gcHJvcHNbaW5kZXhdOwogICAgICAgICAgICAgIGlmIChpdGVyYXRlZShpdGVyYWJsZVtrZXldLCBrZXksIGl0ZXJhYmxlKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQmluZFdyYXBwZXIoZnVuYywgdGhpc0FyZykgewogICAgICAgICAgdmFyIEN0b3IgPSBjcmVhdGVDdG9yV3JhcHBlcihmdW5jKTsKICAgICAgICAgIGZ1bmN0aW9uIHdyYXBwZXIoKSB7CiAgICAgICAgICAgIHZhciBmbiA9ICh0aGlzICYmIHRoaXMgIT09IHJvb3QgJiYgdGhpcyBpbnN0YW5jZW9mIHdyYXBwZXIpID8gQ3RvciA6IGZ1bmM7CiAgICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzQXJnLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHdyYXBwZXI7CiAgICAgICAgfQogICAgICAgIHZhciBjcmVhdGVDYWNoZSA9ICEobmF0aXZlQ3JlYXRlICYmIFNldCkgPyBjb25zdGFudChudWxsKSA6IGZ1bmN0aW9uKHZhbHVlcykgewogICAgICAgICAgcmV0dXJuIG5ldyBTZXRDYWNoZSh2YWx1ZXMpOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ29tcG91bmRlcihjYWxsYmFjaykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmluZykgewogICAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICAgIGFycmF5ID0gd29yZHMoZGVidXJyKHN0cmluZykpLAogICAgICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgICAgICAgICAgcmVzdWx0ID0gJyc7CiAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gY2FsbGJhY2socmVzdWx0LCBhcnJheVtpbmRleF0sIGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ3RvcldyYXBwZXIoQ3RvcikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgc3dpdGNoIChhcmdzLmxlbmd0aCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ3RvcjsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEN0b3IoYXJnc1swXSk7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDdG9yKGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ3RvcihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEN0b3IoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSk7CiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDdG9yKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0aGlzQmluZGluZyA9IGJhc2VDcmVhdGUoQ3Rvci5wcm90b3R5cGUpLAogICAgICAgICAgICAgICAgcmVzdWx0ID0gQ3Rvci5hcHBseSh0aGlzQmluZGluZywgYXJncyk7CiAgICAgICAgICAgIHJldHVybiBpc09iamVjdChyZXN1bHQpID8gcmVzdWx0IDogdGhpc0JpbmRpbmc7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVDdXJyeShmbGFnKSB7CiAgICAgICAgICBmdW5jdGlvbiBjdXJyeUZ1bmMoZnVuYywgYXJpdHksIGd1YXJkKSB7CiAgICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChmdW5jLCBhcml0eSwgZ3VhcmQpKSB7CiAgICAgICAgICAgICAgYXJpdHkgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBjcmVhdGVXcmFwcGVyKGZ1bmMsIGZsYWcsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIGFyaXR5KTsKICAgICAgICAgICAgcmVzdWx0LnBsYWNlaG9sZGVyID0gY3VycnlGdW5jLnBsYWNlaG9sZGVyOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGN1cnJ5RnVuYzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRXh0cmVtdW0oY29tcGFyYXRvciwgZXhWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSB7CiAgICAgICAgICAgIGlmICh0aGlzQXJnICYmIGlzSXRlcmF0ZWVDYWxsKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSkgewogICAgICAgICAgICAgIGl0ZXJhdGVlID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpdGVyYXRlZSA9IGdldENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKTsKICAgICAgICAgICAgaWYgKGl0ZXJhdGVlLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgY29sbGVjdGlvbiA9IHRvSXRlcmFibGUoY29sbGVjdGlvbik7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGFycmF5RXh0cmVtdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IsIGV4VmFsdWUpOwogICAgICAgICAgICAgIGlmICghKGNvbGxlY3Rpb24ubGVuZ3RoICYmIHJlc3VsdCA9PT0gZXhWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBiYXNlRXh0cmVtdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGNvbXBhcmF0b3IsIGV4VmFsdWUpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRmluZChlYWNoRnVuYywgZnJvbVJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY29sbGVjdGlvbiwgcHJlZGljYXRlLCB0aGlzQXJnKSB7CiAgICAgICAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7CiAgICAgICAgICAgIGlmIChpc0FycmF5KGNvbGxlY3Rpb24pKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gYmFzZUZpbmRJbmRleChjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIGZyb21SaWdodCk7CiAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ID4gLTEgPyBjb2xsZWN0aW9uW2luZGV4XSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYmFzZUZpbmQoY29sbGVjdGlvbiwgcHJlZGljYXRlLCBlYWNoRnVuYyk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVGaW5kSW5kZXgoZnJvbVJpZ2h0KSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXksIHByZWRpY2F0ZSwgdGhpc0FyZykgewogICAgICAgICAgICBpZiAoIShhcnJheSAmJiBhcnJheS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7CiAgICAgICAgICAgIHJldHVybiBiYXNlRmluZEluZGV4KGFycmF5LCBwcmVkaWNhdGUsIGZyb21SaWdodCk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVGaW5kS2V5KG9iamVjdEZ1bmMpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QsIHByZWRpY2F0ZSwgdGhpc0FyZykgewogICAgICAgICAgICBwcmVkaWNhdGUgPSBnZXRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpOwogICAgICAgICAgICByZXR1cm4gYmFzZUZpbmQob2JqZWN0LCBwcmVkaWNhdGUsIG9iamVjdEZ1bmMsIHRydWUpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRmxvdyhmcm9tUmlnaHQpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHdyYXBwZXIsCiAgICAgICAgICAgICAgICBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgICAgICAgaW5kZXggPSBmcm9tUmlnaHQgPyBsZW5ndGggOiAtMSwKICAgICAgICAgICAgICAgIGxlZnRJbmRleCA9IDAsCiAgICAgICAgICAgICAgICBmdW5jcyA9IEFycmF5KGxlbmd0aCk7CiAgICAgICAgICAgIHdoaWxlICgoZnJvbVJpZ2h0ID8gaW5kZXgtLSA6ICsraW5kZXggPCBsZW5ndGgpKSB7CiAgICAgICAgICAgICAgdmFyIGZ1bmMgPSBmdW5jc1tsZWZ0SW5kZXgrK10gPSBhcmd1bWVudHNbaW5kZXhdOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghd3JhcHBlciAmJiBMb2Rhc2hXcmFwcGVyLnByb3RvdHlwZS50aHJ1ICYmIGdldEZ1bmNOYW1lKGZ1bmMpID09ICd3cmFwcGVyJykgewogICAgICAgICAgICAgICAgd3JhcHBlciA9IG5ldyBMb2Rhc2hXcmFwcGVyKFtdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5kZXggPSB3cmFwcGVyID8gLTEgOiBsZW5ndGg7CiAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgICAgZnVuYyA9IGZ1bmNzW2luZGV4XTsKICAgICAgICAgICAgICB2YXIgZnVuY05hbWUgPSBnZXRGdW5jTmFtZShmdW5jKSwKICAgICAgICAgICAgICAgICAgZGF0YSA9IGZ1bmNOYW1lID09ICd3cmFwcGVyJyA/IGdldERhdGEoZnVuYykgOiBudWxsOwogICAgICAgICAgICAgIGlmIChkYXRhICYmIGlzTGF6aWFibGUoZGF0YVswXSkgJiYgZGF0YVsxXSA9PSAoQVJZX0ZMQUcgfCBDVVJSWV9GTEFHIHwgUEFSVElBTF9GTEFHIHwgUkVBUkdfRkxBRykgJiYgIWRhdGFbNF0ubGVuZ3RoICYmIGRhdGFbOV0gPT0gMSkgewogICAgICAgICAgICAgICAgd3JhcHBlciA9IHdyYXBwZXJbZ2V0RnVuY05hbWUoZGF0YVswXSldLmFwcGx5KHdyYXBwZXIsIGRhdGFbM10pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3cmFwcGVyID0gKGZ1bmMubGVuZ3RoID09IDEgJiYgaXNMYXppYWJsZShmdW5jKSkgPyB3cmFwcGVyW2Z1bmNOYW1lXSgpIDogd3JhcHBlci50aHJ1KGZ1bmMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgaWYgKHdyYXBwZXIgJiYgYXJncy5sZW5ndGggPT0gMSAmJiBpc0FycmF5KGFyZ3NbMF0pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gd3JhcHBlci5wbGFudChhcmdzWzBdKS52YWx1ZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwLAogICAgICAgICAgICAgICAgICByZXN1bHQgPSBsZW5ndGggPyBmdW5jc1tpbmRleF0uYXBwbHkodGhpcywgYXJncykgOiBhcmdzWzBdOwogICAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jc1tpbmRleF0uY2FsbCh0aGlzLCByZXN1bHQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9OwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRm9yRWFjaChhcnJheUZ1bmMsIGVhY2hGdW5jKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsKICAgICAgICAgICAgcmV0dXJuICh0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyAmJiB0aGlzQXJnID09PSB1bmRlZmluZWQgJiYgaXNBcnJheShjb2xsZWN0aW9uKSkgPyBhcnJheUZ1bmMoY29sbGVjdGlvbiwgaXRlcmF0ZWUpIDogZWFjaEZ1bmMoY29sbGVjdGlvbiwgYmluZENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVGb3JJbihvYmplY3RGdW5jKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0LCBpdGVyYXRlZSwgdGhpc0FyZykgewogICAgICAgICAgICBpZiAodHlwZW9mIGl0ZXJhdGVlICE9ICdmdW5jdGlvbicgfHwgdGhpc0FyZyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaXRlcmF0ZWUgPSBiaW5kQ2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvYmplY3RGdW5jKG9iamVjdCwgaXRlcmF0ZWUsIGtleXNJbik7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVGb3JPd24ob2JqZWN0RnVuYykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVyYXRlZSAhPSAnZnVuY3Rpb24nIHx8IHRoaXNBcmcgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGl0ZXJhdGVlID0gYmluZENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb2JqZWN0RnVuYyhvYmplY3QsIGl0ZXJhdGVlKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdE1hcHBlcihpc01hcEtleXMpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QsIGl0ZXJhdGVlLCB0aGlzQXJnKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgICAgICAgaXRlcmF0ZWUgPSBnZXRDYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgMyk7CiAgICAgICAgICAgIGJhc2VGb3JPd24ob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmplY3QpIHsKICAgICAgICAgICAgICB2YXIgbWFwcGVkID0gaXRlcmF0ZWUodmFsdWUsIGtleSwgb2JqZWN0KTsKICAgICAgICAgICAgICBrZXkgPSBpc01hcEtleXMgPyBtYXBwZWQgOiBrZXk7CiAgICAgICAgICAgICAgdmFsdWUgPSBpc01hcEtleXMgPyB2YWx1ZSA6IG1hcHBlZDsKICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhZERpcihmcm9tUmlnaHQpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzdHJpbmcsIGxlbmd0aCwgY2hhcnMpIHsKICAgICAgICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7CiAgICAgICAgICAgIHJldHVybiAoZnJvbVJpZ2h0ID8gc3RyaW5nIDogJycpICsgY3JlYXRlUGFkZGluZyhzdHJpbmcsIGxlbmd0aCwgY2hhcnMpICsgKGZyb21SaWdodCA/ICcnIDogc3RyaW5nKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhcnRpYWwoZmxhZykgewogICAgICAgICAgdmFyIHBhcnRpYWxGdW5jID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGZ1bmMsIHBhcnRpYWxzKSB7CiAgICAgICAgICAgIHZhciBob2xkZXJzID0gcmVwbGFjZUhvbGRlcnMocGFydGlhbHMsIHBhcnRpYWxGdW5jLnBsYWNlaG9sZGVyKTsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVdyYXBwZXIoZnVuYywgZmxhZywgbnVsbCwgcGFydGlhbHMsIGhvbGRlcnMpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gcGFydGlhbEZ1bmM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVJlZHVjZShhcnJheUZ1bmMsIGVhY2hGdW5jKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIGFjY3VtdWxhdG9yLCB0aGlzQXJnKSB7CiAgICAgICAgICAgIHZhciBpbml0RnJvbUFycmF5ID0gYXJndW1lbnRzLmxlbmd0aCA8IDM7CiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIGl0ZXJhdGVlID09ICdmdW5jdGlvbicgJiYgdGhpc0FyZyA9PT0gdW5kZWZpbmVkICYmIGlzQXJyYXkoY29sbGVjdGlvbikpID8gYXJyYXlGdW5jKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgaW5pdEZyb21BcnJheSkgOiBiYXNlUmVkdWNlKGNvbGxlY3Rpb24sIGdldENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCA0KSwgYWNjdW11bGF0b3IsIGluaXRGcm9tQXJyYXksIGVhY2hGdW5jKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUh5YnJpZFdyYXBwZXIoZnVuYywgYml0bWFzaywgdGhpc0FyZywgcGFydGlhbHMsIGhvbGRlcnMsIHBhcnRpYWxzUmlnaHQsIGhvbGRlcnNSaWdodCwgYXJnUG9zLCBhcnksIGFyaXR5KSB7CiAgICAgICAgICB2YXIgaXNBcnkgPSBiaXRtYXNrICYgQVJZX0ZMQUcsCiAgICAgICAgICAgICAgaXNCaW5kID0gYml0bWFzayAmIEJJTkRfRkxBRywKICAgICAgICAgICAgICBpc0JpbmRLZXkgPSBiaXRtYXNrICYgQklORF9LRVlfRkxBRywKICAgICAgICAgICAgICBpc0N1cnJ5ID0gYml0bWFzayAmIENVUlJZX0ZMQUcsCiAgICAgICAgICAgICAgaXNDdXJyeUJvdW5kID0gYml0bWFzayAmIENVUlJZX0JPVU5EX0ZMQUcsCiAgICAgICAgICAgICAgaXNDdXJyeVJpZ2h0ID0gYml0bWFzayAmIENVUlJZX1JJR0hUX0ZMQUcsCiAgICAgICAgICAgICAgQ3RvciA9IGlzQmluZEtleSA/IG51bGwgOiBjcmVhdGVDdG9yV3JhcHBlcihmdW5jKTsKICAgICAgICAgIGZ1bmN0aW9uIHdyYXBwZXIoKSB7CiAgICAgICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgICAgICAgaW5kZXggPSBsZW5ndGgsCiAgICAgICAgICAgICAgICBhcmdzID0gQXJyYXkobGVuZ3RoKTsKICAgICAgICAgICAgd2hpbGUgKGluZGV4LS0pIHsKICAgICAgICAgICAgICBhcmdzW2luZGV4XSA9IGFyZ3VtZW50c1tpbmRleF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBhcnRpYWxzKSB7CiAgICAgICAgICAgICAgYXJncyA9IGNvbXBvc2VBcmdzKGFyZ3MsIHBhcnRpYWxzLCBob2xkZXJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFydGlhbHNSaWdodCkgewogICAgICAgICAgICAgIGFyZ3MgPSBjb21wb3NlQXJnc1JpZ2h0KGFyZ3MsIHBhcnRpYWxzUmlnaHQsIGhvbGRlcnNSaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzQ3VycnkgfHwgaXNDdXJyeVJpZ2h0KSB7CiAgICAgICAgICAgICAgdmFyIHBsYWNlaG9sZGVyID0gd3JhcHBlci5wbGFjZWhvbGRlciwKICAgICAgICAgICAgICAgICAgYXJnc0hvbGRlcnMgPSByZXBsYWNlSG9sZGVycyhhcmdzLCBwbGFjZWhvbGRlcik7CiAgICAgICAgICAgICAgbGVuZ3RoIC09IGFyZ3NIb2xkZXJzLmxlbmd0aDsKICAgICAgICAgICAgICBpZiAobGVuZ3RoIDwgYXJpdHkpIHsKICAgICAgICAgICAgICAgIHZhciBuZXdBcmdQb3MgPSBhcmdQb3MgPyBhcnJheUNvcHkoYXJnUG9zKSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgbmV3QXJpdHkgPSBuYXRpdmVNYXgoYXJpdHkgLSBsZW5ndGgsIDApLAogICAgICAgICAgICAgICAgICAgIG5ld3NIb2xkZXJzID0gaXNDdXJyeSA/IGFyZ3NIb2xkZXJzIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBuZXdIb2xkZXJzUmlnaHQgPSBpc0N1cnJ5ID8gbnVsbCA6IGFyZ3NIb2xkZXJzLAogICAgICAgICAgICAgICAgICAgIG5ld1BhcnRpYWxzID0gaXNDdXJyeSA/IGFyZ3MgOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG5ld1BhcnRpYWxzUmlnaHQgPSBpc0N1cnJ5ID8gbnVsbCA6IGFyZ3M7CiAgICAgICAgICAgICAgICBiaXRtYXNrIHw9IChpc0N1cnJ5ID8gUEFSVElBTF9GTEFHIDogUEFSVElBTF9SSUdIVF9GTEFHKTsKICAgICAgICAgICAgICAgIGJpdG1hc2sgJj0gfihpc0N1cnJ5ID8gUEFSVElBTF9SSUdIVF9GTEFHIDogUEFSVElBTF9GTEFHKTsKICAgICAgICAgICAgICAgIGlmICghaXNDdXJyeUJvdW5kKSB7CiAgICAgICAgICAgICAgICAgIGJpdG1hc2sgJj0gfihCSU5EX0ZMQUcgfCBCSU5EX0tFWV9GTEFHKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0gW2Z1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIG5ld1BhcnRpYWxzLCBuZXdzSG9sZGVycywgbmV3UGFydGlhbHNSaWdodCwgbmV3SG9sZGVyc1JpZ2h0LCBuZXdBcmdQb3MsIGFyeSwgbmV3QXJpdHldLAogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUh5YnJpZFdyYXBwZXIuYXBwbHkodW5kZWZpbmVkLCBuZXdEYXRhKTsKICAgICAgICAgICAgICAgIGlmIChpc0xhemlhYmxlKGZ1bmMpKSB7CiAgICAgICAgICAgICAgICAgIHNldERhdGEocmVzdWx0LCBuZXdEYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHRoaXNCaW5kaW5nID0gaXNCaW5kID8gdGhpc0FyZyA6IHRoaXMsCiAgICAgICAgICAgICAgICBmbiA9IGlzQmluZEtleSA/IHRoaXNCaW5kaW5nW2Z1bmNdIDogZnVuYzsKICAgICAgICAgICAgaWYgKGFyZ1BvcykgewogICAgICAgICAgICAgIGFyZ3MgPSByZW9yZGVyKGFyZ3MsIGFyZ1Bvcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzQXJ5ICYmIGFyeSA8IGFyZ3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgYXJncy5sZW5ndGggPSBhcnk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMgJiYgdGhpcyAhPT0gcm9vdCAmJiB0aGlzIGluc3RhbmNlb2Ygd3JhcHBlcikgewogICAgICAgICAgICAgIGZuID0gQ3RvciB8fCBjcmVhdGVDdG9yV3JhcHBlcihmdW5jKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpc0JpbmRpbmcsIGFyZ3MpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHdyYXBwZXI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhZGRpbmcoc3RyaW5nLCBsZW5ndGgsIGNoYXJzKSB7CiAgICAgICAgICB2YXIgc3RyTGVuZ3RoID0gc3RyaW5nLmxlbmd0aDsKICAgICAgICAgIGxlbmd0aCA9ICtsZW5ndGg7CiAgICAgICAgICBpZiAoc3RyTGVuZ3RoID49IGxlbmd0aCB8fCAhbmF0aXZlSXNGaW5pdGUobGVuZ3RoKSkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcGFkTGVuZ3RoID0gbGVuZ3RoIC0gc3RyTGVuZ3RoOwogICAgICAgICAgY2hhcnMgPSBjaGFycyA9PSBudWxsID8gJyAnIDogKGNoYXJzICsgJycpOwogICAgICAgICAgcmV0dXJuIHJlcGVhdChjaGFycywgY2VpbChwYWRMZW5ndGggLyBjaGFycy5sZW5ndGgpKS5zbGljZSgwLCBwYWRMZW5ndGgpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVQYXJ0aWFsV3JhcHBlcihmdW5jLCBiaXRtYXNrLCB0aGlzQXJnLCBwYXJ0aWFscykgewogICAgICAgICAgdmFyIGlzQmluZCA9IGJpdG1hc2sgJiBCSU5EX0ZMQUcsCiAgICAgICAgICAgICAgQ3RvciA9IGNyZWF0ZUN0b3JXcmFwcGVyKGZ1bmMpOwogICAgICAgICAgZnVuY3Rpb24gd3JhcHBlcigpIHsKICAgICAgICAgICAgdmFyIGFyZ3NJbmRleCA9IC0xLAogICAgICAgICAgICAgICAgYXJnc0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCiAgICAgICAgICAgICAgICBsZWZ0SW5kZXggPSAtMSwKICAgICAgICAgICAgICAgIGxlZnRMZW5ndGggPSBwYXJ0aWFscy5sZW5ndGgsCiAgICAgICAgICAgICAgICBhcmdzID0gQXJyYXkoYXJnc0xlbmd0aCArIGxlZnRMZW5ndGgpOwogICAgICAgICAgICB3aGlsZSAoKytsZWZ0SW5kZXggPCBsZWZ0TGVuZ3RoKSB7CiAgICAgICAgICAgICAgYXJnc1tsZWZ0SW5kZXhdID0gcGFydGlhbHNbbGVmdEluZGV4XTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aC0tKSB7CiAgICAgICAgICAgICAgYXJnc1tsZWZ0SW5kZXgrK10gPSBhcmd1bWVudHNbKythcmdzSW5kZXhdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBmbiA9ICh0aGlzICYmIHRoaXMgIT09IHJvb3QgJiYgdGhpcyBpbnN0YW5jZW9mIHdyYXBwZXIpID8gQ3RvciA6IGZ1bmM7CiAgICAgICAgICAgIHJldHVybiBmbi5hcHBseShpc0JpbmQgPyB0aGlzQXJnIDogdGhpcywgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gd3JhcHBlcjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlU29ydGVkSW5kZXgocmV0SGlnaGVzdCkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFycmF5LCB2YWx1ZSwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsKICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gZ2V0Q2FsbGJhY2soaXRlcmF0ZWUpOwogICAgICAgICAgICByZXR1cm4gKGl0ZXJhdGVlID09IG51bGwgJiYgY2FsbGJhY2sgPT09IGJhc2VDYWxsYmFjaykgPyBiaW5hcnlJbmRleChhcnJheSwgdmFsdWUsIHJldEhpZ2hlc3QpIDogYmluYXJ5SW5kZXhCeShhcnJheSwgdmFsdWUsIGNhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAxKSwgcmV0SGlnaGVzdCk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVXcmFwcGVyKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBhcmdQb3MsIGFyeSwgYXJpdHkpIHsKICAgICAgICAgIHZhciBpc0JpbmRLZXkgPSBiaXRtYXNrICYgQklORF9LRVlfRkxBRzsKICAgICAgICAgIGlmICghaXNCaW5kS2V5ICYmIHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGxlbmd0aCA9IHBhcnRpYWxzID8gcGFydGlhbHMubGVuZ3RoIDogMDsKICAgICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICAgIGJpdG1hc2sgJj0gfihQQVJUSUFMX0ZMQUcgfCBQQVJUSUFMX1JJR0hUX0ZMQUcpOwogICAgICAgICAgICBwYXJ0aWFscyA9IGhvbGRlcnMgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbGVuZ3RoIC09IChob2xkZXJzID8gaG9sZGVycy5sZW5ndGggOiAwKTsKICAgICAgICAgIGlmIChiaXRtYXNrICYgUEFSVElBTF9SSUdIVF9GTEFHKSB7CiAgICAgICAgICAgIHZhciBwYXJ0aWFsc1JpZ2h0ID0gcGFydGlhbHMsCiAgICAgICAgICAgICAgICBob2xkZXJzUmlnaHQgPSBob2xkZXJzOwogICAgICAgICAgICBwYXJ0aWFscyA9IGhvbGRlcnMgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGRhdGEgPSBpc0JpbmRLZXkgPyBudWxsIDogZ2V0RGF0YShmdW5jKSwKICAgICAgICAgICAgICBuZXdEYXRhID0gW2Z1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBwYXJ0aWFsc1JpZ2h0LCBob2xkZXJzUmlnaHQsIGFyZ1BvcywgYXJ5LCBhcml0eV07CiAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICBtZXJnZURhdGEobmV3RGF0YSwgZGF0YSk7CiAgICAgICAgICAgIGJpdG1hc2sgPSBuZXdEYXRhWzFdOwogICAgICAgICAgICBhcml0eSA9IG5ld0RhdGFbOV07CiAgICAgICAgICB9CiAgICAgICAgICBuZXdEYXRhWzldID0gYXJpdHkgPT0gbnVsbCA/IChpc0JpbmRLZXkgPyAwIDogZnVuYy5sZW5ndGgpIDogKG5hdGl2ZU1heChhcml0eSAtIGxlbmd0aCwgMCkgfHwgMCk7CiAgICAgICAgICBpZiAoYml0bWFzayA9PSBCSU5EX0ZMQUcpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGNyZWF0ZUJpbmRXcmFwcGVyKG5ld0RhdGFbMF0sIG5ld0RhdGFbMl0pOwogICAgICAgICAgfSBlbHNlIGlmICgoYml0bWFzayA9PSBQQVJUSUFMX0ZMQUcgfHwgYml0bWFzayA9PSAoQklORF9GTEFHIHwgUEFSVElBTF9GTEFHKSkgJiYgIW5ld0RhdGFbNF0ubGVuZ3RoKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZVBhcnRpYWxXcmFwcGVyLmFwcGx5KHVuZGVmaW5lZCwgbmV3RGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBjcmVhdGVIeWJyaWRXcmFwcGVyLmFwcGx5KHVuZGVmaW5lZCwgbmV3RGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc2V0dGVyID0gZGF0YSA/IGJhc2VTZXREYXRhIDogc2V0RGF0YTsKICAgICAgICAgIHJldHVybiBzZXR0ZXIocmVzdWx0LCBuZXdEYXRhKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZXF1YWxBcnJheXMoYXJyYXksIG90aGVyLCBlcXVhbEZ1bmMsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBhcnJMZW5ndGggPSBhcnJheS5sZW5ndGgsCiAgICAgICAgICAgICAgb3RoTGVuZ3RoID0gb3RoZXIubGVuZ3RoOwogICAgICAgICAgaWYgKGFyckxlbmd0aCAhPSBvdGhMZW5ndGggJiYgIShpc0xvb3NlICYmIG90aExlbmd0aCA+IGFyckxlbmd0aCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBhcnJMZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGFyclZhbHVlID0gYXJyYXlbaW5kZXhdLAogICAgICAgICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltpbmRleF0sCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjdXN0b21pemVyID8gY3VzdG9taXplcihpc0xvb3NlID8gb3RoVmFsdWUgOiBhcnJWYWx1ZSwgaXNMb29zZSA/IGFyclZhbHVlIDogb3RoVmFsdWUsIGluZGV4KSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNMb29zZSkgewogICAgICAgICAgICAgIGlmICghYXJyYXlTb21lKG90aGVyLCBmdW5jdGlvbihvdGhWYWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFyclZhbHVlID09PSBvdGhWYWx1ZSB8fCBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQik7CiAgICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIShhcnJWYWx1ZSA9PT0gb3RoVmFsdWUgfHwgZXF1YWxGdW5jKGFyclZhbHVlLCBvdGhWYWx1ZSwgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpKSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVxdWFsQnlUYWcob2JqZWN0LCBvdGhlciwgdGFnKSB7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIGJvb2xUYWc6CiAgICAgICAgICAgIGNhc2UgZGF0ZVRhZzoKICAgICAgICAgICAgICByZXR1cm4gK29iamVjdCA9PSArb3RoZXI7CiAgICAgICAgICAgIGNhc2UgZXJyb3JUYWc6CiAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdC5uYW1lID09IG90aGVyLm5hbWUgJiYgb2JqZWN0Lm1lc3NhZ2UgPT0gb3RoZXIubWVzc2FnZTsKICAgICAgICAgICAgY2FzZSBudW1iZXJUYWc6CiAgICAgICAgICAgICAgcmV0dXJuIChvYmplY3QgIT0gK29iamVjdCkgPyBvdGhlciAhPSArb3RoZXIgOiBvYmplY3QgPT0gK290aGVyOwogICAgICAgICAgICBjYXNlIHJlZ2V4cFRhZzoKICAgICAgICAgICAgY2FzZSBzdHJpbmdUYWc6CiAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdCA9PSAob3RoZXIgKyAnJyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVxdWFsT2JqZWN0cyhvYmplY3QsIG90aGVyLCBlcXVhbEZ1bmMsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7CiAgICAgICAgICB2YXIgb2JqUHJvcHMgPSBrZXlzKG9iamVjdCksCiAgICAgICAgICAgICAgb2JqTGVuZ3RoID0gb2JqUHJvcHMubGVuZ3RoLAogICAgICAgICAgICAgIG90aFByb3BzID0ga2V5cyhvdGhlciksCiAgICAgICAgICAgICAgb3RoTGVuZ3RoID0gb3RoUHJvcHMubGVuZ3RoOwogICAgICAgICAgaWYgKG9iakxlbmd0aCAhPSBvdGhMZW5ndGggJiYgIWlzTG9vc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGluZGV4ID0gb2JqTGVuZ3RoOwogICAgICAgICAgd2hpbGUgKGluZGV4LS0pIHsKICAgICAgICAgICAgdmFyIGtleSA9IG9ialByb3BzW2luZGV4XTsKICAgICAgICAgICAgaWYgKCEoaXNMb29zZSA/IGtleSBpbiBvdGhlciA6IGhhc093blByb3BlcnR5LmNhbGwob3RoZXIsIGtleSkpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc2tpcEN0b3IgPSBpc0xvb3NlOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBvYmpMZW5ndGgpIHsKICAgICAgICAgICAga2V5ID0gb2JqUHJvcHNbaW5kZXhdOwogICAgICAgICAgICB2YXIgb2JqVmFsdWUgPSBvYmplY3Rba2V5XSwKICAgICAgICAgICAgICAgIG90aFZhbHVlID0gb3RoZXJba2V5XSwKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKGlzTG9vc2UgPyBvdGhWYWx1ZSA6IG9ialZhbHVlLCBpc0xvb3NlID8gb2JqVmFsdWUgOiBvdGhWYWx1ZSwga2V5KSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKCEocmVzdWx0ID09PSB1bmRlZmluZWQgPyBlcXVhbEZ1bmMob2JqVmFsdWUsIG90aFZhbHVlLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQikgOiByZXN1bHQpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNraXBDdG9yIHx8IChza2lwQ3RvciA9IGtleSA9PSAnY29uc3RydWN0b3InKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghc2tpcEN0b3IpIHsKICAgICAgICAgICAgdmFyIG9iakN0b3IgPSBvYmplY3QuY29uc3RydWN0b3IsCiAgICAgICAgICAgICAgICBvdGhDdG9yID0gb3RoZXIuY29uc3RydWN0b3I7CiAgICAgICAgICAgIGlmIChvYmpDdG9yICE9IG90aEN0b3IgJiYgKCdjb25zdHJ1Y3RvcicgaW4gb2JqZWN0ICYmICdjb25zdHJ1Y3RvcicgaW4gb3RoZXIpICYmICEodHlwZW9mIG9iakN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvYmpDdG9yIGluc3RhbmNlb2Ygb2JqQ3RvciAmJiB0eXBlb2Ygb3RoQ3RvciA9PSAnZnVuY3Rpb24nICYmIG90aEN0b3IgaW5zdGFuY2VvZiBvdGhDdG9yKSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldENhbGxiYWNrKGZ1bmMsIHRoaXNBcmcsIGFyZ0NvdW50KSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbG9kYXNoLmNhbGxiYWNrIHx8IGNhbGxiYWNrOwogICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSBjYWxsYmFjayA/IGJhc2VDYWxsYmFjayA6IHJlc3VsdDsKICAgICAgICAgIHJldHVybiBhcmdDb3VudCA/IHJlc3VsdChmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkgOiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBnZXREYXRhID0gIW1ldGFNYXAgPyBub29wIDogZnVuY3Rpb24oZnVuYykgewogICAgICAgICAgcmV0dXJuIG1ldGFNYXAuZ2V0KGZ1bmMpOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gZ2V0RnVuY05hbWUoZnVuYykgewogICAgICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMubmFtZSwKICAgICAgICAgICAgICBhcnJheSA9IHJlYWxOYW1lc1tyZXN1bHRdLAogICAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsKICAgICAgICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAgICAgICB2YXIgZGF0YSA9IGFycmF5W2xlbmd0aF0sCiAgICAgICAgICAgICAgICBvdGhlckZ1bmMgPSBkYXRhLmZ1bmM7CiAgICAgICAgICAgIGlmIChvdGhlckZ1bmMgPT0gbnVsbCB8fCBvdGhlckZ1bmMgPT0gZnVuYykgewogICAgICAgICAgICAgIHJldHVybiBkYXRhLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEluZGV4T2YoY29sbGVjdGlvbiwgdGFyZ2V0LCBmcm9tSW5kZXgpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBsb2Rhc2guaW5kZXhPZiB8fCBpbmRleE9mOwogICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSBpbmRleE9mID8gYmFzZUluZGV4T2YgOiByZXN1bHQ7CiAgICAgICAgICByZXR1cm4gY29sbGVjdGlvbiA/IHJlc3VsdChjb2xsZWN0aW9uLCB0YXJnZXQsIGZyb21JbmRleCkgOiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBnZXRMZW5ndGggPSBiYXNlUHJvcGVydHkoJ2xlbmd0aCcpOwogICAgICAgIGZ1bmN0aW9uIGdldE1hdGNoRGF0YShvYmplY3QpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBwYWlycyhvYmplY3QpLAogICAgICAgICAgICAgIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgICAgICAgcmVzdWx0W2xlbmd0aF1bMl0gPSBpc1N0cmljdENvbXBhcmFibGUocmVzdWx0W2xlbmd0aF1bMV0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0TmF0aXZlKG9iamVjdCwga2V5KSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogICAgICAgICAgcmV0dXJuIGlzTmF0aXZlKHZhbHVlKSA/IHZhbHVlIDogdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRWaWV3KHN0YXJ0LCBlbmQsIHRyYW5zZm9ybXMpIHsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGxlbmd0aCA9IHRyYW5zZm9ybXMgPyB0cmFuc2Zvcm1zLmxlbmd0aCA6IDA7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICB2YXIgZGF0YSA9IHRyYW5zZm9ybXNbaW5kZXhdLAogICAgICAgICAgICAgICAgc2l6ZSA9IGRhdGEuc2l6ZTsKICAgICAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICdkcm9wJzoKICAgICAgICAgICAgICAgIHN0YXJ0ICs9IHNpemU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICdkcm9wUmlnaHQnOgogICAgICAgICAgICAgICAgZW5kIC09IHNpemU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICd0YWtlJzoKICAgICAgICAgICAgICAgIGVuZCA9IG5hdGl2ZU1pbihlbmQsIHN0YXJ0ICsgc2l6ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICd0YWtlUmlnaHQnOgogICAgICAgICAgICAgICAgc3RhcnQgPSBuYXRpdmVNYXgoc3RhcnQsIGVuZCAtIHNpemUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdzdGFydCc6IHN0YXJ0LAogICAgICAgICAgICAnZW5kJzogZW5kCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpbml0Q2xvbmVBcnJheShhcnJheSkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgYXJyYXkuY29uc3RydWN0b3IobGVuZ3RoKTsKICAgICAgICAgIGlmIChsZW5ndGggJiYgdHlwZW9mIGFycmF5WzBdID09ICdzdHJpbmcnICYmIGhhc093blByb3BlcnR5LmNhbGwoYXJyYXksICdpbmRleCcpKSB7CiAgICAgICAgICAgIHJlc3VsdC5pbmRleCA9IGFycmF5LmluZGV4OwogICAgICAgICAgICByZXN1bHQuaW5wdXQgPSBhcnJheS5pbnB1dDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGluaXRDbG9uZU9iamVjdChvYmplY3QpIHsKICAgICAgICAgIHZhciBDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yOwogICAgICAgICAgaWYgKCEodHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBDdG9yIGluc3RhbmNlb2YgQ3RvcikpIHsKICAgICAgICAgICAgQ3RvciA9IE9iamVjdDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgQ3RvcjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaW5pdENsb25lQnlUYWcob2JqZWN0LCB0YWcsIGlzRGVlcCkgewogICAgICAgICAgdmFyIEN0b3IgPSBvYmplY3QuY29uc3RydWN0b3I7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIGFycmF5QnVmZmVyVGFnOgogICAgICAgICAgICAgIHJldHVybiBidWZmZXJDbG9uZShvYmplY3QpOwogICAgICAgICAgICBjYXNlIGJvb2xUYWc6CiAgICAgICAgICAgIGNhc2UgZGF0ZVRhZzoKICAgICAgICAgICAgICByZXR1cm4gbmV3IEN0b3IoK29iamVjdCk7CiAgICAgICAgICAgIGNhc2UgZmxvYXQzMlRhZzoKICAgICAgICAgICAgY2FzZSBmbG9hdDY0VGFnOgogICAgICAgICAgICBjYXNlIGludDhUYWc6CiAgICAgICAgICAgIGNhc2UgaW50MTZUYWc6CiAgICAgICAgICAgIGNhc2UgaW50MzJUYWc6CiAgICAgICAgICAgIGNhc2UgdWludDhUYWc6CiAgICAgICAgICAgIGNhc2UgdWludDhDbGFtcGVkVGFnOgogICAgICAgICAgICBjYXNlIHVpbnQxNlRhZzoKICAgICAgICAgICAgY2FzZSB1aW50MzJUYWc6CiAgICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IG9iamVjdC5idWZmZXI7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDdG9yKGlzRGVlcCA/IGJ1ZmZlckNsb25lKGJ1ZmZlcikgOiBidWZmZXIsIG9iamVjdC5ieXRlT2Zmc2V0LCBvYmplY3QubGVuZ3RoKTsKICAgICAgICAgICAgY2FzZSBudW1iZXJUYWc6CiAgICAgICAgICAgIGNhc2Ugc3RyaW5nVGFnOgogICAgICAgICAgICAgIHJldHVybiBuZXcgQ3RvcihvYmplY3QpOwogICAgICAgICAgICBjYXNlIHJlZ2V4cFRhZzoKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEN0b3Iob2JqZWN0LnNvdXJjZSwgcmVGbGFncy5leGVjKG9iamVjdCkpOwogICAgICAgICAgICAgIHJlc3VsdC5sYXN0SW5kZXggPSBvYmplY3QubGFzdEluZGV4OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaW52b2tlUGF0aChvYmplY3QsIHBhdGgsIGFyZ3MpIHsKICAgICAgICAgIGlmIChvYmplY3QgIT0gbnVsbCAmJiAhaXNLZXkocGF0aCwgb2JqZWN0KSkgewogICAgICAgICAgICBwYXRoID0gdG9QYXRoKHBhdGgpOwogICAgICAgICAgICBvYmplY3QgPSBwYXRoLmxlbmd0aCA9PSAxID8gb2JqZWN0IDogYmFzZUdldChvYmplY3QsIGJhc2VTbGljZShwYXRoLCAwLCAtMSkpOwogICAgICAgICAgICBwYXRoID0gbGFzdChwYXRoKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBmdW5jID0gb2JqZWN0ID09IG51bGwgPyBvYmplY3QgOiBvYmplY3RbcGF0aF07CiAgICAgICAgICByZXR1cm4gZnVuYyA9PSBudWxsID8gdW5kZWZpbmVkIDogZnVuYy5hcHBseShvYmplY3QsIGFyZ3MpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgoZ2V0TGVuZ3RoKHZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzSW5kZXgodmFsdWUsIGxlbmd0aCkgewogICAgICAgICAgdmFsdWUgPSAodHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8IHJlSXNVaW50LnRlc3QodmFsdWUpKSA/ICt2YWx1ZSA6IC0xOwogICAgICAgICAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyBNQVhfU0FGRV9JTlRFR0VSIDogbGVuZ3RoOwogICAgICAgICAgcmV0dXJuIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPCBsZW5ndGg7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzSXRlcmF0ZWVDYWxsKHZhbHVlLCBpbmRleCwgb2JqZWN0KSB7CiAgICAgICAgICBpZiAoIWlzT2JqZWN0KG9iamVjdCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgaW5kZXg7CiAgICAgICAgICBpZiAodHlwZSA9PSAnbnVtYmVyJyA/IChpc0FycmF5TGlrZShvYmplY3QpICYmIGlzSW5kZXgoaW5kZXgsIG9iamVjdC5sZW5ndGgpKSA6ICh0eXBlID09ICdzdHJpbmcnICYmIGluZGV4IGluIG9iamVjdCkpIHsKICAgICAgICAgICAgdmFyIG90aGVyID0gb2JqZWN0W2luZGV4XTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09PSB2YWx1ZSA/ICh2YWx1ZSA9PT0gb3RoZXIpIDogKG90aGVyICE9PSBvdGhlcik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzS2V5KHZhbHVlLCBvYmplY3QpIHsKICAgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgICAgICAgaWYgKCh0eXBlID09ICdzdHJpbmcnICYmIHJlSXNQbGFpblByb3AudGVzdCh2YWx1ZSkpIHx8IHR5cGUgPT0gJ251bWJlcicpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHJlc3VsdCA9ICFyZUlzRGVlcFByb3AudGVzdCh2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0IHx8IChvYmplY3QgIT0gbnVsbCAmJiB2YWx1ZSBpbiB0b09iamVjdChvYmplY3QpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNMYXppYWJsZShmdW5jKSB7CiAgICAgICAgICB2YXIgZnVuY05hbWUgPSBnZXRGdW5jTmFtZShmdW5jKTsKICAgICAgICAgIGlmICghKGZ1bmNOYW1lIGluIExhenlXcmFwcGVyLnByb3RvdHlwZSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIG90aGVyID0gbG9kYXNoW2Z1bmNOYW1lXTsKICAgICAgICAgIGlmIChmdW5jID09PSBvdGhlcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBkYXRhID0gZ2V0RGF0YShvdGhlcik7CiAgICAgICAgICByZXR1cm4gISFkYXRhICYmIGZ1bmMgPT09IGRhdGFbMF07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzTGVuZ3RoKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdudW1iZXInICYmIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPD0gTUFYX1NBRkVfSU5URUdFUjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNTdHJpY3RDb21wYXJhYmxlKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlICYmICFpc09iamVjdCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1lcmdlRGF0YShkYXRhLCBzb3VyY2UpIHsKICAgICAgICAgIHZhciBiaXRtYXNrID0gZGF0YVsxXSwKICAgICAgICAgICAgICBzcmNCaXRtYXNrID0gc291cmNlWzFdLAogICAgICAgICAgICAgIG5ld0JpdG1hc2sgPSBiaXRtYXNrIHwgc3JjQml0bWFzaywKICAgICAgICAgICAgICBpc0NvbW1vbiA9IG5ld0JpdG1hc2sgPCBBUllfRkxBRzsKICAgICAgICAgIHZhciBpc0NvbWJvID0gKHNyY0JpdG1hc2sgPT0gQVJZX0ZMQUcgJiYgYml0bWFzayA9PSBDVVJSWV9GTEFHKSB8fCAoc3JjQml0bWFzayA9PSBBUllfRkxBRyAmJiBiaXRtYXNrID09IFJFQVJHX0ZMQUcgJiYgZGF0YVs3XS5sZW5ndGggPD0gc291cmNlWzhdKSB8fCAoc3JjQml0bWFzayA9PSAoQVJZX0ZMQUcgfCBSRUFSR19GTEFHKSAmJiBiaXRtYXNrID09IENVUlJZX0ZMQUcpOwogICAgICAgICAgaWYgKCEoaXNDb21tb24gfHwgaXNDb21ibykpIHsKICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3JjQml0bWFzayAmIEJJTkRfRkxBRykgewogICAgICAgICAgICBkYXRhWzJdID0gc291cmNlWzJdOwogICAgICAgICAgICBuZXdCaXRtYXNrIHw9IChiaXRtYXNrICYgQklORF9GTEFHKSA/IDAgOiBDVVJSWV9CT1VORF9GTEFHOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHZhbHVlID0gc291cmNlWzNdOwogICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBwYXJ0aWFscyA9IGRhdGFbM107CiAgICAgICAgICAgIGRhdGFbM10gPSBwYXJ0aWFscyA/IGNvbXBvc2VBcmdzKHBhcnRpYWxzLCB2YWx1ZSwgc291cmNlWzRdKSA6IGFycmF5Q29weSh2YWx1ZSk7CiAgICAgICAgICAgIGRhdGFbNF0gPSBwYXJ0aWFscyA/IHJlcGxhY2VIb2xkZXJzKGRhdGFbM10sIFBMQUNFSE9MREVSKSA6IGFycmF5Q29weShzb3VyY2VbNF0pOwogICAgICAgICAgfQogICAgICAgICAgdmFsdWUgPSBzb3VyY2VbNV07CiAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgcGFydGlhbHMgPSBkYXRhWzVdOwogICAgICAgICAgICBkYXRhWzVdID0gcGFydGlhbHMgPyBjb21wb3NlQXJnc1JpZ2h0KHBhcnRpYWxzLCB2YWx1ZSwgc291cmNlWzZdKSA6IGFycmF5Q29weSh2YWx1ZSk7CiAgICAgICAgICAgIGRhdGFbNl0gPSBwYXJ0aWFscyA/IHJlcGxhY2VIb2xkZXJzKGRhdGFbNV0sIFBMQUNFSE9MREVSKSA6IGFycmF5Q29weShzb3VyY2VbNl0pOwogICAgICAgICAgfQogICAgICAgICAgdmFsdWUgPSBzb3VyY2VbN107CiAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgZGF0YVs3XSA9IGFycmF5Q29weSh2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3JjQml0bWFzayAmIEFSWV9GTEFHKSB7CiAgICAgICAgICAgIGRhdGFbOF0gPSBkYXRhWzhdID09IG51bGwgPyBzb3VyY2VbOF0gOiBuYXRpdmVNaW4oZGF0YVs4XSwgc291cmNlWzhdKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChkYXRhWzldID09IG51bGwpIHsKICAgICAgICAgICAgZGF0YVs5XSA9IHNvdXJjZVs5XTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGFbMF0gPSBzb3VyY2VbMF07CiAgICAgICAgICBkYXRhWzFdID0gbmV3Qml0bWFzazsKICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwaWNrQnlBcnJheShvYmplY3QsIHByb3BzKSB7CiAgICAgICAgICBvYmplY3QgPSB0b09iamVjdChvYmplY3QpOwogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoLAogICAgICAgICAgICAgIHJlc3VsdCA9IHt9OwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsKICAgICAgICAgICAgaWYgKGtleSBpbiBvYmplY3QpIHsKICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IG9iamVjdFtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwaWNrQnlDYWxsYmFjayhvYmplY3QsIHByZWRpY2F0ZSkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgICAgYmFzZUZvckluKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGtleSwgb2JqZWN0KSB7CiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGtleSwgb2JqZWN0KSkgewogICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmVvcmRlcihhcnJheSwgaW5kZXhlcykgewogICAgICAgICAgdmFyIGFyckxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNaW4oaW5kZXhlcy5sZW5ndGgsIGFyckxlbmd0aCksCiAgICAgICAgICAgICAgb2xkQXJyYXkgPSBhcnJheUNvcHkoYXJyYXkpOwogICAgICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGluZGV4ZXNbbGVuZ3RoXTsKICAgICAgICAgICAgYXJyYXlbbGVuZ3RoXSA9IGlzSW5kZXgoaW5kZXgsIGFyckxlbmd0aCkgPyBvbGRBcnJheVtpbmRleF0gOiB1bmRlZmluZWQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgfQogICAgICAgIHZhciBzZXREYXRhID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGNvdW50ID0gMCwKICAgICAgICAgICAgICBsYXN0Q2FsbGVkID0gMDsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBzdGFtcCA9IG5vdygpLAogICAgICAgICAgICAgICAgcmVtYWluaW5nID0gSE9UX1NQQU4gLSAoc3RhbXAgLSBsYXN0Q2FsbGVkKTsKICAgICAgICAgICAgbGFzdENhbGxlZCA9IHN0YW1wOwogICAgICAgICAgICBpZiAocmVtYWluaW5nID4gMCkgewogICAgICAgICAgICAgIGlmICgrK2NvdW50ID49IEhPVF9DT1VOVCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY291bnQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBiYXNlU2V0RGF0YShrZXksIHZhbHVlKTsKICAgICAgICAgIH07CiAgICAgICAgfSgpKTsKICAgICAgICBmdW5jdGlvbiBzaGltSXNQbGFpbk9iamVjdCh2YWx1ZSkgewogICAgICAgICAgdmFyIEN0b3IsCiAgICAgICAgICAgICAgc3VwcG9ydCA9IGxvZGFzaC5zdXBwb3J0OwogICAgICAgICAgaWYgKCEoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBvYmplY3RUYWcpIHx8ICghaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgJ2NvbnN0cnVjdG9yJykgJiYgKEN0b3IgPSB2YWx1ZS5jb25zdHJ1Y3RvciwgdHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiAhKEN0b3IgaW5zdGFuY2VvZiBDdG9yKSkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICBiYXNlRm9ySW4odmFsdWUsIGZ1bmN0aW9uKHN1YlZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgcmVzdWx0ID0ga2V5OwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0ID09PSB1bmRlZmluZWQgfHwgaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgcmVzdWx0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2hpbUtleXMob2JqZWN0KSB7CiAgICAgICAgICB2YXIgcHJvcHMgPSBrZXlzSW4ob2JqZWN0KSwKICAgICAgICAgICAgICBwcm9wc0xlbmd0aCA9IHByb3BzLmxlbmd0aCwKICAgICAgICAgICAgICBsZW5ndGggPSBwcm9wc0xlbmd0aCAmJiBvYmplY3QubGVuZ3RoOwogICAgICAgICAgdmFyIGFsbG93SW5kZXhlcyA9ICEhbGVuZ3RoICYmIGlzTGVuZ3RoKGxlbmd0aCkgJiYgKGlzQXJyYXkob2JqZWN0KSB8fCBpc0FyZ3VtZW50cyhvYmplY3QpKTsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBwcm9wc0xlbmd0aCkgewogICAgICAgICAgICB2YXIga2V5ID0gcHJvcHNbaW5kZXhdOwogICAgICAgICAgICBpZiAoKGFsbG93SW5kZXhlcyAmJiBpc0luZGV4KGtleSwgbGVuZ3RoKSkgfHwgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0b0l0ZXJhYmxlKHZhbHVlKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWlzQXJyYXlMaWtlKHZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWVzKHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpc09iamVjdCh2YWx1ZSkgPyB2YWx1ZSA6IE9iamVjdCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRvT2JqZWN0KHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gaXNPYmplY3QodmFsdWUpID8gdmFsdWUgOiBPYmplY3QodmFsdWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0b1BhdGgodmFsdWUpIHsKICAgICAgICAgIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgICBiYXNlVG9TdHJpbmcodmFsdWUpLnJlcGxhY2UocmVQcm9wTmFtZSwgZnVuY3Rpb24obWF0Y2gsIG51bWJlciwgcXVvdGUsIHN0cmluZykgewogICAgICAgICAgICByZXN1bHQucHVzaChxdW90ZSA/IHN0cmluZy5yZXBsYWNlKHJlRXNjYXBlQ2hhciwgJyQxJykgOiAobnVtYmVyIHx8IG1hdGNoKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdyYXBwZXJDbG9uZSh3cmFwcGVyKSB7CiAgICAgICAgICByZXR1cm4gd3JhcHBlciBpbnN0YW5jZW9mIExhenlXcmFwcGVyID8gd3JhcHBlci5jbG9uZSgpIDogbmV3IExvZGFzaFdyYXBwZXIod3JhcHBlci5fX3dyYXBwZWRfXywgd3JhcHBlci5fX2NoYWluX18sIGFycmF5Q29weSh3cmFwcGVyLl9fYWN0aW9uc19fKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNodW5rKGFycmF5LCBzaXplLCBndWFyZCkgewogICAgICAgICAgaWYgKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoYXJyYXksIHNpemUsIGd1YXJkKSA6IHNpemUgPT0gbnVsbCkgewogICAgICAgICAgICBzaXplID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNpemUgPSBuYXRpdmVNYXgoK3NpemUgfHwgMSwgMSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaW5kZXggPSAwLAogICAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMCwKICAgICAgICAgICAgICByZXNJbmRleCA9IC0xLAogICAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGNlaWwobGVuZ3RoIC8gc2l6ZSkpOwogICAgICAgICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHJlc3VsdFsrK3Jlc0luZGV4XSA9IGJhc2VTbGljZShhcnJheSwgaW5kZXgsIChpbmRleCArPSBzaXplKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjb21wYWN0KGFycmF5KSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDAsCiAgICAgICAgICAgICAgcmVzSW5kZXggPSAtMSwKICAgICAgICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsKICAgICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgICAgcmVzdWx0WysrcmVzSW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBkaWZmZXJlbmNlID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGFycmF5LCB2YWx1ZXMpIHsKICAgICAgICAgIHJldHVybiBpc0FycmF5TGlrZShhcnJheSkgPyBiYXNlRGlmZmVyZW5jZShhcnJheSwgYmFzZUZsYXR0ZW4odmFsdWVzLCBmYWxzZSwgdHJ1ZSkpIDogW107CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gZHJvcChhcnJheSwgbiwgZ3VhcmQpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7CiAgICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbChhcnJheSwgbiwgZ3VhcmQpIDogbiA9PSBudWxsKSB7CiAgICAgICAgICAgIG4gPSAxOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRyb3BSaWdodChhcnJheSwgbiwgZ3VhcmQpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7CiAgICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbChhcnJheSwgbiwgZ3VhcmQpIDogbiA9PSBudWxsKSB7CiAgICAgICAgICAgIG4gPSAxOwogICAgICAgICAgfQogICAgICAgICAgbiA9IGxlbmd0aCAtICgrbiB8fCAwKTsKICAgICAgICAgIHJldHVybiBiYXNlU2xpY2UoYXJyYXksIDAsIG4gPCAwID8gMCA6IG4pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkcm9wUmlnaHRXaGlsZShhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7CiAgICAgICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkgPyBiYXNlV2hpbGUoYXJyYXksIGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyksIHRydWUsIHRydWUpIDogW107CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRyb3BXaGlsZShhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7CiAgICAgICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkgPyBiYXNlV2hpbGUoYXJyYXksIGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyksIHRydWUpIDogW107CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZpbGwoYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwogICAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXJ0ICYmIHR5cGVvZiBzdGFydCAhPSAnbnVtYmVyJyAmJiBpc0l0ZXJhdGVlQ2FsbChhcnJheSwgdmFsdWUsIHN0YXJ0KSkgewogICAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgICAgIGVuZCA9IGxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBiYXNlRmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgICB2YXIgZmluZEluZGV4ID0gY3JlYXRlRmluZEluZGV4KCk7CiAgICAgICAgdmFyIGZpbmRMYXN0SW5kZXggPSBjcmVhdGVGaW5kSW5kZXgodHJ1ZSk7CiAgICAgICAgZnVuY3Rpb24gZmlyc3QoYXJyYXkpIHsKICAgICAgICAgIHJldHVybiBhcnJheSA/IGFycmF5WzBdIDogdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmbGF0dGVuKGFycmF5LCBpc0RlZXAsIGd1YXJkKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwogICAgICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKGFycmF5LCBpc0RlZXAsIGd1YXJkKSkgewogICAgICAgICAgICBpc0RlZXAgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBsZW5ndGggPyBiYXNlRmxhdHRlbihhcnJheSwgaXNEZWVwKSA6IFtdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmbGF0dGVuRGVlcChhcnJheSkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsKICAgICAgICAgIHJldHVybiBsZW5ndGggPyBiYXNlRmxhdHRlbihhcnJheSwgdHJ1ZSkgOiBbXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsKICAgICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgZnJvbUluZGV4ID09ICdudW1iZXInKSB7CiAgICAgICAgICAgIGZyb21JbmRleCA9IGZyb21JbmRleCA8IDAgPyBuYXRpdmVNYXgobGVuZ3RoICsgZnJvbUluZGV4LCAwKSA6IGZyb21JbmRleDsKICAgICAgICAgIH0gZWxzZSBpZiAoZnJvbUluZGV4KSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGJpbmFyeUluZGV4KGFycmF5LCB2YWx1ZSksCiAgICAgICAgICAgICAgICBvdGhlciA9IGFycmF5W2luZGV4XTsKICAgICAgICAgICAgaWYgKHZhbHVlID09PSB2YWx1ZSA/ICh2YWx1ZSA9PT0gb3RoZXIpIDogKG90aGVyICE9PSBvdGhlcikpIHsKICAgICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGJhc2VJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4IHx8IDApOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpbml0aWFsKGFycmF5KSB7CiAgICAgICAgICByZXR1cm4gZHJvcFJpZ2h0KGFycmF5LCAxKTsKICAgICAgICB9CiAgICAgICAgdmFyIGludGVyc2VjdGlvbiA9IHJlc3RQYXJhbShmdW5jdGlvbihhcnJheXMpIHsKICAgICAgICAgIHZhciBvdGhMZW5ndGggPSBhcnJheXMubGVuZ3RoLAogICAgICAgICAgICAgIG90aEluZGV4ID0gb3RoTGVuZ3RoLAogICAgICAgICAgICAgIGNhY2hlcyA9IEFycmF5KGxlbmd0aCksCiAgICAgICAgICAgICAgaW5kZXhPZiA9IGdldEluZGV4T2YoKSwKICAgICAgICAgICAgICBpc0NvbW1vbiA9IGluZGV4T2YgPT0gYmFzZUluZGV4T2YsCiAgICAgICAgICAgICAgcmVzdWx0ID0gW107CiAgICAgICAgICB3aGlsZSAob3RoSW5kZXgtLSkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBhcnJheXNbb3RoSW5kZXhdID0gaXNBcnJheUxpa2UodmFsdWUgPSBhcnJheXNbb3RoSW5kZXhdKSA/IHZhbHVlIDogW107CiAgICAgICAgICAgIGNhY2hlc1tvdGhJbmRleF0gPSAoaXNDb21tb24gJiYgdmFsdWUubGVuZ3RoID49IDEyMCkgPyBjcmVhdGVDYWNoZShvdGhJbmRleCAmJiB2YWx1ZSkgOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGFycmF5ID0gYXJyYXlzWzBdLAogICAgICAgICAgICAgIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwLAogICAgICAgICAgICAgIHNlZW4gPSBjYWNoZXNbMF07CiAgICAgICAgICBvdXRlcjogd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFsdWUgPSBhcnJheVtpbmRleF07CiAgICAgICAgICAgIGlmICgoc2VlbiA/IGNhY2hlSW5kZXhPZihzZWVuLCB2YWx1ZSkgOiBpbmRleE9mKHJlc3VsdCwgdmFsdWUsIDApKSA8IDApIHsKICAgICAgICAgICAgICB2YXIgb3RoSW5kZXggPSBvdGhMZW5ndGg7CiAgICAgICAgICAgICAgd2hpbGUgKC0tb3RoSW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciBjYWNoZSA9IGNhY2hlc1tvdGhJbmRleF07CiAgICAgICAgICAgICAgICBpZiAoKGNhY2hlID8gY2FjaGVJbmRleE9mKGNhY2hlLCB2YWx1ZSkgOiBpbmRleE9mKGFycmF5c1tvdGhJbmRleF0sIHZhbHVlLCAwKSkgPCAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIG91dGVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VlbikgewogICAgICAgICAgICAgICAgc2Vlbi5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIGxhc3QoYXJyYXkpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7CiAgICAgICAgICByZXR1cm4gbGVuZ3RoID8gYXJyYXlbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGxhc3RJbmRleE9mKGFycmF5LCB2YWx1ZSwgZnJvbUluZGV4KSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwogICAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGluZGV4ID0gbGVuZ3RoOwogICAgICAgICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggPT0gJ251bWJlcicpIHsKICAgICAgICAgICAgaW5kZXggPSAoZnJvbUluZGV4IDwgMCA/IG5hdGl2ZU1heChsZW5ndGggKyBmcm9tSW5kZXgsIDApIDogbmF0aXZlTWluKGZyb21JbmRleCB8fCAwLCBsZW5ndGggLSAxKSkgKyAxOwogICAgICAgICAgfSBlbHNlIGlmIChmcm9tSW5kZXgpIHsKICAgICAgICAgICAgaW5kZXggPSBiaW5hcnlJbmRleChhcnJheSwgdmFsdWUsIHRydWUpIC0gMTsKICAgICAgICAgICAgdmFyIG90aGVyID0gYXJyYXlbaW5kZXhdOwogICAgICAgICAgICBpZiAodmFsdWUgPT09IHZhbHVlID8gKHZhbHVlID09PSBvdGhlcikgOiAob3RoZXIgIT09IG90aGVyKSkgewogICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleE9mTmFOKGFycmF5LCBpbmRleCwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoaW5kZXgtLSkgewogICAgICAgICAgICBpZiAoYXJyYXlbaW5kZXhdID09PSB2YWx1ZSkgewogICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwdWxsKCkgewogICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgYXJyYXkgPSBhcmdzWzBdOwogICAgICAgICAgaWYgKCEoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSkgewogICAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaW5kZXggPSAwLAogICAgICAgICAgICAgIGluZGV4T2YgPSBnZXRJbmRleE9mKCksCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJncy5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICB2YXIgZnJvbUluZGV4ID0gMCwKICAgICAgICAgICAgICAgIHZhbHVlID0gYXJnc1tpbmRleF07CiAgICAgICAgICAgIHdoaWxlICgoZnJvbUluZGV4ID0gaW5kZXhPZihhcnJheSwgdmFsdWUsIGZyb21JbmRleCkpID4gLTEpIHsKICAgICAgICAgICAgICBzcGxpY2UuY2FsbChhcnJheSwgZnJvbUluZGV4LCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIH0KICAgICAgICB2YXIgcHVsbEF0ID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGFycmF5LCBpbmRleGVzKSB7CiAgICAgICAgICBpbmRleGVzID0gYmFzZUZsYXR0ZW4oaW5kZXhlcyk7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gYmFzZUF0KGFycmF5LCBpbmRleGVzKTsKICAgICAgICAgIGJhc2VQdWxsQXQoYXJyYXksIGluZGV4ZXMuc29ydChiYXNlQ29tcGFyZUFzY2VuZGluZykpOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiByZW1vdmUoYXJyYXksIHByZWRpY2F0ZSwgdGhpc0FyZykgewogICAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgICAgaWYgKCEoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgaW5kZXhlcyA9IFtdLAogICAgICAgICAgICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgICAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBhcnJheVtpbmRleF07CiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBhcnJheSkpIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgICAgaW5kZXhlcy5wdXNoKGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYmFzZVB1bGxBdChhcnJheSwgaW5kZXhlcyk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZXN0KGFycmF5KSB7CiAgICAgICAgICByZXR1cm4gZHJvcChhcnJheSwgMSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwogICAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGVuZCAmJiB0eXBlb2YgZW5kICE9ICdudW1iZXInICYmIGlzSXRlcmF0ZWVDYWxsKGFycmF5LCBzdGFydCwgZW5kKSkgewogICAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgICAgIGVuZCA9IGxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBiYXNlU2xpY2UoYXJyYXksIHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgICB2YXIgc29ydGVkSW5kZXggPSBjcmVhdGVTb3J0ZWRJbmRleCgpOwogICAgICAgIHZhciBzb3J0ZWRMYXN0SW5kZXggPSBjcmVhdGVTb3J0ZWRJbmRleCh0cnVlKTsKICAgICAgICBmdW5jdGlvbiB0YWtlKGFycmF5LCBuLCBndWFyZCkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsKICAgICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKGFycmF5LCBuLCBndWFyZCkgOiBuID09IG51bGwpIHsKICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmFzZVNsaWNlKGFycmF5LCAwLCBuIDwgMCA/IDAgOiBuKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdGFrZVJpZ2h0KGFycmF5LCBuLCBndWFyZCkgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsKICAgICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKGFycmF5LCBuLCBndWFyZCkgOiBuID09IG51bGwpIHsKICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICBuID0gbGVuZ3RoIC0gKCtuIHx8IDApOwogICAgICAgICAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRha2VSaWdodFdoaWxlKGFycmF5LCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsKICAgICAgICAgIHJldHVybiAoYXJyYXkgJiYgYXJyYXkubGVuZ3RoKSA/IGJhc2VXaGlsZShhcnJheSwgZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKSwgZmFsc2UsIHRydWUpIDogW107CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRha2VXaGlsZShhcnJheSwgcHJlZGljYXRlLCB0aGlzQXJnKSB7CiAgICAgICAgICByZXR1cm4gKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkgPyBiYXNlV2hpbGUoYXJyYXksIGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMykpIDogW107CiAgICAgICAgfQogICAgICAgIHZhciB1bmlvbiA9IHJlc3RQYXJhbShmdW5jdGlvbihhcnJheXMpIHsKICAgICAgICAgIHJldHVybiBiYXNlVW5pcShiYXNlRmxhdHRlbihhcnJheXMsIGZhbHNlLCB0cnVlKSk7CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gdW5pcShhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdGVlLCB0aGlzQXJnKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwogICAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzU29ydGVkICE9IG51bGwgJiYgdHlwZW9mIGlzU29ydGVkICE9ICdib29sZWFuJykgewogICAgICAgICAgICB0aGlzQXJnID0gaXRlcmF0ZWU7CiAgICAgICAgICAgIGl0ZXJhdGVlID0gaXNJdGVyYXRlZUNhbGwoYXJyYXksIGlzU29ydGVkLCB0aGlzQXJnKSA/IG51bGwgOiBpc1NvcnRlZDsKICAgICAgICAgICAgaXNTb3J0ZWQgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBjYWxsYmFjayA9IGdldENhbGxiYWNrKCk7CiAgICAgICAgICBpZiAoIShpdGVyYXRlZSA9PSBudWxsICYmIGNhbGxiYWNrID09PSBiYXNlQ2FsbGJhY2spKSB7CiAgICAgICAgICAgIGl0ZXJhdGVlID0gY2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIChpc1NvcnRlZCAmJiBnZXRJbmRleE9mKCkgPT0gYmFzZUluZGV4T2YpID8gc29ydGVkVW5pcShhcnJheSwgaXRlcmF0ZWUpIDogYmFzZVVuaXEoYXJyYXksIGl0ZXJhdGVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdW56aXAoYXJyYXkpIHsKICAgICAgICAgIGlmICghKGFycmF5ICYmIGFycmF5Lmxlbmd0aCkpIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gMDsKICAgICAgICAgIGFycmF5ID0gYXJyYXlGaWx0ZXIoYXJyYXksIGZ1bmN0aW9uKGdyb3VwKSB7CiAgICAgICAgICAgIGlmIChpc0FycmF5TGlrZShncm91cCkpIHsKICAgICAgICAgICAgICBsZW5ndGggPSBuYXRpdmVNYXgoZ3JvdXAubGVuZ3RoLCBsZW5ndGgpOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciByZXN1bHQgPSBBcnJheShsZW5ndGgpOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgcmVzdWx0W2luZGV4XSA9IGFycmF5TWFwKGFycmF5LCBiYXNlUHJvcGVydHkoaW5kZXgpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVuemlwV2l0aChhcnJheSwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7CiAgICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVzdWx0ID0gdW56aXAoYXJyYXkpOwogICAgICAgICAgaWYgKGl0ZXJhdGVlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZXJhdGVlID0gYmluZENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCA0KTsKICAgICAgICAgIHJldHVybiBhcnJheU1hcChyZXN1bHQsIGZ1bmN0aW9uKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBhcnJheVJlZHVjZShncm91cCwgaXRlcmF0ZWUsIHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdmFyIHdpdGhvdXQgPSByZXN0UGFyYW0oZnVuY3Rpb24oYXJyYXksIHZhbHVlcykgewogICAgICAgICAgcmV0dXJuIGlzQXJyYXlMaWtlKGFycmF5KSA/IGJhc2VEaWZmZXJlbmNlKGFycmF5LCB2YWx1ZXMpIDogW107CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24geG9yKCkgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBhcnJheSA9IGFyZ3VtZW50c1tpbmRleF07CiAgICAgICAgICAgIGlmIChpc0FycmF5TGlrZShhcnJheSkpIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzdWx0ID8gYmFzZURpZmZlcmVuY2UocmVzdWx0LCBhcnJheSkuY29uY2F0KGJhc2VEaWZmZXJlbmNlKGFycmF5LCByZXN1bHQpKSA6IGFycmF5OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0ID8gYmFzZVVuaXEocmVzdWx0KSA6IFtdOwogICAgICAgIH0KICAgICAgICB2YXIgemlwID0gcmVzdFBhcmFtKHVuemlwKTsKICAgICAgICBmdW5jdGlvbiB6aXBPYmplY3QocHJvcHMsIHZhbHVlcykgewogICAgICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgbGVuZ3RoID0gcHJvcHMgPyBwcm9wcy5sZW5ndGggOiAwLAogICAgICAgICAgICAgIHJlc3VsdCA9IHt9OwogICAgICAgICAgaWYgKGxlbmd0aCAmJiAhdmFsdWVzICYmICFpc0FycmF5KHByb3BzWzBdKSkgewogICAgICAgICAgICB2YWx1ZXMgPSBbXTsKICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07CiAgICAgICAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlc1tpbmRleF07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgcmVzdWx0W2tleVswXV0gPSBrZXlbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciB6aXBXaXRoID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGFycmF5cykgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGFycmF5cy5sZW5ndGgsCiAgICAgICAgICAgICAgaXRlcmF0ZWUgPSBsZW5ndGggPiAyID8gYXJyYXlzW2xlbmd0aCAtIDJdIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgIHRoaXNBcmcgPSBsZW5ndGggPiAxID8gYXJyYXlzW2xlbmd0aCAtIDFdIDogdW5kZWZpbmVkOwogICAgICAgICAgaWYgKGxlbmd0aCA+IDIgJiYgdHlwZW9mIGl0ZXJhdGVlID09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgbGVuZ3RoIC09IDI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpdGVyYXRlZSA9IChsZW5ndGggPiAxICYmIHR5cGVvZiB0aGlzQXJnID09ICdmdW5jdGlvbicpID8gKC0tbGVuZ3RoLCB0aGlzQXJnKSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdGhpc0FyZyA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIGFycmF5cy5sZW5ndGggPSBsZW5ndGg7CiAgICAgICAgICByZXR1cm4gdW56aXBXaXRoKGFycmF5cywgaXRlcmF0ZWUsIHRoaXNBcmcpOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIGNoYWluKHZhbHVlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbG9kYXNoKHZhbHVlKTsKICAgICAgICAgIHJlc3VsdC5fX2NoYWluX18gPSB0cnVlOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdGFwKHZhbHVlLCBpbnRlcmNlcHRvciwgdGhpc0FyZykgewogICAgICAgICAgaW50ZXJjZXB0b3IuY2FsbCh0aGlzQXJnLCB2YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRocnUodmFsdWUsIGludGVyY2VwdG9yLCB0aGlzQXJnKSB7CiAgICAgICAgICByZXR1cm4gaW50ZXJjZXB0b3IuY2FsbCh0aGlzQXJnLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdyYXBwZXJDaGFpbigpIHsKICAgICAgICAgIHJldHVybiBjaGFpbih0aGlzKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd3JhcHBlckNvbW1pdCgpIHsKICAgICAgICAgIHJldHVybiBuZXcgTG9kYXNoV3JhcHBlcih0aGlzLnZhbHVlKCksIHRoaXMuX19jaGFpbl9fKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd3JhcHBlclBsYW50KHZhbHVlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0LAogICAgICAgICAgICAgIHBhcmVudCA9IHRoaXM7CiAgICAgICAgICB3aGlsZSAocGFyZW50IGluc3RhbmNlb2YgYmFzZUxvZGFzaCkgewogICAgICAgICAgICB2YXIgY2xvbmUgPSB3cmFwcGVyQ2xvbmUocGFyZW50KTsKICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgIHByZXZpb3VzLl9fd3JhcHBlZF9fID0gY2xvbmU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gY2xvbmU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHByZXZpb3VzID0gY2xvbmU7CiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5fX3dyYXBwZWRfXzsKICAgICAgICAgIH0KICAgICAgICAgIHByZXZpb3VzLl9fd3JhcHBlZF9fID0gdmFsdWU7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3cmFwcGVyUmV2ZXJzZSgpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX193cmFwcGVkX187CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMYXp5V3JhcHBlcikgewogICAgICAgICAgICBpZiAodGhpcy5fX2FjdGlvbnNfXy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IG5ldyBMYXp5V3JhcHBlcih0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IExvZGFzaFdyYXBwZXIodmFsdWUucmV2ZXJzZSgpLCB0aGlzLl9fY2hhaW5fXyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy50aHJ1KGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5yZXZlcnNlKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd3JhcHBlclRvU3RyaW5nKCkgewogICAgICAgICAgcmV0dXJuICh0aGlzLnZhbHVlKCkgKyAnJyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdyYXBwZXJWYWx1ZSgpIHsKICAgICAgICAgIHJldHVybiBiYXNlV3JhcHBlclZhbHVlKHRoaXMuX193cmFwcGVkX18sIHRoaXMuX19hY3Rpb25zX18pOwogICAgICAgIH0KICAgICAgICB2YXIgYXQgPSByZXN0UGFyYW0oZnVuY3Rpb24oY29sbGVjdGlvbiwgcHJvcHMpIHsKICAgICAgICAgIHJldHVybiBiYXNlQXQoY29sbGVjdGlvbiwgYmFzZUZsYXR0ZW4ocHJvcHMpKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgY291bnRCeSA9IGNyZWF0ZUFnZ3JlZ2F0b3IoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7CiAgICAgICAgICBoYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc3VsdCwga2V5KSA/ICsrcmVzdWx0W2tleV0gOiAocmVzdWx0W2tleV0gPSAxKTsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiBldmVyeShjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsKICAgICAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5RXZlcnkgOiBiYXNlRXZlcnk7CiAgICAgICAgICBpZiAodGhpc0FyZyAmJiBpc0l0ZXJhdGVlQ2FsbChjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIHRoaXNBcmcpKSB7CiAgICAgICAgICAgIHByZWRpY2F0ZSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIHByZWRpY2F0ZSAhPSAnZnVuY3Rpb24nIHx8IHRoaXNBcmcgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBwcmVkaWNhdGUgPSBnZXRDYWxsYmFjayhwcmVkaWNhdGUsIHRoaXNBcmcsIDMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZ1bmMoY29sbGVjdGlvbiwgcHJlZGljYXRlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZmlsdGVyKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSwgdGhpc0FyZykgewogICAgICAgICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlGaWx0ZXIgOiBiYXNlRmlsdGVyOwogICAgICAgICAgcHJlZGljYXRlID0gZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTsKICAgICAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSk7CiAgICAgICAgfQogICAgICAgIHZhciBmaW5kID0gY3JlYXRlRmluZChiYXNlRWFjaCk7CiAgICAgICAgdmFyIGZpbmRMYXN0ID0gY3JlYXRlRmluZChiYXNlRWFjaFJpZ2h0LCB0cnVlKTsKICAgICAgICBmdW5jdGlvbiBmaW5kV2hlcmUoY29sbGVjdGlvbiwgc291cmNlKSB7CiAgICAgICAgICByZXR1cm4gZmluZChjb2xsZWN0aW9uLCBiYXNlTWF0Y2hlcyhzb3VyY2UpKTsKICAgICAgICB9CiAgICAgICAgdmFyIGZvckVhY2ggPSBjcmVhdGVGb3JFYWNoKGFycmF5RWFjaCwgYmFzZUVhY2gpOwogICAgICAgIHZhciBmb3JFYWNoUmlnaHQgPSBjcmVhdGVGb3JFYWNoKGFycmF5RWFjaFJpZ2h0LCBiYXNlRWFjaFJpZ2h0KTsKICAgICAgICB2YXIgZ3JvdXBCeSA9IGNyZWF0ZUFnZ3JlZ2F0b3IoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7CiAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChyZXN1bHQsIGtleSkpIHsKICAgICAgICAgICAgcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IFt2YWx1ZV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gaW5jbHVkZXMoY29sbGVjdGlvbiwgdGFyZ2V0LCBmcm9tSW5kZXgsIGd1YXJkKSB7CiAgICAgICAgICB2YXIgbGVuZ3RoID0gY29sbGVjdGlvbiA/IGdldExlbmd0aChjb2xsZWN0aW9uKSA6IDA7CiAgICAgICAgICBpZiAoIWlzTGVuZ3RoKGxlbmd0aCkpIHsKICAgICAgICAgICAgY29sbGVjdGlvbiA9IHZhbHVlcyhjb2xsZWN0aW9uKTsKICAgICAgICAgICAgbGVuZ3RoID0gY29sbGVjdGlvbi5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGZyb21JbmRleCAhPSAnbnVtYmVyJyB8fCAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwodGFyZ2V0LCBmcm9tSW5kZXgsIGd1YXJkKSkpIHsKICAgICAgICAgICAgZnJvbUluZGV4ID0gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZyb21JbmRleCA9IGZyb21JbmRleCA8IDAgPyBuYXRpdmVNYXgobGVuZ3RoICsgZnJvbUluZGV4LCAwKSA6IChmcm9tSW5kZXggfHwgMCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gKHR5cGVvZiBjb2xsZWN0aW9uID09ICdzdHJpbmcnIHx8ICFpc0FycmF5KGNvbGxlY3Rpb24pICYmIGlzU3RyaW5nKGNvbGxlY3Rpb24pKSA/IChmcm9tSW5kZXggPCBsZW5ndGggJiYgY29sbGVjdGlvbi5pbmRleE9mKHRhcmdldCwgZnJvbUluZGV4KSA+IC0xKSA6IChnZXRJbmRleE9mKGNvbGxlY3Rpb24sIHRhcmdldCwgZnJvbUluZGV4KSA+IC0xKTsKICAgICAgICB9CiAgICAgICAgdmFyIGluZGV4QnkgPSBjcmVhdGVBZ2dyZWdhdG9yKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgaW52b2tlID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGNvbGxlY3Rpb24sIHBhdGgsIGFyZ3MpIHsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGlzRnVuYyA9IHR5cGVvZiBwYXRoID09ICdmdW5jdGlvbicsCiAgICAgICAgICAgICAgaXNQcm9wID0gaXNLZXkocGF0aCksCiAgICAgICAgICAgICAgcmVzdWx0ID0gaXNBcnJheUxpa2UoY29sbGVjdGlvbikgPyBBcnJheShjb2xsZWN0aW9uLmxlbmd0aCkgOiBbXTsKICAgICAgICAgIGJhc2VFYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBmdW5jID0gaXNGdW5jID8gcGF0aCA6ICgoaXNQcm9wICYmIHZhbHVlICE9IG51bGwpID8gdmFsdWVbcGF0aF0gOiBudWxsKTsKICAgICAgICAgICAgcmVzdWx0WysraW5kZXhdID0gZnVuYyA/IGZ1bmMuYXBwbHkodmFsdWUsIGFyZ3MpIDogaW52b2tlUGF0aCh2YWx1ZSwgcGF0aCwgYXJncyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gbWFwKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSB7CiAgICAgICAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheU1hcCA6IGJhc2VNYXA7CiAgICAgICAgICBpdGVyYXRlZSA9IGdldENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKTsKICAgICAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKTsKICAgICAgICB9CiAgICAgICAgdmFyIHBhcnRpdGlvbiA9IGNyZWF0ZUFnZ3JlZ2F0b3IoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7CiAgICAgICAgICByZXN1bHRba2V5ID8gMCA6IDFdLnB1c2godmFsdWUpOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIFtbXSwgW11dOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIHBsdWNrKGNvbGxlY3Rpb24sIHBhdGgpIHsKICAgICAgICAgIHJldHVybiBtYXAoY29sbGVjdGlvbiwgcHJvcGVydHkocGF0aCkpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVkdWNlID0gY3JlYXRlUmVkdWNlKGFycmF5UmVkdWNlLCBiYXNlRWFjaCk7CiAgICAgICAgdmFyIHJlZHVjZVJpZ2h0ID0gY3JlYXRlUmVkdWNlKGFycmF5UmVkdWNlUmlnaHQsIGJhc2VFYWNoUmlnaHQpOwogICAgICAgIGZ1bmN0aW9uIHJlamVjdChjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsKICAgICAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5RmlsdGVyIDogYmFzZUZpbHRlcjsKICAgICAgICAgIHByZWRpY2F0ZSA9IGdldENhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7CiAgICAgICAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgcmV0dXJuICFwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzYW1wbGUoY29sbGVjdGlvbiwgbiwgZ3VhcmQpIHsKICAgICAgICAgIGlmIChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKGNvbGxlY3Rpb24sIG4sIGd1YXJkKSA6IG4gPT0gbnVsbCkgewogICAgICAgICAgICBjb2xsZWN0aW9uID0gdG9JdGVyYWJsZShjb2xsZWN0aW9uKTsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoOwogICAgICAgICAgICByZXR1cm4gbGVuZ3RoID4gMCA/IGNvbGxlY3Rpb25bYmFzZVJhbmRvbSgwLCBsZW5ndGggLSAxKV0gOiB1bmRlZmluZWQ7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICByZXN1bHQgPSB0b0FycmF5KGNvbGxlY3Rpb24pLAogICAgICAgICAgICAgIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGgsCiAgICAgICAgICAgICAgbGFzdEluZGV4ID0gbGVuZ3RoIC0gMTsKICAgICAgICAgIG4gPSBuYXRpdmVNaW4obiA8IDAgPyAwIDogKCtuIHx8IDApLCBsZW5ndGgpOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBuKSB7CiAgICAgICAgICAgIHZhciByYW5kID0gYmFzZVJhbmRvbShpbmRleCwgbGFzdEluZGV4KSwKICAgICAgICAgICAgICAgIHZhbHVlID0gcmVzdWx0W3JhbmRdOwogICAgICAgICAgICByZXN1bHRbcmFuZF0gPSByZXN1bHRbaW5kZXhdOwogICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQubGVuZ3RoID0gbjsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNodWZmbGUoY29sbGVjdGlvbikgewogICAgICAgICAgcmV0dXJuIHNhbXBsZShjb2xsZWN0aW9uLCBQT1NJVElWRV9JTkZJTklUWSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNpemUoY29sbGVjdGlvbikgewogICAgICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24gPyBnZXRMZW5ndGgoY29sbGVjdGlvbikgOiAwOwogICAgICAgICAgcmV0dXJuIGlzTGVuZ3RoKGxlbmd0aCkgPyBsZW5ndGggOiBrZXlzKGNvbGxlY3Rpb24pLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc29tZShjb2xsZWN0aW9uLCBwcmVkaWNhdGUsIHRoaXNBcmcpIHsKICAgICAgICAgIHZhciBmdW5jID0gaXNBcnJheShjb2xsZWN0aW9uKSA/IGFycmF5U29tZSA6IGJhc2VTb21lOwogICAgICAgICAgaWYgKHRoaXNBcmcgJiYgaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgcHJlZGljYXRlLCB0aGlzQXJnKSkgewogICAgICAgICAgICBwcmVkaWNhdGUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgIT0gJ2Z1bmN0aW9uJyB8fCB0aGlzQXJnICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcHJlZGljYXRlID0gZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmdW5jKGNvbGxlY3Rpb24sIHByZWRpY2F0ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNvcnRCeShjb2xsZWN0aW9uLCBpdGVyYXRlZSwgdGhpc0FyZykgewogICAgICAgICAgaWYgKGNvbGxlY3Rpb24gPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpc0FyZyAmJiBpc0l0ZXJhdGVlQ2FsbChjb2xsZWN0aW9uLCBpdGVyYXRlZSwgdGhpc0FyZykpIHsKICAgICAgICAgICAgaXRlcmF0ZWUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGluZGV4ID0gLTE7CiAgICAgICAgICBpdGVyYXRlZSA9IGdldENhbGxiYWNrKGl0ZXJhdGVlLCB0aGlzQXJnLCAzKTsKICAgICAgICAgIHZhciByZXN1bHQgPSBiYXNlTWFwKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKHZhbHVlLCBrZXksIGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAnY3JpdGVyaWEnOiBpdGVyYXRlZSh2YWx1ZSwga2V5LCBjb2xsZWN0aW9uKSwKICAgICAgICAgICAgICAnaW5kZXgnOiArK2luZGV4LAogICAgICAgICAgICAgICd2YWx1ZSc6IHZhbHVlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBiYXNlU29ydEJ5KHJlc3VsdCwgY29tcGFyZUFzY2VuZGluZyk7CiAgICAgICAgfQogICAgICAgIHZhciBzb3J0QnlBbGwgPSByZXN0UGFyYW0oZnVuY3Rpb24oY29sbGVjdGlvbiwgaXRlcmF0ZWVzKSB7CiAgICAgICAgICBpZiAoY29sbGVjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBndWFyZCA9IGl0ZXJhdGVlc1syXTsKICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChpdGVyYXRlZXNbMF0sIGl0ZXJhdGVlc1sxXSwgZ3VhcmQpKSB7CiAgICAgICAgICAgIGl0ZXJhdGVlcy5sZW5ndGggPSAxOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGJhc2VTb3J0QnlPcmRlcihjb2xsZWN0aW9uLCBiYXNlRmxhdHRlbihpdGVyYXRlZXMpLCBbXSk7CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gc29ydEJ5T3JkZXIoY29sbGVjdGlvbiwgaXRlcmF0ZWVzLCBvcmRlcnMsIGd1YXJkKSB7CiAgICAgICAgICBpZiAoY29sbGVjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChpdGVyYXRlZXMsIG9yZGVycywgZ3VhcmQpKSB7CiAgICAgICAgICAgIG9yZGVycyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWlzQXJyYXkoaXRlcmF0ZWVzKSkgewogICAgICAgICAgICBpdGVyYXRlZXMgPSBpdGVyYXRlZXMgPT0gbnVsbCA/IFtdIDogW2l0ZXJhdGVlc107CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWlzQXJyYXkob3JkZXJzKSkgewogICAgICAgICAgICBvcmRlcnMgPSBvcmRlcnMgPT0gbnVsbCA/IFtdIDogW29yZGVyc107CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmFzZVNvcnRCeU9yZGVyKGNvbGxlY3Rpb24sIGl0ZXJhdGVlcywgb3JkZXJzKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd2hlcmUoY29sbGVjdGlvbiwgc291cmNlKSB7CiAgICAgICAgICByZXR1cm4gZmlsdGVyKGNvbGxlY3Rpb24sIGJhc2VNYXRjaGVzKHNvdXJjZSkpOwogICAgICAgIH0KICAgICAgICB2YXIgbm93ID0gbmF0aXZlTm93IHx8IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gYWZ0ZXIobiwgZnVuYykgewogICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBuID09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICB2YXIgdGVtcCA9IG47CiAgICAgICAgICAgICAgbiA9IGZ1bmM7CiAgICAgICAgICAgICAgZnVuYyA9IHRlbXA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBuID0gbmF0aXZlSXNGaW5pdGUobiA9ICtuKSA/IG4gOiAwOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoLS1uIDwgMSkgewogICAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFyeShmdW5jLCBuLCBndWFyZCkgewogICAgICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKGZ1bmMsIG4sIGd1YXJkKSkgewogICAgICAgICAgICBuID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG4gPSAoZnVuYyAmJiBuID09IG51bGwpID8gZnVuYy5sZW5ndGggOiBuYXRpdmVNYXgoK24gfHwgMCwgMCk7CiAgICAgICAgICByZXR1cm4gY3JlYXRlV3JhcHBlcihmdW5jLCBBUllfRkxBRywgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJlZm9yZShuLCBmdW5jKSB7CiAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBuID09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICB2YXIgdGVtcCA9IG47CiAgICAgICAgICAgICAgbiA9IGZ1bmM7CiAgICAgICAgICAgICAgZnVuYyA9IHRlbXA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICgtLW4gPiAwKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuIDw9IDEpIHsKICAgICAgICAgICAgICBmdW5jID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgdmFyIGJpbmQgPSByZXN0UGFyYW0oZnVuY3Rpb24oZnVuYywgdGhpc0FyZywgcGFydGlhbHMpIHsKICAgICAgICAgIHZhciBiaXRtYXNrID0gQklORF9GTEFHOwogICAgICAgICAgaWYgKHBhcnRpYWxzLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgaG9sZGVycyA9IHJlcGxhY2VIb2xkZXJzKHBhcnRpYWxzLCBiaW5kLnBsYWNlaG9sZGVyKTsKICAgICAgICAgICAgYml0bWFzayB8PSBQQVJUSUFMX0ZMQUc7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY3JlYXRlV3JhcHBlcihmdW5jLCBiaXRtYXNrLCB0aGlzQXJnLCBwYXJ0aWFscywgaG9sZGVycyk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGJpbmRBbGwgPSByZXN0UGFyYW0oZnVuY3Rpb24ob2JqZWN0LCBtZXRob2ROYW1lcykgewogICAgICAgICAgbWV0aG9kTmFtZXMgPSBtZXRob2ROYW1lcy5sZW5ndGggPyBiYXNlRmxhdHRlbihtZXRob2ROYW1lcykgOiBmdW5jdGlvbnMob2JqZWN0KTsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGxlbmd0aCA9IG1ldGhvZE5hbWVzLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBtZXRob2ROYW1lc1tpbmRleF07CiAgICAgICAgICAgIG9iamVjdFtrZXldID0gY3JlYXRlV3JhcHBlcihvYmplY3Rba2V5XSwgQklORF9GTEFHLCBvYmplY3QpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICB9KTsKICAgICAgICB2YXIgYmluZEtleSA9IHJlc3RQYXJhbShmdW5jdGlvbihvYmplY3QsIGtleSwgcGFydGlhbHMpIHsKICAgICAgICAgIHZhciBiaXRtYXNrID0gQklORF9GTEFHIHwgQklORF9LRVlfRkxBRzsKICAgICAgICAgIGlmIChwYXJ0aWFscy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGhvbGRlcnMgPSByZXBsYWNlSG9sZGVycyhwYXJ0aWFscywgYmluZEtleS5wbGFjZWhvbGRlcik7CiAgICAgICAgICAgIGJpdG1hc2sgfD0gUEFSVElBTF9GTEFHOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGNyZWF0ZVdyYXBwZXIoa2V5LCBiaXRtYXNrLCBvYmplY3QsIHBhcnRpYWxzLCBob2xkZXJzKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgY3VycnkgPSBjcmVhdGVDdXJyeShDVVJSWV9GTEFHKTsKICAgICAgICB2YXIgY3VycnlSaWdodCA9IGNyZWF0ZUN1cnJ5KENVUlJZX1JJR0hUX0ZMQUcpOwogICAgICAgIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBhcmdzLAogICAgICAgICAgICAgIG1heFRpbWVvdXRJZCwKICAgICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgICAgc3RhbXAsCiAgICAgICAgICAgICAgdGhpc0FyZywKICAgICAgICAgICAgICB0aW1lb3V0SWQsCiAgICAgICAgICAgICAgdHJhaWxpbmdDYWxsLAogICAgICAgICAgICAgIGxhc3RDYWxsZWQgPSAwLAogICAgICAgICAgICAgIG1heFdhaXQgPSBmYWxzZSwKICAgICAgICAgICAgICB0cmFpbGluZyA9IHRydWU7CiAgICAgICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7CiAgICAgICAgICB9CiAgICAgICAgICB3YWl0ID0gd2FpdCA8IDAgPyAwIDogKCt3YWl0IHx8IDApOwogICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGxlYWRpbmcgPSB0cnVlOwogICAgICAgICAgICB0cmFpbGluZyA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIGlmIChpc09iamVjdChvcHRpb25zKSkgewogICAgICAgICAgICBsZWFkaW5nID0gb3B0aW9ucy5sZWFkaW5nOwogICAgICAgICAgICBtYXhXYWl0ID0gJ21heFdhaXQnIGluIG9wdGlvbnMgJiYgbmF0aXZlTWF4KCtvcHRpb25zLm1heFdhaXQgfHwgMCwgd2FpdCk7CiAgICAgICAgICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gb3B0aW9ucy50cmFpbGluZyA6IHRyYWlsaW5nOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgICAgICBpZiAodGltZW91dElkKSB7CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFRpbWVvdXRJZCkgewogICAgICAgICAgICAgIGNsZWFyVGltZW91dChtYXhUaW1lb3V0SWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1heFRpbWVvdXRJZCA9IHRpbWVvdXRJZCA9IHRyYWlsaW5nQ2FsbCA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGRlbGF5ZWQoKSB7CiAgICAgICAgICAgIHZhciByZW1haW5pbmcgPSB3YWl0IC0gKG5vdygpIC0gc3RhbXApOwogICAgICAgICAgICBpZiAocmVtYWluaW5nIDw9IDAgfHwgcmVtYWluaW5nID4gd2FpdCkgewogICAgICAgICAgICAgIGlmIChtYXhUaW1lb3V0SWQpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChtYXhUaW1lb3V0SWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgaXNDYWxsZWQgPSB0cmFpbGluZ0NhbGw7CiAgICAgICAgICAgICAgbWF4VGltZW91dElkID0gdGltZW91dElkID0gdHJhaWxpbmdDYWxsID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIGlmIChpc0NhbGxlZCkgewogICAgICAgICAgICAgICAgbGFzdENhbGxlZCA9IG5vdygpOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTsKICAgICAgICAgICAgICAgIGlmICghdGltZW91dElkICYmICFtYXhUaW1lb3V0SWQpIHsKICAgICAgICAgICAgICAgICAgYXJncyA9IHRoaXNBcmcgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGRlbGF5ZWQsIHJlbWFpbmluZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIG1heERlbGF5ZWQoKSB7CiAgICAgICAgICAgIGlmICh0aW1lb3V0SWQpIHsKICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXhUaW1lb3V0SWQgPSB0aW1lb3V0SWQgPSB0cmFpbGluZ0NhbGwgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIGlmICh0cmFpbGluZyB8fCAobWF4V2FpdCAhPT0gd2FpdCkpIHsKICAgICAgICAgICAgICBsYXN0Q2FsbGVkID0gbm93KCk7CiAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTsKICAgICAgICAgICAgICBpZiAoIXRpbWVvdXRJZCAmJiAhbWF4VGltZW91dElkKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gdGhpc0FyZyA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBkZWJvdW5jZWQoKSB7CiAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHN0YW1wID0gbm93KCk7CiAgICAgICAgICAgIHRoaXNBcmcgPSB0aGlzOwogICAgICAgICAgICB0cmFpbGluZ0NhbGwgPSB0cmFpbGluZyAmJiAodGltZW91dElkIHx8ICFsZWFkaW5nKTsKICAgICAgICAgICAgaWYgKG1heFdhaXQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdmFyIGxlYWRpbmdDYWxsID0gbGVhZGluZyAmJiAhdGltZW91dElkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICghbWF4VGltZW91dElkICYmICFsZWFkaW5nKSB7CiAgICAgICAgICAgICAgICBsYXN0Q2FsbGVkID0gc3RhbXA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciByZW1haW5pbmcgPSBtYXhXYWl0IC0gKHN0YW1wIC0gbGFzdENhbGxlZCksCiAgICAgICAgICAgICAgICAgIGlzQ2FsbGVkID0gcmVtYWluaW5nIDw9IDAgfHwgcmVtYWluaW5nID4gbWF4V2FpdDsKICAgICAgICAgICAgICBpZiAoaXNDYWxsZWQpIHsKICAgICAgICAgICAgICAgIGlmIChtYXhUaW1lb3V0SWQpIHsKICAgICAgICAgICAgICAgICAgbWF4VGltZW91dElkID0gY2xlYXJUaW1lb3V0KG1heFRpbWVvdXRJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYXN0Q2FsbGVkID0gc3RhbXA7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW1heFRpbWVvdXRJZCkgewogICAgICAgICAgICAgICAgbWF4VGltZW91dElkID0gc2V0VGltZW91dChtYXhEZWxheWVkLCByZW1haW5pbmcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNDYWxsZWQgJiYgdGltZW91dElkKSB7CiAgICAgICAgICAgICAgdGltZW91dElkID0gY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXRJZCAmJiB3YWl0ICE9PSBtYXhXYWl0KSB7CiAgICAgICAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dChkZWxheWVkLCB3YWl0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGVhZGluZ0NhbGwpIHsKICAgICAgICAgICAgICBpc0NhbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNDYWxsZWQgJiYgIXRpbWVvdXRJZCAmJiAhbWF4VGltZW91dElkKSB7CiAgICAgICAgICAgICAgYXJncyA9IHRoaXNBcmcgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICBkZWJvdW5jZWQuY2FuY2VsID0gY2FuY2VsOwogICAgICAgICAgcmV0dXJuIGRlYm91bmNlZDsKICAgICAgICB9CiAgICAgICAgdmFyIGRlZmVyID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGZ1bmMsIGFyZ3MpIHsKICAgICAgICAgIHJldHVybiBiYXNlRGVsYXkoZnVuYywgMSwgYXJncyk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGRlbGF5ID0gcmVzdFBhcmFtKGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGFyZ3MpIHsKICAgICAgICAgIHJldHVybiBiYXNlRGVsYXkoZnVuYywgd2FpdCwgYXJncyk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGZsb3cgPSBjcmVhdGVGbG93KCk7CiAgICAgICAgdmFyIGZsb3dSaWdodCA9IGNyZWF0ZUZsb3codHJ1ZSk7CiAgICAgICAgZnVuY3Rpb24gbWVtb2l6ZShmdW5jLCByZXNvbHZlcikgewogICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicgfHwgKHJlc29sdmVyICYmIHR5cGVvZiByZXNvbHZlciAhPSAnZnVuY3Rpb24nKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbWVtb2l6ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgICBrZXkgPSByZXNvbHZlciA/IHJlc29sdmVyLmFwcGx5KHRoaXMsIGFyZ3MpIDogYXJnc1swXSwKICAgICAgICAgICAgICAgIGNhY2hlID0gbWVtb2l6ZWQuY2FjaGU7CiAgICAgICAgICAgIGlmIChjYWNoZS5oYXMoa2V5KSkgewogICAgICAgICAgICAgIHJldHVybiBjYWNoZS5nZXQoa2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICAgICAgbWVtb2l6ZWQuY2FjaGUgPSBjYWNoZS5zZXQoa2V5LCByZXN1bHQpOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfTsKICAgICAgICAgIG1lbW9pemVkLmNhY2hlID0gbmV3IG1lbW9pemUuQ2FjaGU7CiAgICAgICAgICByZXR1cm4gbWVtb2l6ZWQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG5lZ2F0ZShwcmVkaWNhdGUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgcHJlZGljYXRlICE9ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gIXByZWRpY2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb25jZShmdW5jKSB7CiAgICAgICAgICByZXR1cm4gYmVmb3JlKDIsIGZ1bmMpOwogICAgICAgIH0KICAgICAgICB2YXIgcGFydGlhbCA9IGNyZWF0ZVBhcnRpYWwoUEFSVElBTF9GTEFHKTsKICAgICAgICB2YXIgcGFydGlhbFJpZ2h0ID0gY3JlYXRlUGFydGlhbChQQVJUSUFMX1JJR0hUX0ZMQUcpOwogICAgICAgIHZhciByZWFyZyA9IHJlc3RQYXJhbShmdW5jdGlvbihmdW5jLCBpbmRleGVzKSB7CiAgICAgICAgICByZXR1cm4gY3JlYXRlV3JhcHBlcihmdW5jLCBSRUFSR19GTEFHLCBudWxsLCBudWxsLCBudWxsLCBiYXNlRmxhdHRlbihpbmRleGVzKSk7CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gcmVzdFBhcmFtKGZ1bmMsIHN0YXJ0KSB7CiAgICAgICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFydCA9IG5hdGl2ZU1heChzdGFydCA9PT0gdW5kZWZpbmVkID8gKGZ1bmMubGVuZ3RoIC0gMSkgOiAoK3N0YXJ0IHx8IDApLCAwKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgICBpbmRleCA9IC0xLAogICAgICAgICAgICAgICAgbGVuZ3RoID0gbmF0aXZlTWF4KGFyZ3MubGVuZ3RoIC0gc3RhcnQsIDApLAogICAgICAgICAgICAgICAgcmVzdCA9IEFycmF5KGxlbmd0aCk7CiAgICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmVzdFtpbmRleF0gPSBhcmdzW3N0YXJ0ICsgaW5kZXhdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaCAoc3RhcnQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuYy5jYWxsKHRoaXMsIHJlc3QpOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpcywgYXJnc1swXSwgcmVzdCk7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzLCBhcmdzWzBdLCBhcmdzWzFdLCByZXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgb3RoZXJBcmdzID0gQXJyYXkoc3RhcnQgKyAxKTsKICAgICAgICAgICAgaW5kZXggPSAtMTsKICAgICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBzdGFydCkgewogICAgICAgICAgICAgIG90aGVyQXJnc1tpbmRleF0gPSBhcmdzW2luZGV4XTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvdGhlckFyZ3Nbc3RhcnRdID0gcmVzdDsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgb3RoZXJBcmdzKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNwcmVhZChmdW5jKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXkpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJyYXkpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdGhyb3R0bGUoZnVuYywgd2FpdCwgb3B0aW9ucykgewogICAgICAgICAgdmFyIGxlYWRpbmcgPSB0cnVlLAogICAgICAgICAgICAgIHRyYWlsaW5nID0gdHJ1ZTsKICAgICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvcHRpb25zID09PSBmYWxzZSkgewogICAgICAgICAgICBsZWFkaW5nID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KG9wdGlvbnMpKSB7CiAgICAgICAgICAgIGxlYWRpbmcgPSAnbGVhZGluZycgaW4gb3B0aW9ucyA/ICEhb3B0aW9ucy5sZWFkaW5nIDogbGVhZGluZzsKICAgICAgICAgICAgdHJhaWxpbmcgPSAndHJhaWxpbmcnIGluIG9wdGlvbnMgPyAhIW9wdGlvbnMudHJhaWxpbmcgOiB0cmFpbGluZzsKICAgICAgICAgIH0KICAgICAgICAgIGRlYm91bmNlT3B0aW9ucy5sZWFkaW5nID0gbGVhZGluZzsKICAgICAgICAgIGRlYm91bmNlT3B0aW9ucy5tYXhXYWl0ID0gK3dhaXQ7CiAgICAgICAgICBkZWJvdW5jZU9wdGlvbnMudHJhaWxpbmcgPSB0cmFpbGluZzsKICAgICAgICAgIHJldHVybiBkZWJvdW5jZShmdW5jLCB3YWl0LCBkZWJvdW5jZU9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3cmFwKHZhbHVlLCB3cmFwcGVyKSB7CiAgICAgICAgICB3cmFwcGVyID0gd3JhcHBlciA9PSBudWxsID8gaWRlbnRpdHkgOiB3cmFwcGVyOwogICAgICAgICAgcmV0dXJuIGNyZWF0ZVdyYXBwZXIod3JhcHBlciwgUEFSVElBTF9GTEFHLCBudWxsLCBbdmFsdWVdLCBbXSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNsb25lKHZhbHVlLCBpc0RlZXAsIGN1c3RvbWl6ZXIsIHRoaXNBcmcpIHsKICAgICAgICAgIGlmIChpc0RlZXAgJiYgdHlwZW9mIGlzRGVlcCAhPSAnYm9vbGVhbicgJiYgaXNJdGVyYXRlZUNhbGwodmFsdWUsIGlzRGVlcCwgY3VzdG9taXplcikpIHsKICAgICAgICAgICAgaXNEZWVwID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpc0RlZXAgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aGlzQXJnID0gY3VzdG9taXplcjsKICAgICAgICAgICAgY3VzdG9taXplciA9IGlzRGVlcDsKICAgICAgICAgICAgaXNEZWVwID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGN1c3RvbWl6ZXIgPT0gJ2Z1bmN0aW9uJyA/IGJhc2VDbG9uZSh2YWx1ZSwgaXNEZWVwLCBiaW5kQ2FsbGJhY2soY3VzdG9taXplciwgdGhpc0FyZywgMSkpIDogYmFzZUNsb25lKHZhbHVlLCBpc0RlZXApOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjbG9uZURlZXAodmFsdWUsIGN1c3RvbWl6ZXIsIHRoaXNBcmcpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgY3VzdG9taXplciA9PSAnZnVuY3Rpb24nID8gYmFzZUNsb25lKHZhbHVlLCB0cnVlLCBiaW5kQ2FsbGJhY2soY3VzdG9taXplciwgdGhpc0FyZywgMSkpIDogYmFzZUNsb25lKHZhbHVlLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ3QodmFsdWUsIG90aGVyKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWUgPiBvdGhlcjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ3RlKHZhbHVlLCBvdGhlcikgewogICAgICAgICAgcmV0dXJuIHZhbHVlID49IG90aGVyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpc0FyZ3VtZW50cyh2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNBcnJheUxpa2UodmFsdWUpICYmIG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IGFyZ3NUYWc7CiAgICAgICAgfQogICAgICAgIHZhciBpc0FycmF5ID0gbmF0aXZlSXNBcnJheSB8fCBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBhcnJheVRhZzsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGlzQm9vbGVhbih2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBmYWxzZSB8fCAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBib29sVGFnKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNEYXRlKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBkYXRlVGFnOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpc0VsZW1lbnQodmFsdWUpIHsKICAgICAgICAgIHJldHVybiAhIXZhbHVlICYmIHZhbHVlLm5vZGVUeXBlID09PSAxICYmIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgKG9ialRvU3RyaW5nLmNhbGwodmFsdWUpLmluZGV4T2YoJ0VsZW1lbnQnKSA+IC0xKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzdXBwb3J0LmRvbSkgewogICAgICAgICAgaXNFbGVtZW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuICEhdmFsdWUgJiYgdmFsdWUubm9kZVR5cGUgPT09IDEgJiYgaXNPYmplY3RMaWtlKHZhbHVlKSAmJiAhaXNQbGFpbk9iamVjdCh2YWx1ZSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpc0VtcHR5KHZhbHVlKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc0FycmF5TGlrZSh2YWx1ZSkgJiYgKGlzQXJyYXkodmFsdWUpIHx8IGlzU3RyaW5nKHZhbHVlKSB8fCBpc0FyZ3VtZW50cyh2YWx1ZSkgfHwgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNGdW5jdGlvbih2YWx1ZS5zcGxpY2UpKSkpIHsKICAgICAgICAgICAgcmV0dXJuICF2YWx1ZS5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gIWtleXModmFsdWUpLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGN1c3RvbWl6ZXIsIHRoaXNBcmcpIHsKICAgICAgICAgIGN1c3RvbWl6ZXIgPSB0eXBlb2YgY3VzdG9taXplciA9PSAnZnVuY3Rpb24nID8gYmluZENhbGxiYWNrKGN1c3RvbWl6ZXIsIHRoaXNBcmcsIDMpIDogdW5kZWZpbmVkOwogICAgICAgICAgdmFyIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKHZhbHVlLCBvdGhlcikgOiB1bmRlZmluZWQ7CiAgICAgICAgICByZXR1cm4gcmVzdWx0ID09PSB1bmRlZmluZWQgPyBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGN1c3RvbWl6ZXIpIDogISFyZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzRXJyb3IodmFsdWUpIHsKICAgICAgICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIHR5cGVvZiB2YWx1ZS5tZXNzYWdlID09ICdzdHJpbmcnICYmIG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IGVycm9yVGFnOwogICAgICAgIH0KICAgICAgICB2YXIgaXNGaW5pdGUgPSBuYXRpdmVOdW1Jc0Zpbml0ZSB8fCBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiBuYXRpdmVJc0Zpbml0ZSh2YWx1ZSk7CiAgICAgICAgfTsKICAgICAgICB2YXIgaXNGdW5jdGlvbiA9ICEoYmFzZUlzRnVuY3Rpb24oL3gvKSB8fCAoVWludDhBcnJheSAmJiAhYmFzZUlzRnVuY3Rpb24oVWludDhBcnJheSkpKSA/IGJhc2VJc0Z1bmN0aW9uIDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIHJldHVybiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBmdW5jVGFnOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHsKICAgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgICAgICAgcmV0dXJuICEhdmFsdWUgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNNYXRjaChvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplciwgdGhpc0FyZykgewogICAgICAgICAgY3VzdG9taXplciA9IHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicgPyBiaW5kQ2FsbGJhY2soY3VzdG9taXplciwgdGhpc0FyZywgMykgOiB1bmRlZmluZWQ7CiAgICAgICAgICByZXR1cm4gYmFzZUlzTWF0Y2gob2JqZWN0LCBnZXRNYXRjaERhdGEoc291cmNlKSwgY3VzdG9taXplcik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzTmFOKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gaXNOdW1iZXIodmFsdWUpICYmIHZhbHVlICE9ICt2YWx1ZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNOYXRpdmUodmFsdWUpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBmdW5jVGFnKSB7CiAgICAgICAgICAgIHJldHVybiByZUlzTmF0aXZlLnRlc3QoZm5Ub1N0cmluZy5jYWxsKHZhbHVlKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiByZUlzSG9zdEN0b3IudGVzdCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzTnVsbCh2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpc051bWJlcih2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyB8fCAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBudW1iZXJUYWcpOwogICAgICAgIH0KICAgICAgICB2YXIgaXNQbGFpbk9iamVjdCA9ICFnZXRQcm90b3R5cGVPZiA/IHNoaW1Jc1BsYWluT2JqZWN0IDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmICghKHZhbHVlICYmIG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IG9iamVjdFRhZykpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHZhbHVlT2YgPSBnZXROYXRpdmUodmFsdWUsICd2YWx1ZU9mJyksCiAgICAgICAgICAgICAgb2JqUHJvdG8gPSB2YWx1ZU9mICYmIChvYmpQcm90byA9IGdldFByb3RvdHlwZU9mKHZhbHVlT2YpKSAmJiBnZXRQcm90b3R5cGVPZihvYmpQcm90byk7CiAgICAgICAgICByZXR1cm4gb2JqUHJvdG8gPyAodmFsdWUgPT0gb2JqUHJvdG8gfHwgZ2V0UHJvdG90eXBlT2YodmFsdWUpID09IG9ialByb3RvKSA6IHNoaW1Jc1BsYWluT2JqZWN0KHZhbHVlKTsKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGlzUmVnRXhwKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSByZWdleHBUYWc7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzU3RyaW5nKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IChpc09iamVjdExpa2UodmFsdWUpICYmIG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IHN0cmluZ1RhZyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzVHlwZWRBcnJheSh2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW29ialRvU3RyaW5nLmNhbGwodmFsdWUpXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNVbmRlZmluZWQodmFsdWUpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsdCh2YWx1ZSwgb3RoZXIpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZSA8IG90aGVyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsdGUodmFsdWUsIG90aGVyKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWUgPD0gb3RoZXI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRvQXJyYXkodmFsdWUpIHsKICAgICAgICAgIHZhciBsZW5ndGggPSB2YWx1ZSA/IGdldExlbmd0aCh2YWx1ZSkgOiAwOwogICAgICAgICAgaWYgKCFpc0xlbmd0aChsZW5ndGgpKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZXModmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFycmF5Q29weSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRvUGxhaW5PYmplY3QodmFsdWUpIHsKICAgICAgICAgIHJldHVybiBiYXNlQ29weSh2YWx1ZSwga2V5c0luKHZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIHZhciBhc3NpZ24gPSBjcmVhdGVBc3NpZ25lcihmdW5jdGlvbihvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplcikgewogICAgICAgICAgcmV0dXJuIGN1c3RvbWl6ZXIgPyBhc3NpZ25XaXRoKG9iamVjdCwgc291cmNlLCBjdXN0b21pemVyKSA6IGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShwcm90b3R5cGUsIHByb3BlcnRpZXMsIGd1YXJkKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gYmFzZUNyZWF0ZShwcm90b3R5cGUpOwogICAgICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKHByb3RvdHlwZSwgcHJvcGVydGllcywgZ3VhcmQpKSB7CiAgICAgICAgICAgIHByb3BlcnRpZXMgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXMgPyBiYXNlQXNzaWduKHJlc3VsdCwgcHJvcGVydGllcykgOiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBkZWZhdWx0cyA9IHJlc3RQYXJhbShmdW5jdGlvbihhcmdzKSB7CiAgICAgICAgICB2YXIgb2JqZWN0ID0gYXJnc1swXTsKICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgICAgfQogICAgICAgICAgYXJncy5wdXNoKGFzc2lnbkRlZmF1bHRzKTsKICAgICAgICAgIHJldHVybiBhc3NpZ24uYXBwbHkodW5kZWZpbmVkLCBhcmdzKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZmluZEtleSA9IGNyZWF0ZUZpbmRLZXkoYmFzZUZvck93bik7CiAgICAgICAgdmFyIGZpbmRMYXN0S2V5ID0gY3JlYXRlRmluZEtleShiYXNlRm9yT3duUmlnaHQpOwogICAgICAgIHZhciBmb3JJbiA9IGNyZWF0ZUZvckluKGJhc2VGb3IpOwogICAgICAgIHZhciBmb3JJblJpZ2h0ID0gY3JlYXRlRm9ySW4oYmFzZUZvclJpZ2h0KTsKICAgICAgICB2YXIgZm9yT3duID0gY3JlYXRlRm9yT3duKGJhc2VGb3JPd24pOwogICAgICAgIHZhciBmb3JPd25SaWdodCA9IGNyZWF0ZUZvck93bihiYXNlRm9yT3duUmlnaHQpOwogICAgICAgIGZ1bmN0aW9uIGZ1bmN0aW9ucyhvYmplY3QpIHsKICAgICAgICAgIHJldHVybiBiYXNlRnVuY3Rpb25zKG9iamVjdCwga2V5c0luKG9iamVjdCkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXQob2JqZWN0LCBwYXRoLCBkZWZhdWx0VmFsdWUpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGJhc2VHZXQob2JqZWN0LCB0b1BhdGgocGF0aCksIHBhdGggKyAnJyk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0ID09PSB1bmRlZmluZWQgPyBkZWZhdWx0VmFsdWUgOiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGhhcyhvYmplY3QsIHBhdGgpIHsKICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVzdWx0ID0gaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHBhdGgpOwogICAgICAgICAgaWYgKCFyZXN1bHQgJiYgIWlzS2V5KHBhdGgpKSB7CiAgICAgICAgICAgIHBhdGggPSB0b1BhdGgocGF0aCk7CiAgICAgICAgICAgIG9iamVjdCA9IHBhdGgubGVuZ3RoID09IDEgPyBvYmplY3QgOiBiYXNlR2V0KG9iamVjdCwgYmFzZVNsaWNlKHBhdGgsIDAsIC0xKSk7CiAgICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXRoID0gbGFzdChwYXRoKTsKICAgICAgICAgICAgcmVzdWx0ID0gaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHBhdGgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdCB8fCAoaXNMZW5ndGgob2JqZWN0Lmxlbmd0aCkgJiYgaXNJbmRleChwYXRoLCBvYmplY3QubGVuZ3RoKSAmJiAoaXNBcnJheShvYmplY3QpIHx8IGlzQXJndW1lbnRzKG9iamVjdCkpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaW52ZXJ0KG9iamVjdCwgbXVsdGlWYWx1ZSwgZ3VhcmQpIHsKICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChvYmplY3QsIG11bHRpVmFsdWUsIGd1YXJkKSkgewogICAgICAgICAgICBtdWx0aVZhbHVlID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIHByb3BzID0ga2V5cyhvYmplY3QpLAogICAgICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aCwKICAgICAgICAgICAgICByZXN1bHQgPSB7fTsKICAgICAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF0sCiAgICAgICAgICAgICAgICB2YWx1ZSA9IG9iamVjdFtrZXldOwogICAgICAgICAgICBpZiAobXVsdGlWYWx1ZSkgewogICAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHJlc3VsdCwgdmFsdWUpKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbdmFsdWVdLnB1c2goa2V5KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0W3ZhbHVlXSA9IFtrZXldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXN1bHRbdmFsdWVdID0ga2V5OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICB2YXIga2V5cyA9ICFuYXRpdmVLZXlzID8gc2hpbUtleXMgOiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICAgIHZhciBDdG9yID0gb2JqZWN0ID09IG51bGwgPyBudWxsIDogb2JqZWN0LmNvbnN0cnVjdG9yOwogICAgICAgICAgaWYgKCh0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IucHJvdG90eXBlID09PSBvYmplY3QpIHx8ICh0eXBlb2Ygb2JqZWN0ICE9ICdmdW5jdGlvbicgJiYgaXNBcnJheUxpa2Uob2JqZWN0KSkpIHsKICAgICAgICAgICAgcmV0dXJuIHNoaW1LZXlzKG9iamVjdCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaXNPYmplY3Qob2JqZWN0KSA/IG5hdGl2ZUtleXMob2JqZWN0KSA6IFtdOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24ga2V5c0luKG9iamVjdCkgewogICAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghaXNPYmplY3Qob2JqZWN0KSkgewogICAgICAgICAgICBvYmplY3QgPSBPYmplY3Qob2JqZWN0KTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBsZW5ndGggPSBvYmplY3QubGVuZ3RoOwogICAgICAgICAgbGVuZ3RoID0gKGxlbmd0aCAmJiBpc0xlbmd0aChsZW5ndGgpICYmIChpc0FycmF5KG9iamVjdCkgfHwgaXNBcmd1bWVudHMob2JqZWN0KSkgJiYgbGVuZ3RoKSB8fCAwOwogICAgICAgICAgdmFyIEN0b3IgPSBvYmplY3QuY29uc3RydWN0b3IsCiAgICAgICAgICAgICAgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBpc1Byb3RvID0gdHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBDdG9yLnByb3RvdHlwZSA9PT0gb2JqZWN0LAogICAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCksCiAgICAgICAgICAgICAgc2tpcEluZGV4ZXMgPSBsZW5ndGggPiAwOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgcmVzdWx0W2luZGV4XSA9IChpbmRleCArICcnKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHsKICAgICAgICAgICAgaWYgKCEoc2tpcEluZGV4ZXMgJiYgaXNJbmRleChrZXksIGxlbmd0aCkpICYmICEoa2V5ID09ICdjb25zdHJ1Y3RvcicgJiYgKGlzUHJvdG8gfHwgIWhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpKSkpIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICB2YXIgbWFwS2V5cyA9IGNyZWF0ZU9iamVjdE1hcHBlcih0cnVlKTsKICAgICAgICB2YXIgbWFwVmFsdWVzID0gY3JlYXRlT2JqZWN0TWFwcGVyKCk7CiAgICAgICAgdmFyIG1lcmdlID0gY3JlYXRlQXNzaWduZXIoYmFzZU1lcmdlKTsKICAgICAgICB2YXIgb21pdCA9IHJlc3RQYXJhbShmdW5jdGlvbihvYmplY3QsIHByb3BzKSB7CiAgICAgICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBwcm9wc1swXSAhPSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHZhciBwcm9wcyA9IGFycmF5TWFwKGJhc2VGbGF0dGVuKHByb3BzKSwgU3RyaW5nKTsKICAgICAgICAgICAgcmV0dXJuIHBpY2tCeUFycmF5KG9iamVjdCwgYmFzZURpZmZlcmVuY2Uoa2V5c0luKG9iamVjdCksIHByb3BzKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHJlZGljYXRlID0gYmluZENhbGxiYWNrKHByb3BzWzBdLCBwcm9wc1sxXSwgMyk7CiAgICAgICAgICByZXR1cm4gcGlja0J5Q2FsbGJhY2sob2JqZWN0LCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuICFwcmVkaWNhdGUodmFsdWUsIGtleSwgb2JqZWN0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIHBhaXJzKG9iamVjdCkgewogICAgICAgICAgb2JqZWN0ID0gdG9PYmplY3Qob2JqZWN0KTsKICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIHByb3BzID0ga2V5cyhvYmplY3QpLAogICAgICAgICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aCwKICAgICAgICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsKICAgICAgICAgICAgcmVzdWx0W2luZGV4XSA9IFtrZXksIG9iamVjdFtrZXldXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBwaWNrID0gcmVzdFBhcmFtKGZ1bmN0aW9uKG9iamVjdCwgcHJvcHMpIHsKICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHByb3BzWzBdID09ICdmdW5jdGlvbicgPyBwaWNrQnlDYWxsYmFjayhvYmplY3QsIGJpbmRDYWxsYmFjayhwcm9wc1swXSwgcHJvcHNbMV0sIDMpKSA6IHBpY2tCeUFycmF5KG9iamVjdCwgYmFzZUZsYXR0ZW4ocHJvcHMpKTsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiByZXN1bHQob2JqZWN0LCBwYXRoLCBkZWZhdWx0VmFsdWUpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtwYXRoXTsKICAgICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAob2JqZWN0ICE9IG51bGwgJiYgIWlzS2V5KHBhdGgsIG9iamVjdCkpIHsKICAgICAgICAgICAgICBwYXRoID0gdG9QYXRoKHBhdGgpOwogICAgICAgICAgICAgIG9iamVjdCA9IHBhdGgubGVuZ3RoID09IDEgPyBvYmplY3QgOiBiYXNlR2V0KG9iamVjdCwgYmFzZVNsaWNlKHBhdGgsIDAsIC0xKSk7CiAgICAgICAgICAgICAgcmVzdWx0ID0gb2JqZWN0ID09IG51bGwgPyB1bmRlZmluZWQgOiBvYmplY3RbbGFzdChwYXRoKV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0ID09PSB1bmRlZmluZWQgPyBkZWZhdWx0VmFsdWUgOiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaXNGdW5jdGlvbihyZXN1bHQpID8gcmVzdWx0LmNhbGwob2JqZWN0KSA6IHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2V0KG9iamVjdCwgcGF0aCwgdmFsdWUpIHsKICAgICAgICAgIGlmIChvYmplY3QgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgICAgfQogICAgICAgICAgdmFyIHBhdGhLZXkgPSAocGF0aCArICcnKTsKICAgICAgICAgIHBhdGggPSAob2JqZWN0W3BhdGhLZXldICE9IG51bGwgfHwgaXNLZXkocGF0aCwgb2JqZWN0KSkgPyBbcGF0aEtleV0gOiB0b1BhdGgocGF0aCk7CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICBsZW5ndGggPSBwYXRoLmxlbmd0aCwKICAgICAgICAgICAgICBsYXN0SW5kZXggPSBsZW5ndGggLSAxLAogICAgICAgICAgICAgIG5lc3RlZCA9IG9iamVjdDsKICAgICAgICAgIHdoaWxlIChuZXN0ZWQgIT0gbnVsbCAmJiArK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwYXRoW2luZGV4XTsKICAgICAgICAgICAgaWYgKGlzT2JqZWN0KG5lc3RlZCkpIHsKICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gbGFzdEluZGV4KSB7CiAgICAgICAgICAgICAgICBuZXN0ZWRba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAobmVzdGVkW2tleV0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbmVzdGVkW2tleV0gPSBpc0luZGV4KHBhdGhbaW5kZXggKyAxXSkgPyBbXSA6IHt9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXN0ZWQgPSBuZXN0ZWRba2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybShvYmplY3QsIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgdGhpc0FyZykgewogICAgICAgICAgdmFyIGlzQXJyID0gaXNBcnJheShvYmplY3QpIHx8IGlzVHlwZWRBcnJheShvYmplY3QpOwogICAgICAgICAgaXRlcmF0ZWUgPSBnZXRDYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgNCk7CiAgICAgICAgICBpZiAoYWNjdW11bGF0b3IgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaXNBcnIgfHwgaXNPYmplY3Qob2JqZWN0KSkgewogICAgICAgICAgICAgIHZhciBDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yOwogICAgICAgICAgICAgIGlmIChpc0FycikgewogICAgICAgICAgICAgICAgYWNjdW11bGF0b3IgPSBpc0FycmF5KG9iamVjdCkgPyBuZXcgQ3RvciA6IFtdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvciA9IGJhc2VDcmVhdGUoaXNGdW5jdGlvbihDdG9yKSA/IEN0b3IucHJvdG90eXBlIDogbnVsbCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGFjY3VtdWxhdG9yID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIChpc0FyciA/IGFycmF5RWFjaCA6IGJhc2VGb3JPd24pKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIG9iamVjdCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBhY2N1bXVsYXRvcjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdmFsdWVzKG9iamVjdCkgewogICAgICAgICAgcmV0dXJuIGJhc2VWYWx1ZXMob2JqZWN0LCBrZXlzKG9iamVjdCkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB2YWx1ZXNJbihvYmplY3QpIHsKICAgICAgICAgIHJldHVybiBiYXNlVmFsdWVzKG9iamVjdCwga2V5c0luKG9iamVjdCkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpblJhbmdlKHZhbHVlLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICBzdGFydCA9ICtzdGFydCB8fCAwOwogICAgICAgICAgaWYgKHR5cGVvZiBlbmQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGVuZCA9IHN0YXJ0OwogICAgICAgICAgICBzdGFydCA9IDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbmQgPSArZW5kIHx8IDA7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdmFsdWUgPj0gbmF0aXZlTWluKHN0YXJ0LCBlbmQpICYmIHZhbHVlIDwgbmF0aXZlTWF4KHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByYW5kb20obWluLCBtYXgsIGZsb2F0aW5nKSB7CiAgICAgICAgICBpZiAoZmxvYXRpbmcgJiYgaXNJdGVyYXRlZUNhbGwobWluLCBtYXgsIGZsb2F0aW5nKSkgewogICAgICAgICAgICBtYXggPSBmbG9hdGluZyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbm9NaW4gPSBtaW4gPT0gbnVsbCwKICAgICAgICAgICAgICBub01heCA9IG1heCA9PSBudWxsOwogICAgICAgICAgaWYgKGZsb2F0aW5nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKG5vTWF4ICYmIHR5cGVvZiBtaW4gPT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgICAgZmxvYXRpbmcgPSBtaW47CiAgICAgICAgICAgICAgbWluID0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbWF4ID09ICdib29sZWFuJykgewogICAgICAgICAgICAgIGZsb2F0aW5nID0gbWF4OwogICAgICAgICAgICAgIG5vTWF4ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKG5vTWluICYmIG5vTWF4KSB7CiAgICAgICAgICAgIG1heCA9IDE7CiAgICAgICAgICAgIG5vTWF4ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBtaW4gPSArbWluIHx8IDA7CiAgICAgICAgICBpZiAobm9NYXgpIHsKICAgICAgICAgICAgbWF4ID0gbWluOwogICAgICAgICAgICBtaW4gPSAwOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWF4ID0gK21heCB8fCAwOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGZsb2F0aW5nIHx8IG1pbiAlIDEgfHwgbWF4ICUgMSkgewogICAgICAgICAgICB2YXIgcmFuZCA9IG5hdGl2ZVJhbmRvbSgpOwogICAgICAgICAgICByZXR1cm4gbmF0aXZlTWluKG1pbiArIChyYW5kICogKG1heCAtIG1pbiArIHBhcnNlRmxvYXQoJzFlLScgKyAoKHJhbmQgKyAnJykubGVuZ3RoIC0gMSkpKSksIG1heCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmFzZVJhbmRvbShtaW4sIG1heCk7CiAgICAgICAgfQogICAgICAgIHZhciBjYW1lbENhc2UgPSBjcmVhdGVDb21wb3VuZGVyKGZ1bmN0aW9uKHJlc3VsdCwgd29yZCwgaW5kZXgpIHsKICAgICAgICAgIHdvcmQgPSB3b3JkLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gKHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKSA6IHdvcmQpOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyaW5nKSB7CiAgICAgICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsKICAgICAgICAgIHJldHVybiBzdHJpbmcgJiYgKHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRlYnVycihzdHJpbmcpIHsKICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgcmV0dXJuIHN0cmluZyAmJiBzdHJpbmcucmVwbGFjZShyZUxhdGluMSwgZGVidXJyTGV0dGVyKS5yZXBsYWNlKHJlQ29tYm9NYXJrLCAnJyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHN0cmluZywgdGFyZ2V0LCBwb3NpdGlvbikgewogICAgICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7CiAgICAgICAgICB0YXJnZXQgPSAodGFyZ2V0ICsgJycpOwogICAgICAgICAgdmFyIGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7CiAgICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uID09PSB1bmRlZmluZWQgPyBsZW5ndGggOiBuYXRpdmVNaW4ocG9zaXRpb24gPCAwID8gMCA6ICgrcG9zaXRpb24gfHwgMCksIGxlbmd0aCk7CiAgICAgICAgICBwb3NpdGlvbiAtPSB0YXJnZXQubGVuZ3RoOwogICAgICAgICAgcmV0dXJuIHBvc2l0aW9uID49IDAgJiYgc3RyaW5nLmluZGV4T2YodGFyZ2V0LCBwb3NpdGlvbikgPT0gcG9zaXRpb247CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGVzY2FwZShzdHJpbmcpIHsKICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgcmV0dXJuIChzdHJpbmcgJiYgcmVIYXNVbmVzY2FwZWRIdG1sLnRlc3Qoc3RyaW5nKSkgPyBzdHJpbmcucmVwbGFjZShyZVVuZXNjYXBlZEh0bWwsIGVzY2FwZUh0bWxDaGFyKSA6IHN0cmluZzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cmluZykgewogICAgICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7CiAgICAgICAgICByZXR1cm4gKHN0cmluZyAmJiByZUhhc1JlZ0V4cENoYXJzLnRlc3Qoc3RyaW5nKSkgPyBzdHJpbmcucmVwbGFjZShyZVJlZ0V4cENoYXJzLCAnXFwkJicpIDogc3RyaW5nOwogICAgICAgIH0KICAgICAgICB2YXIga2ViYWJDYXNlID0gY3JlYXRlQ29tcG91bmRlcihmdW5jdGlvbihyZXN1bHQsIHdvcmQsIGluZGV4KSB7CiAgICAgICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gJy0nIDogJycpICsgd29yZC50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIHBhZChzdHJpbmcsIGxlbmd0aCwgY2hhcnMpIHsKICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgbGVuZ3RoID0gK2xlbmd0aDsKICAgICAgICAgIHZhciBzdHJMZW5ndGggPSBzdHJpbmcubGVuZ3RoOwogICAgICAgICAgaWYgKHN0ckxlbmd0aCA+PSBsZW5ndGggfHwgIW5hdGl2ZUlzRmluaXRlKGxlbmd0aCkpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBtaWQgPSAobGVuZ3RoIC0gc3RyTGVuZ3RoKSAvIDIsCiAgICAgICAgICAgICAgbGVmdExlbmd0aCA9IGZsb29yKG1pZCksCiAgICAgICAgICAgICAgcmlnaHRMZW5ndGggPSBjZWlsKG1pZCk7CiAgICAgICAgICBjaGFycyA9IGNyZWF0ZVBhZGRpbmcoJycsIHJpZ2h0TGVuZ3RoLCBjaGFycyk7CiAgICAgICAgICByZXR1cm4gY2hhcnMuc2xpY2UoMCwgbGVmdExlbmd0aCkgKyBzdHJpbmcgKyBjaGFyczsKICAgICAgICB9CiAgICAgICAgdmFyIHBhZExlZnQgPSBjcmVhdGVQYWREaXIoKTsKICAgICAgICB2YXIgcGFkUmlnaHQgPSBjcmVhdGVQYWREaXIodHJ1ZSk7CiAgICAgICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nLCByYWRpeCwgZ3VhcmQpIHsKICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChzdHJpbmcsIHJhZGl4LCBndWFyZCkpIHsKICAgICAgICAgICAgcmFkaXggPSAwOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5hdGl2ZVBhcnNlSW50KHN0cmluZywgcmFkaXgpOwogICAgICAgIH0KICAgICAgICBpZiAobmF0aXZlUGFyc2VJbnQod2hpdGVzcGFjZSArICcwOCcpICE9IDgpIHsKICAgICAgICAgIHBhcnNlSW50ID0gZnVuY3Rpb24oc3RyaW5nLCByYWRpeCwgZ3VhcmQpIHsKICAgICAgICAgICAgaWYgKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCByYWRpeCwgZ3VhcmQpIDogcmFkaXggPT0gbnVsbCkgewogICAgICAgICAgICAgIHJhZGl4ID0gMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChyYWRpeCkgewogICAgICAgICAgICAgIHJhZGl4ID0gK3JhZGl4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cmluZyA9IHRyaW0oc3RyaW5nKTsKICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZVBhcnNlSW50KHN0cmluZywgcmFkaXggfHwgKHJlSGFzSGV4UHJlZml4LnRlc3Qoc3RyaW5nKSA/IDE2IDogMTApKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlcGVhdChzdHJpbmcsIG4pIHsKICAgICAgICAgIHZhciByZXN1bHQgPSAnJzsKICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgbiA9ICtuOwogICAgICAgICAgaWYgKG4gPCAxIHx8ICFzdHJpbmcgfHwgIW5hdGl2ZUlzRmluaXRlKG4pKSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGlmIChuICUgMikgewogICAgICAgICAgICAgIHJlc3VsdCArPSBzdHJpbmc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbiA9IGZsb29yKG4gLyAyKTsKICAgICAgICAgICAgc3RyaW5nICs9IHN0cmluZzsKICAgICAgICAgIH0gd2hpbGUgKG4pOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgdmFyIHNuYWtlQ2FzZSA9IGNyZWF0ZUNvbXBvdW5kZXIoZnVuY3Rpb24ocmVzdWx0LCB3b3JkLCBpbmRleCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdCArIChpbmRleCA/ICdfJyA6ICcnKSArIHdvcmQudG9Mb3dlckNhc2UoKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgc3RhcnRDYXNlID0gY3JlYXRlQ29tcG91bmRlcihmdW5jdGlvbihyZXN1bHQsIHdvcmQsIGluZGV4KSB7CiAgICAgICAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gJyAnIDogJycpICsgKHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpKTsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHN0cmluZywgdGFyZ2V0LCBwb3NpdGlvbikgewogICAgICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7CiAgICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uID09IG51bGwgPyAwIDogbmF0aXZlTWluKHBvc2l0aW9uIDwgMCA/IDAgOiAoK3Bvc2l0aW9uIHx8IDApLCBzdHJpbmcubGVuZ3RoKTsKICAgICAgICAgIHJldHVybiBzdHJpbmcubGFzdEluZGV4T2YodGFyZ2V0LCBwb3NpdGlvbikgPT0gcG9zaXRpb247CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRlbXBsYXRlKHN0cmluZywgb3B0aW9ucywgb3RoZXJPcHRpb25zKSB7CiAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBsb2Rhc2gudGVtcGxhdGVTZXR0aW5nczsKICAgICAgICAgIGlmIChvdGhlck9wdGlvbnMgJiYgaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCBvcHRpb25zLCBvdGhlck9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSBvdGhlck9wdGlvbnMgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7CiAgICAgICAgICBvcHRpb25zID0gYXNzaWduV2l0aChiYXNlQXNzaWduKHt9LCBvdGhlck9wdGlvbnMgfHwgb3B0aW9ucyksIHNldHRpbmdzLCBhc3NpZ25Pd25EZWZhdWx0cyk7CiAgICAgICAgICB2YXIgaW1wb3J0cyA9IGFzc2lnbldpdGgoYmFzZUFzc2lnbih7fSwgb3B0aW9ucy5pbXBvcnRzKSwgc2V0dGluZ3MuaW1wb3J0cywgYXNzaWduT3duRGVmYXVsdHMpLAogICAgICAgICAgICAgIGltcG9ydHNLZXlzID0ga2V5cyhpbXBvcnRzKSwKICAgICAgICAgICAgICBpbXBvcnRzVmFsdWVzID0gYmFzZVZhbHVlcyhpbXBvcnRzLCBpbXBvcnRzS2V5cyk7CiAgICAgICAgICB2YXIgaXNFc2NhcGluZywKICAgICAgICAgICAgICBpc0V2YWx1YXRpbmcsCiAgICAgICAgICAgICAgaW5kZXggPSAwLAogICAgICAgICAgICAgIGludGVycG9sYXRlID0gb3B0aW9ucy5pbnRlcnBvbGF0ZSB8fCByZU5vTWF0Y2gsCiAgICAgICAgICAgICAgc291cmNlID0gIl9fcCArPSAnIjsKICAgICAgICAgIHZhciByZURlbGltaXRlcnMgPSBSZWdFeHAoKG9wdGlvbnMuZXNjYXBlIHx8IHJlTm9NYXRjaCkuc291cmNlICsgJ3wnICsgaW50ZXJwb2xhdGUuc291cmNlICsgJ3wnICsgKGludGVycG9sYXRlID09PSByZUludGVycG9sYXRlID8gcmVFc1RlbXBsYXRlIDogcmVOb01hdGNoKS5zb3VyY2UgKyAnfCcgKyAob3B0aW9ucy5ldmFsdWF0ZSB8fCByZU5vTWF0Y2gpLnNvdXJjZSArICd8JCcsICdnJyk7CiAgICAgICAgICB2YXIgc291cmNlVVJMID0gJy8vIyBzb3VyY2VVUkw9JyArICgnc291cmNlVVJMJyBpbiBvcHRpb25zID8gb3B0aW9ucy5zb3VyY2VVUkwgOiAoJ2xvZGFzaC50ZW1wbGF0ZVNvdXJjZXNbJyArICgrK3RlbXBsYXRlQ291bnRlcikgKyAnXScpKSArICdcbic7CiAgICAgICAgICBzdHJpbmcucmVwbGFjZShyZURlbGltaXRlcnMsIGZ1bmN0aW9uKG1hdGNoLCBlc2NhcGVWYWx1ZSwgaW50ZXJwb2xhdGVWYWx1ZSwgZXNUZW1wbGF0ZVZhbHVlLCBldmFsdWF0ZVZhbHVlLCBvZmZzZXQpIHsKICAgICAgICAgICAgaW50ZXJwb2xhdGVWYWx1ZSB8fCAoaW50ZXJwb2xhdGVWYWx1ZSA9IGVzVGVtcGxhdGVWYWx1ZSk7CiAgICAgICAgICAgIHNvdXJjZSArPSBzdHJpbmcuc2xpY2UoaW5kZXgsIG9mZnNldCkucmVwbGFjZShyZVVuZXNjYXBlZFN0cmluZywgZXNjYXBlU3RyaW5nQ2hhcik7CiAgICAgICAgICAgIGlmIChlc2NhcGVWYWx1ZSkgewogICAgICAgICAgICAgIGlzRXNjYXBpbmcgPSB0cnVlOwogICAgICAgICAgICAgIHNvdXJjZSArPSAiJyArXG5fX2UoIiArIGVzY2FwZVZhbHVlICsgIikgK1xuJyI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGV2YWx1YXRlVmFsdWUpIHsKICAgICAgICAgICAgICBpc0V2YWx1YXRpbmcgPSB0cnVlOwogICAgICAgICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZVZhbHVlICsgIjtcbl9fcCArPSAnIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaW50ZXJwb2xhdGVWYWx1ZSkgewogICAgICAgICAgICAgIHNvdXJjZSArPSAiJyArXG4oKF9fdCA9ICgiICsgaW50ZXJwb2xhdGVWYWx1ZSArICIpKSA9PSBudWxsID8gJycgOiBfX3QpICtcbiciOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4ID0gb2Zmc2V0ICsgbWF0Y2gubGVuZ3RoOwogICAgICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICAgICAgICB9KTsKICAgICAgICAgIHNvdXJjZSArPSAiJztcbiI7CiAgICAgICAgICB2YXIgdmFyaWFibGUgPSBvcHRpb25zLnZhcmlhYmxlOwogICAgICAgICAgaWYgKCF2YXJpYWJsZSkgewogICAgICAgICAgICBzb3VyY2UgPSAnd2l0aCAob2JqKSB7XG4nICsgc291cmNlICsgJ1xufVxuJzsKICAgICAgICAgIH0KICAgICAgICAgIHNvdXJjZSA9IChpc0V2YWx1YXRpbmcgPyBzb3VyY2UucmVwbGFjZShyZUVtcHR5U3RyaW5nTGVhZGluZywgJycpIDogc291cmNlKS5yZXBsYWNlKHJlRW1wdHlTdHJpbmdNaWRkbGUsICckMScpLnJlcGxhY2UocmVFbXB0eVN0cmluZ1RyYWlsaW5nLCAnJDE7Jyk7CiAgICAgICAgICBzb3VyY2UgPSAnZnVuY3Rpb24oJyArICh2YXJpYWJsZSB8fCAnb2JqJykgKyAnKSB7XG4nICsgKHZhcmlhYmxlID8gJycgOiAnb2JqIHx8IChvYmogPSB7fSk7XG4nKSArICJ2YXIgX190LCBfX3AgPSAnJyIgKyAoaXNFc2NhcGluZyA/ICcsIF9fZSA9IF8uZXNjYXBlJyA6ICcnKSArIChpc0V2YWx1YXRpbmcgPyAnLCBfX2ogPSBBcnJheS5wcm90b3R5cGUuam9pbjtcbicgKyAiZnVuY3Rpb24gcHJpbnQoKSB7IF9fcCArPSBfX2ouY2FsbChhcmd1bWVudHMsICcnKSB9XG4iIDogJztcbicpICsgc291cmNlICsgJ3JldHVybiBfX3Bcbn0nOwogICAgICAgICAgdmFyIHJlc3VsdCA9IGF0dGVtcHQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBGdW5jdGlvbihpbXBvcnRzS2V5cywgc291cmNlVVJMICsgJ3JldHVybiAnICsgc291cmNlKS5hcHBseSh1bmRlZmluZWQsIGltcG9ydHNWYWx1ZXMpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXN1bHQuc291cmNlID0gc291cmNlOwogICAgICAgICAgaWYgKGlzRXJyb3IocmVzdWx0KSkgewogICAgICAgICAgICB0aHJvdyByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cmltKHN0cmluZywgY2hhcnMsIGd1YXJkKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBzdHJpbmc7CiAgICAgICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsKICAgICAgICAgIGlmICghc3RyaW5nKSB7CiAgICAgICAgICAgIHJldHVybiBzdHJpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbCh2YWx1ZSwgY2hhcnMsIGd1YXJkKSA6IGNoYXJzID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5zbGljZSh0cmltbWVkTGVmdEluZGV4KHN0cmluZyksIHRyaW1tZWRSaWdodEluZGV4KHN0cmluZykgKyAxKTsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJzID0gKGNoYXJzICsgJycpOwogICAgICAgICAgcmV0dXJuIHN0cmluZy5zbGljZShjaGFyc0xlZnRJbmRleChzdHJpbmcsIGNoYXJzKSwgY2hhcnNSaWdodEluZGV4KHN0cmluZywgY2hhcnMpICsgMSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRyaW1MZWZ0KHN0cmluZywgY2hhcnMsIGd1YXJkKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBzdHJpbmc7CiAgICAgICAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsKICAgICAgICAgIGlmICghc3RyaW5nKSB7CiAgICAgICAgICAgIHJldHVybiBzdHJpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3VhcmQgPyBpc0l0ZXJhdGVlQ2FsbCh2YWx1ZSwgY2hhcnMsIGd1YXJkKSA6IGNoYXJzID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5zbGljZSh0cmltbWVkTGVmdEluZGV4KHN0cmluZykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHN0cmluZy5zbGljZShjaGFyc0xlZnRJbmRleChzdHJpbmcsIChjaGFycyArICcnKSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cmltUmlnaHQoc3RyaW5nLCBjaGFycywgZ3VhcmQpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHN0cmluZzsKICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgaWYgKCFzdHJpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChndWFyZCA/IGlzSXRlcmF0ZWVDYWxsKHZhbHVlLCBjaGFycywgZ3VhcmQpIDogY2hhcnMgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKDAsIHRyaW1tZWRSaWdodEluZGV4KHN0cmluZykgKyAxKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzdHJpbmcuc2xpY2UoMCwgY2hhcnNSaWdodEluZGV4KHN0cmluZywgKGNoYXJzICsgJycpKSArIDEpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cnVuYyhzdHJpbmcsIG9wdGlvbnMsIGd1YXJkKSB7CiAgICAgICAgICBpZiAoZ3VhcmQgJiYgaXNJdGVyYXRlZUNhbGwoc3RyaW5nLCBvcHRpb25zLCBndWFyZCkpIHsKICAgICAgICAgICAgb3B0aW9ucyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbGVuZ3RoID0gREVGQVVMVF9UUlVOQ19MRU5HVEgsCiAgICAgICAgICAgICAgb21pc3Npb24gPSBERUZBVUxUX1RSVU5DX09NSVNTSU9OOwogICAgICAgICAgaWYgKG9wdGlvbnMgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoaXNPYmplY3Qob3B0aW9ucykpIHsKICAgICAgICAgICAgICB2YXIgc2VwYXJhdG9yID0gJ3NlcGFyYXRvcicgaW4gb3B0aW9ucyA/IG9wdGlvbnMuc2VwYXJhdG9yIDogc2VwYXJhdG9yOwogICAgICAgICAgICAgIGxlbmd0aCA9ICdsZW5ndGgnIGluIG9wdGlvbnMgPyAoK29wdGlvbnMubGVuZ3RoIHx8IDApIDogbGVuZ3RoOwogICAgICAgICAgICAgIG9taXNzaW9uID0gJ29taXNzaW9uJyBpbiBvcHRpb25zID8gYmFzZVRvU3RyaW5nKG9wdGlvbnMub21pc3Npb24pIDogb21pc3Npb247CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbGVuZ3RoID0gK29wdGlvbnMgfHwgMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3RyaW5nID0gYmFzZVRvU3RyaW5nKHN0cmluZyk7CiAgICAgICAgICBpZiAobGVuZ3RoID49IHN0cmluZy5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBlbmQgPSBsZW5ndGggLSBvbWlzc2lvbi5sZW5ndGg7CiAgICAgICAgICBpZiAoZW5kIDwgMSkgewogICAgICAgICAgICByZXR1cm4gb21pc3Npb247CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVzdWx0ID0gc3RyaW5nLnNsaWNlKDAsIGVuZCk7CiAgICAgICAgICBpZiAoc2VwYXJhdG9yID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCArIG9taXNzaW9uOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzUmVnRXhwKHNlcGFyYXRvcikpIHsKICAgICAgICAgICAgaWYgKHN0cmluZy5zbGljZShlbmQpLnNlYXJjaChzZXBhcmF0b3IpKSB7CiAgICAgICAgICAgICAgdmFyIG1hdGNoLAogICAgICAgICAgICAgICAgICBuZXdFbmQsCiAgICAgICAgICAgICAgICAgIHN1YnN0cmluZyA9IHN0cmluZy5zbGljZSgwLCBlbmQpOwogICAgICAgICAgICAgIGlmICghc2VwYXJhdG9yLmdsb2JhbCkgewogICAgICAgICAgICAgICAgc2VwYXJhdG9yID0gUmVnRXhwKHNlcGFyYXRvci5zb3VyY2UsIChyZUZsYWdzLmV4ZWMoc2VwYXJhdG9yKSB8fCAnJykgKyAnZycpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzZXBhcmF0b3IubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgICB3aGlsZSAoKG1hdGNoID0gc2VwYXJhdG9yLmV4ZWMoc3Vic3RyaW5nKSkpIHsKICAgICAgICAgICAgICAgIG5ld0VuZCA9IG1hdGNoLmluZGV4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQuc2xpY2UoMCwgbmV3RW5kID09IG51bGwgPyBlbmQgOiBuZXdFbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHN0cmluZy5pbmRleE9mKHNlcGFyYXRvciwgZW5kKSAhPSBlbmQpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gcmVzdWx0Lmxhc3RJbmRleE9mKHNlcGFyYXRvcik7CiAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnNsaWNlKDAsIGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdCArIG9taXNzaW9uOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1bmVzY2FwZShzdHJpbmcpIHsKICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgcmV0dXJuIChzdHJpbmcgJiYgcmVIYXNFc2NhcGVkSHRtbC50ZXN0KHN0cmluZykpID8gc3RyaW5nLnJlcGxhY2UocmVFc2NhcGVkSHRtbCwgdW5lc2NhcGVIdG1sQ2hhcikgOiBzdHJpbmc7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdvcmRzKHN0cmluZywgcGF0dGVybiwgZ3VhcmQpIHsKICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChzdHJpbmcsIHBhdHRlcm4sIGd1YXJkKSkgewogICAgICAgICAgICBwYXR0ZXJuID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHN0cmluZyA9IGJhc2VUb1N0cmluZyhzdHJpbmcpOwogICAgICAgICAgcmV0dXJuIHN0cmluZy5tYXRjaChwYXR0ZXJuIHx8IHJlV29yZHMpIHx8IFtdOwogICAgICAgIH0KICAgICAgICB2YXIgYXR0ZW1wdCA9IHJlc3RQYXJhbShmdW5jdGlvbihmdW5jLCBhcmdzKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh1bmRlZmluZWQsIGFyZ3MpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZXR1cm4gaXNFcnJvcihlKSA/IGUgOiBuZXcgRXJyb3IoZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZnVuY3Rpb24gY2FsbGJhY2soZnVuYywgdGhpc0FyZywgZ3VhcmQpIHsKICAgICAgICAgIGlmIChndWFyZCAmJiBpc0l0ZXJhdGVlQ2FsbChmdW5jLCB0aGlzQXJnLCBndWFyZCkpIHsKICAgICAgICAgICAgdGhpc0FyZyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaXNPYmplY3RMaWtlKGZ1bmMpID8gbWF0Y2hlcyhmdW5jKSA6IGJhc2VDYWxsYmFjayhmdW5jLCB0aGlzQXJnKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY29uc3RhbnQodmFsdWUpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbWF0Y2hlcyhzb3VyY2UpIHsKICAgICAgICAgIHJldHVybiBiYXNlTWF0Y2hlcyhiYXNlQ2xvbmUoc291cmNlLCB0cnVlKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1hdGNoZXNQcm9wZXJ0eShwYXRoLCBzcmNWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIGJhc2VNYXRjaGVzUHJvcGVydHkocGF0aCwgYmFzZUNsb25lKHNyY1ZhbHVlLCB0cnVlKSk7CiAgICAgICAgfQogICAgICAgIHZhciBtZXRob2QgPSByZXN0UGFyYW0oZnVuY3Rpb24ocGF0aCwgYXJncykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaW52b2tlUGF0aChvYmplY3QsIHBhdGgsIGFyZ3MpOwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICB2YXIgbWV0aG9kT2YgPSByZXN0UGFyYW0oZnVuY3Rpb24ob2JqZWN0LCBhcmdzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocGF0aCkgewogICAgICAgICAgICByZXR1cm4gaW52b2tlUGF0aChvYmplY3QsIHBhdGgsIGFyZ3MpOwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBmdW5jdGlvbiBtaXhpbihvYmplY3QsIHNvdXJjZSwgb3B0aW9ucykgewogICAgICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICB2YXIgaXNPYmogPSBpc09iamVjdChzb3VyY2UpLAogICAgICAgICAgICAgICAgcHJvcHMgPSBpc09iaiA/IGtleXMoc291cmNlKSA6IG51bGwsCiAgICAgICAgICAgICAgICBtZXRob2ROYW1lcyA9IChwcm9wcyAmJiBwcm9wcy5sZW5ndGgpID8gYmFzZUZ1bmN0aW9ucyhzb3VyY2UsIHByb3BzKSA6IG51bGw7CiAgICAgICAgICAgIGlmICghKG1ldGhvZE5hbWVzID8gbWV0aG9kTmFtZXMubGVuZ3RoIDogaXNPYmopKSB7CiAgICAgICAgICAgICAgbWV0aG9kTmFtZXMgPSBmYWxzZTsKICAgICAgICAgICAgICBvcHRpb25zID0gc291cmNlOwogICAgICAgICAgICAgIHNvdXJjZSA9IG9iamVjdDsKICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIW1ldGhvZE5hbWVzKSB7CiAgICAgICAgICAgIG1ldGhvZE5hbWVzID0gYmFzZUZ1bmN0aW9ucyhzb3VyY2UsIGtleXMoc291cmNlKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2hhaW4gPSB0cnVlLAogICAgICAgICAgICAgIGluZGV4ID0gLTEsCiAgICAgICAgICAgICAgaXNGdW5jID0gaXNGdW5jdGlvbihvYmplY3QpLAogICAgICAgICAgICAgIGxlbmd0aCA9IG1ldGhvZE5hbWVzLmxlbmd0aDsKICAgICAgICAgIGlmIChvcHRpb25zID09PSBmYWxzZSkgewogICAgICAgICAgICBjaGFpbiA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIGlmIChpc09iamVjdChvcHRpb25zKSAmJiAnY2hhaW4nIGluIG9wdGlvbnMpIHsKICAgICAgICAgICAgY2hhaW4gPSBvcHRpb25zLmNoYWluOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZE5hbWUgPSBtZXRob2ROYW1lc1tpbmRleF0sCiAgICAgICAgICAgICAgICBmdW5jID0gc291cmNlW21ldGhvZE5hbWVdOwogICAgICAgICAgICBvYmplY3RbbWV0aG9kTmFtZV0gPSBmdW5jOwogICAgICAgICAgICBpZiAoaXNGdW5jKSB7CiAgICAgICAgICAgICAgb2JqZWN0LnByb3RvdHlwZVttZXRob2ROYW1lXSA9IChmdW5jdGlvbihmdW5jKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjaGFpbkFsbCA9IHRoaXMuX19jaGFpbl9fOwogICAgICAgICAgICAgICAgICBpZiAoY2hhaW4gfHwgY2hhaW5BbGwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gb2JqZWN0KHRoaXMuX193cmFwcGVkX18pLAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zID0gcmVzdWx0Ll9fYWN0aW9uc19fID0gYXJyYXlDb3B5KHRoaXMuX19hY3Rpb25zX18pOwogICAgICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAnZnVuYyc6IGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgICAnYXJncyc6IGFyZ3VtZW50cywKICAgICAgICAgICAgICAgICAgICAgICd0aGlzQXJnJzogb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Ll9fY2hhaW5fXyA9IGNoYWluQWxsOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy52YWx1ZSgpXTsKICAgICAgICAgICAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseShvYmplY3QsIGFyZ3MpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KGZ1bmMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbm9Db25mbGljdCgpIHsKICAgICAgICAgIGNvbnRleHQuXyA9IG9sZERhc2g7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbm9vcCgpIHt9CiAgICAgICAgZnVuY3Rpb24gcHJvcGVydHkocGF0aCkgewogICAgICAgICAgcmV0dXJuIGlzS2V5KHBhdGgpID8gYmFzZVByb3BlcnR5KHBhdGgpIDogYmFzZVByb3BlcnR5RGVlcChwYXRoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcHJvcGVydHlPZihvYmplY3QpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihwYXRoKSB7CiAgICAgICAgICAgIHJldHVybiBiYXNlR2V0KG9iamVjdCwgdG9QYXRoKHBhdGgpLCBwYXRoICsgJycpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmFuZ2Uoc3RhcnQsIGVuZCwgc3RlcCkgewogICAgICAgICAgaWYgKHN0ZXAgJiYgaXNJdGVyYXRlZUNhbGwoc3RhcnQsIGVuZCwgc3RlcCkpIHsKICAgICAgICAgICAgZW5kID0gc3RlcCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFydCA9ICtzdGFydCB8fCAwOwogICAgICAgICAgc3RlcCA9IHN0ZXAgPT0gbnVsbCA/IDEgOiAoK3N0ZXAgfHwgMCk7CiAgICAgICAgICBpZiAoZW5kID09IG51bGwpIHsKICAgICAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgICAgICAgIHN0YXJ0ID0gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVuZCA9ICtlbmQgfHwgMDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgICAgICAgIGxlbmd0aCA9IG5hdGl2ZU1heChjZWlsKChlbmQgLSBzdGFydCkgLyAoc3RlcCB8fCAxKSksIDApLAogICAgICAgICAgICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICAgICAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gc3RhcnQ7CiAgICAgICAgICAgIHN0YXJ0ICs9IHN0ZXA7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0aW1lcyhuLCBpdGVyYXRlZSwgdGhpc0FyZykgewogICAgICAgICAgbiA9IGZsb29yKG4pOwogICAgICAgICAgaWYgKG4gPCAxIHx8ICFuYXRpdmVJc0Zpbml0ZShuKSkgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgICAgICByZXN1bHQgPSBBcnJheShuYXRpdmVNaW4obiwgTUFYX0FSUkFZX0xFTkdUSCkpOwogICAgICAgICAgaXRlcmF0ZWUgPSBiaW5kQ2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDEpOwogICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBuKSB7CiAgICAgICAgICAgIGlmIChpbmRleCA8IE1BWF9BUlJBWV9MRU5HVEgpIHsKICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGl0ZXJhdGVlKGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdW5pcXVlSWQocHJlZml4KSB7CiAgICAgICAgICB2YXIgaWQgPSArK2lkQ291bnRlcjsKICAgICAgICAgIHJldHVybiBiYXNlVG9TdHJpbmcocHJlZml4KSArIGlkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhZGQoYXVnZW5kLCBhZGRlbmQpIHsKICAgICAgICAgIHJldHVybiAoK2F1Z2VuZCB8fCAwKSArICgrYWRkZW5kIHx8IDApOwogICAgICAgIH0KICAgICAgICB2YXIgbWF4ID0gY3JlYXRlRXh0cmVtdW0oZ3QsIE5FR0FUSVZFX0lORklOSVRZKTsKICAgICAgICB2YXIgbWluID0gY3JlYXRlRXh0cmVtdW0obHQsIFBPU0lUSVZFX0lORklOSVRZKTsKICAgICAgICBmdW5jdGlvbiBzdW0oY29sbGVjdGlvbiwgaXRlcmF0ZWUsIHRoaXNBcmcpIHsKICAgICAgICAgIGlmICh0aGlzQXJnICYmIGlzSXRlcmF0ZWVDYWxsKGNvbGxlY3Rpb24sIGl0ZXJhdGVlLCB0aGlzQXJnKSkgewogICAgICAgICAgICBpdGVyYXRlZSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBnZXRDYWxsYmFjaygpLAogICAgICAgICAgICAgIG5vSXRlcmF0ZWUgPSBpdGVyYXRlZSA9PSBudWxsOwogICAgICAgICAgaWYgKCEobm9JdGVyYXRlZSAmJiBjYWxsYmFjayA9PT0gYmFzZUNhbGxiYWNrKSkgewogICAgICAgICAgICBub0l0ZXJhdGVlID0gZmFsc2U7CiAgICAgICAgICAgIGl0ZXJhdGVlID0gY2FsbGJhY2soaXRlcmF0ZWUsIHRoaXNBcmcsIDMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5vSXRlcmF0ZWUgPyBhcnJheVN1bShpc0FycmF5KGNvbGxlY3Rpb24pID8gY29sbGVjdGlvbiA6IHRvSXRlcmFibGUoY29sbGVjdGlvbikpIDogYmFzZVN1bShjb2xsZWN0aW9uLCBpdGVyYXRlZSk7CiAgICAgICAgfQogICAgICAgIGxvZGFzaC5wcm90b3R5cGUgPSBiYXNlTG9kYXNoLnByb3RvdHlwZTsKICAgICAgICBMb2Rhc2hXcmFwcGVyLnByb3RvdHlwZSA9IGJhc2VDcmVhdGUoYmFzZUxvZGFzaC5wcm90b3R5cGUpOwogICAgICAgIExvZGFzaFdyYXBwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTG9kYXNoV3JhcHBlcjsKICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUgPSBiYXNlQ3JlYXRlKGJhc2VMb2Rhc2gucHJvdG90eXBlKTsKICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMYXp5V3JhcHBlcjsKICAgICAgICBNYXBDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbWFwRGVsZXRlOwogICAgICAgIE1hcENhY2hlLnByb3RvdHlwZS5nZXQgPSBtYXBHZXQ7CiAgICAgICAgTWFwQ2FjaGUucHJvdG90eXBlLmhhcyA9IG1hcEhhczsKICAgICAgICBNYXBDYWNoZS5wcm90b3R5cGUuc2V0ID0gbWFwU2V0OwogICAgICAgIFNldENhY2hlLnByb3RvdHlwZS5wdXNoID0gY2FjaGVQdXNoOwogICAgICAgIG1lbW9pemUuQ2FjaGUgPSBNYXBDYWNoZTsKICAgICAgICBsb2Rhc2guYWZ0ZXIgPSBhZnRlcjsKICAgICAgICBsb2Rhc2guYXJ5ID0gYXJ5OwogICAgICAgIGxvZGFzaC5hc3NpZ24gPSBhc3NpZ247CiAgICAgICAgbG9kYXNoLmF0ID0gYXQ7CiAgICAgICAgbG9kYXNoLmJlZm9yZSA9IGJlZm9yZTsKICAgICAgICBsb2Rhc2guYmluZCA9IGJpbmQ7CiAgICAgICAgbG9kYXNoLmJpbmRBbGwgPSBiaW5kQWxsOwogICAgICAgIGxvZGFzaC5iaW5kS2V5ID0gYmluZEtleTsKICAgICAgICBsb2Rhc2guY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICBsb2Rhc2guY2hhaW4gPSBjaGFpbjsKICAgICAgICBsb2Rhc2guY2h1bmsgPSBjaHVuazsKICAgICAgICBsb2Rhc2guY29tcGFjdCA9IGNvbXBhY3Q7CiAgICAgICAgbG9kYXNoLmNvbnN0YW50ID0gY29uc3RhbnQ7CiAgICAgICAgbG9kYXNoLmNvdW50QnkgPSBjb3VudEJ5OwogICAgICAgIGxvZGFzaC5jcmVhdGUgPSBjcmVhdGU7CiAgICAgICAgbG9kYXNoLmN1cnJ5ID0gY3Vycnk7CiAgICAgICAgbG9kYXNoLmN1cnJ5UmlnaHQgPSBjdXJyeVJpZ2h0OwogICAgICAgIGxvZGFzaC5kZWJvdW5jZSA9IGRlYm91bmNlOwogICAgICAgIGxvZGFzaC5kZWZhdWx0cyA9IGRlZmF1bHRzOwogICAgICAgIGxvZGFzaC5kZWZlciA9IGRlZmVyOwogICAgICAgIGxvZGFzaC5kZWxheSA9IGRlbGF5OwogICAgICAgIGxvZGFzaC5kaWZmZXJlbmNlID0gZGlmZmVyZW5jZTsKICAgICAgICBsb2Rhc2guZHJvcCA9IGRyb3A7CiAgICAgICAgbG9kYXNoLmRyb3BSaWdodCA9IGRyb3BSaWdodDsKICAgICAgICBsb2Rhc2guZHJvcFJpZ2h0V2hpbGUgPSBkcm9wUmlnaHRXaGlsZTsKICAgICAgICBsb2Rhc2guZHJvcFdoaWxlID0gZHJvcFdoaWxlOwogICAgICAgIGxvZGFzaC5maWxsID0gZmlsbDsKICAgICAgICBsb2Rhc2guZmlsdGVyID0gZmlsdGVyOwogICAgICAgIGxvZGFzaC5mbGF0dGVuID0gZmxhdHRlbjsKICAgICAgICBsb2Rhc2guZmxhdHRlbkRlZXAgPSBmbGF0dGVuRGVlcDsKICAgICAgICBsb2Rhc2guZmxvdyA9IGZsb3c7CiAgICAgICAgbG9kYXNoLmZsb3dSaWdodCA9IGZsb3dSaWdodDsKICAgICAgICBsb2Rhc2guZm9yRWFjaCA9IGZvckVhY2g7CiAgICAgICAgbG9kYXNoLmZvckVhY2hSaWdodCA9IGZvckVhY2hSaWdodDsKICAgICAgICBsb2Rhc2guZm9ySW4gPSBmb3JJbjsKICAgICAgICBsb2Rhc2guZm9ySW5SaWdodCA9IGZvckluUmlnaHQ7CiAgICAgICAgbG9kYXNoLmZvck93biA9IGZvck93bjsKICAgICAgICBsb2Rhc2guZm9yT3duUmlnaHQgPSBmb3JPd25SaWdodDsKICAgICAgICBsb2Rhc2guZnVuY3Rpb25zID0gZnVuY3Rpb25zOwogICAgICAgIGxvZGFzaC5ncm91cEJ5ID0gZ3JvdXBCeTsKICAgICAgICBsb2Rhc2guaW5kZXhCeSA9IGluZGV4Qnk7CiAgICAgICAgbG9kYXNoLmluaXRpYWwgPSBpbml0aWFsOwogICAgICAgIGxvZGFzaC5pbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247CiAgICAgICAgbG9kYXNoLmludmVydCA9IGludmVydDsKICAgICAgICBsb2Rhc2guaW52b2tlID0gaW52b2tlOwogICAgICAgIGxvZGFzaC5rZXlzID0ga2V5czsKICAgICAgICBsb2Rhc2gua2V5c0luID0ga2V5c0luOwogICAgICAgIGxvZGFzaC5tYXAgPSBtYXA7CiAgICAgICAgbG9kYXNoLm1hcEtleXMgPSBtYXBLZXlzOwogICAgICAgIGxvZGFzaC5tYXBWYWx1ZXMgPSBtYXBWYWx1ZXM7CiAgICAgICAgbG9kYXNoLm1hdGNoZXMgPSBtYXRjaGVzOwogICAgICAgIGxvZGFzaC5tYXRjaGVzUHJvcGVydHkgPSBtYXRjaGVzUHJvcGVydHk7CiAgICAgICAgbG9kYXNoLm1lbW9pemUgPSBtZW1vaXplOwogICAgICAgIGxvZGFzaC5tZXJnZSA9IG1lcmdlOwogICAgICAgIGxvZGFzaC5tZXRob2QgPSBtZXRob2Q7CiAgICAgICAgbG9kYXNoLm1ldGhvZE9mID0gbWV0aG9kT2Y7CiAgICAgICAgbG9kYXNoLm1peGluID0gbWl4aW47CiAgICAgICAgbG9kYXNoLm5lZ2F0ZSA9IG5lZ2F0ZTsKICAgICAgICBsb2Rhc2gub21pdCA9IG9taXQ7CiAgICAgICAgbG9kYXNoLm9uY2UgPSBvbmNlOwogICAgICAgIGxvZGFzaC5wYWlycyA9IHBhaXJzOwogICAgICAgIGxvZGFzaC5wYXJ0aWFsID0gcGFydGlhbDsKICAgICAgICBsb2Rhc2gucGFydGlhbFJpZ2h0ID0gcGFydGlhbFJpZ2h0OwogICAgICAgIGxvZGFzaC5wYXJ0aXRpb24gPSBwYXJ0aXRpb247CiAgICAgICAgbG9kYXNoLnBpY2sgPSBwaWNrOwogICAgICAgIGxvZGFzaC5wbHVjayA9IHBsdWNrOwogICAgICAgIGxvZGFzaC5wcm9wZXJ0eSA9IHByb3BlcnR5OwogICAgICAgIGxvZGFzaC5wcm9wZXJ0eU9mID0gcHJvcGVydHlPZjsKICAgICAgICBsb2Rhc2gucHVsbCA9IHB1bGw7CiAgICAgICAgbG9kYXNoLnB1bGxBdCA9IHB1bGxBdDsKICAgICAgICBsb2Rhc2gucmFuZ2UgPSByYW5nZTsKICAgICAgICBsb2Rhc2gucmVhcmcgPSByZWFyZzsKICAgICAgICBsb2Rhc2gucmVqZWN0ID0gcmVqZWN0OwogICAgICAgIGxvZGFzaC5yZW1vdmUgPSByZW1vdmU7CiAgICAgICAgbG9kYXNoLnJlc3QgPSByZXN0OwogICAgICAgIGxvZGFzaC5yZXN0UGFyYW0gPSByZXN0UGFyYW07CiAgICAgICAgbG9kYXNoLnNldCA9IHNldDsKICAgICAgICBsb2Rhc2guc2h1ZmZsZSA9IHNodWZmbGU7CiAgICAgICAgbG9kYXNoLnNsaWNlID0gc2xpY2U7CiAgICAgICAgbG9kYXNoLnNvcnRCeSA9IHNvcnRCeTsKICAgICAgICBsb2Rhc2guc29ydEJ5QWxsID0gc29ydEJ5QWxsOwogICAgICAgIGxvZGFzaC5zb3J0QnlPcmRlciA9IHNvcnRCeU9yZGVyOwogICAgICAgIGxvZGFzaC5zcHJlYWQgPSBzcHJlYWQ7CiAgICAgICAgbG9kYXNoLnRha2UgPSB0YWtlOwogICAgICAgIGxvZGFzaC50YWtlUmlnaHQgPSB0YWtlUmlnaHQ7CiAgICAgICAgbG9kYXNoLnRha2VSaWdodFdoaWxlID0gdGFrZVJpZ2h0V2hpbGU7CiAgICAgICAgbG9kYXNoLnRha2VXaGlsZSA9IHRha2VXaGlsZTsKICAgICAgICBsb2Rhc2gudGFwID0gdGFwOwogICAgICAgIGxvZGFzaC50aHJvdHRsZSA9IHRocm90dGxlOwogICAgICAgIGxvZGFzaC50aHJ1ID0gdGhydTsKICAgICAgICBsb2Rhc2gudGltZXMgPSB0aW1lczsKICAgICAgICBsb2Rhc2gudG9BcnJheSA9IHRvQXJyYXk7CiAgICAgICAgbG9kYXNoLnRvUGxhaW5PYmplY3QgPSB0b1BsYWluT2JqZWN0OwogICAgICAgIGxvZGFzaC50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07CiAgICAgICAgbG9kYXNoLnVuaW9uID0gdW5pb247CiAgICAgICAgbG9kYXNoLnVuaXEgPSB1bmlxOwogICAgICAgIGxvZGFzaC51bnppcCA9IHVuemlwOwogICAgICAgIGxvZGFzaC51bnppcFdpdGggPSB1bnppcFdpdGg7CiAgICAgICAgbG9kYXNoLnZhbHVlcyA9IHZhbHVlczsKICAgICAgICBsb2Rhc2gudmFsdWVzSW4gPSB2YWx1ZXNJbjsKICAgICAgICBsb2Rhc2gud2hlcmUgPSB3aGVyZTsKICAgICAgICBsb2Rhc2gud2l0aG91dCA9IHdpdGhvdXQ7CiAgICAgICAgbG9kYXNoLndyYXAgPSB3cmFwOwogICAgICAgIGxvZGFzaC54b3IgPSB4b3I7CiAgICAgICAgbG9kYXNoLnppcCA9IHppcDsKICAgICAgICBsb2Rhc2guemlwT2JqZWN0ID0gemlwT2JqZWN0OwogICAgICAgIGxvZGFzaC56aXBXaXRoID0gemlwV2l0aDsKICAgICAgICBsb2Rhc2guYmFja2Zsb3cgPSBmbG93UmlnaHQ7CiAgICAgICAgbG9kYXNoLmNvbGxlY3QgPSBtYXA7CiAgICAgICAgbG9kYXNoLmNvbXBvc2UgPSBmbG93UmlnaHQ7CiAgICAgICAgbG9kYXNoLmVhY2ggPSBmb3JFYWNoOwogICAgICAgIGxvZGFzaC5lYWNoUmlnaHQgPSBmb3JFYWNoUmlnaHQ7CiAgICAgICAgbG9kYXNoLmV4dGVuZCA9IGFzc2lnbjsKICAgICAgICBsb2Rhc2guaXRlcmF0ZWUgPSBjYWxsYmFjazsKICAgICAgICBsb2Rhc2gubWV0aG9kcyA9IGZ1bmN0aW9uczsKICAgICAgICBsb2Rhc2gub2JqZWN0ID0gemlwT2JqZWN0OwogICAgICAgIGxvZGFzaC5zZWxlY3QgPSBmaWx0ZXI7CiAgICAgICAgbG9kYXNoLnRhaWwgPSByZXN0OwogICAgICAgIGxvZGFzaC51bmlxdWUgPSB1bmlxOwogICAgICAgIG1peGluKGxvZGFzaCwgbG9kYXNoKTsKICAgICAgICBsb2Rhc2guYWRkID0gYWRkOwogICAgICAgIGxvZGFzaC5hdHRlbXB0ID0gYXR0ZW1wdDsKICAgICAgICBsb2Rhc2guY2FtZWxDYXNlID0gY2FtZWxDYXNlOwogICAgICAgIGxvZGFzaC5jYXBpdGFsaXplID0gY2FwaXRhbGl6ZTsKICAgICAgICBsb2Rhc2guY2xvbmUgPSBjbG9uZTsKICAgICAgICBsb2Rhc2guY2xvbmVEZWVwID0gY2xvbmVEZWVwOwogICAgICAgIGxvZGFzaC5kZWJ1cnIgPSBkZWJ1cnI7CiAgICAgICAgbG9kYXNoLmVuZHNXaXRoID0gZW5kc1dpdGg7CiAgICAgICAgbG9kYXNoLmVzY2FwZSA9IGVzY2FwZTsKICAgICAgICBsb2Rhc2guZXNjYXBlUmVnRXhwID0gZXNjYXBlUmVnRXhwOwogICAgICAgIGxvZGFzaC5ldmVyeSA9IGV2ZXJ5OwogICAgICAgIGxvZGFzaC5maW5kID0gZmluZDsKICAgICAgICBsb2Rhc2guZmluZEluZGV4ID0gZmluZEluZGV4OwogICAgICAgIGxvZGFzaC5maW5kS2V5ID0gZmluZEtleTsKICAgICAgICBsb2Rhc2guZmluZExhc3QgPSBmaW5kTGFzdDsKICAgICAgICBsb2Rhc2guZmluZExhc3RJbmRleCA9IGZpbmRMYXN0SW5kZXg7CiAgICAgICAgbG9kYXNoLmZpbmRMYXN0S2V5ID0gZmluZExhc3RLZXk7CiAgICAgICAgbG9kYXNoLmZpbmRXaGVyZSA9IGZpbmRXaGVyZTsKICAgICAgICBsb2Rhc2guZmlyc3QgPSBmaXJzdDsKICAgICAgICBsb2Rhc2guZ2V0ID0gZ2V0OwogICAgICAgIGxvZGFzaC5ndCA9IGd0OwogICAgICAgIGxvZGFzaC5ndGUgPSBndGU7CiAgICAgICAgbG9kYXNoLmhhcyA9IGhhczsKICAgICAgICBsb2Rhc2guaWRlbnRpdHkgPSBpZGVudGl0eTsKICAgICAgICBsb2Rhc2guaW5jbHVkZXMgPSBpbmNsdWRlczsKICAgICAgICBsb2Rhc2guaW5kZXhPZiA9IGluZGV4T2Y7CiAgICAgICAgbG9kYXNoLmluUmFuZ2UgPSBpblJhbmdlOwogICAgICAgIGxvZGFzaC5pc0FyZ3VtZW50cyA9IGlzQXJndW1lbnRzOwogICAgICAgIGxvZGFzaC5pc0FycmF5ID0gaXNBcnJheTsKICAgICAgICBsb2Rhc2guaXNCb29sZWFuID0gaXNCb29sZWFuOwogICAgICAgIGxvZGFzaC5pc0RhdGUgPSBpc0RhdGU7CiAgICAgICAgbG9kYXNoLmlzRWxlbWVudCA9IGlzRWxlbWVudDsKICAgICAgICBsb2Rhc2guaXNFbXB0eSA9IGlzRW1wdHk7CiAgICAgICAgbG9kYXNoLmlzRXF1YWwgPSBpc0VxdWFsOwogICAgICAgIGxvZGFzaC5pc0Vycm9yID0gaXNFcnJvcjsKICAgICAgICBsb2Rhc2guaXNGaW5pdGUgPSBpc0Zpbml0ZTsKICAgICAgICBsb2Rhc2guaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247CiAgICAgICAgbG9kYXNoLmlzTWF0Y2ggPSBpc01hdGNoOwogICAgICAgIGxvZGFzaC5pc05hTiA9IGlzTmFOOwogICAgICAgIGxvZGFzaC5pc05hdGl2ZSA9IGlzTmF0aXZlOwogICAgICAgIGxvZGFzaC5pc051bGwgPSBpc051bGw7CiAgICAgICAgbG9kYXNoLmlzTnVtYmVyID0gaXNOdW1iZXI7CiAgICAgICAgbG9kYXNoLmlzT2JqZWN0ID0gaXNPYmplY3Q7CiAgICAgICAgbG9kYXNoLmlzUGxhaW5PYmplY3QgPSBpc1BsYWluT2JqZWN0OwogICAgICAgIGxvZGFzaC5pc1JlZ0V4cCA9IGlzUmVnRXhwOwogICAgICAgIGxvZGFzaC5pc1N0cmluZyA9IGlzU3RyaW5nOwogICAgICAgIGxvZGFzaC5pc1R5cGVkQXJyYXkgPSBpc1R5cGVkQXJyYXk7CiAgICAgICAgbG9kYXNoLmlzVW5kZWZpbmVkID0gaXNVbmRlZmluZWQ7CiAgICAgICAgbG9kYXNoLmtlYmFiQ2FzZSA9IGtlYmFiQ2FzZTsKICAgICAgICBsb2Rhc2gubGFzdCA9IGxhc3Q7CiAgICAgICAgbG9kYXNoLmxhc3RJbmRleE9mID0gbGFzdEluZGV4T2Y7CiAgICAgICAgbG9kYXNoLmx0ID0gbHQ7CiAgICAgICAgbG9kYXNoLmx0ZSA9IGx0ZTsKICAgICAgICBsb2Rhc2gubWF4ID0gbWF4OwogICAgICAgIGxvZGFzaC5taW4gPSBtaW47CiAgICAgICAgbG9kYXNoLm5vQ29uZmxpY3QgPSBub0NvbmZsaWN0OwogICAgICAgIGxvZGFzaC5ub29wID0gbm9vcDsKICAgICAgICBsb2Rhc2gubm93ID0gbm93OwogICAgICAgIGxvZGFzaC5wYWQgPSBwYWQ7CiAgICAgICAgbG9kYXNoLnBhZExlZnQgPSBwYWRMZWZ0OwogICAgICAgIGxvZGFzaC5wYWRSaWdodCA9IHBhZFJpZ2h0OwogICAgICAgIGxvZGFzaC5wYXJzZUludCA9IHBhcnNlSW50OwogICAgICAgIGxvZGFzaC5yYW5kb20gPSByYW5kb207CiAgICAgICAgbG9kYXNoLnJlZHVjZSA9IHJlZHVjZTsKICAgICAgICBsb2Rhc2gucmVkdWNlUmlnaHQgPSByZWR1Y2VSaWdodDsKICAgICAgICBsb2Rhc2gucmVwZWF0ID0gcmVwZWF0OwogICAgICAgIGxvZGFzaC5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgbG9kYXNoLnJ1bkluQ29udGV4dCA9IHJ1bkluQ29udGV4dDsKICAgICAgICBsb2Rhc2guc2l6ZSA9IHNpemU7CiAgICAgICAgbG9kYXNoLnNuYWtlQ2FzZSA9IHNuYWtlQ2FzZTsKICAgICAgICBsb2Rhc2guc29tZSA9IHNvbWU7CiAgICAgICAgbG9kYXNoLnNvcnRlZEluZGV4ID0gc29ydGVkSW5kZXg7CiAgICAgICAgbG9kYXNoLnNvcnRlZExhc3RJbmRleCA9IHNvcnRlZExhc3RJbmRleDsKICAgICAgICBsb2Rhc2guc3RhcnRDYXNlID0gc3RhcnRDYXNlOwogICAgICAgIGxvZGFzaC5zdGFydHNXaXRoID0gc3RhcnRzV2l0aDsKICAgICAgICBsb2Rhc2guc3VtID0gc3VtOwogICAgICAgIGxvZGFzaC50ZW1wbGF0ZSA9IHRlbXBsYXRlOwogICAgICAgIGxvZGFzaC50cmltID0gdHJpbTsKICAgICAgICBsb2Rhc2gudHJpbUxlZnQgPSB0cmltTGVmdDsKICAgICAgICBsb2Rhc2gudHJpbVJpZ2h0ID0gdHJpbVJpZ2h0OwogICAgICAgIGxvZGFzaC50cnVuYyA9IHRydW5jOwogICAgICAgIGxvZGFzaC51bmVzY2FwZSA9IHVuZXNjYXBlOwogICAgICAgIGxvZGFzaC51bmlxdWVJZCA9IHVuaXF1ZUlkOwogICAgICAgIGxvZGFzaC53b3JkcyA9IHdvcmRzOwogICAgICAgIGxvZGFzaC5hbGwgPSBldmVyeTsKICAgICAgICBsb2Rhc2guYW55ID0gc29tZTsKICAgICAgICBsb2Rhc2guY29udGFpbnMgPSBpbmNsdWRlczsKICAgICAgICBsb2Rhc2guZXEgPSBpc0VxdWFsOwogICAgICAgIGxvZGFzaC5kZXRlY3QgPSBmaW5kOwogICAgICAgIGxvZGFzaC5mb2xkbCA9IHJlZHVjZTsKICAgICAgICBsb2Rhc2guZm9sZHIgPSByZWR1Y2VSaWdodDsKICAgICAgICBsb2Rhc2guaGVhZCA9IGZpcnN0OwogICAgICAgIGxvZGFzaC5pbmNsdWRlID0gaW5jbHVkZXM7CiAgICAgICAgbG9kYXNoLmluamVjdCA9IHJlZHVjZTsKICAgICAgICBtaXhpbihsb2Rhc2gsIChmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBzb3VyY2UgPSB7fTsKICAgICAgICAgIGJhc2VGb3JPd24obG9kYXNoLCBmdW5jdGlvbihmdW5jLCBtZXRob2ROYW1lKSB7CiAgICAgICAgICAgIGlmICghbG9kYXNoLnByb3RvdHlwZVttZXRob2ROYW1lXSkgewogICAgICAgICAgICAgIHNvdXJjZVttZXRob2ROYW1lXSA9IGZ1bmM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHNvdXJjZTsKICAgICAgICB9KCkpLCBmYWxzZSk7CiAgICAgICAgbG9kYXNoLnNhbXBsZSA9IHNhbXBsZTsKICAgICAgICBsb2Rhc2gucHJvdG90eXBlLnNhbXBsZSA9IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgIGlmICghdGhpcy5fX2NoYWluX18gJiYgbiA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBzYW1wbGUodGhpcy52YWx1ZSgpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzLnRocnUoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHNhbXBsZSh2YWx1ZSwgbik7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIGxvZGFzaC5WRVJTSU9OID0gVkVSU0lPTjsKICAgICAgICBhcnJheUVhY2goWydiaW5kJywgJ2JpbmRLZXknLCAnY3VycnknLCAnY3VycnlSaWdodCcsICdwYXJ0aWFsJywgJ3BhcnRpYWxSaWdodCddLCBmdW5jdGlvbihtZXRob2ROYW1lKSB7CiAgICAgICAgICBsb2Rhc2hbbWV0aG9kTmFtZV0ucGxhY2Vob2xkZXIgPSBsb2Rhc2g7CiAgICAgICAgfSk7CiAgICAgICAgYXJyYXlFYWNoKFsnZHJvcFdoaWxlJywgJ2ZpbHRlcicsICdtYXAnLCAndGFrZVdoaWxlJ10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUsIHR5cGUpIHsKICAgICAgICAgIHZhciBpc0ZpbHRlciA9IHR5cGUgIT0gTEFaWV9NQVBfRkxBRywKICAgICAgICAgICAgICBpc0Ryb3BXaGlsZSA9IHR5cGUgPT0gTEFaWV9EUk9QX1dISUxFX0ZMQUc7CiAgICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbihpdGVyYXRlZSwgdGhpc0FyZykgewogICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSB0aGlzLl9fZmlsdGVyZWRfXywKICAgICAgICAgICAgICAgIHJlc3VsdCA9IChmaWx0ZXJlZCAmJiBpc0Ryb3BXaGlsZSkgPyBuZXcgTGF6eVdyYXBwZXIodGhpcykgOiB0aGlzLmNsb25lKCksCiAgICAgICAgICAgICAgICBpdGVyYXRlZXMgPSByZXN1bHQuX19pdGVyYXRlZXNfXyB8fCAocmVzdWx0Ll9faXRlcmF0ZWVzX18gPSBbXSk7CiAgICAgICAgICAgIGl0ZXJhdGVlcy5wdXNoKHsKICAgICAgICAgICAgICAnZG9uZSc6IGZhbHNlLAogICAgICAgICAgICAgICdjb3VudCc6IDAsCiAgICAgICAgICAgICAgJ2luZGV4JzogMCwKICAgICAgICAgICAgICAnaXRlcmF0ZWUnOiBnZXRDYWxsYmFjayhpdGVyYXRlZSwgdGhpc0FyZywgMSksCiAgICAgICAgICAgICAgJ2xpbWl0JzogLTEsCiAgICAgICAgICAgICAgJ3R5cGUnOiB0eXBlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXN1bHQuX19maWx0ZXJlZF9fID0gZmlsdGVyZWQgfHwgaXNGaWx0ZXI7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGFycmF5RWFjaChbJ2Ryb3AnLCAndGFrZSddLCBmdW5jdGlvbihtZXRob2ROYW1lLCBpbmRleCkgewogICAgICAgICAgdmFyIHdoaWxlTmFtZSA9IG1ldGhvZE5hbWUgKyAnV2hpbGUnOwogICAgICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24obikgewogICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSB0aGlzLl9fZmlsdGVyZWRfXywKICAgICAgICAgICAgICAgIHJlc3VsdCA9IChmaWx0ZXJlZCAmJiAhaW5kZXgpID8gdGhpcy5kcm9wV2hpbGUoKSA6IHRoaXMuY2xvbmUoKTsKICAgICAgICAgICAgbiA9IG4gPT0gbnVsbCA/IDEgOiBuYXRpdmVNYXgoZmxvb3IobikgfHwgMCwgMCk7CiAgICAgICAgICAgIGlmIChmaWx0ZXJlZCkgewogICAgICAgICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgICAgICAgcmVzdWx0Ll9fdGFrZUNvdW50X18gPSBuYXRpdmVNaW4ocmVzdWx0Ll9fdGFrZUNvdW50X18sIG4pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsYXN0KHJlc3VsdC5fX2l0ZXJhdGVlc19fKS5saW1pdCA9IG47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciB2aWV3cyA9IHJlc3VsdC5fX3ZpZXdzX18gfHwgKHJlc3VsdC5fX3ZpZXdzX18gPSBbXSk7CiAgICAgICAgICAgICAgdmlld3MucHVzaCh7CiAgICAgICAgICAgICAgICAnc2l6ZSc6IG4sCiAgICAgICAgICAgICAgICAndHlwZSc6IG1ldGhvZE5hbWUgKyAocmVzdWx0Ll9fZGlyX18gPCAwID8gJ1JpZ2h0JyA6ICcnKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9OwogICAgICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlW21ldGhvZE5hbWUgKyAnUmlnaHQnXSA9IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmV2ZXJzZSgpW21ldGhvZE5hbWVdKG4pLnJldmVyc2UoKTsKICAgICAgICAgIH07CiAgICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZSArICdSaWdodFdoaWxlJ10gPSBmdW5jdGlvbihwcmVkaWNhdGUsIHRoaXNBcmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmV2ZXJzZSgpW3doaWxlTmFtZV0ocHJlZGljYXRlLCB0aGlzQXJnKS5yZXZlcnNlKCk7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGFycmF5RWFjaChbJ2ZpcnN0JywgJ2xhc3QnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSwgaW5kZXgpIHsKICAgICAgICAgIHZhciB0YWtlTmFtZSA9ICd0YWtlJyArIChpbmRleCA/ICdSaWdodCcgOiAnJyk7CiAgICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXNbdGFrZU5hbWVdKDEpLnZhbHVlKClbMF07CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGFycmF5RWFjaChbJ2luaXRpYWwnLCAncmVzdCddLCBmdW5jdGlvbihtZXRob2ROYW1lLCBpbmRleCkgewogICAgICAgICAgdmFyIGRyb3BOYW1lID0gJ2Ryb3AnICsgKGluZGV4ID8gJycgOiAnUmlnaHQnKTsKICAgICAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpc1tkcm9wTmFtZV0oMSk7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGFycmF5RWFjaChbJ3BsdWNrJywgJ3doZXJlJ10sIGZ1bmN0aW9uKG1ldGhvZE5hbWUsIGluZGV4KSB7CiAgICAgICAgICB2YXIgb3BlcmF0aW9uTmFtZSA9IGluZGV4ID8gJ2ZpbHRlcicgOiAnbWFwJywKICAgICAgICAgICAgICBjcmVhdGVDYWxsYmFjayA9IGluZGV4ID8gYmFzZU1hdGNoZXMgOiBwcm9wZXJ0eTsKICAgICAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzW29wZXJhdGlvbk5hbWVdKGNyZWF0ZUNhbGxiYWNrKHZhbHVlKSk7CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5jb21wYWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoaWRlbnRpdHkpOwogICAgICAgIH07CiAgICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uKHByZWRpY2F0ZSwgdGhpc0FyZykgewogICAgICAgICAgcHJlZGljYXRlID0gZ2V0Q2FsbGJhY2socHJlZGljYXRlLCB0aGlzQXJnLCAxKTsKICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gIXByZWRpY2F0ZSh2YWx1ZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS5zbGljZSA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHsKICAgICAgICAgIHN0YXJ0ID0gc3RhcnQgPT0gbnVsbCA/IDAgOiAoK3N0YXJ0IHx8IDApOwogICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXM7CiAgICAgICAgICBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMudGFrZVJpZ2h0KC1zdGFydCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0KSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZHJvcChzdGFydCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZW5kICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZW5kID0gKCtlbmQgfHwgMCk7CiAgICAgICAgICAgIHJlc3VsdCA9IGVuZCA8IDAgPyByZXN1bHQuZHJvcFJpZ2h0KC1lbmQpIDogcmVzdWx0LnRha2UoZW5kIC0gc3RhcnQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgICAgIExhenlXcmFwcGVyLnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5kcm9wKDApOwogICAgICAgIH07CiAgICAgICAgYmFzZUZvck93bihMYXp5V3JhcHBlci5wcm90b3R5cGUsIGZ1bmN0aW9uKGZ1bmMsIG1ldGhvZE5hbWUpIHsKICAgICAgICAgIHZhciBsb2Rhc2hGdW5jID0gbG9kYXNoW21ldGhvZE5hbWVdOwogICAgICAgICAgaWYgKCFsb2Rhc2hGdW5jKSB7CiAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2hlY2tJdGVyYXRlZSA9IC9eKD86ZmlsdGVyfG1hcHxyZWplY3QpfFdoaWxlJC8udGVzdChtZXRob2ROYW1lKSwKICAgICAgICAgICAgICByZXRVbndyYXBwZWQgPSAvXig/OmZpcnN0fGxhc3QpJC8udGVzdChtZXRob2ROYW1lKTsKICAgICAgICAgIGxvZGFzaC5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMsCiAgICAgICAgICAgICAgICBjaGFpbkFsbCA9IHRoaXMuX19jaGFpbl9fLAogICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9fd3JhcHBlZF9fLAogICAgICAgICAgICAgICAgaXNIeWJyaWQgPSAhIXRoaXMuX19hY3Rpb25zX18ubGVuZ3RoLAogICAgICAgICAgICAgICAgaXNMYXp5ID0gdmFsdWUgaW5zdGFuY2VvZiBMYXp5V3JhcHBlciwKICAgICAgICAgICAgICAgIGl0ZXJhdGVlID0gYXJnc1swXSwKICAgICAgICAgICAgICAgIHVzZUxhenkgPSBpc0xhenkgfHwgaXNBcnJheSh2YWx1ZSk7CiAgICAgICAgICAgIGlmICh1c2VMYXp5ICYmIGNoZWNrSXRlcmF0ZWUgJiYgdHlwZW9mIGl0ZXJhdGVlID09ICdmdW5jdGlvbicgJiYgaXRlcmF0ZWUubGVuZ3RoICE9IDEpIHsKICAgICAgICAgICAgICBpc0xhenkgPSB1c2VMYXp5ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG9ubHlMYXp5ID0gaXNMYXp5ICYmICFpc0h5YnJpZDsKICAgICAgICAgICAgaWYgKHJldFVud3JhcHBlZCAmJiAhY2hhaW5BbGwpIHsKICAgICAgICAgICAgICByZXR1cm4gb25seUxhenkgPyBmdW5jLmNhbGwodmFsdWUpIDogbG9kYXNoRnVuYy5jYWxsKGxvZGFzaCwgdGhpcy52YWx1ZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaW50ZXJjZXB0b3IgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgIHZhciBvdGhlckFyZ3MgPSBbdmFsdWVdOwogICAgICAgICAgICAgIHB1c2guYXBwbHkob3RoZXJBcmdzLCBhcmdzKTsKICAgICAgICAgICAgICByZXR1cm4gbG9kYXNoRnVuYy5hcHBseShsb2Rhc2gsIG90aGVyQXJncyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICh1c2VMYXp5KSB7CiAgICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSBvbmx5TGF6eSA/IHZhbHVlIDogbmV3IExhenlXcmFwcGVyKHRoaXMpLAogICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHdyYXBwZXIsIGFyZ3MpOwogICAgICAgICAgICAgIGlmICghcmV0VW53cmFwcGVkICYmIChpc0h5YnJpZCB8fCByZXN1bHQuX19hY3Rpb25zX18pKSB7CiAgICAgICAgICAgICAgICB2YXIgYWN0aW9ucyA9IHJlc3VsdC5fX2FjdGlvbnNfXyB8fCAocmVzdWx0Ll9fYWN0aW9uc19fID0gW10pOwogICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKHsKICAgICAgICAgICAgICAgICAgJ2Z1bmMnOiB0aHJ1LAogICAgICAgICAgICAgICAgICAnYXJncyc6IFtpbnRlcmNlcHRvcl0sCiAgICAgICAgICAgICAgICAgICd0aGlzQXJnJzogbG9kYXNoCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMb2Rhc2hXcmFwcGVyKHJlc3VsdCwgY2hhaW5BbGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRocnUoaW50ZXJjZXB0b3IpOwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBhcnJheUVhY2goWydjb25jYXQnLCAnam9pbicsICdwb3AnLCAncHVzaCcsICdyZXBsYWNlJywgJ3NoaWZ0JywgJ3NvcnQnLCAnc3BsaWNlJywgJ3NwbGl0JywgJ3Vuc2hpZnQnXSwgZnVuY3Rpb24obWV0aG9kTmFtZSkgewogICAgICAgICAgdmFyIGZ1bmMgPSAoL14oPzpyZXBsYWNlfHNwbGl0KSQvLnRlc3QobWV0aG9kTmFtZSkgPyBzdHJpbmdQcm90byA6IGFycmF5UHJvdG8pW21ldGhvZE5hbWVdLAogICAgICAgICAgICAgIGNoYWluTmFtZSA9IC9eKD86cHVzaHxzb3J0fHVuc2hpZnQpJC8udGVzdChtZXRob2ROYW1lKSA/ICd0YXAnIDogJ3RocnUnLAogICAgICAgICAgICAgIHJldFVud3JhcHBlZCA9IC9eKD86am9pbnxwb3B8cmVwbGFjZXxzaGlmdCkkLy50ZXN0KG1ldGhvZE5hbWUpOwogICAgICAgICAgbG9kYXNoLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgaWYgKHJldFVud3JhcHBlZCAmJiAhdGhpcy5fX2NoYWluX18pIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLnZhbHVlKCksIGFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzW2NoYWluTmFtZV0oZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh2YWx1ZSwgYXJncyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBiYXNlRm9yT3duKExhenlXcmFwcGVyLnByb3RvdHlwZSwgZnVuY3Rpb24oZnVuYywgbWV0aG9kTmFtZSkgewogICAgICAgICAgdmFyIGxvZGFzaEZ1bmMgPSBsb2Rhc2hbbWV0aG9kTmFtZV07CiAgICAgICAgICBpZiAobG9kYXNoRnVuYykgewogICAgICAgICAgICB2YXIga2V5ID0gbG9kYXNoRnVuYy5uYW1lLAogICAgICAgICAgICAgICAgbmFtZXMgPSByZWFsTmFtZXNba2V5XSB8fCAocmVhbE5hbWVzW2tleV0gPSBbXSk7CiAgICAgICAgICAgIG5hbWVzLnB1c2goewogICAgICAgICAgICAgICduYW1lJzogbWV0aG9kTmFtZSwKICAgICAgICAgICAgICAnZnVuYyc6IGxvZGFzaEZ1bmMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmVhbE5hbWVzW2NyZWF0ZUh5YnJpZFdyYXBwZXIobnVsbCwgQklORF9LRVlfRkxBRykubmFtZV0gPSBbewogICAgICAgICAgJ25hbWUnOiAnd3JhcHBlcicsCiAgICAgICAgICAnZnVuYyc6IG51bGwKICAgICAgICB9XTsKICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUuY2xvbmUgPSBsYXp5Q2xvbmU7CiAgICAgICAgTGF6eVdyYXBwZXIucHJvdG90eXBlLnJldmVyc2UgPSBsYXp5UmV2ZXJzZTsKICAgICAgICBMYXp5V3JhcHBlci5wcm90b3R5cGUudmFsdWUgPSBsYXp5VmFsdWU7CiAgICAgICAgbG9kYXNoLnByb3RvdHlwZS5jaGFpbiA9IHdyYXBwZXJDaGFpbjsKICAgICAgICBsb2Rhc2gucHJvdG90eXBlLmNvbW1pdCA9IHdyYXBwZXJDb21taXQ7CiAgICAgICAgbG9kYXNoLnByb3RvdHlwZS5wbGFudCA9IHdyYXBwZXJQbGFudDsKICAgICAgICBsb2Rhc2gucHJvdG90eXBlLnJldmVyc2UgPSB3cmFwcGVyUmV2ZXJzZTsKICAgICAgICBsb2Rhc2gucHJvdG90eXBlLnRvU3RyaW5nID0gd3JhcHBlclRvU3RyaW5nOwogICAgICAgIGxvZGFzaC5wcm90b3R5cGUucnVuID0gbG9kYXNoLnByb3RvdHlwZS50b0pTT04gPSBsb2Rhc2gucHJvdG90eXBlLnZhbHVlT2YgPSBsb2Rhc2gucHJvdG90eXBlLnZhbHVlID0gd3JhcHBlclZhbHVlOwogICAgICAgIGxvZGFzaC5wcm90b3R5cGUuY29sbGVjdCA9IGxvZGFzaC5wcm90b3R5cGUubWFwOwogICAgICAgIGxvZGFzaC5wcm90b3R5cGUuaGVhZCA9IGxvZGFzaC5wcm90b3R5cGUuZmlyc3Q7CiAgICAgICAgbG9kYXNoLnByb3RvdHlwZS5zZWxlY3QgPSBsb2Rhc2gucHJvdG90eXBlLmZpbHRlcjsKICAgICAgICBsb2Rhc2gucHJvdG90eXBlLnRhaWwgPSBsb2Rhc2gucHJvdG90eXBlLnJlc3Q7CiAgICAgICAgcmV0dXJuIGxvZGFzaDsKICAgICAgfQogICAgICB2YXIgXyA9IHJ1bkluQ29udGV4dCgpOwogICAgICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBkZWZpbmUuYW1kID09ICdvYmplY3QnICYmIGRlZmluZS5hbWQpIHsKICAgICAgICByb290Ll8gPSBfOwogICAgICAgIGRlZmluZShmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBfOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGZyZWVFeHBvcnRzICYmIGZyZWVNb2R1bGUpIHsKICAgICAgICBpZiAobW9kdWxlRXhwb3J0cykgewogICAgICAgICAgKGZyZWVNb2R1bGUuZXhwb3J0cyA9IF8pLl8gPSBfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmVlRXhwb3J0cy5fID0gXzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcm9vdC5fID0gXzsKICAgICAgfQogICAgfS5jYWxsKHRoaXMpKTsKICB9KShyZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIikpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06ZXZlbnRzQDEuMC4yIiwgWyJucG06ZXZlbnRzQDEuMC4yL2V2ZW50cyJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06ZXZlbnRzQDEuMC4yL2V2ZW50cyIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06aW5oZXJpdHNAMi4wLjEiLCBbIm5wbTppbmhlcml0c0AyLjAuMS9pbmhlcml0c19icm93c2VyIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoIm5wbTppbmhlcml0c0AyLjAuMS9pbmhlcml0c19icm93c2VyIik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTppc2FycmF5QDAuMC4xIiwgWyJucG06aXNhcnJheUAwLjAuMS9pbmRleCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06aXNhcnJheUAwLjAuMS9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06YmFzZTY0LWpzQDAuMC44IiwgWyJucG06YmFzZTY0LWpzQDAuMC44L2xpYi9iNjQiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOmJhc2U2NC1qc0AwLjAuOC9saWIvYjY0Iik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTppZWVlNzU0QDEuMS42IiwgWyJucG06aWVlZTc1NEAxLjEuNi9pbmRleCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06aWVlZTc1NEAxLjEuNi9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06aXMtYXJyYXlAMS4wLjEiLCBbIm5wbTppcy1hcnJheUAxLjAuMS9pbmRleCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06aXMtYXJyYXlAMS4wLjEvaW5kZXgiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmNvcmUtdXRpbC1pc0AxLjAuMSIsIFsibnBtOmNvcmUtdXRpbC1pc0AxLjAuMS9saWIvdXRpbCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06Y29yZS11dGlsLWlzQDEuMC4xL2xpYi91dGlsIik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpwcm9jZXNzQDAuMTAuMSIsIFsibnBtOnByb2Nlc3NAMC4xMC4xL2Jyb3dzZXIiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOnByb2Nlc3NAMC4xMC4xL2Jyb3dzZXIiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnN0cmluZ19kZWNvZGVyQDAuMTAuMzEiLCBbIm5wbTpzdHJpbmdfZGVjb2RlckAwLjEwLjMxL2luZGV4Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoIm5wbTpzdHJpbmdfZGVjb2RlckAwLjEwLjMxL2luZGV4Iik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXN0cmluZ19kZWNvZGVyQDAuMS4wIiwgWyJnaXRodWI6anNwbS9ub2RlbGlicy1zdHJpbmdfZGVjb2RlckAwLjEuMC9pbmRleCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1zdHJpbmdfZGVjb2RlckAwLjEuMC9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL3N0cmluZy9lc2NhcGVSZWdFeHAiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZVRvU3RyaW5nIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYmFzZVRvU3RyaW5nID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlVG9TdHJpbmciKTsKICB2YXIgcmVSZWdFeHBDaGFycyA9IC9bLiorP14ke30oKXxbXF1cL1xcXS9nLAogICAgICByZUhhc1JlZ0V4cENoYXJzID0gUmVnRXhwKHJlUmVnRXhwQ2hhcnMuc291cmNlKTsKICBmdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyaW5nKSB7CiAgICBzdHJpbmcgPSBiYXNlVG9TdHJpbmcoc3RyaW5nKTsKICAgIHJldHVybiAoc3RyaW5nICYmIHJlSGFzUmVnRXhwQ2hhcnMudGVzdChzdHJpbmcpKSA/IHN0cmluZy5yZXBsYWNlKHJlUmVnRXhwQ2hhcnMsICdcXCQmJykgOiBzdHJpbmc7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gZXNjYXBlUmVnRXhwOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2dldExlbmd0aCIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlUHJvcGVydHkiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBiYXNlUHJvcGVydHkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VQcm9wZXJ0eSIpOwogIHZhciBnZXRMZW5ndGggPSBiYXNlUHJvcGVydHkoJ2xlbmd0aCcpOwogIG1vZHVsZS5leHBvcnRzID0gZ2V0TGVuZ3RoOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL3NoaW1LZXlzIiwgWyJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcmd1bWVudHMiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0luZGV4IiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNMZW5ndGgiLCAibnBtOmxvZGFzaEAzLjkuMy9vYmplY3Qva2V5c0luIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgaXNBcmd1bWVudHMgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcmd1bWVudHMiKSwKICAgICAgaXNBcnJheSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FycmF5IiksCiAgICAgIGlzSW5kZXggPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzSW5kZXgiKSwKICAgICAgaXNMZW5ndGggPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzTGVuZ3RoIiksCiAgICAgIGtleXNJbiA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2tleXNJbiIpOwogIHZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CiAgdmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7CiAgZnVuY3Rpb24gc2hpbUtleXMob2JqZWN0KSB7CiAgICB2YXIgcHJvcHMgPSBrZXlzSW4ob2JqZWN0KSwKICAgICAgICBwcm9wc0xlbmd0aCA9IHByb3BzLmxlbmd0aCwKICAgICAgICBsZW5ndGggPSBwcm9wc0xlbmd0aCAmJiBvYmplY3QubGVuZ3RoOwogICAgdmFyIGFsbG93SW5kZXhlcyA9ICEhbGVuZ3RoICYmIGlzTGVuZ3RoKGxlbmd0aCkgJiYgKGlzQXJyYXkob2JqZWN0KSB8fCBpc0FyZ3VtZW50cyhvYmplY3QpKTsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IFtdOwogICAgd2hpbGUgKCsraW5kZXggPCBwcm9wc0xlbmd0aCkgewogICAgICB2YXIga2V5ID0gcHJvcHNbaW5kZXhdOwogICAgICBpZiAoKGFsbG93SW5kZXhlcyAmJiBpc0luZGV4KGtleSwgbGVuZ3RoKSkgfHwgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpIHsKICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IHNoaW1LZXlzOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VBc3NpZ24iLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUNvcHkiLCAibnBtOmxvZGFzaEAzLjkuMy9vYmplY3Qva2V5cyJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJhc2VDb3B5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlQ29weSIpLAogICAgICBrZXlzID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9vYmplY3Qva2V5cyIpOwogIGZ1bmN0aW9uIGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpIHsKICAgIHJldHVybiBzb3VyY2UgPT0gbnVsbCA/IG9iamVjdCA6IGJhc2VDb3B5KHNvdXJjZSwga2V5cyhzb3VyY2UpLCBvYmplY3QpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VBc3NpZ247CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmluZENhbGxiYWNrIiwgWyJucG06bG9kYXNoQDMuOS4zL3V0aWxpdHkvaWRlbnRpdHkiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBpZGVudGl0eSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvdXRpbGl0eS9pZGVudGl0eSIpOwogIGZ1bmN0aW9uIGJpbmRDYWxsYmFjayhmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkgewogICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuIGlkZW50aXR5OwogICAgfQogICAgaWYgKHRoaXNBcmcgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gZnVuYzsKICAgIH0KICAgIHN3aXRjaCAoYXJnQ291bnQpIHsKICAgICAgY2FzZSAxOgogICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbCh0aGlzQXJnLCB2YWx1ZSk7CiAgICAgICAgfTsKICAgICAgY2FzZSAzOgogICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsKICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgICB9OwogICAgICBjYXNlIDQ6CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsKICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7CiAgICAgICAgfTsKICAgICAgY2FzZSA1OgogICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIsIGtleSwgb2JqZWN0LCBzb3VyY2UpIHsKICAgICAgICAgIHJldHVybiBmdW5jLmNhbGwodGhpc0FyZywgdmFsdWUsIG90aGVyLCBrZXksIG9iamVjdCwgc291cmNlKTsKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmd1bWVudHMpOwogICAgfTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiaW5kQ2FsbGJhY2s7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlQXNzaWduIiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUNyZWF0ZSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzSXRlcmF0ZWVDYWxsIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYmFzZUFzc2lnbiA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUFzc2lnbiIpLAogICAgICBiYXNlQ3JlYXRlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlQ3JlYXRlIiksCiAgICAgIGlzSXRlcmF0ZWVDYWxsID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0l0ZXJhdGVlQ2FsbCIpOwogIGZ1bmN0aW9uIGNyZWF0ZShwcm90b3R5cGUsIHByb3BlcnRpZXMsIGd1YXJkKSB7CiAgICB2YXIgcmVzdWx0ID0gYmFzZUNyZWF0ZShwcm90b3R5cGUpOwogICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKHByb3RvdHlwZSwgcHJvcGVydGllcywgZ3VhcmQpKSB7CiAgICAgIHByb3BlcnRpZXMgPSBudWxsOwogICAgfQogICAgcmV0dXJuIHByb3BlcnRpZXMgPyBiYXNlQXNzaWduKHJlc3VsdCwgcHJvcGVydGllcykgOiByZXN1bHQ7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gY3JlYXRlOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNGdW5jdGlvbiIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlSXNGdW5jdGlvbiIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2dldE5hdGl2ZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJhc2VJc0Z1bmN0aW9uID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlSXNGdW5jdGlvbiIpLAogICAgICBnZXROYXRpdmUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2dldE5hdGl2ZSIpOwogIHZhciBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJzsKICB2YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBvYmpUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOwogIHZhciBVaW50OEFycmF5ID0gZ2V0TmF0aXZlKGdsb2JhbCwgJ1VpbnQ4QXJyYXknKTsKICB2YXIgaXNGdW5jdGlvbiA9ICEoYmFzZUlzRnVuY3Rpb24oL3gvKSB8fCAoVWludDhBcnJheSAmJiAhYmFzZUlzRnVuY3Rpb24oVWludDhBcnJheSkpKSA/IGJhc2VJc0Z1bmN0aW9uIDogZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBvYmpUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBmdW5jVGFnOwogIH07CiAgbW9kdWxlLmV4cG9ydHMgPSBpc0Z1bmN0aW9uOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNFbXB0eSIsIFsibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJndW1lbnRzIiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FycmF5IiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNBcnJheUxpa2UiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzRnVuY3Rpb24iLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzU3RyaW5nIiwgIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2tleXMiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBpc0FyZ3VtZW50cyA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FyZ3VtZW50cyIpLAogICAgICBpc0FycmF5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiKSwKICAgICAgaXNBcnJheUxpa2UgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzQXJyYXlMaWtlIiksCiAgICAgIGlzRnVuY3Rpb24gPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNGdW5jdGlvbiIpLAogICAgICBpc09iamVjdExpa2UgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSIpLAogICAgICBpc1N0cmluZyA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc1N0cmluZyIpLAogICAgICBrZXlzID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9vYmplY3Qva2V5cyIpOwogIGZ1bmN0aW9uIGlzRW1wdHkodmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSAmJiAoaXNBcnJheSh2YWx1ZSkgfHwgaXNTdHJpbmcodmFsdWUpIHx8IGlzQXJndW1lbnRzKHZhbHVlKSB8fCAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBpc0Z1bmN0aW9uKHZhbHVlLnNwbGljZSkpKSkgewogICAgICByZXR1cm4gIXZhbHVlLmxlbmd0aDsKICAgIH0KICAgIHJldHVybiAha2V5cyh2YWx1ZSkubGVuZ3RoOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGlzRW1wdHk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZXF1YWxBcnJheXMiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYXJyYXlTb21lIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYXJyYXlTb21lID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9hcnJheVNvbWUiKTsKICBmdW5jdGlvbiBlcXVhbEFycmF5cyhhcnJheSwgb3RoZXIsIGVxdWFsRnVuYywgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGFyckxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICBvdGhMZW5ndGggPSBvdGhlci5sZW5ndGg7CiAgICBpZiAoYXJyTGVuZ3RoICE9IG90aExlbmd0aCAmJiAhKGlzTG9vc2UgJiYgb3RoTGVuZ3RoID4gYXJyTGVuZ3RoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGFyckxlbmd0aCkgewogICAgICB2YXIgYXJyVmFsdWUgPSBhcnJheVtpbmRleF0sCiAgICAgICAgICBvdGhWYWx1ZSA9IG90aGVyW2luZGV4XSwKICAgICAgICAgIHJlc3VsdCA9IGN1c3RvbWl6ZXIgPyBjdXN0b21pemVyKGlzTG9vc2UgPyBvdGhWYWx1ZSA6IGFyclZhbHVlLCBpc0xvb3NlID8gYXJyVmFsdWUgOiBvdGhWYWx1ZSwgaW5kZXgpIDogdW5kZWZpbmVkOwogICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChpc0xvb3NlKSB7CiAgICAgICAgaWYgKCFhcnJheVNvbWUob3RoZXIsIGZ1bmN0aW9uKG90aFZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gYXJyVmFsdWUgPT09IG90aFZhbHVlIHx8IGVxdWFsRnVuYyhhcnJWYWx1ZSwgb3RoVmFsdWUsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKTsKICAgICAgICB9KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghKGFyclZhbHVlID09PSBvdGhWYWx1ZSB8fCBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBjdXN0b21pemVyLCBpc0xvb3NlLCBzdGFja0EsIHN0YWNrQikpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBlcXVhbEFycmF5czsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9nZXRNYXRjaERhdGEiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNTdHJpY3RDb21wYXJhYmxlIiwgIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L3BhaXJzIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgaXNTdHJpY3RDb21wYXJhYmxlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc1N0cmljdENvbXBhcmFibGUiKSwKICAgICAgcGFpcnMgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9wYWlycyIpOwogIGZ1bmN0aW9uIGdldE1hdGNoRGF0YShvYmplY3QpIHsKICAgIHZhciByZXN1bHQgPSBwYWlycyhvYmplY3QpLAogICAgICAgIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGg7CiAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgcmVzdWx0W2xlbmd0aF1bMl0gPSBpc1N0cmljdENvbXBhcmFibGUocmVzdWx0W2xlbmd0aF1bMV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBnZXRNYXRjaERhdGE7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZU1hdGNoZXNQcm9wZXJ0eSIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlR2V0IiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUlzRXF1YWwiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlU2xpY2UiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0tleSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzU3RyaWN0Q29tcGFyYWJsZSIsICJucG06bG9kYXNoQDMuOS4zL2FycmF5L2xhc3QiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL3RvUGF0aCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJhc2VHZXQgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VHZXQiKSwKICAgICAgYmFzZUlzRXF1YWwgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc0VxdWFsIiksCiAgICAgIGJhc2VTbGljZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZVNsaWNlIiksCiAgICAgIGlzQXJyYXkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIpLAogICAgICBpc0tleSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNLZXkiKSwKICAgICAgaXNTdHJpY3RDb21wYXJhYmxlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc1N0cmljdENvbXBhcmFibGUiKSwKICAgICAgbGFzdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvYXJyYXkvbGFzdCIpLAogICAgICB0b09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvdG9PYmplY3QiKSwKICAgICAgdG9QYXRoID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b1BhdGgiKTsKICBmdW5jdGlvbiBiYXNlTWF0Y2hlc1Byb3BlcnR5KHBhdGgsIHNyY1ZhbHVlKSB7CiAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHBhdGgpLAogICAgICAgIGlzQ29tbW9uID0gaXNLZXkocGF0aCkgJiYgaXNTdHJpY3RDb21wYXJhYmxlKHNyY1ZhbHVlKSwKICAgICAgICBwYXRoS2V5ID0gKHBhdGggKyAnJyk7CiAgICBwYXRoID0gdG9QYXRoKHBhdGgpOwogICAgcmV0dXJuIGZ1bmN0aW9uKG9iamVjdCkgewogICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdmFyIGtleSA9IHBhdGhLZXk7CiAgICAgIG9iamVjdCA9IHRvT2JqZWN0KG9iamVjdCk7CiAgICAgIGlmICgoaXNBcnIgfHwgIWlzQ29tbW9uKSAmJiAhKGtleSBpbiBvYmplY3QpKSB7CiAgICAgICAgb2JqZWN0ID0gcGF0aC5sZW5ndGggPT0gMSA/IG9iamVjdCA6IGJhc2VHZXQob2JqZWN0LCBiYXNlU2xpY2UocGF0aCwgMCwgLTEpKTsKICAgICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAga2V5ID0gbGFzdChwYXRoKTsKICAgICAgICBvYmplY3QgPSB0b09iamVjdChvYmplY3QpOwogICAgICB9CiAgICAgIHJldHVybiBvYmplY3Rba2V5XSA9PT0gc3JjVmFsdWUgPyAoc3JjVmFsdWUgIT09IHVuZGVmaW5lZCB8fCAoa2V5IGluIG9iamVjdCkpIDogYmFzZUlzRXF1YWwoc3JjVmFsdWUsIG9iamVjdFtrZXldLCB1bmRlZmluZWQsIHRydWUpOwogICAgfTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlTWF0Y2hlc1Byb3BlcnR5OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL3V0aWxpdHkvcHJvcGVydHkiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZVByb3BlcnR5IiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZVByb3BlcnR5RGVlcCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzS2V5Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYmFzZVByb3BlcnR5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlUHJvcGVydHkiKSwKICAgICAgYmFzZVByb3BlcnR5RGVlcCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZVByb3BlcnR5RGVlcCIpLAogICAgICBpc0tleSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvaXNLZXkiKTsKICBmdW5jdGlvbiBwcm9wZXJ0eShwYXRoKSB7CiAgICByZXR1cm4gaXNLZXkocGF0aCkgPyBiYXNlUHJvcGVydHkocGF0aCkgOiBiYXNlUHJvcGVydHlEZWVwKHBhdGgpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IHByb3BlcnR5OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VGb3IiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvY3JlYXRlQmFzZUZvciJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGNyZWF0ZUJhc2VGb3IgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2NyZWF0ZUJhc2VGb3IiKTsKICB2YXIgYmFzZUZvciA9IGNyZWF0ZUJhc2VGb3IoKTsKICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VGb3I7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEb2NUeXBlIiwgWyJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0IiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxDRGF0YSIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MQ29tbWVudCIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRFREQXR0TGlzdCIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRFRERW50aXR5IiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEVERFbGVtZW50IiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEVEROb3RhdGlvbiIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgWE1MQ0RhdGEsCiAgICAgICAgWE1MQ29tbWVudCwKICAgICAgICBYTUxEVERBdHRMaXN0LAogICAgICAgIFhNTERUREVsZW1lbnQsCiAgICAgICAgWE1MRFRERW50aXR5LAogICAgICAgIFhNTERURE5vdGF0aW9uLAogICAgICAgIFhNTERvY1R5cGUsCiAgICAgICAgWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uLAogICAgICAgIGNyZWF0ZSwKICAgICAgICBpc09iamVjdDsKICAgIGNyZWF0ZSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2NyZWF0ZSIpOwogICAgaXNPYmplY3QgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiKTsKICAgIFhNTENEYXRhID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTENEYXRhIik7CiAgICBYTUxDb21tZW50ID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTENvbW1lbnQiKTsKICAgIFhNTERUREF0dExpc3QgPSByZXF1aXJlKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRFREQXR0TGlzdCIpOwogICAgWE1MRFRERW50aXR5ID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERUREVudGl0eSIpOwogICAgWE1MRFRERWxlbWVudCA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEVERFbGVtZW50Iik7CiAgICBYTUxEVEROb3RhdGlvbiA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEVEROb3RhdGlvbiIpOwogICAgWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTFByb2Nlc3NpbmdJbnN0cnVjdGlvbiIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxEb2NUeXBlID0gKGZ1bmN0aW9uKCkgewogICAgICBmdW5jdGlvbiBYTUxEb2NUeXBlKHBhcmVudCwgcHViSUQsIHN5c0lEKSB7CiAgICAgICAgdmFyIHJlZiwKICAgICAgICAgICAgcmVmMTsKICAgICAgICB0aGlzLmRvY3VtZW50T2JqZWN0ID0gcGFyZW50OwogICAgICAgIHRoaXMuc3RyaW5naWZ5ID0gdGhpcy5kb2N1bWVudE9iamVjdC5zdHJpbmdpZnk7CiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgICAgIGlmIChpc09iamVjdChwdWJJRCkpIHsKICAgICAgICAgIHJlZiA9IHB1YklELCBwdWJJRCA9IHJlZi5wdWJJRCwgc3lzSUQgPSByZWYuc3lzSUQ7CiAgICAgICAgfQogICAgICAgIGlmIChzeXNJRCA9PSBudWxsKSB7CiAgICAgICAgICByZWYxID0gW3B1YklELCBzeXNJRF0sIHN5c0lEID0gcmVmMVswXSwgcHViSUQgPSByZWYxWzFdOwogICAgICAgIH0KICAgICAgICBpZiAocHViSUQgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5wdWJJRCA9IHRoaXMuc3RyaW5naWZ5LmR0ZFB1YklEKHB1YklEKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN5c0lEICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMuc3lzSUQgPSB0aGlzLnN0cmluZ2lmeS5kdGRTeXNJRChzeXNJRCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZShYTUxEb2NUeXBlLnByb3RvdHlwZSwgdGhpcyk7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmVsZW1lbnQgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgIHZhciBjaGlsZDsKICAgICAgICBjaGlsZCA9IG5ldyBYTUxEVERFbGVtZW50KHRoaXMsIG5hbWUsIHZhbHVlKTsKICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBYTUxEb2NUeXBlLnByb3RvdHlwZS5hdHRMaXN0ID0gZnVuY3Rpb24oZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGRlZmF1bHRWYWx1ZVR5cGUsIGRlZmF1bHRWYWx1ZSkgewogICAgICAgIHZhciBjaGlsZDsKICAgICAgICBjaGlsZCA9IG5ldyBYTUxEVERBdHRMaXN0KHRoaXMsIGVsZW1lbnROYW1lLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVUeXBlLCBkZWZhdWx0VmFsdWVUeXBlLCBkZWZhdWx0VmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmVudGl0eSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdmFyIGNoaWxkOwogICAgICAgIGNoaWxkID0gbmV3IFhNTERUREVudGl0eSh0aGlzLCBmYWxzZSwgbmFtZSwgdmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLnBFbnRpdHkgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgIHZhciBjaGlsZDsKICAgICAgICBjaGlsZCA9IG5ldyBYTUxEVERFbnRpdHkodGhpcywgdHJ1ZSwgbmFtZSwgdmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLm5vdGF0aW9uID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICB2YXIgY2hpbGQ7CiAgICAgICAgY2hpbGQgPSBuZXcgWE1MRFRETm90YXRpb24odGhpcywgbmFtZSwgdmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmNkYXRhID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB2YXIgY2hpbGQ7CiAgICAgICAgY2hpbGQgPSBuZXcgWE1MQ0RhdGEodGhpcywgdmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmNvbW1lbnQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHZhciBjaGlsZDsKICAgICAgICBjaGlsZCA9IG5ldyBYTUxDb21tZW50KHRoaXMsIHZhbHVlKTsKICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBYTUxEb2NUeXBlLnByb3RvdHlwZS5pbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKICAgICAgICB2YXIgY2hpbGQ7CiAgICAgICAgY2hpbGQgPSBuZXcgWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uKHRoaXMsIHRhcmdldCwgdmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLnJvb3QgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudE9iamVjdC5yb290KCk7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmRvY3VtZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRPYmplY3Q7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24ob3B0aW9ucywgbGV2ZWwpIHsKICAgICAgICB2YXIgY2hpbGQsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGluZGVudCwKICAgICAgICAgICAgbGVuLAogICAgICAgICAgICBuZXdsaW5lLAogICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgIHByZXR0eSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcmVmLAogICAgICAgICAgICByZWYxLAogICAgICAgICAgICByZWYyLAogICAgICAgICAgICByZWYzLAogICAgICAgICAgICBzcGFjZTsKICAgICAgICBwcmV0dHkgPSAob3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5wcmV0dHkgOiB2b2lkIDApIHx8IGZhbHNlOwogICAgICAgIGluZGVudCA9IChyZWYgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLmluZGVudCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZiA6ICcgICc7CiAgICAgICAgb2Zmc2V0ID0gKHJlZjEgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLm9mZnNldCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjEgOiAwOwogICAgICAgIG5ld2xpbmUgPSAocmVmMiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMubmV3bGluZSA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjIgOiAnXG4nOwogICAgICAgIGxldmVsIHx8IChsZXZlbCA9IDApOwogICAgICAgIHNwYWNlID0gbmV3IEFycmF5KGxldmVsICsgb2Zmc2V0ICsgMSkuam9pbihpbmRlbnQpOwogICAgICAgIHIgPSAnJzsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IHNwYWNlOwogICAgICAgIH0KICAgICAgICByICs9ICc8IURPQ1RZUEUgJyArIHRoaXMucm9vdCgpLm5hbWU7CiAgICAgICAgaWYgKHRoaXMucHViSUQgJiYgdGhpcy5zeXNJRCkgewogICAgICAgICAgciArPSAnIFBVQkxJQyAiJyArIHRoaXMucHViSUQgKyAnIiAiJyArIHRoaXMuc3lzSUQgKyAnIic7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN5c0lEKSB7CiAgICAgICAgICByICs9ICcgU1lTVEVNICInICsgdGhpcy5zeXNJRCArICciJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgciArPSAnIFsnOwogICAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgICByICs9IG5ld2xpbmU7CiAgICAgICAgICB9CiAgICAgICAgICByZWYzID0gdGhpcy5jaGlsZHJlbjsKICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHJlZjMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgY2hpbGQgPSByZWYzW2ldOwogICAgICAgICAgICByICs9IGNoaWxkLnRvU3RyaW5nKG9wdGlvbnMsIGxldmVsICsgMSk7CiAgICAgICAgICB9CiAgICAgICAgICByICs9ICddJzsKICAgICAgICB9CiAgICAgICAgciArPSAnPic7CiAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgICAgfTsKICAgICAgWE1MRG9jVHlwZS5wcm90b3R5cGUuZWxlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50KG5hbWUsIHZhbHVlKTsKICAgICAgfTsKICAgICAgWE1MRG9jVHlwZS5wcm90b3R5cGUuYXR0ID0gZnVuY3Rpb24oZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGRlZmF1bHRWYWx1ZVR5cGUsIGRlZmF1bHRWYWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmF0dExpc3QoZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGRlZmF1bHRWYWx1ZVR5cGUsIGRlZmF1bHRWYWx1ZSk7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLmVudCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5KG5hbWUsIHZhbHVlKTsKICAgICAgfTsKICAgICAgWE1MRG9jVHlwZS5wcm90b3R5cGUucGVudCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucEVudGl0eShuYW1lLCB2YWx1ZSk7CiAgICAgIH07CiAgICAgIFhNTERvY1R5cGUucHJvdG90eXBlLm5vdCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubm90YXRpb24obmFtZSwgdmFsdWUpOwogICAgICB9OwogICAgICBYTUxEb2NUeXBlLnByb3RvdHlwZS5kYXQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmNkYXRhKHZhbHVlKTsKICAgICAgfTsKICAgICAgWE1MRG9jVHlwZS5wcm90b3R5cGUuY29tID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb21tZW50KHZhbHVlKTsKICAgICAgfTsKICAgICAgWE1MRG9jVHlwZS5wcm90b3R5cGUuaW5zID0gZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmluc3RydWN0aW9uKHRhcmdldCwgdmFsdWUpOwogICAgICB9OwogICAgICBYTUxEb2NUeXBlLnByb3RvdHlwZS51cCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnJvb3QoKTsKICAgICAgfTsKICAgICAgWE1MRG9jVHlwZS5wcm90b3R5cGUuZG9jID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQoKTsKICAgICAgfTsKICAgICAgcmV0dXJuIFhNTERvY1R5cGU7CiAgICB9KSgpOwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW5kZXgiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJnaXRodWI6anNwbS9ub2RlbGlicy1ldmVudHNAMC4xLjEvaW5kZXgiLCBbIm5wbTpldmVudHNAMS4wLjIiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gU3lzdGVtLl9ub2RlUmVxdWlyZSA/IFN5c3RlbS5fbm9kZVJlcXVpcmUoJ2V2ZW50cycpIDogcmVxdWlyZSgibnBtOmV2ZW50c0AxLjAuMiIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06YnVmZmVyQDMuMi4yL2luZGV4IiwgWyJucG06YmFzZTY0LWpzQDAuMC44IiwgIm5wbTppZWVlNzU0QDEuMS42IiwgIm5wbTppcy1hcnJheUAxLjAuMSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJhc2U2NCA9IHJlcXVpcmUoIm5wbTpiYXNlNjQtanNAMC4wLjgiKTsKICB2YXIgaWVlZTc1NCA9IHJlcXVpcmUoIm5wbTppZWVlNzU0QDEuMS42Iik7CiAgdmFyIGlzQXJyYXkgPSByZXF1aXJlKCJucG06aXMtYXJyYXlAMS4wLjEiKTsKICBleHBvcnRzLkJ1ZmZlciA9IEJ1ZmZlcjsKICBleHBvcnRzLlNsb3dCdWZmZXIgPSBTbG93QnVmZmVyOwogIGV4cG9ydHMuSU5TUEVDVF9NQVhfQllURVMgPSA1MDsKICBCdWZmZXIucG9vbFNpemUgPSA4MTkyOwogIHZhciBrTWF4TGVuZ3RoID0gMHgzZmZmZmZmZjsKICB2YXIgcm9vdFBhcmVudCA9IHt9OwogIEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUID0gKGZ1bmN0aW9uKCkgewogICAgdHJ5IHsKICAgICAgdmFyIGJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcigwKTsKICAgICAgdmFyIGFyciA9IG5ldyBVaW50OEFycmF5KGJ1Zik7CiAgICAgIGFyci5mb28gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gNDI7CiAgICAgIH07CiAgICAgIHJldHVybiBhcnIuZm9vKCkgPT09IDQyICYmIHR5cGVvZiBhcnIuc3ViYXJyYXkgPT09ICdmdW5jdGlvbicgJiYgbmV3IFVpbnQ4QXJyYXkoMSkuc3ViYXJyYXkoMSwgMSkuYnl0ZUxlbmd0aCA9PT0gMDsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0pKCk7CiAgZnVuY3Rpb24gQnVmZmVyKGFyZykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEJ1ZmZlcikpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKQogICAgICAgIHJldHVybiBuZXcgQnVmZmVyKGFyZywgYXJndW1lbnRzWzFdKTsKICAgICAgcmV0dXJuIG5ldyBCdWZmZXIoYXJnKTsKICAgIH0KICAgIHRoaXMubGVuZ3RoID0gMDsKICAgIHRoaXMucGFyZW50ID0gdW5kZWZpbmVkOwogICAgaWYgKHR5cGVvZiBhcmcgPT09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiBmcm9tTnVtYmVyKHRoaXMsIGFyZyk7CiAgICB9CiAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIGZyb21TdHJpbmcodGhpcywgYXJnLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6ICd1dGY4Jyk7CiAgICB9CiAgICByZXR1cm4gZnJvbU9iamVjdCh0aGlzLCBhcmcpOwogIH0KICBmdW5jdGlvbiBmcm9tTnVtYmVyKHRoYXQsIGxlbmd0aCkgewogICAgdGhhdCA9IGFsbG9jYXRlKHRoYXQsIGxlbmd0aCA8IDAgPyAwIDogY2hlY2tlZChsZW5ndGgpIHwgMCk7CiAgICBpZiAoIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGF0W2ldID0gMDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoYXQ7CiAgfQogIGZ1bmN0aW9uIGZyb21TdHJpbmcodGhhdCwgc3RyaW5nLCBlbmNvZGluZykgewogICAgaWYgKHR5cGVvZiBlbmNvZGluZyAhPT0gJ3N0cmluZycgfHwgZW5jb2RpbmcgPT09ICcnKQogICAgICBlbmNvZGluZyA9ICd1dGY4JzsKICAgIHZhciBsZW5ndGggPSBieXRlTGVuZ3RoKHN0cmluZywgZW5jb2RpbmcpIHwgMDsKICAgIHRoYXQgPSBhbGxvY2F0ZSh0aGF0LCBsZW5ndGgpOwogICAgdGhhdC53cml0ZShzdHJpbmcsIGVuY29kaW5nKTsKICAgIHJldHVybiB0aGF0OwogIH0KICBmdW5jdGlvbiBmcm9tT2JqZWN0KHRoYXQsIG9iamVjdCkgewogICAgaWYgKEJ1ZmZlci5pc0J1ZmZlcihvYmplY3QpKQogICAgICByZXR1cm4gZnJvbUJ1ZmZlcih0aGF0LCBvYmplY3QpOwogICAgaWYgKGlzQXJyYXkob2JqZWN0KSkKICAgICAgcmV0dXJuIGZyb21BcnJheSh0aGF0LCBvYmplY3QpOwogICAgaWYgKG9iamVjdCA9PSBudWxsKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ211c3Qgc3RhcnQgd2l0aCBudW1iZXIsIGJ1ZmZlciwgYXJyYXkgb3Igc3RyaW5nJyk7CiAgICB9CiAgICBpZiAodHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiBvYmplY3QuYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgcmV0dXJuIGZyb21UeXBlZEFycmF5KHRoYXQsIG9iamVjdCk7CiAgICB9CiAgICBpZiAob2JqZWN0Lmxlbmd0aCkKICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2UodGhhdCwgb2JqZWN0KTsKICAgIHJldHVybiBmcm9tSnNvbk9iamVjdCh0aGF0LCBvYmplY3QpOwogIH0KICBmdW5jdGlvbiBmcm9tQnVmZmVyKHRoYXQsIGJ1ZmZlcikgewogICAgdmFyIGxlbmd0aCA9IGNoZWNrZWQoYnVmZmVyLmxlbmd0aCkgfCAwOwogICAgdGhhdCA9IGFsbG9jYXRlKHRoYXQsIGxlbmd0aCk7CiAgICBidWZmZXIuY29weSh0aGF0LCAwLCAwLCBsZW5ndGgpOwogICAgcmV0dXJuIHRoYXQ7CiAgfQogIGZ1bmN0aW9uIGZyb21BcnJheSh0aGF0LCBhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGNoZWNrZWQoYXJyYXkubGVuZ3RoKSB8IDA7CiAgICB0aGF0ID0gYWxsb2NhdGUodGhhdCwgbGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdGhhdFtpXSA9IGFycmF5W2ldICYgMjU1OwogICAgfQogICAgcmV0dXJuIHRoYXQ7CiAgfQogIGZ1bmN0aW9uIGZyb21UeXBlZEFycmF5KHRoYXQsIGFycmF5KSB7CiAgICB2YXIgbGVuZ3RoID0gY2hlY2tlZChhcnJheS5sZW5ndGgpIHwgMDsKICAgIHRoYXQgPSBhbGxvY2F0ZSh0aGF0LCBsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewogICAgICB0aGF0W2ldID0gYXJyYXlbaV0gJiAyNTU7CiAgICB9CiAgICByZXR1cm4gdGhhdDsKICB9CiAgZnVuY3Rpb24gZnJvbUFycmF5TGlrZSh0aGF0LCBhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGNoZWNrZWQoYXJyYXkubGVuZ3RoKSB8IDA7CiAgICB0aGF0ID0gYWxsb2NhdGUodGhhdCwgbGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdGhhdFtpXSA9IGFycmF5W2ldICYgMjU1OwogICAgfQogICAgcmV0dXJuIHRoYXQ7CiAgfQogIGZ1bmN0aW9uIGZyb21Kc29uT2JqZWN0KHRoYXQsIG9iamVjdCkgewogICAgdmFyIGFycmF5OwogICAgdmFyIGxlbmd0aCA9IDA7CiAgICBpZiAob2JqZWN0LnR5cGUgPT09ICdCdWZmZXInICYmIGlzQXJyYXkob2JqZWN0LmRhdGEpKSB7CiAgICAgIGFycmF5ID0gb2JqZWN0LmRhdGE7CiAgICAgIGxlbmd0aCA9IGNoZWNrZWQoYXJyYXkubGVuZ3RoKSB8IDA7CiAgICB9CiAgICB0aGF0ID0gYWxsb2NhdGUodGhhdCwgbGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdGhhdFtpXSA9IGFycmF5W2ldICYgMjU1OwogICAgfQogICAgcmV0dXJuIHRoYXQ7CiAgfQogIGZ1bmN0aW9uIGFsbG9jYXRlKHRoYXQsIGxlbmd0aCkgewogICAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICAgIHRoYXQgPSBCdWZmZXIuX2F1Z21lbnQobmV3IFVpbnQ4QXJyYXkobGVuZ3RoKSk7CiAgICB9IGVsc2UgewogICAgICB0aGF0Lmxlbmd0aCA9IGxlbmd0aDsKICAgICAgdGhhdC5faXNCdWZmZXIgPSB0cnVlOwogICAgfQogICAgdmFyIGZyb21Qb29sID0gbGVuZ3RoICE9PSAwICYmIGxlbmd0aCA8PSBCdWZmZXIucG9vbFNpemUgPj4+IDE7CiAgICBpZiAoZnJvbVBvb2wpCiAgICAgIHRoYXQucGFyZW50ID0gcm9vdFBhcmVudDsKICAgIHJldHVybiB0aGF0OwogIH0KICBmdW5jdGlvbiBjaGVja2VkKGxlbmd0aCkgewogICAgaWYgKGxlbmd0aCA+PSBrTWF4TGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtICcgKyAnc2l6ZTogMHgnICsga01heExlbmd0aC50b1N0cmluZygxNikgKyAnIGJ5dGVzJyk7CiAgICB9CiAgICByZXR1cm4gbGVuZ3RoIHwgMDsKICB9CiAgZnVuY3Rpb24gU2xvd0J1ZmZlcihzdWJqZWN0LCBlbmNvZGluZykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNsb3dCdWZmZXIpKQogICAgICByZXR1cm4gbmV3IFNsb3dCdWZmZXIoc3ViamVjdCwgZW5jb2RpbmcpOwogICAgdmFyIGJ1ZiA9IG5ldyBCdWZmZXIoc3ViamVjdCwgZW5jb2RpbmcpOwogICAgZGVsZXRlIGJ1Zi5wYXJlbnQ7CiAgICByZXR1cm4gYnVmOwogIH0KICBCdWZmZXIuaXNCdWZmZXIgPSBmdW5jdGlvbiBpc0J1ZmZlcihiKSB7CiAgICByZXR1cm4gISEoYiAhPSBudWxsICYmIGIuX2lzQnVmZmVyKTsKICB9OwogIEJ1ZmZlci5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZShhLCBiKSB7CiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihhKSB8fCAhQnVmZmVyLmlzQnVmZmVyKGIpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50cyBtdXN0IGJlIEJ1ZmZlcnMnKTsKICAgIH0KICAgIGlmIChhID09PSBiKQogICAgICByZXR1cm4gMDsKICAgIHZhciB4ID0gYS5sZW5ndGg7CiAgICB2YXIgeSA9IGIubGVuZ3RoOwogICAgdmFyIGkgPSAwOwogICAgdmFyIGxlbiA9IE1hdGgubWluKHgsIHkpOwogICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgaWYgKGFbaV0gIT09IGJbaV0pCiAgICAgICAgYnJlYWs7CiAgICAgICsraTsKICAgIH0KICAgIGlmIChpICE9PSBsZW4pIHsKICAgICAgeCA9IGFbaV07CiAgICAgIHkgPSBiW2ldOwogICAgfQogICAgaWYgKHggPCB5KQogICAgICByZXR1cm4gLTE7CiAgICBpZiAoeSA8IHgpCiAgICAgIHJldHVybiAxOwogICAgcmV0dXJuIDA7CiAgfTsKICBCdWZmZXIuaXNFbmNvZGluZyA9IGZ1bmN0aW9uIGlzRW5jb2RpbmcoZW5jb2RpbmcpIHsKICAgIHN3aXRjaCAoU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgIGNhc2UgJ2hleCc6CiAgICAgIGNhc2UgJ3V0ZjgnOgogICAgICBjYXNlICd1dGYtOCc6CiAgICAgIGNhc2UgJ2FzY2lpJzoKICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgY2FzZSAncmF3JzoKICAgICAgY2FzZSAndWNzMic6CiAgICAgIGNhc2UgJ3Vjcy0yJzoKICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfTsKICBCdWZmZXIuY29uY2F0ID0gZnVuY3Rpb24gY29uY2F0KGxpc3QsIGxlbmd0aCkgewogICAgaWYgKCFpc0FycmF5KGxpc3QpKQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdsaXN0IGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycy4nKTsKICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gbmV3IEJ1ZmZlcigwKTsKICAgIH0gZWxzZSBpZiAobGlzdC5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIGxpc3RbMF07CiAgICB9CiAgICB2YXIgaTsKICAgIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgICBsZW5ndGggPSAwOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIGxlbmd0aCArPSBsaXN0W2ldLmxlbmd0aDsKICAgICAgfQogICAgfQogICAgdmFyIGJ1ZiA9IG5ldyBCdWZmZXIobGVuZ3RoKTsKICAgIHZhciBwb3MgPSAwOwogICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGl0ZW0gPSBsaXN0W2ldOwogICAgICBpdGVtLmNvcHkoYnVmLCBwb3MpOwogICAgICBwb3MgKz0gaXRlbS5sZW5ndGg7CiAgICB9CiAgICByZXR1cm4gYnVmOwogIH07CiAgZnVuY3Rpb24gYnl0ZUxlbmd0aChzdHJpbmcsIGVuY29kaW5nKSB7CiAgICBpZiAodHlwZW9mIHN0cmluZyAhPT0gJ3N0cmluZycpCiAgICAgIHN0cmluZyA9IFN0cmluZyhzdHJpbmcpOwogICAgaWYgKHN0cmluZy5sZW5ndGggPT09IDApCiAgICAgIHJldHVybiAwOwogICAgc3dpdGNoIChlbmNvZGluZyB8fCAndXRmOCcpIHsKICAgICAgY2FzZSAnYXNjaWknOgogICAgICBjYXNlICdiaW5hcnknOgogICAgICBjYXNlICdyYXcnOgogICAgICAgIHJldHVybiBzdHJpbmcubGVuZ3RoOwogICAgICBjYXNlICd1Y3MyJzoKICAgICAgY2FzZSAndWNzLTInOgogICAgICBjYXNlICd1dGYxNmxlJzoKICAgICAgY2FzZSAndXRmLTE2bGUnOgogICAgICAgIHJldHVybiBzdHJpbmcubGVuZ3RoICogMjsKICAgICAgY2FzZSAnaGV4JzoKICAgICAgICByZXR1cm4gc3RyaW5nLmxlbmd0aCA+Pj4gMTsKICAgICAgY2FzZSAndXRmOCc6CiAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICByZXR1cm4gdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGg7CiAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgcmV0dXJuIGJhc2U2NFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGg7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIHN0cmluZy5sZW5ndGg7CiAgICB9CiAgfQogIEJ1ZmZlci5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aDsKICBCdWZmZXIucHJvdG90eXBlLmxlbmd0aCA9IHVuZGVmaW5lZDsKICBCdWZmZXIucHJvdG90eXBlLnBhcmVudCA9IHVuZGVmaW5lZDsKICBCdWZmZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoZW5jb2RpbmcsIHN0YXJ0LCBlbmQpIHsKICAgIHZhciBsb3dlcmVkQ2FzZSA9IGZhbHNlOwogICAgc3RhcnQgPSBzdGFydCB8IDA7CiAgICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPT09IEluZmluaXR5ID8gdGhpcy5sZW5ndGggOiBlbmQgfCAwOwogICAgaWYgKCFlbmNvZGluZykKICAgICAgZW5jb2RpbmcgPSAndXRmOCc7CiAgICBpZiAoc3RhcnQgPCAwKQogICAgICBzdGFydCA9IDA7CiAgICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpCiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoOwogICAgaWYgKGVuZCA8PSBzdGFydCkKICAgICAgcmV0dXJuICcnOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICAgIGNhc2UgJ2hleCc6CiAgICAgICAgICByZXR1cm4gaGV4U2xpY2UodGhpcywgc3RhcnQsIGVuZCk7CiAgICAgICAgY2FzZSAndXRmOCc6CiAgICAgICAgY2FzZSAndXRmLTgnOgogICAgICAgICAgcmV0dXJuIHV0ZjhTbGljZSh0aGlzLCBzdGFydCwgZW5kKTsKICAgICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgICByZXR1cm4gYXNjaWlTbGljZSh0aGlzLCBzdGFydCwgZW5kKTsKICAgICAgICBjYXNlICdiaW5hcnknOgogICAgICAgICAgcmV0dXJuIGJpbmFyeVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgICByZXR1cm4gYmFzZTY0U2xpY2UodGhpcywgc3RhcnQsIGVuZCk7CiAgICAgICAgY2FzZSAndWNzMic6CiAgICAgICAgY2FzZSAndWNzLTInOgogICAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICAgIHJldHVybiB1dGYxNmxlU2xpY2UodGhpcywgc3RhcnQsIGVuZCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChsb3dlcmVkQ2FzZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKTsKICAgICAgICAgIGVuY29kaW5nID0gKGVuY29kaW5nICsgJycpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWU7CiAgICAgIH0KICAgIH0KICB9OwogIEJ1ZmZlci5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gZXF1YWxzKGIpIHsKICAgIGlmICghQnVmZmVyLmlzQnVmZmVyKGIpKQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyJyk7CiAgICBpZiAodGhpcyA9PT0gYikKICAgICAgcmV0dXJuIHRydWU7CiAgICByZXR1cm4gQnVmZmVyLmNvbXBhcmUodGhpcywgYikgPT09IDA7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLmluc3BlY3QgPSBmdW5jdGlvbiBpbnNwZWN0KCkgewogICAgdmFyIHN0ciA9ICcnOwogICAgdmFyIG1heCA9IGV4cG9ydHMuSU5TUEVDVF9NQVhfQllURVM7CiAgICBpZiAodGhpcy5sZW5ndGggPiAwKSB7CiAgICAgIHN0ciA9IHRoaXMudG9TdHJpbmcoJ2hleCcsIDAsIG1heCkubWF0Y2goLy57Mn0vZykuam9pbignICcpOwogICAgICBpZiAodGhpcy5sZW5ndGggPiBtYXgpCiAgICAgICAgc3RyICs9ICcgLi4uICc7CiAgICB9CiAgICByZXR1cm4gJzxCdWZmZXIgJyArIHN0ciArICc+JzsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uIGNvbXBhcmUoYikgewogICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYikpCiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXInKTsKICAgIGlmICh0aGlzID09PSBiKQogICAgICByZXR1cm4gMDsKICAgIHJldHVybiBCdWZmZXIuY29tcGFyZSh0aGlzLCBiKTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIGluZGV4T2YodmFsLCBieXRlT2Zmc2V0KSB7CiAgICBpZiAoYnl0ZU9mZnNldCA+IDB4N2ZmZmZmZmYpCiAgICAgIGJ5dGVPZmZzZXQgPSAweDdmZmZmZmZmOwogICAgZWxzZSBpZiAoYnl0ZU9mZnNldCA8IC0weDgwMDAwMDAwKQogICAgICBieXRlT2Zmc2V0ID0gLTB4ODAwMDAwMDA7CiAgICBieXRlT2Zmc2V0ID4+PSAwOwogICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKQogICAgICByZXR1cm4gLTE7CiAgICBpZiAoYnl0ZU9mZnNldCA+PSB0aGlzLmxlbmd0aCkKICAgICAgcmV0dXJuIC0xOwogICAgaWYgKGJ5dGVPZmZzZXQgPCAwKQogICAgICBieXRlT2Zmc2V0ID0gTWF0aC5tYXgodGhpcy5sZW5ndGggKyBieXRlT2Zmc2V0LCAwKTsKICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgewogICAgICBpZiAodmFsLmxlbmd0aCA9PT0gMCkKICAgICAgICByZXR1cm4gLTE7CiAgICAgIHJldHVybiBTdHJpbmcucHJvdG90eXBlLmluZGV4T2YuY2FsbCh0aGlzLCB2YWwsIGJ5dGVPZmZzZXQpOwogICAgfQogICAgaWYgKEJ1ZmZlci5pc0J1ZmZlcih2YWwpKSB7CiAgICAgIHJldHVybiBhcnJheUluZGV4T2YodGhpcywgdmFsLCBieXRlT2Zmc2V0KTsKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykgewogICAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQgJiYgVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwodGhpcywgdmFsLCBieXRlT2Zmc2V0KTsKICAgICAgfQogICAgICByZXR1cm4gYXJyYXlJbmRleE9mKHRoaXMsIFt2YWxdLCBieXRlT2Zmc2V0KTsKICAgIH0KICAgIGZ1bmN0aW9uIGFycmF5SW5kZXhPZihhcnIsIHZhbCwgYnl0ZU9mZnNldCkgewogICAgICB2YXIgZm91bmRJbmRleCA9IC0xOwogICAgICBmb3IgKHZhciBpID0gMDsgYnl0ZU9mZnNldCArIGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJyW2J5dGVPZmZzZXQgKyBpXSA9PT0gdmFsW2ZvdW5kSW5kZXggPT09IC0xID8gMCA6IGkgLSBmb3VuZEluZGV4XSkgewogICAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKQogICAgICAgICAgICBmb3VuZEluZGV4ID0gaTsKICAgICAgICAgIGlmIChpIC0gZm91bmRJbmRleCArIDEgPT09IHZhbC5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBieXRlT2Zmc2V0ICsgZm91bmRJbmRleDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm91bmRJbmRleCA9IC0xOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCd2YWwgbXVzdCBiZSBzdHJpbmcsIG51bWJlciBvciBCdWZmZXInKTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gZ2V0KG9mZnNldCkgewogICAgY29uc29sZS5sb2coJy5nZXQoKSBpcyBkZXByZWNhdGVkLiBBY2Nlc3MgdXNpbmcgYXJyYXkgaW5kZXhlcyBpbnN0ZWFkLicpOwogICAgcmV0dXJuIHRoaXMucmVhZFVJbnQ4KG9mZnNldCk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIHNldCh2LCBvZmZzZXQpIHsKICAgIGNvbnNvbGUubG9nKCcuc2V0KCkgaXMgZGVwcmVjYXRlZC4gQWNjZXNzIHVzaW5nIGFycmF5IGluZGV4ZXMgaW5zdGVhZC4nKTsKICAgIHJldHVybiB0aGlzLndyaXRlVUludDgodiwgb2Zmc2V0KTsKICB9OwogIGZ1bmN0aW9uIGhleFdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogICAgb2Zmc2V0ID0gTnVtYmVyKG9mZnNldCkgfHwgMDsKICAgIHZhciByZW1haW5pbmcgPSBidWYubGVuZ3RoIC0gb2Zmc2V0OwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgbGVuZ3RoID0gcmVtYWluaW5nOwogICAgfSBlbHNlIHsKICAgICAgbGVuZ3RoID0gTnVtYmVyKGxlbmd0aCk7CiAgICAgIGlmIChsZW5ndGggPiByZW1haW5pbmcpIHsKICAgICAgICBsZW5ndGggPSByZW1haW5pbmc7CiAgICAgIH0KICAgIH0KICAgIHZhciBzdHJMZW4gPSBzdHJpbmcubGVuZ3RoOwogICAgaWYgKHN0ckxlbiAlIDIgIT09IDApCiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBoZXggc3RyaW5nJyk7CiAgICBpZiAobGVuZ3RoID4gc3RyTGVuIC8gMikgewogICAgICBsZW5ndGggPSBzdHJMZW4gLyAyOwogICAgfQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgcGFyc2VkID0gcGFyc2VJbnQoc3RyaW5nLnN1YnN0cihpICogMiwgMiksIDE2KTsKICAgICAgaWYgKGlzTmFOKHBhcnNlZCkpCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGhleCBzdHJpbmcnKTsKICAgICAgYnVmW29mZnNldCArIGldID0gcGFyc2VkOwogICAgfQogICAgcmV0dXJuIGk7CiAgfQogIGZ1bmN0aW9uIHV0ZjhXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgIHJldHVybiBibGl0QnVmZmVyKHV0ZjhUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpOwogIH0KICBmdW5jdGlvbiBhc2NpaVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogICAgcmV0dXJuIGJsaXRCdWZmZXIoYXNjaWlUb0J5dGVzKHN0cmluZyksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpOwogIH0KICBmdW5jdGlvbiBiaW5hcnlXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgIHJldHVybiBhc2NpaVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgfQogIGZ1bmN0aW9uIGJhc2U2NFdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogICAgcmV0dXJuIGJsaXRCdWZmZXIoYmFzZTY0VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKTsKICB9CiAgZnVuY3Rpb24gdWNzMldyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogICAgcmV0dXJuIGJsaXRCdWZmZXIodXRmMTZsZVRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgfQogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiB3cml0ZShzdHJpbmcsIG9mZnNldCwgbGVuZ3RoLCBlbmNvZGluZykgewogICAgaWYgKG9mZnNldCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGVuY29kaW5nID0gJ3V0ZjgnOwogICAgICBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgICAgb2Zmc2V0ID0gMDsKICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQgJiYgdHlwZW9mIG9mZnNldCA9PT0gJ3N0cmluZycpIHsKICAgICAgZW5jb2RpbmcgPSBvZmZzZXQ7CiAgICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoOwogICAgICBvZmZzZXQgPSAwOwogICAgfSBlbHNlIGlmIChpc0Zpbml0ZShvZmZzZXQpKSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICAgIGlmIChpc0Zpbml0ZShsZW5ndGgpKSB7CiAgICAgICAgbGVuZ3RoID0gbGVuZ3RoIHwgMDsKICAgICAgICBpZiAoZW5jb2RpbmcgPT09IHVuZGVmaW5lZCkKICAgICAgICAgIGVuY29kaW5nID0gJ3V0ZjgnOwogICAgICB9IGVsc2UgewogICAgICAgIGVuY29kaW5nID0gbGVuZ3RoOwogICAgICAgIGxlbmd0aCA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIHN3YXAgPSBlbmNvZGluZzsKICAgICAgZW5jb2RpbmcgPSBvZmZzZXQ7CiAgICAgIG9mZnNldCA9IGxlbmd0aCB8IDA7CiAgICAgIGxlbmd0aCA9IHN3YXA7CiAgICB9CiAgICB2YXIgcmVtYWluaW5nID0gdGhpcy5sZW5ndGggLSBvZmZzZXQ7CiAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQgfHwgbGVuZ3RoID4gcmVtYWluaW5nKQogICAgICBsZW5ndGggPSByZW1haW5pbmc7CiAgICBpZiAoKHN0cmluZy5sZW5ndGggPiAwICYmIChsZW5ndGggPCAwIHx8IG9mZnNldCA8IDApKSB8fCBvZmZzZXQgPiB0aGlzLmxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignYXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMnKTsKICAgIH0KICAgIGlmICghZW5jb2RpbmcpCiAgICAgIGVuY29kaW5nID0gJ3V0ZjgnOwogICAgdmFyIGxvd2VyZWRDYXNlID0gZmFsc2U7CiAgICBmb3IgKDsgOyApIHsKICAgICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICAgIGNhc2UgJ2hleCc6CiAgICAgICAgICByZXR1cm4gaGV4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgY2FzZSAndXRmOCc6CiAgICAgICAgY2FzZSAndXRmLTgnOgogICAgICAgICAgcmV0dXJuIHV0ZjhXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgICByZXR1cm4gYXNjaWlXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICBjYXNlICdiaW5hcnknOgogICAgICAgICAgcmV0dXJuIGJpbmFyeVdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpOwogICAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgICByZXR1cm4gYmFzZTY0V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgY2FzZSAndWNzMic6CiAgICAgICAgY2FzZSAndWNzLTInOgogICAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICAgIHJldHVybiB1Y3MyV3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChsb3dlcmVkQ2FzZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKTsKICAgICAgICAgIGVuY29kaW5nID0gKCcnICsgZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWU7CiAgICAgIH0KICAgIH0KICB9OwogIEJ1ZmZlci5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogJ0J1ZmZlcicsCiAgICAgIGRhdGE6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMuX2FyciB8fCB0aGlzLCAwKQogICAgfTsKICB9OwogIGZ1bmN0aW9uIGJhc2U2NFNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgaWYgKHN0YXJ0ID09PSAwICYmIGVuZCA9PT0gYnVmLmxlbmd0aCkgewogICAgICByZXR1cm4gYmFzZTY0LmZyb21CeXRlQXJyYXkoYnVmKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBiYXNlNjQuZnJvbUJ5dGVBcnJheShidWYuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgfQogIH0KICBmdW5jdGlvbiB1dGY4U2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7CiAgICB2YXIgcmVzID0gJyc7CiAgICB2YXIgdG1wID0gJyc7CiAgICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpOwogICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgaWYgKGJ1ZltpXSA8PSAweDdGKSB7CiAgICAgICAgcmVzICs9IGRlY29kZVV0ZjhDaGFyKHRtcCkgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSk7CiAgICAgICAgdG1wID0gJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG1wICs9ICclJyArIGJ1ZltpXS50b1N0cmluZygxNik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMgKyBkZWNvZGVVdGY4Q2hhcih0bXApOwogIH0KICBmdW5jdGlvbiBhc2NpaVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgdmFyIHJldCA9ICcnOwogICAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKTsKICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSAmIDB4N0YpOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9CiAgZnVuY3Rpb24gYmluYXJ5U2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7CiAgICB2YXIgcmV0ID0gJyc7CiAgICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpOwogICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgcmV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKTsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfQogIGZ1bmN0aW9uIGhleFNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGg7CiAgICBpZiAoIXN0YXJ0IHx8IHN0YXJ0IDwgMCkKICAgICAgc3RhcnQgPSAwOwogICAgaWYgKCFlbmQgfHwgZW5kIDwgMCB8fCBlbmQgPiBsZW4pCiAgICAgIGVuZCA9IGxlbjsKICAgIHZhciBvdXQgPSAnJzsKICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIG91dCArPSB0b0hleChidWZbaV0pOwogICAgfQogICAgcmV0dXJuIG91dDsKICB9CiAgZnVuY3Rpb24gdXRmMTZsZVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgdmFyIGJ5dGVzID0gYnVmLnNsaWNlKHN0YXJ0LCBlbmQpOwogICAgdmFyIHJlcyA9ICcnOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGg7IGkgKz0gMikgewogICAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSArIGJ5dGVzW2kgKyAxXSAqIDI1Nik7CiAgICB9CiAgICByZXR1cm4gcmVzOwogIH0KICBCdWZmZXIucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gc2xpY2Uoc3RhcnQsIGVuZCkgewogICAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoOwogICAgc3RhcnQgPSB+fnN0YXJ0OwogICAgZW5kID0gZW5kID09PSB1bmRlZmluZWQgPyBsZW4gOiB+fmVuZDsKICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgc3RhcnQgKz0gbGVuOwogICAgICBpZiAoc3RhcnQgPCAwKQogICAgICAgIHN0YXJ0ID0gMDsKICAgIH0gZWxzZSBpZiAoc3RhcnQgPiBsZW4pIHsKICAgICAgc3RhcnQgPSBsZW47CiAgICB9CiAgICBpZiAoZW5kIDwgMCkgewogICAgICBlbmQgKz0gbGVuOwogICAgICBpZiAoZW5kIDwgMCkKICAgICAgICBlbmQgPSAwOwogICAgfSBlbHNlIGlmIChlbmQgPiBsZW4pIHsKICAgICAgZW5kID0gbGVuOwogICAgfQogICAgaWYgKGVuZCA8IHN0YXJ0KQogICAgICBlbmQgPSBzdGFydDsKICAgIHZhciBuZXdCdWY7CiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgICAgbmV3QnVmID0gQnVmZmVyLl9hdWdtZW50KHRoaXMuc3ViYXJyYXkoc3RhcnQsIGVuZCkpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHNsaWNlTGVuID0gZW5kIC0gc3RhcnQ7CiAgICAgIG5ld0J1ZiA9IG5ldyBCdWZmZXIoc2xpY2VMZW4sIHVuZGVmaW5lZCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpY2VMZW47IGkrKykgewogICAgICAgIG5ld0J1ZltpXSA9IHRoaXNbaSArIHN0YXJ0XTsKICAgICAgfQogICAgfQogICAgaWYgKG5ld0J1Zi5sZW5ndGgpCiAgICAgIG5ld0J1Zi5wYXJlbnQgPSB0aGlzLnBhcmVudCB8fCB0aGlzOwogICAgcmV0dXJuIG5ld0J1ZjsKICB9OwogIGZ1bmN0aW9uIGNoZWNrT2Zmc2V0KG9mZnNldCwgZXh0LCBsZW5ndGgpIHsKICAgIGlmICgob2Zmc2V0ICUgMSkgIT09IDAgfHwgb2Zmc2V0IDwgMCkKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ29mZnNldCBpcyBub3QgdWludCcpOwogICAgaWYgKG9mZnNldCArIGV4dCA+IGxlbmd0aCkKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RyeWluZyB0byBhY2Nlc3MgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKTsKICB9CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludExFID0gZnVuY3Rpb24gcmVhZFVJbnRMRShvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aCk7CiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdOwogICAgdmFyIG11bCA9IDE7CiAgICB2YXIgaSA9IDA7CiAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bDsKICAgIH0KICAgIHJldHVybiB2YWw7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbiByZWFkVUludEJFKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpOwogICAgfQogICAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0ICsgLS1ieXRlTGVuZ3RoXTsKICAgIHZhciBtdWwgPSAxOwogICAgd2hpbGUgKGJ5dGVMZW5ndGggPiAwICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICAgIHZhbCArPSB0aGlzW29mZnNldCArIC0tYnl0ZUxlbmd0aF0gKiBtdWw7CiAgICB9CiAgICByZXR1cm4gdmFsOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiByZWFkVUludDgob2Zmc2V0LCBub0Fzc2VydCkgewogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAxLCB0aGlzLmxlbmd0aCk7CiAgICByZXR1cm4gdGhpc1tvZmZzZXRdOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDE2TEUgPSBmdW5jdGlvbiByZWFkVUludDE2TEUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aCk7CiAgICByZXR1cm4gdGhpc1tvZmZzZXRdIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MTZCRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTsKICAgIHJldHVybiAodGhpc1tvZmZzZXRdIDw8IDgpIHwgdGhpc1tvZmZzZXQgKyAxXTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQzMkxFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkxFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIGlmICghbm9Bc3NlcnQpCiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgcmV0dXJuICgodGhpc1tvZmZzZXRdKSB8ICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHwgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpKSArICh0aGlzW29mZnNldCArIDNdICogMHgxMDAwMDAwKTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQzMkJFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIGlmICghbm9Bc3NlcnQpCiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgcmV0dXJuICh0aGlzW29mZnNldF0gKiAweDEwMDAwMDApICsgKCh0aGlzW29mZnNldCArIDFdIDw8IDE2KSB8ICh0aGlzW29mZnNldCArIDJdIDw8IDgpIHwgdGhpc1tvZmZzZXQgKyAzXSk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWRJbnRMRSA9IGZ1bmN0aW9uIHJlYWRJbnRMRShvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aCk7CiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdOwogICAgdmFyIG11bCA9IDE7CiAgICB2YXIgaSA9IDA7CiAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bDsKICAgIH0KICAgIG11bCAqPSAweDgwOwogICAgaWYgKHZhbCA+PSBtdWwpCiAgICAgIHZhbCAtPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCk7CiAgICByZXR1cm4gdmFsOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50QkUgPSBmdW5jdGlvbiByZWFkSW50QkUob2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMDsKICAgIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMDsKICAgIGlmICghbm9Bc3NlcnQpCiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpOwogICAgdmFyIGkgPSBieXRlTGVuZ3RoOwogICAgdmFyIG11bCA9IDE7CiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWldOwogICAgd2hpbGUgKGkgPiAwICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICAgIHZhbCArPSB0aGlzW29mZnNldCArIC0taV0gKiBtdWw7CiAgICB9CiAgICBtdWwgKj0gMHg4MDsKICAgIGlmICh2YWwgPj0gbXVsKQogICAgICB2YWwgLT0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgpOwogICAgcmV0dXJuIHZhbDsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiByZWFkSW50OChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKTsKICAgIGlmICghKHRoaXNbb2Zmc2V0XSAmIDB4ODApKQogICAgICByZXR1cm4gKHRoaXNbb2Zmc2V0XSk7CiAgICByZXR1cm4gKCgweGZmIC0gdGhpc1tvZmZzZXRdICsgMSkgKiAtMSk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkxFID0gZnVuY3Rpb24gcmVhZEludDE2TEUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aCk7CiAgICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCk7CiAgICByZXR1cm4gKHZhbCAmIDB4ODAwMCkgPyB2YWwgfCAweEZGRkYwMDAwIDogdmFsOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRJbnQxNkJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIGlmICghbm9Bc3NlcnQpCiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpOwogICAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0ICsgMV0gfCAodGhpc1tvZmZzZXRdIDw8IDgpOwogICAgcmV0dXJuICh2YWwgJiAweDgwMDApID8gdmFsIHwgMHhGRkZGMDAwMCA6IHZhbDsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiByZWFkSW50MzJMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTsKICAgIHJldHVybiAodGhpc1tvZmZzZXRdKSB8ICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHwgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpIHwgKHRoaXNbb2Zmc2V0ICsgM10gPDwgMjQpOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIGlmICghbm9Bc3NlcnQpCiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgcmV0dXJuICh0aGlzW29mZnNldF0gPDwgMjQpIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYpIHwgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgOCkgfCAodGhpc1tvZmZzZXQgKyAzXSk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWRGbG9hdExFID0gZnVuY3Rpb24gcmVhZEZsb2F0TEUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7CiAgICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgMjMsIDQpOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS5yZWFkRmxvYXRCRSA9IGZ1bmN0aW9uIHJlYWRGbG9hdEJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIGlmICghbm9Bc3NlcnQpCiAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIGZhbHNlLCAyMywgNCk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWREb3VibGVMRSA9IGZ1bmN0aW9uIHJlYWREb3VibGVMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja09mZnNldChvZmZzZXQsIDgsIHRoaXMubGVuZ3RoKTsKICAgIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCB0cnVlLCA1MiwgOCk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLnJlYWREb3VibGVCRSA9IGZ1bmN0aW9uIHJlYWREb3VibGVCRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja09mZnNldChvZmZzZXQsIDgsIHRoaXMubGVuZ3RoKTsKICAgIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgNTIsIDgpOwogIH07CiAgZnVuY3Rpb24gY2hlY2tJbnQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBleHQsIG1heCwgbWluKSB7CiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpKQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdidWZmZXIgbXVzdCBiZSBhIEJ1ZmZlciBpbnN0YW5jZScpOwogICAgaWYgKHZhbHVlID4gbWF4IHx8IHZhbHVlIDwgbWluKQogICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigndmFsdWUgaXMgb3V0IG9mIGJvdW5kcycpOwogICAgaWYgKG9mZnNldCArIGV4dCA+IGJ1Zi5sZW5ndGgpCiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdpbmRleCBvdXQgb2YgcmFuZ2UnKTsKICB9CiAgQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlVUludExFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCksIDApOwogICAgdmFyIG11bCA9IDE7CiAgICB2YXIgaSA9IDA7CiAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDB4RkY7CiAgICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgICB0aGlzW29mZnNldCArIGldID0gKHZhbHVlIC8gbXVsKSAmIDB4RkY7CiAgICB9CiAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnRCRSh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aCwgTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgpLCAwKTsKICAgIHZhciBpID0gYnl0ZUxlbmd0aCAtIDE7CiAgICB2YXIgbXVsID0gMTsKICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSB2YWx1ZSAmIDB4RkY7CiAgICB3aGlsZSAoLS1pID49IDAgJiYgKG11bCAqPSAweDEwMCkpIHsKICAgICAgdGhpc1tvZmZzZXQgKyBpXSA9ICh2YWx1ZSAvIG11bCkgJiAweEZGOwogICAgfQogICAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGg7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbiB3cml0ZVVJbnQ4KHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAxLCAweGZmLCAwKTsKICAgIGlmICghQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpCiAgICAgIHZhbHVlID0gTWF0aC5mbG9vcih2YWx1ZSk7CiAgICB0aGlzW29mZnNldF0gPSB2YWx1ZTsKICAgIHJldHVybiBvZmZzZXQgKyAxOwogIH07CiAgZnVuY3Rpb24gb2JqZWN0V3JpdGVVSW50MTYoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHsKICAgIGlmICh2YWx1ZSA8IDApCiAgICAgIHZhbHVlID0gMHhmZmZmICsgdmFsdWUgKyAxOwogICAgZm9yICh2YXIgaSA9IDAsCiAgICAgICAgaiA9IE1hdGgubWluKGJ1Zi5sZW5ndGggLSBvZmZzZXQsIDIpOyBpIDwgajsgaSsrKSB7CiAgICAgIGJ1ZltvZmZzZXQgKyBpXSA9ICh2YWx1ZSAmICgweGZmIDw8ICg4ICogKGxpdHRsZUVuZGlhbiA/IGkgOiAxIC0gaSkpKSkgPj4+IChsaXR0bGVFbmRpYW4gPyBpIDogMSAtIGkpICogODsKICAgIH0KICB9CiAgQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQxNkxFID0gZnVuY3Rpb24gd3JpdGVVSW50MTZMRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKTsKICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZTsKICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCk7CiAgICB9IGVsc2UgewogICAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlKTsKICAgIH0KICAgIHJldHVybiBvZmZzZXQgKyAyOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24gd3JpdGVVSW50MTZCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKTsKICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgPj4+IDgpOwogICAgICB0aGlzW29mZnNldCArIDFdID0gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSk7CiAgICB9CiAgICByZXR1cm4gb2Zmc2V0ICsgMjsKICB9OwogIGZ1bmN0aW9uIG9iamVjdFdyaXRlVUludDMyKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuKSB7CiAgICBpZiAodmFsdWUgPCAwKQogICAgICB2YWx1ZSA9IDB4ZmZmZmZmZmYgKyB2YWx1ZSArIDE7CiAgICBmb3IgKHZhciBpID0gMCwKICAgICAgICBqID0gTWF0aC5taW4oYnVmLmxlbmd0aCAtIG9mZnNldCwgNCk7IGkgPCBqOyBpKyspIHsKICAgICAgYnVmW29mZnNldCArIGldID0gKHZhbHVlID4+PiAobGl0dGxlRW5kaWFuID8gaSA6IDMgLSBpKSAqIDgpICYgMHhmZjsKICAgIH0KICB9CiAgQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQzMkxFID0gZnVuY3Rpb24gd3JpdGVVSW50MzJMRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHhmZmZmZmZmZiwgMCk7CiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgICAgdGhpc1tvZmZzZXQgKyAzXSA9ICh2YWx1ZSA+Pj4gMjQpOwogICAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiAxNik7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpOwogICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpOwogICAgfQogICAgcmV0dXJuIG9mZnNldCArIDQ7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDMyQkUgPSBmdW5jdGlvbiB3cml0ZVVJbnQzMkJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAweGZmZmZmZmZmLCAwKTsKICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgPj4+IDI0KTsKICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gMTYpOwogICAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiA4KTsKICAgICAgdGhpc1tvZmZzZXQgKyAzXSA9IHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UpOwogICAgfQogICAgcmV0dXJuIG9mZnNldCArIDQ7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLndyaXRlSW50TEUgPSBmdW5jdGlvbiB3cml0ZUludExFKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoIC0gMSk7CiAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KTsKICAgIH0KICAgIHZhciBpID0gMDsKICAgIHZhciBtdWwgPSAxOwogICAgdmFyIHN1YiA9IHZhbHVlIDwgMCA/IDEgOiAwOwogICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAweEZGOwogICAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHsKICAgICAgdGhpc1tvZmZzZXQgKyBpXSA9ICgodmFsdWUgLyBtdWwpID4+IDApIC0gc3ViICYgMHhGRjsKICAgIH0KICAgIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoOwogIH07CiAgQnVmZmVyLnByb3RvdHlwZS53cml0ZUludEJFID0gZnVuY3Rpb24gd3JpdGVJbnRCRSh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgaWYgKCFub0Fzc2VydCkgewogICAgICB2YXIgbGltaXQgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCAtIDEpOwogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBsaW1pdCAtIDEsIC1saW1pdCk7CiAgICB9CiAgICB2YXIgaSA9IGJ5dGVMZW5ndGggLSAxOwogICAgdmFyIG11bCA9IDE7CiAgICB2YXIgc3ViID0gdmFsdWUgPCAwID8gMSA6IDA7CiAgICB0aGlzW29mZnNldCArIGldID0gdmFsdWUgJiAweEZGOwogICAgd2hpbGUgKC0taSA+PSAwICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAoKHZhbHVlIC8gbXVsKSA+PiAwKSAtIHN1YiAmIDB4RkY7CiAgICB9CiAgICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQ4ID0gZnVuY3Rpb24gd3JpdGVJbnQ4KHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAxLCAweDdmLCAtMHg4MCk7CiAgICBpZiAoIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKQogICAgICB2YWx1ZSA9IE1hdGguZmxvb3IodmFsdWUpOwogICAgaWYgKHZhbHVlIDwgMCkKICAgICAgdmFsdWUgPSAweGZmICsgdmFsdWUgKyAxOwogICAgdGhpc1tvZmZzZXRdID0gdmFsdWU7CiAgICByZXR1cm4gb2Zmc2V0ICsgMTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24gd3JpdGVJbnQxNkxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCAweDdmZmYsIC0weDgwMDApOwogICAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlOwogICAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiA4KTsKICAgIH0gZWxzZSB7CiAgICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpOwogICAgfQogICAgcmV0dXJuIG9mZnNldCArIDI7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLndyaXRlSW50MTZCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MTZCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHg3ZmZmLCAtMHg4MDAwKTsKICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgPj4+IDgpOwogICAgICB0aGlzW29mZnNldCArIDFdID0gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSk7CiAgICB9CiAgICByZXR1cm4gb2Zmc2V0ICsgMjsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQzMkxFID0gZnVuY3Rpb24gd3JpdGVJbnQzMkxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgIG9mZnNldCA9IG9mZnNldCB8IDA7CiAgICBpZiAoIW5vQXNzZXJ0KQogICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAweDdmZmZmZmZmLCAtMHg4MDAwMDAwMCk7CiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWU7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpOwogICAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiAxNik7CiAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgPj4+IDI0KTsKICAgIH0gZWxzZSB7CiAgICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpOwogICAgfQogICAgcmV0dXJuIG9mZnNldCArIDQ7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgdmFsdWUgPSArdmFsdWU7CiAgICBvZmZzZXQgPSBvZmZzZXQgfCAwOwogICAgaWYgKCFub0Fzc2VydCkKICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHg3ZmZmZmZmZiwgLTB4ODAwMDAwMDApOwogICAgaWYgKHZhbHVlIDwgMCkKICAgICAgdmFsdWUgPSAweGZmZmZmZmZmICsgdmFsdWUgKyAxOwogICAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gMjQpOwogICAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiAxNik7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDgpOwogICAgICB0aGlzW29mZnNldCArIDNdID0gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBvYmplY3RXcml0ZVVJbnQzMih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSk7CiAgICB9CiAgICByZXR1cm4gb2Zmc2V0ICsgNDsKICB9OwogIGZ1bmN0aW9uIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIGV4dCwgbWF4LCBtaW4pIHsKICAgIGlmICh2YWx1ZSA+IG1heCB8fCB2YWx1ZSA8IG1pbikKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3ZhbHVlIGlzIG91dCBvZiBib3VuZHMnKTsKICAgIGlmIChvZmZzZXQgKyBleHQgPiBidWYubGVuZ3RoKQogICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignaW5kZXggb3V0IG9mIHJhbmdlJyk7CiAgICBpZiAob2Zmc2V0IDwgMCkKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ2luZGV4IG91dCBvZiByYW5nZScpOwogIH0KICBmdW5jdGlvbiB3cml0ZUZsb2F0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkgewogICAgaWYgKCFub0Fzc2VydCkgewogICAgICBjaGVja0lFRUU3NTQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCA0LCAzLjQwMjgyMzQ2NjM4NTI4ODZlKzM4LCAtMy40MDI4MjM0NjYzODUyODg2ZSszOCk7CiAgICB9CiAgICBpZWVlNzU0LndyaXRlKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCAyMywgNCk7CiAgICByZXR1cm4gb2Zmc2V0ICsgNDsKICB9CiAgQnVmZmVyLnByb3RvdHlwZS53cml0ZUZsb2F0TEUgPSBmdW5jdGlvbiB3cml0ZUZsb2F0TEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIHJldHVybiB3cml0ZUZsb2F0KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGVGbG9hdEJFID0gZnVuY3Rpb24gd3JpdGVGbG9hdEJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICByZXR1cm4gd3JpdGVGbG9hdCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpOwogIH07CiAgZnVuY3Rpb24gd3JpdGVEb3VibGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIG5vQXNzZXJ0KSB7CiAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIDgsIDEuNzk3NjkzMTM0ODYyMzE1N0UrMzA4LCAtMS43OTc2OTMxMzQ4NjIzMTU3RSszMDgpOwogICAgfQogICAgaWVlZTc1NC53cml0ZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgNTIsIDgpOwogICAgcmV0dXJuIG9mZnNldCArIDg7CiAgfQogIEJ1ZmZlci5wcm90b3R5cGUud3JpdGVEb3VibGVMRSA9IGZ1bmN0aW9uIHdyaXRlRG91YmxlTEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgIHJldHVybiB3cml0ZURvdWJsZSh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydCk7CiAgfTsKICBCdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUJFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICByZXR1cm4gd3JpdGVEb3VibGUodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KTsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIGNvcHkodGFyZ2V0LCB0YXJnZXRTdGFydCwgc3RhcnQsIGVuZCkgewogICAgaWYgKCFzdGFydCkKICAgICAgc3RhcnQgPSAwOwogICAgaWYgKCFlbmQgJiYgZW5kICE9PSAwKQogICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgIGlmICh0YXJnZXRTdGFydCA+PSB0YXJnZXQubGVuZ3RoKQogICAgICB0YXJnZXRTdGFydCA9IHRhcmdldC5sZW5ndGg7CiAgICBpZiAoIXRhcmdldFN0YXJ0KQogICAgICB0YXJnZXRTdGFydCA9IDA7CiAgICBpZiAoZW5kID4gMCAmJiBlbmQgPCBzdGFydCkKICAgICAgZW5kID0gc3RhcnQ7CiAgICBpZiAoZW5kID09PSBzdGFydCkKICAgICAgcmV0dXJuIDA7CiAgICBpZiAodGFyZ2V0Lmxlbmd0aCA9PT0gMCB8fCB0aGlzLmxlbmd0aCA9PT0gMCkKICAgICAgcmV0dXJuIDA7CiAgICBpZiAodGFyZ2V0U3RhcnQgPCAwKSB7CiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCd0YXJnZXRTdGFydCBvdXQgb2YgYm91bmRzJyk7CiAgICB9CiAgICBpZiAoc3RhcnQgPCAwIHx8IHN0YXJ0ID49IHRoaXMubGVuZ3RoKQogICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignc291cmNlU3RhcnQgb3V0IG9mIGJvdW5kcycpOwogICAgaWYgKGVuZCA8IDApCiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcycpOwogICAgaWYgKGVuZCA+IHRoaXMubGVuZ3RoKQogICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgIGlmICh0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgPCBlbmQgLSBzdGFydCkgewogICAgICBlbmQgPSB0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgKyBzdGFydDsKICAgIH0KICAgIHZhciBsZW4gPSBlbmQgLSBzdGFydDsKICAgIGlmIChsZW4gPCAxMDAwIHx8ICFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdGFyZ2V0W2kgKyB0YXJnZXRTdGFydF0gPSB0aGlzW2kgKyBzdGFydF07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRhcmdldC5fc2V0KHRoaXMuc3ViYXJyYXkoc3RhcnQsIHN0YXJ0ICsgbGVuKSwgdGFyZ2V0U3RhcnQpOwogICAgfQogICAgcmV0dXJuIGxlbjsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUuZmlsbCA9IGZ1bmN0aW9uIGZpbGwodmFsdWUsIHN0YXJ0LCBlbmQpIHsKICAgIGlmICghdmFsdWUpCiAgICAgIHZhbHVlID0gMDsKICAgIGlmICghc3RhcnQpCiAgICAgIHN0YXJ0ID0gMDsKICAgIGlmICghZW5kKQogICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgIGlmIChlbmQgPCBzdGFydCkKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ2VuZCA8IHN0YXJ0Jyk7CiAgICBpZiAoZW5kID09PSBzdGFydCkKICAgICAgcmV0dXJuIDsKICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkKICAgICAgcmV0dXJuIDsKICAgIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgPj0gdGhpcy5sZW5ndGgpCiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdzdGFydCBvdXQgb2YgYm91bmRzJyk7CiAgICBpZiAoZW5kIDwgMCB8fCBlbmQgPiB0aGlzLmxlbmd0aCkKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ2VuZCBvdXQgb2YgYm91bmRzJyk7CiAgICB2YXIgaTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgICB0aGlzW2ldID0gdmFsdWU7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBieXRlcyA9IHV0ZjhUb0J5dGVzKHZhbHVlLnRvU3RyaW5nKCkpOwogICAgICB2YXIgbGVuID0gYnl0ZXMubGVuZ3RoOwogICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgICAgdGhpc1tpXSA9IGJ5dGVzW2kgJSBsZW5dOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwogIEJ1ZmZlci5wcm90b3R5cGUudG9BcnJheUJ1ZmZlciA9IGZ1bmN0aW9uIHRvQXJyYXlCdWZmZXIoKSB7CiAgICBpZiAodHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgICAgIHJldHVybiAobmV3IEJ1ZmZlcih0aGlzKSkuYnVmZmVyOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBidWYgPSBuZXcgVWludDhBcnJheSh0aGlzLmxlbmd0aCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsCiAgICAgICAgICAgIGxlbiA9IGJ1Zi5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgewogICAgICAgICAgYnVmW2ldID0gdGhpc1tpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi5idWZmZXI7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0J1ZmZlci50b0FycmF5QnVmZmVyIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyJyk7CiAgICB9CiAgfTsKICB2YXIgQlAgPSBCdWZmZXIucHJvdG90eXBlOwogIEJ1ZmZlci5fYXVnbWVudCA9IGZ1bmN0aW9uIF9hdWdtZW50KGFycikgewogICAgYXJyLmNvbnN0cnVjdG9yID0gQnVmZmVyOwogICAgYXJyLl9pc0J1ZmZlciA9IHRydWU7CiAgICBhcnIuX3NldCA9IGFyci5zZXQ7CiAgICBhcnIuZ2V0ID0gQlAuZ2V0OwogICAgYXJyLnNldCA9IEJQLnNldDsKICAgIGFyci53cml0ZSA9IEJQLndyaXRlOwogICAgYXJyLnRvU3RyaW5nID0gQlAudG9TdHJpbmc7CiAgICBhcnIudG9Mb2NhbGVTdHJpbmcgPSBCUC50b1N0cmluZzsKICAgIGFyci50b0pTT04gPSBCUC50b0pTT047CiAgICBhcnIuZXF1YWxzID0gQlAuZXF1YWxzOwogICAgYXJyLmNvbXBhcmUgPSBCUC5jb21wYXJlOwogICAgYXJyLmluZGV4T2YgPSBCUC5pbmRleE9mOwogICAgYXJyLmNvcHkgPSBCUC5jb3B5OwogICAgYXJyLnNsaWNlID0gQlAuc2xpY2U7CiAgICBhcnIucmVhZFVJbnRMRSA9IEJQLnJlYWRVSW50TEU7CiAgICBhcnIucmVhZFVJbnRCRSA9IEJQLnJlYWRVSW50QkU7CiAgICBhcnIucmVhZFVJbnQ4ID0gQlAucmVhZFVJbnQ4OwogICAgYXJyLnJlYWRVSW50MTZMRSA9IEJQLnJlYWRVSW50MTZMRTsKICAgIGFyci5yZWFkVUludDE2QkUgPSBCUC5yZWFkVUludDE2QkU7CiAgICBhcnIucmVhZFVJbnQzMkxFID0gQlAucmVhZFVJbnQzMkxFOwogICAgYXJyLnJlYWRVSW50MzJCRSA9IEJQLnJlYWRVSW50MzJCRTsKICAgIGFyci5yZWFkSW50TEUgPSBCUC5yZWFkSW50TEU7CiAgICBhcnIucmVhZEludEJFID0gQlAucmVhZEludEJFOwogICAgYXJyLnJlYWRJbnQ4ID0gQlAucmVhZEludDg7CiAgICBhcnIucmVhZEludDE2TEUgPSBCUC5yZWFkSW50MTZMRTsKICAgIGFyci5yZWFkSW50MTZCRSA9IEJQLnJlYWRJbnQxNkJFOwogICAgYXJyLnJlYWRJbnQzMkxFID0gQlAucmVhZEludDMyTEU7CiAgICBhcnIucmVhZEludDMyQkUgPSBCUC5yZWFkSW50MzJCRTsKICAgIGFyci5yZWFkRmxvYXRMRSA9IEJQLnJlYWRGbG9hdExFOwogICAgYXJyLnJlYWRGbG9hdEJFID0gQlAucmVhZEZsb2F0QkU7CiAgICBhcnIucmVhZERvdWJsZUxFID0gQlAucmVhZERvdWJsZUxFOwogICAgYXJyLnJlYWREb3VibGVCRSA9IEJQLnJlYWREb3VibGVCRTsKICAgIGFyci53cml0ZVVJbnQ4ID0gQlAud3JpdGVVSW50ODsKICAgIGFyci53cml0ZVVJbnRMRSA9IEJQLndyaXRlVUludExFOwogICAgYXJyLndyaXRlVUludEJFID0gQlAud3JpdGVVSW50QkU7CiAgICBhcnIud3JpdGVVSW50MTZMRSA9IEJQLndyaXRlVUludDE2TEU7CiAgICBhcnIud3JpdGVVSW50MTZCRSA9IEJQLndyaXRlVUludDE2QkU7CiAgICBhcnIud3JpdGVVSW50MzJMRSA9IEJQLndyaXRlVUludDMyTEU7CiAgICBhcnIud3JpdGVVSW50MzJCRSA9IEJQLndyaXRlVUludDMyQkU7CiAgICBhcnIud3JpdGVJbnRMRSA9IEJQLndyaXRlSW50TEU7CiAgICBhcnIud3JpdGVJbnRCRSA9IEJQLndyaXRlSW50QkU7CiAgICBhcnIud3JpdGVJbnQ4ID0gQlAud3JpdGVJbnQ4OwogICAgYXJyLndyaXRlSW50MTZMRSA9IEJQLndyaXRlSW50MTZMRTsKICAgIGFyci53cml0ZUludDE2QkUgPSBCUC53cml0ZUludDE2QkU7CiAgICBhcnIud3JpdGVJbnQzMkxFID0gQlAud3JpdGVJbnQzMkxFOwogICAgYXJyLndyaXRlSW50MzJCRSA9IEJQLndyaXRlSW50MzJCRTsKICAgIGFyci53cml0ZUZsb2F0TEUgPSBCUC53cml0ZUZsb2F0TEU7CiAgICBhcnIud3JpdGVGbG9hdEJFID0gQlAud3JpdGVGbG9hdEJFOwogICAgYXJyLndyaXRlRG91YmxlTEUgPSBCUC53cml0ZURvdWJsZUxFOwogICAgYXJyLndyaXRlRG91YmxlQkUgPSBCUC53cml0ZURvdWJsZUJFOwogICAgYXJyLmZpbGwgPSBCUC5maWxsOwogICAgYXJyLmluc3BlY3QgPSBCUC5pbnNwZWN0OwogICAgYXJyLnRvQXJyYXlCdWZmZXIgPSBCUC50b0FycmF5QnVmZmVyOwogICAgcmV0dXJuIGFycjsKICB9OwogIHZhciBJTlZBTElEX0JBU0U2NF9SRSA9IC9bXitcLzAtOUEtelwtXS9nOwogIGZ1bmN0aW9uIGJhc2U2NGNsZWFuKHN0cikgewogICAgc3RyID0gc3RyaW5ndHJpbShzdHIpLnJlcGxhY2UoSU5WQUxJRF9CQVNFNjRfUkUsICcnKTsKICAgIGlmIChzdHIubGVuZ3RoIDwgMikKICAgICAgcmV0dXJuICcnOwogICAgd2hpbGUgKHN0ci5sZW5ndGggJSA0ICE9PSAwKSB7CiAgICAgIHN0ciA9IHN0ciArICc9JzsKICAgIH0KICAgIHJldHVybiBzdHI7CiAgfQogIGZ1bmN0aW9uIHN0cmluZ3RyaW0oc3RyKSB7CiAgICBpZiAoc3RyLnRyaW0pCiAgICAgIHJldHVybiBzdHIudHJpbSgpOwogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogIH0KICBmdW5jdGlvbiB0b0hleChuKSB7CiAgICBpZiAobiA8IDE2KQogICAgICByZXR1cm4gJzAnICsgbi50b1N0cmluZygxNik7CiAgICByZXR1cm4gbi50b1N0cmluZygxNik7CiAgfQogIGZ1bmN0aW9uIHV0ZjhUb0J5dGVzKHN0cmluZywgdW5pdHMpIHsKICAgIHVuaXRzID0gdW5pdHMgfHwgSW5maW5pdHk7CiAgICB2YXIgY29kZVBvaW50OwogICAgdmFyIGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7CiAgICB2YXIgbGVhZFN1cnJvZ2F0ZSA9IG51bGw7CiAgICB2YXIgYnl0ZXMgPSBbXTsKICAgIHZhciBpID0gMDsKICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgY29kZVBvaW50ID0gc3RyaW5nLmNoYXJDb2RlQXQoaSk7CiAgICAgIGlmIChjb2RlUG9pbnQgPiAweEQ3RkYgJiYgY29kZVBvaW50IDwgMHhFMDAwKSB7CiAgICAgICAgaWYgKGxlYWRTdXJyb2dhdGUpIHsKICAgICAgICAgIGlmIChjb2RlUG9pbnQgPCAweERDMDApIHsKICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKQogICAgICAgICAgICAgIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCk7CiAgICAgICAgICAgIGxlYWRTdXJyb2dhdGUgPSBjb2RlUG9pbnQ7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29kZVBvaW50ID0gbGVhZFN1cnJvZ2F0ZSAtIDB4RDgwMCA8PCAxMCB8IGNvZGVQb2ludCAtIDB4REMwMCB8IDB4MTAwMDA7CiAgICAgICAgICAgIGxlYWRTdXJyb2dhdGUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoY29kZVBvaW50ID4gMHhEQkZGKSB7CiAgICAgICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkKICAgICAgICAgICAgICBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoaSArIDEgPT09IGxlbmd0aCkgewogICAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpCiAgICAgICAgICAgICAgYnl0ZXMucHVzaCgweEVGLCAweEJGLCAweEJEKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50OwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobGVhZFN1cnJvZ2F0ZSkgewogICAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkKICAgICAgICAgIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCk7CiAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKGNvZGVQb2ludCA8IDB4ODApIHsKICAgICAgICBpZiAoKHVuaXRzIC09IDEpIDwgMCkKICAgICAgICAgIGJyZWFrOwogICAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50KTsKICAgICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDgwMCkgewogICAgICAgIGlmICgodW5pdHMgLT0gMikgPCAwKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgYnl0ZXMucHVzaChjb2RlUG9pbnQgPj4gMHg2IHwgMHhDMCwgY29kZVBvaW50ICYgMHgzRiB8IDB4ODApOwogICAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDB4MTAwMDApIHsKICAgICAgICBpZiAoKHVuaXRzIC09IDMpIDwgMCkKICAgICAgICAgIGJyZWFrOwogICAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50ID4+IDB4QyB8IDB4RTAsIGNvZGVQb2ludCA+PiAweDYgJiAweDNGIHwgMHg4MCwgY29kZVBvaW50ICYgMHgzRiB8IDB4ODApOwogICAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDB4MjAwMDAwKSB7CiAgICAgICAgaWYgKCh1bml0cyAtPSA0KSA8IDApCiAgICAgICAgICBicmVhazsKICAgICAgICBieXRlcy5wdXNoKGNvZGVQb2ludCA+PiAweDEyIHwgMHhGMCwgY29kZVBvaW50ID4+IDB4QyAmIDB4M0YgfCAweDgwLCBjb2RlUG9pbnQgPj4gMHg2ICYgMHgzRiB8IDB4ODAsIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY29kZSBwb2ludCcpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYnl0ZXM7CiAgfQogIGZ1bmN0aW9uIGFzY2lpVG9CeXRlcyhzdHIpIHsKICAgIHZhciBieXRlQXJyYXkgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGJ5dGVBcnJheS5wdXNoKHN0ci5jaGFyQ29kZUF0KGkpICYgMHhGRik7CiAgICB9CiAgICByZXR1cm4gYnl0ZUFycmF5OwogIH0KICBmdW5jdGlvbiB1dGYxNmxlVG9CeXRlcyhzdHIsIHVuaXRzKSB7CiAgICB2YXIgYywKICAgICAgICBoaSwKICAgICAgICBsbzsKICAgIHZhciBieXRlQXJyYXkgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICgodW5pdHMgLT0gMikgPCAwKQogICAgICAgIGJyZWFrOwogICAgICBjID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgIGhpID0gYyA+PiA4OwogICAgICBsbyA9IGMgJSAyNTY7CiAgICAgIGJ5dGVBcnJheS5wdXNoKGxvKTsKICAgICAgYnl0ZUFycmF5LnB1c2goaGkpOwogICAgfQogICAgcmV0dXJuIGJ5dGVBcnJheTsKICB9CiAgZnVuY3Rpb24gYmFzZTY0VG9CeXRlcyhzdHIpIHsKICAgIHJldHVybiBiYXNlNjQudG9CeXRlQXJyYXkoYmFzZTY0Y2xlYW4oc3RyKSk7CiAgfQogIGZ1bmN0aW9uIGJsaXRCdWZmZXIoc3JjLCBkc3QsIG9mZnNldCwgbGVuZ3RoKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICgoaSArIG9mZnNldCA+PSBkc3QubGVuZ3RoKSB8fCAoaSA+PSBzcmMubGVuZ3RoKSkKICAgICAgICBicmVhazsKICAgICAgZHN0W2kgKyBvZmZzZXRdID0gc3JjW2ldOwogICAgfQogICAgcmV0dXJuIGk7CiAgfQogIGZ1bmN0aW9uIGRlY29kZVV0ZjhDaGFyKHN0cikgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHIpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4RkZGRCk7CiAgICB9CiAgfQogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xL2luZGV4IiwgWyJucG06cHJvY2Vzc0AwLjEwLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gU3lzdGVtLl9ub2RlUmVxdWlyZSA/IHByb2Nlc3MgOiByZXF1aXJlKCJucG06cHJvY2Vzc0AwLjEwLjEiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzTmF0aXZlIiwgWyJucG06bG9kYXNoQDMuOS4zL3N0cmluZy9lc2NhcGVSZWdFeHAiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBlc2NhcGVSZWdFeHAgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL3N0cmluZy9lc2NhcGVSZWdFeHAiKSwKICAgICAgaXNPYmplY3RMaWtlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiKTsKICB2YXIgZnVuY1RhZyA9ICdbb2JqZWN0IEZ1bmN0aW9uXSc7CiAgdmFyIHJlSXNIb3N0Q3RvciA9IC9eXFtvYmplY3QgLis/Q29uc3RydWN0b3JcXSQvOwogIHZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CiAgdmFyIGZuVG9TdHJpbmcgPSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmc7CiAgdmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7CiAgdmFyIG9ialRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7CiAgdmFyIHJlSXNOYXRpdmUgPSBSZWdFeHAoJ14nICsgZXNjYXBlUmVnRXhwKGZuVG9TdHJpbmcuY2FsbChoYXNPd25Qcm9wZXJ0eSkpLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csICckMS4qPycpICsgJyQnKTsKICBmdW5jdGlvbiBpc05hdGl2ZSh2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKG9ialRvU3RyaW5nLmNhbGwodmFsdWUpID09IGZ1bmNUYWcpIHsKICAgICAgcmV0dXJuIHJlSXNOYXRpdmUudGVzdChmblRvU3RyaW5nLmNhbGwodmFsdWUpKTsKICAgIH0KICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIHJlSXNIb3N0Q3Rvci50ZXN0KHZhbHVlKTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBpc05hdGl2ZTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0FycmF5TGlrZSIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9nZXRMZW5ndGgiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGdldExlbmd0aCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZ2V0TGVuZ3RoIiksCiAgICAgIGlzTGVuZ3RoID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0xlbmd0aCIpOwogIGZ1bmN0aW9uIGlzQXJyYXlMaWtlKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiBpc0xlbmd0aChnZXRMZW5ndGgodmFsdWUpKTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBpc0FycmF5TGlrZTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9jcmVhdGVBc3NpZ25lciIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iaW5kQ2FsbGJhY2siLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0l0ZXJhdGVlQ2FsbCIsICJucG06bG9kYXNoQDMuOS4zL2Z1bmN0aW9uL3Jlc3RQYXJhbSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJpbmRDYWxsYmFjayA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmluZENhbGxiYWNrIiksCiAgICAgIGlzSXRlcmF0ZWVDYWxsID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc0l0ZXJhdGVlQ2FsbCIpLAogICAgICByZXN0UGFyYW0gPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2Z1bmN0aW9uL3Jlc3RQYXJhbSIpOwogIGZ1bmN0aW9uIGNyZWF0ZUFzc2lnbmVyKGFzc2lnbmVyKSB7CiAgICByZXR1cm4gcmVzdFBhcmFtKGZ1bmN0aW9uKG9iamVjdCwgc291cmNlcykgewogICAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICAgIGxlbmd0aCA9IG9iamVjdCA9PSBudWxsID8gMCA6IHNvdXJjZXMubGVuZ3RoLAogICAgICAgICAgY3VzdG9taXplciA9IGxlbmd0aCA+IDIgPyBzb3VyY2VzW2xlbmd0aCAtIDJdIDogdW5kZWZpbmVkLAogICAgICAgICAgZ3VhcmQgPSBsZW5ndGggPiAyID8gc291cmNlc1syXSA6IHVuZGVmaW5lZCwKICAgICAgICAgIHRoaXNBcmcgPSBsZW5ndGggPiAxID8gc291cmNlc1tsZW5ndGggLSAxXSA6IHVuZGVmaW5lZDsKICAgICAgaWYgKHR5cGVvZiBjdXN0b21pemVyID09ICdmdW5jdGlvbicpIHsKICAgICAgICBjdXN0b21pemVyID0gYmluZENhbGxiYWNrKGN1c3RvbWl6ZXIsIHRoaXNBcmcsIDUpOwogICAgICAgIGxlbmd0aCAtPSAyOwogICAgICB9IGVsc2UgewogICAgICAgIGN1c3RvbWl6ZXIgPSB0eXBlb2YgdGhpc0FyZyA9PSAnZnVuY3Rpb24nID8gdGhpc0FyZyA6IHVuZGVmaW5lZDsKICAgICAgICBsZW5ndGggLT0gKGN1c3RvbWl6ZXIgPyAxIDogMCk7CiAgICAgIH0KICAgICAgaWYgKGd1YXJkICYmIGlzSXRlcmF0ZWVDYWxsKHNvdXJjZXNbMF0sIHNvdXJjZXNbMV0sIGd1YXJkKSkgewogICAgICAgIGN1c3RvbWl6ZXIgPSBsZW5ndGggPCAzID8gdW5kZWZpbmVkIDogY3VzdG9taXplcjsKICAgICAgICBsZW5ndGggPSAxOwogICAgICB9CiAgICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IHNvdXJjZXNbaW5kZXhdOwogICAgICAgIGlmIChzb3VyY2UpIHsKICAgICAgICAgIGFzc2lnbmVyKG9iamVjdCwgc291cmNlLCBjdXN0b21pemVyKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG9iamVjdDsKICAgIH0pOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZUFzc2lnbmVyOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc0VxdWFsRGVlcCIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9lcXVhbEFycmF5cyIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2VxdWFsQnlUYWciLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9lcXVhbE9iamVjdHMiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiLCAibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzVHlwZWRBcnJheSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGVxdWFsQXJyYXlzID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9lcXVhbEFycmF5cyIpLAogICAgICBlcXVhbEJ5VGFnID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9lcXVhbEJ5VGFnIiksCiAgICAgIGVxdWFsT2JqZWN0cyA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZXF1YWxPYmplY3RzIiksCiAgICAgIGlzQXJyYXkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIpLAogICAgICBpc1R5cGVkQXJyYXkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNUeXBlZEFycmF5Iik7CiAgdmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJywKICAgICAgYXJyYXlUYWcgPSAnW29iamVjdCBBcnJheV0nLAogICAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJzsKICB2YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwogIHZhciBvYmpUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOwogIGZ1bmN0aW9uIGJhc2VJc0VxdWFsRGVlcChvYmplY3QsIG90aGVyLCBlcXVhbEZ1bmMsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKSB7CiAgICB2YXIgb2JqSXNBcnIgPSBpc0FycmF5KG9iamVjdCksCiAgICAgICAgb3RoSXNBcnIgPSBpc0FycmF5KG90aGVyKSwKICAgICAgICBvYmpUYWcgPSBhcnJheVRhZywKICAgICAgICBvdGhUYWcgPSBhcnJheVRhZzsKICAgIGlmICghb2JqSXNBcnIpIHsKICAgICAgb2JqVGFnID0gb2JqVG9TdHJpbmcuY2FsbChvYmplY3QpOwogICAgICBpZiAob2JqVGFnID09IGFyZ3NUYWcpIHsKICAgICAgICBvYmpUYWcgPSBvYmplY3RUYWc7CiAgICAgIH0gZWxzZSBpZiAob2JqVGFnICE9IG9iamVjdFRhZykgewogICAgICAgIG9iaklzQXJyID0gaXNUeXBlZEFycmF5KG9iamVjdCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghb3RoSXNBcnIpIHsKICAgICAgb3RoVGFnID0gb2JqVG9TdHJpbmcuY2FsbChvdGhlcik7CiAgICAgIGlmIChvdGhUYWcgPT0gYXJnc1RhZykgewogICAgICAgIG90aFRhZyA9IG9iamVjdFRhZzsKICAgICAgfSBlbHNlIGlmIChvdGhUYWcgIT0gb2JqZWN0VGFnKSB7CiAgICAgICAgb3RoSXNBcnIgPSBpc1R5cGVkQXJyYXkob3RoZXIpOwogICAgICB9CiAgICB9CiAgICB2YXIgb2JqSXNPYmogPSBvYmpUYWcgPT0gb2JqZWN0VGFnLAogICAgICAgIG90aElzT2JqID0gb3RoVGFnID09IG9iamVjdFRhZywKICAgICAgICBpc1NhbWVUYWcgPSBvYmpUYWcgPT0gb3RoVGFnOwogICAgaWYgKGlzU2FtZVRhZyAmJiAhKG9iaklzQXJyIHx8IG9iaklzT2JqKSkgewogICAgICByZXR1cm4gZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCBvYmpUYWcpOwogICAgfQogICAgaWYgKCFpc0xvb3NlKSB7CiAgICAgIHZhciBvYmpJc1dyYXBwZWQgPSBvYmpJc09iaiAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgJ19fd3JhcHBlZF9fJyksCiAgICAgICAgICBvdGhJc1dyYXBwZWQgPSBvdGhJc09iaiAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG90aGVyLCAnX193cmFwcGVkX18nKTsKICAgICAgaWYgKG9iaklzV3JhcHBlZCB8fCBvdGhJc1dyYXBwZWQpIHsKICAgICAgICByZXR1cm4gZXF1YWxGdW5jKG9iaklzV3JhcHBlZCA/IG9iamVjdC52YWx1ZSgpIDogb2JqZWN0LCBvdGhJc1dyYXBwZWQgPyBvdGhlci52YWx1ZSgpIDogb3RoZXIsIGN1c3RvbWl6ZXIsIGlzTG9vc2UsIHN0YWNrQSwgc3RhY2tCKTsKICAgICAgfQogICAgfQogICAgaWYgKCFpc1NhbWVUYWcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgc3RhY2tBIHx8IChzdGFja0EgPSBbXSk7CiAgICBzdGFja0IgfHwgKHN0YWNrQiA9IFtdKTsKICAgIHZhciBsZW5ndGggPSBzdGFja0EubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIGlmIChzdGFja0FbbGVuZ3RoXSA9PSBvYmplY3QpIHsKICAgICAgICByZXR1cm4gc3RhY2tCW2xlbmd0aF0gPT0gb3RoZXI7CiAgICAgIH0KICAgIH0KICAgIHN0YWNrQS5wdXNoKG9iamVjdCk7CiAgICBzdGFja0IucHVzaChvdGhlcik7CiAgICB2YXIgcmVzdWx0ID0gKG9iaklzQXJyID8gZXF1YWxBcnJheXMgOiBlcXVhbE9iamVjdHMpKG9iamVjdCwgb3RoZXIsIGVxdWFsRnVuYywgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpOwogICAgc3RhY2tBLnBvcCgpOwogICAgc3RhY2tCLnBvcCgpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlSXNFcXVhbERlZXA7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUZvck93biIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlRm9yIiwgIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2tleXMiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBiYXNlRm9yID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlRm9yIiksCiAgICAgIGtleXMgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9rZXlzIik7CiAgZnVuY3Rpb24gYmFzZUZvck93bihvYmplY3QsIGl0ZXJhdGVlKSB7CiAgICByZXR1cm4gYmFzZUZvcihvYmplY3QsIGl0ZXJhdGVlLCBrZXlzKTsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlRm9yT3duOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJnaXRodWI6anNwbS9ub2RlbGlicy1ldmVudHNAMC4xLjEiLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLWV2ZW50c0AwLjEuMS9pbmRleCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1ldmVudHNAMC4xLjEvaW5kZXgiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmJ1ZmZlckAzLjIuMiIsIFsibnBtOmJ1ZmZlckAzLjIuMi9pbmRleCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06YnVmZmVyQDMuMi4yL2luZGV4Iik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEvaW5kZXgiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMS9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2dldE5hdGl2ZSIsIFsibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzTmF0aXZlIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgaXNOYXRpdmUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNOYXRpdmUiKTsKICBmdW5jdGlvbiBnZXROYXRpdmUob2JqZWN0LCBrZXkpIHsKICAgIHZhciB2YWx1ZSA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W2tleV07CiAgICByZXR1cm4gaXNOYXRpdmUodmFsdWUpID8gdmFsdWUgOiB1bmRlZmluZWQ7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gZ2V0TmF0aXZlOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc0VxdWFsIiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc0VxdWFsRGVlcCIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9pc09iamVjdExpa2UiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBiYXNlSXNFcXVhbERlZXAgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc0VxdWFsRGVlcCIpLAogICAgICBpc09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIpLAogICAgICBpc09iamVjdExpa2UgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzT2JqZWN0TGlrZSIpOwogIGZ1bmN0aW9uIGJhc2VJc0VxdWFsKHZhbHVlLCBvdGhlciwgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpIHsKICAgIGlmICh2YWx1ZSA9PT0gb3RoZXIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCBvdGhlciA9PSBudWxsIHx8ICghaXNPYmplY3QodmFsdWUpICYmICFpc09iamVjdExpa2Uob3RoZXIpKSkgewogICAgICByZXR1cm4gdmFsdWUgIT09IHZhbHVlICYmIG90aGVyICE9PSBvdGhlcjsKICAgIH0KICAgIHJldHVybiBiYXNlSXNFcXVhbERlZXAodmFsdWUsIG90aGVyLCBiYXNlSXNFcXVhbCwgY3VzdG9taXplciwgaXNMb29zZSwgc3RhY2tBLCBzdGFja0IpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VJc0VxdWFsOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VFYWNoIiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VGb3JPd24iLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9jcmVhdGVCYXNlRWFjaCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGJhc2VGb3JPd24gPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VGb3JPd24iKSwKICAgICAgY3JlYXRlQmFzZUVhY2ggPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2NyZWF0ZUJhc2VFYWNoIik7CiAgdmFyIGJhc2VFYWNoID0gY3JlYXRlQmFzZUVhY2goYmFzZUZvck93bik7CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlRWFjaDsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wL2luZGV4IiwgWyJucG06YnVmZmVyQDMuMi4yIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IFN5c3RlbS5fbm9kZVJlcXVpcmUgPyBTeXN0ZW0uX25vZGVSZXF1aXJlKCdidWZmZXInKSA6IHJlcXVpcmUoIm5wbTpidWZmZXJAMy4yLjIiKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fd3JpdGFibGUiLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLWJ1ZmZlckAwLjEuMCIsICJucG06Y29yZS11dGlsLWlzQDEuMC4xIiwgIm5wbTppbmhlcml0c0AyLjAuMSIsICJucG06c3RyZWFtLWJyb3dzZXJpZnlAMS4wLjAvaW5kZXgiLCAibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fZHVwbGV4IiwgIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX2R1cGxleCIsICJnaXRodWI6anNwbS9ub2RlbGlicy1idWZmZXJAMC4xLjAiLCAiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKEJ1ZmZlciwgcHJvY2VzcykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBXcml0YWJsZTsKICAgIHZhciBCdWZmZXIgPSByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1idWZmZXJAMC4xLjAiKS5CdWZmZXI7CiAgICBXcml0YWJsZS5Xcml0YWJsZVN0YXRlID0gV3JpdGFibGVTdGF0ZTsKICAgIHZhciB1dGlsID0gcmVxdWlyZSgibnBtOmNvcmUtdXRpbC1pc0AxLjAuMSIpOwogICAgdXRpbC5pbmhlcml0cyA9IHJlcXVpcmUoIm5wbTppbmhlcml0c0AyLjAuMSIpOwogICAgdmFyIFN0cmVhbSA9IHJlcXVpcmUoIm5wbTpzdHJlYW0tYnJvd3NlcmlmeUAxLjAuMC9pbmRleCIpOwogICAgdXRpbC5pbmhlcml0cyhXcml0YWJsZSwgU3RyZWFtKTsKICAgIGZ1bmN0aW9uIFdyaXRlUmVxKGNodW5rLCBlbmNvZGluZywgY2IpIHsKICAgICAgdGhpcy5jaHVuayA9IGNodW5rOwogICAgICB0aGlzLmVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYjsKICAgIH0KICAgIGZ1bmN0aW9uIFdyaXRhYmxlU3RhdGUob3B0aW9ucywgc3RyZWFtKSB7CiAgICAgIHZhciBEdXBsZXggPSByZXF1aXJlKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9kdXBsZXgiKTsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIHZhciBod20gPSBvcHRpb25zLmhpZ2hXYXRlck1hcms7CiAgICAgIHZhciBkZWZhdWx0SHdtID0gb3B0aW9ucy5vYmplY3RNb2RlID8gMTYgOiAxNiAqIDEwMjQ7CiAgICAgIHRoaXMuaGlnaFdhdGVyTWFyayA9IChod20gfHwgaHdtID09PSAwKSA/IGh3bSA6IGRlZmF1bHRId207CiAgICAgIHRoaXMub2JqZWN0TW9kZSA9ICEhb3B0aW9ucy5vYmplY3RNb2RlOwogICAgICBpZiAoc3RyZWFtIGluc3RhbmNlb2YgRHVwbGV4KQogICAgICAgIHRoaXMub2JqZWN0TW9kZSA9IHRoaXMub2JqZWN0TW9kZSB8fCAhIW9wdGlvbnMud3JpdGFibGVPYmplY3RNb2RlOwogICAgICB0aGlzLmhpZ2hXYXRlck1hcmsgPSB+fnRoaXMuaGlnaFdhdGVyTWFyazsKICAgICAgdGhpcy5uZWVkRHJhaW4gPSBmYWxzZTsKICAgICAgdGhpcy5lbmRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5lbmRlZCA9IGZhbHNlOwogICAgICB0aGlzLmZpbmlzaGVkID0gZmFsc2U7CiAgICAgIHZhciBub0RlY29kZSA9IG9wdGlvbnMuZGVjb2RlU3RyaW5ncyA9PT0gZmFsc2U7CiAgICAgIHRoaXMuZGVjb2RlU3RyaW5ncyA9ICFub0RlY29kZTsKICAgICAgdGhpcy5kZWZhdWx0RW5jb2RpbmcgPSBvcHRpb25zLmRlZmF1bHRFbmNvZGluZyB8fCAndXRmOCc7CiAgICAgIHRoaXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy53cml0aW5nID0gZmFsc2U7CiAgICAgIHRoaXMuY29ya2VkID0gMDsKICAgICAgdGhpcy5zeW5jID0gdHJ1ZTsKICAgICAgdGhpcy5idWZmZXJQcm9jZXNzaW5nID0gZmFsc2U7CiAgICAgIHRoaXMub253cml0ZSA9IGZ1bmN0aW9uKGVyKSB7CiAgICAgICAgb253cml0ZShzdHJlYW0sIGVyKTsKICAgICAgfTsKICAgICAgdGhpcy53cml0ZWNiID0gbnVsbDsKICAgICAgdGhpcy53cml0ZWxlbiA9IDA7CiAgICAgIHRoaXMuYnVmZmVyID0gW107CiAgICAgIHRoaXMucGVuZGluZ2NiID0gMDsKICAgICAgdGhpcy5wcmVmaW5pc2hlZCA9IGZhbHNlOwogICAgICB0aGlzLmVycm9yRW1pdHRlZCA9IGZhbHNlOwogICAgfQogICAgZnVuY3Rpb24gV3JpdGFibGUob3B0aW9ucykgewogICAgICB2YXIgRHVwbGV4ID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fZHVwbGV4Iik7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBXcml0YWJsZSkgJiYgISh0aGlzIGluc3RhbmNlb2YgRHVwbGV4KSkKICAgICAgICByZXR1cm4gbmV3IFdyaXRhYmxlKG9wdGlvbnMpOwogICAgICB0aGlzLl93cml0YWJsZVN0YXRlID0gbmV3IFdyaXRhYmxlU3RhdGUob3B0aW9ucywgdGhpcyk7CiAgICAgIHRoaXMud3JpdGFibGUgPSB0cnVlOwogICAgICBTdHJlYW0uY2FsbCh0aGlzKTsKICAgIH0KICAgIFdyaXRhYmxlLnByb3RvdHlwZS5waXBlID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBuZXcgRXJyb3IoJ0Nhbm5vdCBwaXBlLiBOb3QgcmVhZGFibGUuJykpOwogICAgfTsKICAgIGZ1bmN0aW9uIHdyaXRlQWZ0ZXJFbmQoc3RyZWFtLCBzdGF0ZSwgY2IpIHsKICAgICAgdmFyIGVyID0gbmV3IEVycm9yKCd3cml0ZSBhZnRlciBlbmQnKTsKICAgICAgc3RyZWFtLmVtaXQoJ2Vycm9yJywgZXIpOwogICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uKCkgewogICAgICAgIGNiKGVyKTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiB2YWxpZENodW5rKHN0cmVhbSwgc3RhdGUsIGNodW5rLCBjYikgewogICAgICB2YXIgdmFsaWQgPSB0cnVlOwogICAgICBpZiAoIXV0aWwuaXNCdWZmZXIoY2h1bmspICYmICF1dGlsLmlzU3RyaW5nKGNodW5rKSAmJiAhdXRpbC5pc051bGxPclVuZGVmaW5lZChjaHVuaykgJiYgIXN0YXRlLm9iamVjdE1vZGUpIHsKICAgICAgICB2YXIgZXIgPSBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIG5vbi1zdHJpbmcvYnVmZmVyIGNodW5rJyk7CiAgICAgICAgc3RyZWFtLmVtaXQoJ2Vycm9yJywgZXIpOwogICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICBjYihlcik7CiAgICAgICAgfSk7CiAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdmFsaWQ7CiAgICB9CiAgICBXcml0YWJsZS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihjaHVuaywgZW5jb2RpbmcsIGNiKSB7CiAgICAgIHZhciBzdGF0ZSA9IHRoaXMuX3dyaXRhYmxlU3RhdGU7CiAgICAgIHZhciByZXQgPSBmYWxzZTsKICAgICAgaWYgKHV0aWwuaXNGdW5jdGlvbihlbmNvZGluZykpIHsKICAgICAgICBjYiA9IGVuY29kaW5nOwogICAgICAgIGVuY29kaW5nID0gbnVsbDsKICAgICAgfQogICAgICBpZiAodXRpbC5pc0J1ZmZlcihjaHVuaykpCiAgICAgICAgZW5jb2RpbmcgPSAnYnVmZmVyJzsKICAgICAgZWxzZSBpZiAoIWVuY29kaW5nKQogICAgICAgIGVuY29kaW5nID0gc3RhdGUuZGVmYXVsdEVuY29kaW5nOwogICAgICBpZiAoIXV0aWwuaXNGdW5jdGlvbihjYikpCiAgICAgICAgY2IgPSBmdW5jdGlvbigpIHt9OwogICAgICBpZiAoc3RhdGUuZW5kZWQpCiAgICAgICAgd3JpdGVBZnRlckVuZCh0aGlzLCBzdGF0ZSwgY2IpOwogICAgICBlbHNlIGlmICh2YWxpZENodW5rKHRoaXMsIHN0YXRlLCBjaHVuaywgY2IpKSB7CiAgICAgICAgc3RhdGUucGVuZGluZ2NiKys7CiAgICAgICAgcmV0ID0gd3JpdGVPckJ1ZmZlcih0aGlzLCBzdGF0ZSwgY2h1bmssIGVuY29kaW5nLCBjYik7CiAgICAgIH0KICAgICAgcmV0dXJuIHJldDsKICAgIH07CiAgICBXcml0YWJsZS5wcm90b3R5cGUuY29yayA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3RhdGUgPSB0aGlzLl93cml0YWJsZVN0YXRlOwogICAgICBzdGF0ZS5jb3JrZWQrKzsKICAgIH07CiAgICBXcml0YWJsZS5wcm90b3R5cGUudW5jb3JrID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzdGF0ZSA9IHRoaXMuX3dyaXRhYmxlU3RhdGU7CiAgICAgIGlmIChzdGF0ZS5jb3JrZWQpIHsKICAgICAgICBzdGF0ZS5jb3JrZWQtLTsKICAgICAgICBpZiAoIXN0YXRlLndyaXRpbmcgJiYgIXN0YXRlLmNvcmtlZCAmJiAhc3RhdGUuZmluaXNoZWQgJiYgIXN0YXRlLmJ1ZmZlclByb2Nlc3NpbmcgJiYgc3RhdGUuYnVmZmVyLmxlbmd0aCkKICAgICAgICAgIGNsZWFyQnVmZmVyKHRoaXMsIHN0YXRlKTsKICAgICAgfQogICAgfTsKICAgIGZ1bmN0aW9uIGRlY29kZUNodW5rKHN0YXRlLCBjaHVuaywgZW5jb2RpbmcpIHsKICAgICAgaWYgKCFzdGF0ZS5vYmplY3RNb2RlICYmIHN0YXRlLmRlY29kZVN0cmluZ3MgIT09IGZhbHNlICYmIHV0aWwuaXNTdHJpbmcoY2h1bmspKSB7CiAgICAgICAgY2h1bmsgPSBuZXcgQnVmZmVyKGNodW5rLCBlbmNvZGluZyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNodW5rOwogICAgfQogICAgZnVuY3Rpb24gd3JpdGVPckJ1ZmZlcihzdHJlYW0sIHN0YXRlLCBjaHVuaywgZW5jb2RpbmcsIGNiKSB7CiAgICAgIGNodW5rID0gZGVjb2RlQ2h1bmsoc3RhdGUsIGNodW5rLCBlbmNvZGluZyk7CiAgICAgIGlmICh1dGlsLmlzQnVmZmVyKGNodW5rKSkKICAgICAgICBlbmNvZGluZyA9ICdidWZmZXInOwogICAgICB2YXIgbGVuID0gc3RhdGUub2JqZWN0TW9kZSA/IDEgOiBjaHVuay5sZW5ndGg7CiAgICAgIHN0YXRlLmxlbmd0aCArPSBsZW47CiAgICAgIHZhciByZXQgPSBzdGF0ZS5sZW5ndGggPCBzdGF0ZS5oaWdoV2F0ZXJNYXJrOwogICAgICBpZiAoIXJldCkKICAgICAgICBzdGF0ZS5uZWVkRHJhaW4gPSB0cnVlOwogICAgICBpZiAoc3RhdGUud3JpdGluZyB8fCBzdGF0ZS5jb3JrZWQpCiAgICAgICAgc3RhdGUuYnVmZmVyLnB1c2gobmV3IFdyaXRlUmVxKGNodW5rLCBlbmNvZGluZywgY2IpKTsKICAgICAgZWxzZQogICAgICAgIGRvV3JpdGUoc3RyZWFtLCBzdGF0ZSwgZmFsc2UsIGxlbiwgY2h1bmssIGVuY29kaW5nLCBjYik7CiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICBmdW5jdGlvbiBkb1dyaXRlKHN0cmVhbSwgc3RhdGUsIHdyaXRldiwgbGVuLCBjaHVuaywgZW5jb2RpbmcsIGNiKSB7CiAgICAgIHN0YXRlLndyaXRlbGVuID0gbGVuOwogICAgICBzdGF0ZS53cml0ZWNiID0gY2I7CiAgICAgIHN0YXRlLndyaXRpbmcgPSB0cnVlOwogICAgICBzdGF0ZS5zeW5jID0gdHJ1ZTsKICAgICAgaWYgKHdyaXRldikKICAgICAgICBzdHJlYW0uX3dyaXRldihjaHVuaywgc3RhdGUub253cml0ZSk7CiAgICAgIGVsc2UKICAgICAgICBzdHJlYW0uX3dyaXRlKGNodW5rLCBlbmNvZGluZywgc3RhdGUub253cml0ZSk7CiAgICAgIHN0YXRlLnN5bmMgPSBmYWxzZTsKICAgIH0KICAgIGZ1bmN0aW9uIG9ud3JpdGVFcnJvcihzdHJlYW0sIHN0YXRlLCBzeW5jLCBlciwgY2IpIHsKICAgICAgaWYgKHN5bmMpCiAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhmdW5jdGlvbigpIHsKICAgICAgICAgIHN0YXRlLnBlbmRpbmdjYi0tOwogICAgICAgICAgY2IoZXIpOwogICAgICAgIH0pOwogICAgICBlbHNlIHsKICAgICAgICBzdGF0ZS5wZW5kaW5nY2ItLTsKICAgICAgICBjYihlcik7CiAgICAgIH0KICAgICAgc3RyZWFtLl93cml0YWJsZVN0YXRlLmVycm9yRW1pdHRlZCA9IHRydWU7CiAgICAgIHN0cmVhbS5lbWl0KCdlcnJvcicsIGVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9ud3JpdGVTdGF0ZVVwZGF0ZShzdGF0ZSkgewogICAgICBzdGF0ZS53cml0aW5nID0gZmFsc2U7CiAgICAgIHN0YXRlLndyaXRlY2IgPSBudWxsOwogICAgICBzdGF0ZS5sZW5ndGggLT0gc3RhdGUud3JpdGVsZW47CiAgICAgIHN0YXRlLndyaXRlbGVuID0gMDsKICAgIH0KICAgIGZ1bmN0aW9uIG9ud3JpdGUoc3RyZWFtLCBlcikgewogICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3dyaXRhYmxlU3RhdGU7CiAgICAgIHZhciBzeW5jID0gc3RhdGUuc3luYzsKICAgICAgdmFyIGNiID0gc3RhdGUud3JpdGVjYjsKICAgICAgb253cml0ZVN0YXRlVXBkYXRlKHN0YXRlKTsKICAgICAgaWYgKGVyKQogICAgICAgIG9ud3JpdGVFcnJvcihzdHJlYW0sIHN0YXRlLCBzeW5jLCBlciwgY2IpOwogICAgICBlbHNlIHsKICAgICAgICB2YXIgZmluaXNoZWQgPSBuZWVkRmluaXNoKHN0cmVhbSwgc3RhdGUpOwogICAgICAgIGlmICghZmluaXNoZWQgJiYgIXN0YXRlLmNvcmtlZCAmJiAhc3RhdGUuYnVmZmVyUHJvY2Vzc2luZyAmJiBzdGF0ZS5idWZmZXIubGVuZ3RoKSB7CiAgICAgICAgICBjbGVhckJ1ZmZlcihzdHJlYW0sIHN0YXRlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN5bmMpIHsKICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGFmdGVyV3JpdGUoc3RyZWFtLCBzdGF0ZSwgZmluaXNoZWQsIGNiKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhZnRlcldyaXRlKHN0cmVhbSwgc3RhdGUsIGZpbmlzaGVkLCBjYik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhZnRlcldyaXRlKHN0cmVhbSwgc3RhdGUsIGZpbmlzaGVkLCBjYikgewogICAgICBpZiAoIWZpbmlzaGVkKQogICAgICAgIG9ud3JpdGVEcmFpbihzdHJlYW0sIHN0YXRlKTsKICAgICAgc3RhdGUucGVuZGluZ2NiLS07CiAgICAgIGNiKCk7CiAgICAgIGZpbmlzaE1heWJlKHN0cmVhbSwgc3RhdGUpOwogICAgfQogICAgZnVuY3Rpb24gb253cml0ZURyYWluKHN0cmVhbSwgc3RhdGUpIHsKICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCAmJiBzdGF0ZS5uZWVkRHJhaW4pIHsKICAgICAgICBzdGF0ZS5uZWVkRHJhaW4gPSBmYWxzZTsKICAgICAgICBzdHJlYW0uZW1pdCgnZHJhaW4nKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gY2xlYXJCdWZmZXIoc3RyZWFtLCBzdGF0ZSkgewogICAgICBzdGF0ZS5idWZmZXJQcm9jZXNzaW5nID0gdHJ1ZTsKICAgICAgaWYgKHN0cmVhbS5fd3JpdGV2ICYmIHN0YXRlLmJ1ZmZlci5sZW5ndGggPiAxKSB7CiAgICAgICAgdmFyIGNicyA9IFtdOwogICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc3RhdGUuYnVmZmVyLmxlbmd0aDsgYysrKQogICAgICAgICAgY2JzLnB1c2goc3RhdGUuYnVmZmVyW2NdLmNhbGxiYWNrKTsKICAgICAgICBzdGF0ZS5wZW5kaW5nY2IrKzsKICAgICAgICBkb1dyaXRlKHN0cmVhbSwgc3RhdGUsIHRydWUsIHN0YXRlLmxlbmd0aCwgc3RhdGUuYnVmZmVyLCAnJywgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNicy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdGF0ZS5wZW5kaW5nY2ItLTsKICAgICAgICAgICAgY2JzW2ldKGVycik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgc3RhdGUuYnVmZmVyID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBzdGF0ZS5idWZmZXIubGVuZ3RoOyBjKyspIHsKICAgICAgICAgIHZhciBlbnRyeSA9IHN0YXRlLmJ1ZmZlcltjXTsKICAgICAgICAgIHZhciBjaHVuayA9IGVudHJ5LmNodW5rOwogICAgICAgICAgdmFyIGVuY29kaW5nID0gZW50cnkuZW5jb2Rpbmc7CiAgICAgICAgICB2YXIgY2IgPSBlbnRyeS5jYWxsYmFjazsKICAgICAgICAgIHZhciBsZW4gPSBzdGF0ZS5vYmplY3RNb2RlID8gMSA6IGNodW5rLmxlbmd0aDsKICAgICAgICAgIGRvV3JpdGUoc3RyZWFtLCBzdGF0ZSwgZmFsc2UsIGxlbiwgY2h1bmssIGVuY29kaW5nLCBjYik7CiAgICAgICAgICBpZiAoc3RhdGUud3JpdGluZykgewogICAgICAgICAgICBjKys7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYyA8IHN0YXRlLmJ1ZmZlci5sZW5ndGgpCiAgICAgICAgICBzdGF0ZS5idWZmZXIgPSBzdGF0ZS5idWZmZXIuc2xpY2UoYyk7CiAgICAgICAgZWxzZQogICAgICAgICAgc3RhdGUuYnVmZmVyLmxlbmd0aCA9IDA7CiAgICAgIH0KICAgICAgc3RhdGUuYnVmZmVyUHJvY2Vzc2luZyA9IGZhbHNlOwogICAgfQogICAgV3JpdGFibGUucHJvdG90eXBlLl93cml0ZSA9IGZ1bmN0aW9uKGNodW5rLCBlbmNvZGluZywgY2IpIHsKICAgICAgY2IobmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKSk7CiAgICB9OwogICAgV3JpdGFibGUucHJvdG90eXBlLl93cml0ZXYgPSBudWxsOwogICAgV3JpdGFibGUucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uKGNodW5rLCBlbmNvZGluZywgY2IpIHsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5fd3JpdGFibGVTdGF0ZTsKICAgICAgaWYgKHV0aWwuaXNGdW5jdGlvbihjaHVuaykpIHsKICAgICAgICBjYiA9IGNodW5rOwogICAgICAgIGNodW5rID0gbnVsbDsKICAgICAgICBlbmNvZGluZyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAodXRpbC5pc0Z1bmN0aW9uKGVuY29kaW5nKSkgewogICAgICAgIGNiID0gZW5jb2Rpbmc7CiAgICAgICAgZW5jb2RpbmcgPSBudWxsOwogICAgICB9CiAgICAgIGlmICghdXRpbC5pc051bGxPclVuZGVmaW5lZChjaHVuaykpCiAgICAgICAgdGhpcy53cml0ZShjaHVuaywgZW5jb2RpbmcpOwogICAgICBpZiAoc3RhdGUuY29ya2VkKSB7CiAgICAgICAgc3RhdGUuY29ya2VkID0gMTsKICAgICAgICB0aGlzLnVuY29yaygpOwogICAgICB9CiAgICAgIGlmICghc3RhdGUuZW5kaW5nICYmICFzdGF0ZS5maW5pc2hlZCkKICAgICAgICBlbmRXcml0YWJsZSh0aGlzLCBzdGF0ZSwgY2IpOwogICAgfTsKICAgIGZ1bmN0aW9uIG5lZWRGaW5pc2goc3RyZWFtLCBzdGF0ZSkgewogICAgICByZXR1cm4gKHN0YXRlLmVuZGluZyAmJiBzdGF0ZS5sZW5ndGggPT09IDAgJiYgIXN0YXRlLmZpbmlzaGVkICYmICFzdGF0ZS53cml0aW5nKTsKICAgIH0KICAgIGZ1bmN0aW9uIHByZWZpbmlzaChzdHJlYW0sIHN0YXRlKSB7CiAgICAgIGlmICghc3RhdGUucHJlZmluaXNoZWQpIHsKICAgICAgICBzdGF0ZS5wcmVmaW5pc2hlZCA9IHRydWU7CiAgICAgICAgc3RyZWFtLmVtaXQoJ3ByZWZpbmlzaCcpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBmaW5pc2hNYXliZShzdHJlYW0sIHN0YXRlKSB7CiAgICAgIHZhciBuZWVkID0gbmVlZEZpbmlzaChzdHJlYW0sIHN0YXRlKTsKICAgICAgaWYgKG5lZWQpIHsKICAgICAgICBpZiAoc3RhdGUucGVuZGluZ2NiID09PSAwKSB7CiAgICAgICAgICBwcmVmaW5pc2goc3RyZWFtLCBzdGF0ZSk7CiAgICAgICAgICBzdGF0ZS5maW5pc2hlZCA9IHRydWU7CiAgICAgICAgICBzdHJlYW0uZW1pdCgnZmluaXNoJyk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICBwcmVmaW5pc2goc3RyZWFtLCBzdGF0ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5lZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBlbmRXcml0YWJsZShzdHJlYW0sIHN0YXRlLCBjYikgewogICAgICBzdGF0ZS5lbmRpbmcgPSB0cnVlOwogICAgICBmaW5pc2hNYXliZShzdHJlYW0sIHN0YXRlKTsKICAgICAgaWYgKGNiKSB7CiAgICAgICAgaWYgKHN0YXRlLmZpbmlzaGVkKQogICAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhjYik7CiAgICAgICAgZWxzZQogICAgICAgICAgc3RyZWFtLm9uY2UoJ2ZpbmlzaCcsIGNiKTsKICAgICAgfQogICAgICBzdGF0ZS5lbmRlZCA9IHRydWU7CiAgICB9CiAgfSkocmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wIikuQnVmZmVyLCByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIikpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9rZXlzIiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2dldE5hdGl2ZSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzQXJyYXlMaWtlIiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL3NoaW1LZXlzIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgZ2V0TmF0aXZlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9nZXROYXRpdmUiKSwKICAgICAgaXNBcnJheUxpa2UgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzQXJyYXlMaWtlIiksCiAgICAgIGlzT2JqZWN0ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0IiksCiAgICAgIHNoaW1LZXlzID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9zaGltS2V5cyIpOwogIHZhciBuYXRpdmVLZXlzID0gZ2V0TmF0aXZlKE9iamVjdCwgJ2tleXMnKTsKICB2YXIga2V5cyA9ICFuYXRpdmVLZXlzID8gc2hpbUtleXMgOiBmdW5jdGlvbihvYmplY3QpIHsKICAgIHZhciBDdG9yID0gb2JqZWN0ID09IG51bGwgPyBudWxsIDogb2JqZWN0LmNvbnN0cnVjdG9yOwogICAgaWYgKCh0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IucHJvdG90eXBlID09PSBvYmplY3QpIHx8ICh0eXBlb2Ygb2JqZWN0ICE9ICdmdW5jdGlvbicgJiYgaXNBcnJheUxpa2Uob2JqZWN0KSkpIHsKICAgICAgcmV0dXJuIHNoaW1LZXlzKG9iamVjdCk7CiAgICB9CiAgICByZXR1cm4gaXNPYmplY3Qob2JqZWN0KSA/IG5hdGl2ZUtleXMob2JqZWN0KSA6IFtdOwogIH07CiAgbW9kdWxlLmV4cG9ydHMgPSBrZXlzOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc01hdGNoIiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc0VxdWFsIiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvdG9PYmplY3QiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBiYXNlSXNFcXVhbCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUlzRXF1YWwiKSwKICAgICAgdG9PYmplY3QgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL3RvT2JqZWN0Iik7CiAgZnVuY3Rpb24gYmFzZUlzTWF0Y2gob2JqZWN0LCBtYXRjaERhdGEsIGN1c3RvbWl6ZXIpIHsKICAgIHZhciBpbmRleCA9IG1hdGNoRGF0YS5sZW5ndGgsCiAgICAgICAgbGVuZ3RoID0gaW5kZXgsCiAgICAgICAgbm9DdXN0b21pemVyID0gIWN1c3RvbWl6ZXI7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgcmV0dXJuICFsZW5ndGg7CiAgICB9CiAgICBvYmplY3QgPSB0b09iamVjdChvYmplY3QpOwogICAgd2hpbGUgKGluZGV4LS0pIHsKICAgICAgdmFyIGRhdGEgPSBtYXRjaERhdGFbaW5kZXhdOwogICAgICBpZiAoKG5vQ3VzdG9taXplciAmJiBkYXRhWzJdKSA/IGRhdGFbMV0gIT09IG9iamVjdFtkYXRhWzBdXSA6ICEoZGF0YVswXSBpbiBvYmplY3QpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBkYXRhID0gbWF0Y2hEYXRhW2luZGV4XTsKICAgICAgdmFyIGtleSA9IGRhdGFbMF0sCiAgICAgICAgICBvYmpWYWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgc3JjVmFsdWUgPSBkYXRhWzFdOwogICAgICBpZiAobm9DdXN0b21pemVyICYmIGRhdGFbMl0pIHsKICAgICAgICBpZiAob2JqVmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhKGtleSBpbiBvYmplY3QpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhciByZXN1bHQgPSBjdXN0b21pemVyID8gY3VzdG9taXplcihvYmpWYWx1ZSwgc3JjVmFsdWUsIGtleSkgOiB1bmRlZmluZWQ7CiAgICAgICAgaWYgKCEocmVzdWx0ID09PSB1bmRlZmluZWQgPyBiYXNlSXNFcXVhbChzcmNWYWx1ZSwgb2JqVmFsdWUsIGN1c3RvbWl6ZXIsIHRydWUpIDogcmVzdWx0KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gYmFzZUlzTWF0Y2g7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUV2ZXJ5IiwgWyJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VFYWNoIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYmFzZUVhY2ggPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VFYWNoIik7CiAgZnVuY3Rpb24gYmFzZUV2ZXJ5KGNvbGxlY3Rpb24sIHByZWRpY2F0ZSkgewogICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICBiYXNlRWFjaChjb2xsZWN0aW9uLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHsKICAgICAgcmVzdWx0ID0gISFwcmVkaWNhdGUodmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgbW9kdWxlLmV4cG9ydHMgPSBiYXNlRXZlcnk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoImdpdGh1Yjpqc3BtL25vZGVsaWJzLWJ1ZmZlckAwLjEuMCIsIFsiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wL2luZGV4Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLWJ1ZmZlckAwLjEuMC9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9kdXBsZXgiLCBbIm5wbTpjb3JlLXV0aWwtaXNAMS4wLjEiLCAibnBtOmluaGVyaXRzQDIuMC4xIiwgIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3JlYWRhYmxlIiwgIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3dyaXRhYmxlIiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihwcm9jZXNzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IER1cGxleDsKICAgIHZhciBvYmplY3RLZXlzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICAgIHZhciBrZXlzID0gW107CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopCiAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgIHJldHVybiBrZXlzOwogICAgfTsKICAgIHZhciB1dGlsID0gcmVxdWlyZSgibnBtOmNvcmUtdXRpbC1pc0AxLjAuMSIpOwogICAgdXRpbC5pbmhlcml0cyA9IHJlcXVpcmUoIm5wbTppbmhlcml0c0AyLjAuMSIpOwogICAgdmFyIFJlYWRhYmxlID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fcmVhZGFibGUiKTsKICAgIHZhciBXcml0YWJsZSA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3dyaXRhYmxlIik7CiAgICB1dGlsLmluaGVyaXRzKER1cGxleCwgUmVhZGFibGUpOwogICAgZm9yRWFjaChvYmplY3RLZXlzKFdyaXRhYmxlLnByb3RvdHlwZSksIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgICBpZiAoIUR1cGxleC5wcm90b3R5cGVbbWV0aG9kXSkKICAgICAgICBEdXBsZXgucHJvdG90eXBlW21ldGhvZF0gPSBXcml0YWJsZS5wcm90b3R5cGVbbWV0aG9kXTsKICAgIH0pOwogICAgZnVuY3Rpb24gRHVwbGV4KG9wdGlvbnMpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIER1cGxleCkpCiAgICAgICAgcmV0dXJuIG5ldyBEdXBsZXgob3B0aW9ucyk7CiAgICAgIFJlYWRhYmxlLmNhbGwodGhpcywgb3B0aW9ucyk7CiAgICAgIFdyaXRhYmxlLmNhbGwodGhpcywgb3B0aW9ucyk7CiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucmVhZGFibGUgPT09IGZhbHNlKQogICAgICAgIHRoaXMucmVhZGFibGUgPSBmYWxzZTsKICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy53cml0YWJsZSA9PT0gZmFsc2UpCiAgICAgICAgdGhpcy53cml0YWJsZSA9IGZhbHNlOwogICAgICB0aGlzLmFsbG93SGFsZk9wZW4gPSB0cnVlOwogICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmFsbG93SGFsZk9wZW4gPT09IGZhbHNlKQogICAgICAgIHRoaXMuYWxsb3dIYWxmT3BlbiA9IGZhbHNlOwogICAgICB0aGlzLm9uY2UoJ2VuZCcsIG9uZW5kKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uZW5kKCkgewogICAgICBpZiAodGhpcy5hbGxvd0hhbGZPcGVuIHx8IHRoaXMuX3dyaXRhYmxlU3RhdGUuZW5kZWQpCiAgICAgICAgcmV0dXJuIDsKICAgICAgcHJvY2Vzcy5uZXh0VGljayh0aGlzLmVuZC5iaW5kKHRoaXMpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZvckVhY2goeHMsIGYpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsCiAgICAgICAgICBsID0geHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgZih4c1tpXSwgaSk7CiAgICAgIH0KICAgIH0KICB9KShyZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIikpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Fzc2lnbldpdGgiLCBbIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2tleXMiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBrZXlzID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9vYmplY3Qva2V5cyIpOwogIGZ1bmN0aW9uIGFzc2lnbldpdGgob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHByb3BzID0ga2V5cyhzb3VyY2UpLAogICAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF0sCiAgICAgICAgICB2YWx1ZSA9IG9iamVjdFtrZXldLAogICAgICAgICAgcmVzdWx0ID0gY3VzdG9taXplcih2YWx1ZSwgc291cmNlW2tleV0sIGtleSwgb2JqZWN0LCBzb3VyY2UpOwogICAgICBpZiAoKHJlc3VsdCA9PT0gcmVzdWx0ID8gKHJlc3VsdCAhPT0gdmFsdWUpIDogKHZhbHVlID09PSB2YWx1ZSkpIHx8ICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICEoa2V5IGluIG9iamVjdCkpKSB7CiAgICAgICAgb2JqZWN0W2tleV0gPSByZXN1bHQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvYmplY3Q7CiAgfQogIG1vZHVsZS5leHBvcnRzID0gYXNzaWduV2l0aDsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlTWF0Y2hlcyIsIFsibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlSXNNYXRjaCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2dldE1hdGNoRGF0YSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL3RvT2JqZWN0Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYmFzZUlzTWF0Y2ggPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VJc01hdGNoIiksCiAgICAgIGdldE1hdGNoRGF0YSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvZ2V0TWF0Y2hEYXRhIiksCiAgICAgIHRvT2JqZWN0ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC90b09iamVjdCIpOwogIGZ1bmN0aW9uIGJhc2VNYXRjaGVzKHNvdXJjZSkgewogICAgdmFyIG1hdGNoRGF0YSA9IGdldE1hdGNoRGF0YShzb3VyY2UpOwogICAgaWYgKG1hdGNoRGF0YS5sZW5ndGggPT0gMSAmJiBtYXRjaERhdGFbMF1bMl0pIHsKICAgICAgdmFyIGtleSA9IG1hdGNoRGF0YVswXVswXSwKICAgICAgICAgIHZhbHVlID0gbWF0Y2hEYXRhWzBdWzFdOwogICAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmplY3Rba2V5XSA9PT0gdmFsdWUgJiYgKHZhbHVlICE9PSB1bmRlZmluZWQgfHwgKGtleSBpbiB0b09iamVjdChvYmplY3QpKSk7CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgIHJldHVybiBiYXNlSXNNYXRjaChvYmplY3QsIG1hdGNoRGF0YSk7CiAgICB9OwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VNYXRjaGVzOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9yZWFkYWJsZSIsIFsibnBtOmlzYXJyYXlAMC4wLjEiLCAiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wIiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLWV2ZW50c0AwLjEuMSIsICJucG06c3RyZWFtLWJyb3dzZXJpZnlAMS4wLjAvaW5kZXgiLCAibnBtOmNvcmUtdXRpbC1pc0AxLjAuMSIsICJucG06aW5oZXJpdHNAMi4wLjEiLCAiQGVtcHR5IiwgIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX2R1cGxleCIsICJucG06c3RyaW5nX2RlY29kZXJAMC4xMC4zMSIsICJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9kdXBsZXgiLCAibnBtOnN0cmluZ19kZWNvZGVyQDAuMTAuMzEiLCAiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wIiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihCdWZmZXIsIHByb2Nlc3MpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gUmVhZGFibGU7CiAgICB2YXIgaXNBcnJheSA9IHJlcXVpcmUoIm5wbTppc2FycmF5QDAuMC4xIik7CiAgICB2YXIgQnVmZmVyID0gcmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wIikuQnVmZmVyOwogICAgUmVhZGFibGUuUmVhZGFibGVTdGF0ZSA9IFJlYWRhYmxlU3RhdGU7CiAgICB2YXIgRUUgPSByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1ldmVudHNAMC4xLjEiKS5FdmVudEVtaXR0ZXI7CiAgICBpZiAoIUVFLmxpc3RlbmVyQ291bnQpCiAgICAgIEVFLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7CiAgICAgICAgcmV0dXJuIGVtaXR0ZXIubGlzdGVuZXJzKHR5cGUpLmxlbmd0aDsKICAgICAgfTsKICAgIHZhciBTdHJlYW0gPSByZXF1aXJlKCJucG06c3RyZWFtLWJyb3dzZXJpZnlAMS4wLjAvaW5kZXgiKTsKICAgIHZhciB1dGlsID0gcmVxdWlyZSgibnBtOmNvcmUtdXRpbC1pc0AxLjAuMSIpOwogICAgdXRpbC5pbmhlcml0cyA9IHJlcXVpcmUoIm5wbTppbmhlcml0c0AyLjAuMSIpOwogICAgdmFyIFN0cmluZ0RlY29kZXI7CiAgICB2YXIgZGVidWcgPSByZXF1aXJlKCJAZW1wdHkiKTsKICAgIGlmIChkZWJ1ZyAmJiBkZWJ1Zy5kZWJ1Z2xvZykgewogICAgICBkZWJ1ZyA9IGRlYnVnLmRlYnVnbG9nKCdzdHJlYW0nKTsKICAgIH0gZWxzZSB7CiAgICAgIGRlYnVnID0gZnVuY3Rpb24oKSB7fTsKICAgIH0KICAgIHV0aWwuaW5oZXJpdHMoUmVhZGFibGUsIFN0cmVhbSk7CiAgICBmdW5jdGlvbiBSZWFkYWJsZVN0YXRlKG9wdGlvbnMsIHN0cmVhbSkgewogICAgICB2YXIgRHVwbGV4ID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fZHVwbGV4Iik7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB2YXIgaHdtID0gb3B0aW9ucy5oaWdoV2F0ZXJNYXJrOwogICAgICB2YXIgZGVmYXVsdEh3bSA9IG9wdGlvbnMub2JqZWN0TW9kZSA/IDE2IDogMTYgKiAxMDI0OwogICAgICB0aGlzLmhpZ2hXYXRlck1hcmsgPSAoaHdtIHx8IGh3bSA9PT0gMCkgPyBod20gOiBkZWZhdWx0SHdtOwogICAgICB0aGlzLmhpZ2hXYXRlck1hcmsgPSB+fnRoaXMuaGlnaFdhdGVyTWFyazsKICAgICAgdGhpcy5idWZmZXIgPSBbXTsKICAgICAgdGhpcy5sZW5ndGggPSAwOwogICAgICB0aGlzLnBpcGVzID0gbnVsbDsKICAgICAgdGhpcy5waXBlc0NvdW50ID0gMDsKICAgICAgdGhpcy5mbG93aW5nID0gbnVsbDsKICAgICAgdGhpcy5lbmRlZCA9IGZhbHNlOwogICAgICB0aGlzLmVuZEVtaXR0ZWQgPSBmYWxzZTsKICAgICAgdGhpcy5yZWFkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuc3luYyA9IHRydWU7CiAgICAgIHRoaXMubmVlZFJlYWRhYmxlID0gZmFsc2U7CiAgICAgIHRoaXMuZW1pdHRlZFJlYWRhYmxlID0gZmFsc2U7CiAgICAgIHRoaXMucmVhZGFibGVMaXN0ZW5pbmcgPSBmYWxzZTsKICAgICAgdGhpcy5vYmplY3RNb2RlID0gISFvcHRpb25zLm9iamVjdE1vZGU7CiAgICAgIGlmIChzdHJlYW0gaW5zdGFuY2VvZiBEdXBsZXgpCiAgICAgICAgdGhpcy5vYmplY3RNb2RlID0gdGhpcy5vYmplY3RNb2RlIHx8ICEhb3B0aW9ucy5yZWFkYWJsZU9iamVjdE1vZGU7CiAgICAgIHRoaXMuZGVmYXVsdEVuY29kaW5nID0gb3B0aW9ucy5kZWZhdWx0RW5jb2RpbmcgfHwgJ3V0ZjgnOwogICAgICB0aGlzLnJhbk91dCA9IGZhbHNlOwogICAgICB0aGlzLmF3YWl0RHJhaW4gPSAwOwogICAgICB0aGlzLnJlYWRpbmdNb3JlID0gZmFsc2U7CiAgICAgIHRoaXMuZGVjb2RlciA9IG51bGw7CiAgICAgIHRoaXMuZW5jb2RpbmcgPSBudWxsOwogICAgICBpZiAob3B0aW9ucy5lbmNvZGluZykgewogICAgICAgIGlmICghU3RyaW5nRGVjb2RlcikKICAgICAgICAgIFN0cmluZ0RlY29kZXIgPSByZXF1aXJlKCJucG06c3RyaW5nX2RlY29kZXJAMC4xMC4zMSIpLlN0cmluZ0RlY29kZXI7CiAgICAgICAgdGhpcy5kZWNvZGVyID0gbmV3IFN0cmluZ0RlY29kZXIob3B0aW9ucy5lbmNvZGluZyk7CiAgICAgICAgdGhpcy5lbmNvZGluZyA9IG9wdGlvbnMuZW5jb2Rpbmc7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIFJlYWRhYmxlKG9wdGlvbnMpIHsKICAgICAgdmFyIER1cGxleCA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX2R1cGxleCIpOwogICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUmVhZGFibGUpKQogICAgICAgIHJldHVybiBuZXcgUmVhZGFibGUob3B0aW9ucyk7CiAgICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUgPSBuZXcgUmVhZGFibGVTdGF0ZShvcHRpb25zLCB0aGlzKTsKICAgICAgdGhpcy5yZWFkYWJsZSA9IHRydWU7CiAgICAgIFN0cmVhbS5jYWxsKHRoaXMpOwogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihjaHVuaywgZW5jb2RpbmcpIHsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICAgICAgaWYgKHV0aWwuaXNTdHJpbmcoY2h1bmspICYmICFzdGF0ZS5vYmplY3RNb2RlKSB7CiAgICAgICAgZW5jb2RpbmcgPSBlbmNvZGluZyB8fCBzdGF0ZS5kZWZhdWx0RW5jb2Rpbmc7CiAgICAgICAgaWYgKGVuY29kaW5nICE9PSBzdGF0ZS5lbmNvZGluZykgewogICAgICAgICAgY2h1bmsgPSBuZXcgQnVmZmVyKGNodW5rLCBlbmNvZGluZyk7CiAgICAgICAgICBlbmNvZGluZyA9ICcnOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVhZGFibGVBZGRDaHVuayh0aGlzLCBzdGF0ZSwgY2h1bmssIGVuY29kaW5nLCBmYWxzZSk7CiAgICB9OwogICAgUmVhZGFibGUucHJvdG90eXBlLnVuc2hpZnQgPSBmdW5jdGlvbihjaHVuaykgewogICAgICB2YXIgc3RhdGUgPSB0aGlzLl9yZWFkYWJsZVN0YXRlOwogICAgICByZXR1cm4gcmVhZGFibGVBZGRDaHVuayh0aGlzLCBzdGF0ZSwgY2h1bmssICcnLCB0cnVlKTsKICAgIH07CiAgICBmdW5jdGlvbiByZWFkYWJsZUFkZENodW5rKHN0cmVhbSwgc3RhdGUsIGNodW5rLCBlbmNvZGluZywgYWRkVG9Gcm9udCkgewogICAgICB2YXIgZXIgPSBjaHVua0ludmFsaWQoc3RhdGUsIGNodW5rKTsKICAgICAgaWYgKGVyKSB7CiAgICAgICAgc3RyZWFtLmVtaXQoJ2Vycm9yJywgZXIpOwogICAgICB9IGVsc2UgaWYgKHV0aWwuaXNOdWxsT3JVbmRlZmluZWQoY2h1bmspKSB7CiAgICAgICAgc3RhdGUucmVhZGluZyA9IGZhbHNlOwogICAgICAgIGlmICghc3RhdGUuZW5kZWQpCiAgICAgICAgICBvbkVvZkNodW5rKHN0cmVhbSwgc3RhdGUpOwogICAgICB9IGVsc2UgaWYgKHN0YXRlLm9iamVjdE1vZGUgfHwgY2h1bmsgJiYgY2h1bmsubGVuZ3RoID4gMCkgewogICAgICAgIGlmIChzdGF0ZS5lbmRlZCAmJiAhYWRkVG9Gcm9udCkgewogICAgICAgICAgdmFyIGUgPSBuZXcgRXJyb3IoJ3N0cmVhbS5wdXNoKCkgYWZ0ZXIgRU9GJyk7CiAgICAgICAgICBzdHJlYW0uZW1pdCgnZXJyb3InLCBlKTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmVuZEVtaXR0ZWQgJiYgYWRkVG9Gcm9udCkgewogICAgICAgICAgdmFyIGUgPSBuZXcgRXJyb3IoJ3N0cmVhbS51bnNoaWZ0KCkgYWZ0ZXIgZW5kIGV2ZW50Jyk7CiAgICAgICAgICBzdHJlYW0uZW1pdCgnZXJyb3InLCBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHN0YXRlLmRlY29kZXIgJiYgIWFkZFRvRnJvbnQgJiYgIWVuY29kaW5nKQogICAgICAgICAgICBjaHVuayA9IHN0YXRlLmRlY29kZXIud3JpdGUoY2h1bmspOwogICAgICAgICAgaWYgKCFhZGRUb0Zyb250KQogICAgICAgICAgICBzdGF0ZS5yZWFkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAoc3RhdGUuZmxvd2luZyAmJiBzdGF0ZS5sZW5ndGggPT09IDAgJiYgIXN0YXRlLnN5bmMpIHsKICAgICAgICAgICAgc3RyZWFtLmVtaXQoJ2RhdGEnLCBjaHVuayk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkKDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUubGVuZ3RoICs9IHN0YXRlLm9iamVjdE1vZGUgPyAxIDogY2h1bmsubGVuZ3RoOwogICAgICAgICAgICBpZiAoYWRkVG9Gcm9udCkKICAgICAgICAgICAgICBzdGF0ZS5idWZmZXIudW5zaGlmdChjaHVuayk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBzdGF0ZS5idWZmZXIucHVzaChjaHVuayk7CiAgICAgICAgICAgIGlmIChzdGF0ZS5uZWVkUmVhZGFibGUpCiAgICAgICAgICAgICAgZW1pdFJlYWRhYmxlKHN0cmVhbSk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXliZVJlYWRNb3JlKHN0cmVhbSwgc3RhdGUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghYWRkVG9Gcm9udCkgewogICAgICAgIHN0YXRlLnJlYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gbmVlZE1vcmVEYXRhKHN0YXRlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG5lZWRNb3JlRGF0YShzdGF0ZSkgewogICAgICByZXR1cm4gIXN0YXRlLmVuZGVkICYmIChzdGF0ZS5uZWVkUmVhZGFibGUgfHwgc3RhdGUubGVuZ3RoIDwgc3RhdGUuaGlnaFdhdGVyTWFyayB8fCBzdGF0ZS5sZW5ndGggPT09IDApOwogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLnNldEVuY29kaW5nID0gZnVuY3Rpb24oZW5jKSB7CiAgICAgIGlmICghU3RyaW5nRGVjb2RlcikKICAgICAgICBTdHJpbmdEZWNvZGVyID0gcmVxdWlyZSgibnBtOnN0cmluZ19kZWNvZGVyQDAuMTAuMzEiKS5TdHJpbmdEZWNvZGVyOwogICAgICB0aGlzLl9yZWFkYWJsZVN0YXRlLmRlY29kZXIgPSBuZXcgU3RyaW5nRGVjb2RlcihlbmMpOwogICAgICB0aGlzLl9yZWFkYWJsZVN0YXRlLmVuY29kaW5nID0gZW5jOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICB2YXIgTUFYX0hXTSA9IDB4ODAwMDAwOwogICAgZnVuY3Rpb24gcm91bmRVcFRvTmV4dFBvd2VyT2YyKG4pIHsKICAgICAgaWYgKG4gPj0gTUFYX0hXTSkgewogICAgICAgIG4gPSBNQVhfSFdNOwogICAgICB9IGVsc2UgewogICAgICAgIG4tLTsKICAgICAgICBmb3IgKHZhciBwID0gMTsgcCA8IDMyOyBwIDw8PSAxKQogICAgICAgICAgbiB8PSBuID4+IHA7CiAgICAgICAgbisrOwogICAgICB9CiAgICAgIHJldHVybiBuOwogICAgfQogICAgZnVuY3Rpb24gaG93TXVjaFRvUmVhZChuLCBzdGF0ZSkgewogICAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwICYmIHN0YXRlLmVuZGVkKQogICAgICAgIHJldHVybiAwOwogICAgICBpZiAoc3RhdGUub2JqZWN0TW9kZSkKICAgICAgICByZXR1cm4gbiA9PT0gMCA/IDAgOiAxOwogICAgICBpZiAoaXNOYU4obikgfHwgdXRpbC5pc051bGwobikpIHsKICAgICAgICBpZiAoc3RhdGUuZmxvd2luZyAmJiBzdGF0ZS5idWZmZXIubGVuZ3RoKQogICAgICAgICAgcmV0dXJuIHN0YXRlLmJ1ZmZlclswXS5sZW5ndGg7CiAgICAgICAgZWxzZQogICAgICAgICAgcmV0dXJuIHN0YXRlLmxlbmd0aDsKICAgICAgfQogICAgICBpZiAobiA8PSAwKQogICAgICAgIHJldHVybiAwOwogICAgICBpZiAobiA+IHN0YXRlLmhpZ2hXYXRlck1hcmspCiAgICAgICAgc3RhdGUuaGlnaFdhdGVyTWFyayA9IHJvdW5kVXBUb05leHRQb3dlck9mMihuKTsKICAgICAgaWYgKG4gPiBzdGF0ZS5sZW5ndGgpIHsKICAgICAgICBpZiAoIXN0YXRlLmVuZGVkKSB7CiAgICAgICAgICBzdGF0ZS5uZWVkUmVhZGFibGUgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICByZXR1cm4gc3RhdGUubGVuZ3RoOwogICAgICB9CiAgICAgIHJldHVybiBuOwogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbihuKSB7CiAgICAgIGRlYnVnKCdyZWFkJywgbik7CiAgICAgIHZhciBzdGF0ZSA9IHRoaXMuX3JlYWRhYmxlU3RhdGU7CiAgICAgIHZhciBuT3JpZyA9IG47CiAgICAgIGlmICghdXRpbC5pc051bWJlcihuKSB8fCBuID4gMCkKICAgICAgICBzdGF0ZS5lbWl0dGVkUmVhZGFibGUgPSBmYWxzZTsKICAgICAgaWYgKG4gPT09IDAgJiYgc3RhdGUubmVlZFJlYWRhYmxlICYmIChzdGF0ZS5sZW5ndGggPj0gc3RhdGUuaGlnaFdhdGVyTWFyayB8fCBzdGF0ZS5lbmRlZCkpIHsKICAgICAgICBkZWJ1ZygncmVhZDogZW1pdFJlYWRhYmxlJywgc3RhdGUubGVuZ3RoLCBzdGF0ZS5lbmRlZCk7CiAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCAmJiBzdGF0ZS5lbmRlZCkKICAgICAgICAgIGVuZFJlYWRhYmxlKHRoaXMpOwogICAgICAgIGVsc2UKICAgICAgICAgIGVtaXRSZWFkYWJsZSh0aGlzKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBuID0gaG93TXVjaFRvUmVhZChuLCBzdGF0ZSk7CiAgICAgIGlmIChuID09PSAwICYmIHN0YXRlLmVuZGVkKSB7CiAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkKICAgICAgICAgIGVuZFJlYWRhYmxlKHRoaXMpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciBkb1JlYWQgPSBzdGF0ZS5uZWVkUmVhZGFibGU7CiAgICAgIGRlYnVnKCduZWVkIHJlYWRhYmxlJywgZG9SZWFkKTsKICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCB8fCBzdGF0ZS5sZW5ndGggLSBuIDwgc3RhdGUuaGlnaFdhdGVyTWFyaykgewogICAgICAgIGRvUmVhZCA9IHRydWU7CiAgICAgICAgZGVidWcoJ2xlbmd0aCBsZXNzIHRoYW4gd2F0ZXJtYXJrJywgZG9SZWFkKTsKICAgICAgfQogICAgICBpZiAoc3RhdGUuZW5kZWQgfHwgc3RhdGUucmVhZGluZykgewogICAgICAgIGRvUmVhZCA9IGZhbHNlOwogICAgICAgIGRlYnVnKCdyZWFkaW5nIG9yIGVuZGVkJywgZG9SZWFkKTsKICAgICAgfQogICAgICBpZiAoZG9SZWFkKSB7CiAgICAgICAgZGVidWcoJ2RvIHJlYWQnKTsKICAgICAgICBzdGF0ZS5yZWFkaW5nID0gdHJ1ZTsKICAgICAgICBzdGF0ZS5zeW5jID0gdHJ1ZTsKICAgICAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKQogICAgICAgICAgc3RhdGUubmVlZFJlYWRhYmxlID0gdHJ1ZTsKICAgICAgICB0aGlzLl9yZWFkKHN0YXRlLmhpZ2hXYXRlck1hcmspOwogICAgICAgIHN0YXRlLnN5bmMgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoZG9SZWFkICYmICFzdGF0ZS5yZWFkaW5nKQogICAgICAgIG4gPSBob3dNdWNoVG9SZWFkKG5PcmlnLCBzdGF0ZSk7CiAgICAgIHZhciByZXQ7CiAgICAgIGlmIChuID4gMCkKICAgICAgICByZXQgPSBmcm9tTGlzdChuLCBzdGF0ZSk7CiAgICAgIGVsc2UKICAgICAgICByZXQgPSBudWxsOwogICAgICBpZiAodXRpbC5pc051bGwocmV0KSkgewogICAgICAgIHN0YXRlLm5lZWRSZWFkYWJsZSA9IHRydWU7CiAgICAgICAgbiA9IDA7CiAgICAgIH0KICAgICAgc3RhdGUubGVuZ3RoIC09IG47CiAgICAgIGlmIChzdGF0ZS5sZW5ndGggPT09IDAgJiYgIXN0YXRlLmVuZGVkKQogICAgICAgIHN0YXRlLm5lZWRSZWFkYWJsZSA9IHRydWU7CiAgICAgIGlmIChuT3JpZyAhPT0gbiAmJiBzdGF0ZS5lbmRlZCAmJiBzdGF0ZS5sZW5ndGggPT09IDApCiAgICAgICAgZW5kUmVhZGFibGUodGhpcyk7CiAgICAgIGlmICghdXRpbC5pc051bGwocmV0KSkKICAgICAgICB0aGlzLmVtaXQoJ2RhdGEnLCByZXQpOwogICAgICByZXR1cm4gcmV0OwogICAgfTsKICAgIGZ1bmN0aW9uIGNodW5rSW52YWxpZChzdGF0ZSwgY2h1bmspIHsKICAgICAgdmFyIGVyID0gbnVsbDsKICAgICAgaWYgKCF1dGlsLmlzQnVmZmVyKGNodW5rKSAmJiAhdXRpbC5pc1N0cmluZyhjaHVuaykgJiYgIXV0aWwuaXNOdWxsT3JVbmRlZmluZWQoY2h1bmspICYmICFzdGF0ZS5vYmplY3RNb2RlKSB7CiAgICAgICAgZXIgPSBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIG5vbi1zdHJpbmcvYnVmZmVyIGNodW5rJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGVyOwogICAgfQogICAgZnVuY3Rpb24gb25Fb2ZDaHVuayhzdHJlYW0sIHN0YXRlKSB7CiAgICAgIGlmIChzdGF0ZS5kZWNvZGVyICYmICFzdGF0ZS5lbmRlZCkgewogICAgICAgIHZhciBjaHVuayA9IHN0YXRlLmRlY29kZXIuZW5kKCk7CiAgICAgICAgaWYgKGNodW5rICYmIGNodW5rLmxlbmd0aCkgewogICAgICAgICAgc3RhdGUuYnVmZmVyLnB1c2goY2h1bmspOwogICAgICAgICAgc3RhdGUubGVuZ3RoICs9IHN0YXRlLm9iamVjdE1vZGUgPyAxIDogY2h1bmsubGVuZ3RoOwogICAgICAgIH0KICAgICAgfQogICAgICBzdGF0ZS5lbmRlZCA9IHRydWU7CiAgICAgIGVtaXRSZWFkYWJsZShzdHJlYW0pOwogICAgfQogICAgZnVuY3Rpb24gZW1pdFJlYWRhYmxlKHN0cmVhbSkgewogICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3JlYWRhYmxlU3RhdGU7CiAgICAgIHN0YXRlLm5lZWRSZWFkYWJsZSA9IGZhbHNlOwogICAgICBpZiAoIXN0YXRlLmVtaXR0ZWRSZWFkYWJsZSkgewogICAgICAgIGRlYnVnKCdlbWl0UmVhZGFibGUnLCBzdGF0ZS5mbG93aW5nKTsKICAgICAgICBzdGF0ZS5lbWl0dGVkUmVhZGFibGUgPSB0cnVlOwogICAgICAgIGlmIChzdGF0ZS5zeW5jKQogICAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgZW1pdFJlYWRhYmxlXyhzdHJlYW0pOwogICAgICAgICAgfSk7CiAgICAgICAgZWxzZQogICAgICAgICAgZW1pdFJlYWRhYmxlXyhzdHJlYW0pOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBlbWl0UmVhZGFibGVfKHN0cmVhbSkgewogICAgICBkZWJ1ZygnZW1pdCByZWFkYWJsZScpOwogICAgICBzdHJlYW0uZW1pdCgncmVhZGFibGUnKTsKICAgICAgZmxvdyhzdHJlYW0pOwogICAgfQogICAgZnVuY3Rpb24gbWF5YmVSZWFkTW9yZShzdHJlYW0sIHN0YXRlKSB7CiAgICAgIGlmICghc3RhdGUucmVhZGluZ01vcmUpIHsKICAgICAgICBzdGF0ZS5yZWFkaW5nTW9yZSA9IHRydWU7CiAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhmdW5jdGlvbigpIHsKICAgICAgICAgIG1heWJlUmVhZE1vcmVfKHN0cmVhbSwgc3RhdGUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtYXliZVJlYWRNb3JlXyhzdHJlYW0sIHN0YXRlKSB7CiAgICAgIHZhciBsZW4gPSBzdGF0ZS5sZW5ndGg7CiAgICAgIHdoaWxlICghc3RhdGUucmVhZGluZyAmJiAhc3RhdGUuZmxvd2luZyAmJiAhc3RhdGUuZW5kZWQgJiYgc3RhdGUubGVuZ3RoIDwgc3RhdGUuaGlnaFdhdGVyTWFyaykgewogICAgICAgIGRlYnVnKCdtYXliZVJlYWRNb3JlIHJlYWQgMCcpOwogICAgICAgIHN0cmVhbS5yZWFkKDApOwogICAgICAgIGlmIChsZW4gPT09IHN0YXRlLmxlbmd0aCkKICAgICAgICAgIGJyZWFrOwogICAgICAgIGVsc2UKICAgICAgICAgIGxlbiA9IHN0YXRlLmxlbmd0aDsKICAgICAgfQogICAgICBzdGF0ZS5yZWFkaW5nTW9yZSA9IGZhbHNlOwogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLl9yZWFkID0gZnVuY3Rpb24obikgewogICAgICB0aGlzLmVtaXQoJ2Vycm9yJywgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKSk7CiAgICB9OwogICAgUmVhZGFibGUucHJvdG90eXBlLnBpcGUgPSBmdW5jdGlvbihkZXN0LCBwaXBlT3B0cykgewogICAgICB2YXIgc3JjID0gdGhpczsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICAgICAgc3dpdGNoIChzdGF0ZS5waXBlc0NvdW50KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgc3RhdGUucGlwZXMgPSBkZXN0OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgc3RhdGUucGlwZXMgPSBbc3RhdGUucGlwZXMsIGRlc3RdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHN0YXRlLnBpcGVzLnB1c2goZGVzdCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBzdGF0ZS5waXBlc0NvdW50ICs9IDE7CiAgICAgIGRlYnVnKCdwaXBlIGNvdW50PSVkIG9wdHM9JWonLCBzdGF0ZS5waXBlc0NvdW50LCBwaXBlT3B0cyk7CiAgICAgIHZhciBkb0VuZCA9ICghcGlwZU9wdHMgfHwgcGlwZU9wdHMuZW5kICE9PSBmYWxzZSkgJiYgZGVzdCAhPT0gcHJvY2Vzcy5zdGRvdXQgJiYgZGVzdCAhPT0gcHJvY2Vzcy5zdGRlcnI7CiAgICAgIHZhciBlbmRGbiA9IGRvRW5kID8gb25lbmQgOiBjbGVhbnVwOwogICAgICBpZiAoc3RhdGUuZW5kRW1pdHRlZCkKICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGVuZEZuKTsKICAgICAgZWxzZQogICAgICAgIHNyYy5vbmNlKCdlbmQnLCBlbmRGbik7CiAgICAgIGRlc3Qub24oJ3VucGlwZScsIG9udW5waXBlKTsKICAgICAgZnVuY3Rpb24gb251bnBpcGUocmVhZGFibGUpIHsKICAgICAgICBkZWJ1Zygnb251bnBpcGUnKTsKICAgICAgICBpZiAocmVhZGFibGUgPT09IHNyYykgewogICAgICAgICAgY2xlYW51cCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBvbmVuZCgpIHsKICAgICAgICBkZWJ1Zygnb25lbmQnKTsKICAgICAgICBkZXN0LmVuZCgpOwogICAgICB9CiAgICAgIHZhciBvbmRyYWluID0gcGlwZU9uRHJhaW4oc3JjKTsKICAgICAgZGVzdC5vbignZHJhaW4nLCBvbmRyYWluKTsKICAgICAgZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgICBkZWJ1ZygnY2xlYW51cCcpOwogICAgICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2Nsb3NlJywgb25jbG9zZSk7CiAgICAgICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZmluaXNoJywgb25maW5pc2gpOwogICAgICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2RyYWluJywgb25kcmFpbik7CiAgICAgICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZXJyb3InLCBvbmVycm9yKTsKICAgICAgICBkZXN0LnJlbW92ZUxpc3RlbmVyKCd1bnBpcGUnLCBvbnVucGlwZSk7CiAgICAgICAgc3JjLnJlbW92ZUxpc3RlbmVyKCdlbmQnLCBvbmVuZCk7CiAgICAgICAgc3JjLnJlbW92ZUxpc3RlbmVyKCdlbmQnLCBjbGVhbnVwKTsKICAgICAgICBzcmMucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCBvbmRhdGEpOwogICAgICAgIGlmIChzdGF0ZS5hd2FpdERyYWluICYmICghZGVzdC5fd3JpdGFibGVTdGF0ZSB8fCBkZXN0Ll93cml0YWJsZVN0YXRlLm5lZWREcmFpbikpCiAgICAgICAgICBvbmRyYWluKCk7CiAgICAgIH0KICAgICAgc3JjLm9uKCdkYXRhJywgb25kYXRhKTsKICAgICAgZnVuY3Rpb24gb25kYXRhKGNodW5rKSB7CiAgICAgICAgZGVidWcoJ29uZGF0YScpOwogICAgICAgIHZhciByZXQgPSBkZXN0LndyaXRlKGNodW5rKTsKICAgICAgICBpZiAoZmFsc2UgPT09IHJldCkgewogICAgICAgICAgZGVidWcoJ2ZhbHNlIHdyaXRlIHJlc3BvbnNlLCBwYXVzZScsIHNyYy5fcmVhZGFibGVTdGF0ZS5hd2FpdERyYWluKTsKICAgICAgICAgIHNyYy5fcmVhZGFibGVTdGF0ZS5hd2FpdERyYWluKys7CiAgICAgICAgICBzcmMucGF1c2UoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb25lcnJvcihlcikgewogICAgICAgIGRlYnVnKCdvbmVycm9yJywgZXIpOwogICAgICAgIHVucGlwZSgpOwogICAgICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2Vycm9yJywgb25lcnJvcik7CiAgICAgICAgaWYgKEVFLmxpc3RlbmVyQ291bnQoZGVzdCwgJ2Vycm9yJykgPT09IDApCiAgICAgICAgICBkZXN0LmVtaXQoJ2Vycm9yJywgZXIpOwogICAgICB9CiAgICAgIGlmICghZGVzdC5fZXZlbnRzIHx8ICFkZXN0Ll9ldmVudHMuZXJyb3IpCiAgICAgICAgZGVzdC5vbignZXJyb3InLCBvbmVycm9yKTsKICAgICAgZWxzZSBpZiAoaXNBcnJheShkZXN0Ll9ldmVudHMuZXJyb3IpKQogICAgICAgIGRlc3QuX2V2ZW50cy5lcnJvci51bnNoaWZ0KG9uZXJyb3IpOwogICAgICBlbHNlCiAgICAgICAgZGVzdC5fZXZlbnRzLmVycm9yID0gW29uZXJyb3IsIGRlc3QuX2V2ZW50cy5lcnJvcl07CiAgICAgIGZ1bmN0aW9uIG9uY2xvc2UoKSB7CiAgICAgICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZmluaXNoJywgb25maW5pc2gpOwogICAgICAgIHVucGlwZSgpOwogICAgICB9CiAgICAgIGRlc3Qub25jZSgnY2xvc2UnLCBvbmNsb3NlKTsKICAgICAgZnVuY3Rpb24gb25maW5pc2goKSB7CiAgICAgICAgZGVidWcoJ29uZmluaXNoJyk7CiAgICAgICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignY2xvc2UnLCBvbmNsb3NlKTsKICAgICAgICB1bnBpcGUoKTsKICAgICAgfQogICAgICBkZXN0Lm9uY2UoJ2ZpbmlzaCcsIG9uZmluaXNoKTsKICAgICAgZnVuY3Rpb24gdW5waXBlKCkgewogICAgICAgIGRlYnVnKCd1bnBpcGUnKTsKICAgICAgICBzcmMudW5waXBlKGRlc3QpOwogICAgICB9CiAgICAgIGRlc3QuZW1pdCgncGlwZScsIHNyYyk7CiAgICAgIGlmICghc3RhdGUuZmxvd2luZykgewogICAgICAgIGRlYnVnKCdwaXBlIHJlc3VtZScpOwogICAgICAgIHNyYy5yZXN1bWUoKTsKICAgICAgfQogICAgICByZXR1cm4gZGVzdDsKICAgIH07CiAgICBmdW5jdGlvbiBwaXBlT25EcmFpbihzcmMpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzdGF0ZSA9IHNyYy5fcmVhZGFibGVTdGF0ZTsKICAgICAgICBkZWJ1ZygncGlwZU9uRHJhaW4nLCBzdGF0ZS5hd2FpdERyYWluKTsKICAgICAgICBpZiAoc3RhdGUuYXdhaXREcmFpbikKICAgICAgICAgIHN0YXRlLmF3YWl0RHJhaW4tLTsKICAgICAgICBpZiAoc3RhdGUuYXdhaXREcmFpbiA9PT0gMCAmJiBFRS5saXN0ZW5lckNvdW50KHNyYywgJ2RhdGEnKSkgewogICAgICAgICAgc3RhdGUuZmxvd2luZyA9IHRydWU7CiAgICAgICAgICBmbG93KHNyYyk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLnVucGlwZSA9IGZ1bmN0aW9uKGRlc3QpIHsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICAgICAgaWYgKHN0YXRlLnBpcGVzQ291bnQgPT09IDApCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIGlmIChzdGF0ZS5waXBlc0NvdW50ID09PSAxKSB7CiAgICAgICAgaWYgKGRlc3QgJiYgZGVzdCAhPT0gc3RhdGUucGlwZXMpCiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICBpZiAoIWRlc3QpCiAgICAgICAgICBkZXN0ID0gc3RhdGUucGlwZXM7CiAgICAgICAgc3RhdGUucGlwZXMgPSBudWxsOwogICAgICAgIHN0YXRlLnBpcGVzQ291bnQgPSAwOwogICAgICAgIHN0YXRlLmZsb3dpbmcgPSBmYWxzZTsKICAgICAgICBpZiAoZGVzdCkKICAgICAgICAgIGRlc3QuZW1pdCgndW5waXBlJywgdGhpcyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgaWYgKCFkZXN0KSB7CiAgICAgICAgdmFyIGRlc3RzID0gc3RhdGUucGlwZXM7CiAgICAgICAgdmFyIGxlbiA9IHN0YXRlLnBpcGVzQ291bnQ7CiAgICAgICAgc3RhdGUucGlwZXMgPSBudWxsOwogICAgICAgIHN0YXRlLnBpcGVzQ291bnQgPSAwOwogICAgICAgIHN0YXRlLmZsb3dpbmcgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgZGVzdHNbaV0uZW1pdCgndW5waXBlJywgdGhpcyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgdmFyIGkgPSBpbmRleE9mKHN0YXRlLnBpcGVzLCBkZXN0KTsKICAgICAgaWYgKGkgPT09IC0xKQogICAgICAgIHJldHVybiB0aGlzOwogICAgICBzdGF0ZS5waXBlcy5zcGxpY2UoaSwgMSk7CiAgICAgIHN0YXRlLnBpcGVzQ291bnQgLT0gMTsKICAgICAgaWYgKHN0YXRlLnBpcGVzQ291bnQgPT09IDEpCiAgICAgICAgc3RhdGUucGlwZXMgPSBzdGF0ZS5waXBlc1swXTsKICAgICAgZGVzdC5lbWl0KCd1bnBpcGUnLCB0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgUmVhZGFibGUucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oZXYsIGZuKSB7CiAgICAgIHZhciByZXMgPSBTdHJlYW0ucHJvdG90eXBlLm9uLmNhbGwodGhpcywgZXYsIGZuKTsKICAgICAgaWYgKGV2ID09PSAnZGF0YScgJiYgZmFsc2UgIT09IHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZykgewogICAgICAgIHRoaXMucmVzdW1lKCk7CiAgICAgIH0KICAgICAgaWYgKGV2ID09PSAncmVhZGFibGUnICYmIHRoaXMucmVhZGFibGUpIHsKICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLl9yZWFkYWJsZVN0YXRlOwogICAgICAgIGlmICghc3RhdGUucmVhZGFibGVMaXN0ZW5pbmcpIHsKICAgICAgICAgIHN0YXRlLnJlYWRhYmxlTGlzdGVuaW5nID0gdHJ1ZTsKICAgICAgICAgIHN0YXRlLmVtaXR0ZWRSZWFkYWJsZSA9IGZhbHNlOwogICAgICAgICAgc3RhdGUubmVlZFJlYWRhYmxlID0gdHJ1ZTsKICAgICAgICAgIGlmICghc3RhdGUucmVhZGluZykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHByb2Nlc3MubmV4dFRpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZGVidWcoJ3JlYWRhYmxlIG5leHR0aWNrIHJlYWQgMCcpOwogICAgICAgICAgICAgIHNlbGYucmVhZCgwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmxlbmd0aCkgewogICAgICAgICAgICBlbWl0UmVhZGFibGUodGhpcywgc3RhdGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzOwogICAgfTsKICAgIFJlYWRhYmxlLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IFJlYWRhYmxlLnByb3RvdHlwZS5vbjsKICAgIFJlYWRhYmxlLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICAgICAgaWYgKCFzdGF0ZS5mbG93aW5nKSB7CiAgICAgICAgZGVidWcoJ3Jlc3VtZScpOwogICAgICAgIHN0YXRlLmZsb3dpbmcgPSB0cnVlOwogICAgICAgIGlmICghc3RhdGUucmVhZGluZykgewogICAgICAgICAgZGVidWcoJ3Jlc3VtZSByZWFkIDAnKTsKICAgICAgICAgIHRoaXMucmVhZCgwKTsKICAgICAgICB9CiAgICAgICAgcmVzdW1lKHRoaXMsIHN0YXRlKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICBmdW5jdGlvbiByZXN1bWUoc3RyZWFtLCBzdGF0ZSkgewogICAgICBpZiAoIXN0YXRlLnJlc3VtZVNjaGVkdWxlZCkgewogICAgICAgIHN0YXRlLnJlc3VtZVNjaGVkdWxlZCA9IHRydWU7CiAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhmdW5jdGlvbigpIHsKICAgICAgICAgIHJlc3VtZV8oc3RyZWFtLCBzdGF0ZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJlc3VtZV8oc3RyZWFtLCBzdGF0ZSkgewogICAgICBzdGF0ZS5yZXN1bWVTY2hlZHVsZWQgPSBmYWxzZTsKICAgICAgc3RyZWFtLmVtaXQoJ3Jlc3VtZScpOwogICAgICBmbG93KHN0cmVhbSk7CiAgICAgIGlmIChzdGF0ZS5mbG93aW5nICYmICFzdGF0ZS5yZWFkaW5nKQogICAgICAgIHN0cmVhbS5yZWFkKDApOwogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7CiAgICAgIGRlYnVnKCdjYWxsIHBhdXNlIGZsb3dpbmc9JWonLCB0aGlzLl9yZWFkYWJsZVN0YXRlLmZsb3dpbmcpOwogICAgICBpZiAoZmFsc2UgIT09IHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZykgewogICAgICAgIGRlYnVnKCdwYXVzZScpOwogICAgICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUuZmxvd2luZyA9IGZhbHNlOwogICAgICAgIHRoaXMuZW1pdCgncGF1c2UnKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICBmdW5jdGlvbiBmbG93KHN0cmVhbSkgewogICAgICB2YXIgc3RhdGUgPSBzdHJlYW0uX3JlYWRhYmxlU3RhdGU7CiAgICAgIGRlYnVnKCdmbG93Jywgc3RhdGUuZmxvd2luZyk7CiAgICAgIGlmIChzdGF0ZS5mbG93aW5nKSB7CiAgICAgICAgZG8gewogICAgICAgICAgdmFyIGNodW5rID0gc3RyZWFtLnJlYWQoKTsKICAgICAgICB9IHdoaWxlIChudWxsICE9PSBjaHVuayAmJiBzdGF0ZS5mbG93aW5nKTsKICAgICAgfQogICAgfQogICAgUmVhZGFibGUucHJvdG90eXBlLndyYXAgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5fcmVhZGFibGVTdGF0ZTsKICAgICAgdmFyIHBhdXNlZCA9IGZhbHNlOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHN0cmVhbS5vbignZW5kJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZGVidWcoJ3dyYXBwZWQgZW5kJyk7CiAgICAgICAgaWYgKHN0YXRlLmRlY29kZXIgJiYgIXN0YXRlLmVuZGVkKSB7CiAgICAgICAgICB2YXIgY2h1bmsgPSBzdGF0ZS5kZWNvZGVyLmVuZCgpOwogICAgICAgICAgaWYgKGNodW5rICYmIGNodW5rLmxlbmd0aCkKICAgICAgICAgICAgc2VsZi5wdXNoKGNodW5rKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5wdXNoKG51bGwpOwogICAgICB9KTsKICAgICAgc3RyZWFtLm9uKCdkYXRhJywgZnVuY3Rpb24oY2h1bmspIHsKICAgICAgICBkZWJ1Zygnd3JhcHBlZCBkYXRhJyk7CiAgICAgICAgaWYgKHN0YXRlLmRlY29kZXIpCiAgICAgICAgICBjaHVuayA9IHN0YXRlLmRlY29kZXIud3JpdGUoY2h1bmspOwogICAgICAgIGlmICghY2h1bmsgfHwgIXN0YXRlLm9iamVjdE1vZGUgJiYgIWNodW5rLmxlbmd0aCkKICAgICAgICAgIHJldHVybiA7CiAgICAgICAgdmFyIHJldCA9IHNlbGYucHVzaChjaHVuayk7CiAgICAgICAgaWYgKCFyZXQpIHsKICAgICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICAgICAgICBzdHJlYW0ucGF1c2UoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBmb3IgKHZhciBpIGluIHN0cmVhbSkgewogICAgICAgIGlmICh1dGlsLmlzRnVuY3Rpb24oc3RyZWFtW2ldKSAmJiB1dGlsLmlzVW5kZWZpbmVkKHRoaXNbaV0pKSB7CiAgICAgICAgICB0aGlzW2ldID0gZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtW21ldGhvZF0uYXBwbHkoc3RyZWFtLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9OwogICAgICAgICAgfShpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGV2ZW50cyA9IFsnZXJyb3InLCAnY2xvc2UnLCAnZGVzdHJveScsICdwYXVzZScsICdyZXN1bWUnXTsKICAgICAgZm9yRWFjaChldmVudHMsIGZ1bmN0aW9uKGV2KSB7CiAgICAgICAgc3RyZWFtLm9uKGV2LCBzZWxmLmVtaXQuYmluZChzZWxmLCBldikpOwogICAgICB9KTsKICAgICAgc2VsZi5fcmVhZCA9IGZ1bmN0aW9uKG4pIHsKICAgICAgICBkZWJ1Zygnd3JhcHBlZCBfcmVhZCcsIG4pOwogICAgICAgIGlmIChwYXVzZWQpIHsKICAgICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgICAgc3RyZWFtLnJlc3VtZSgpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIHNlbGY7CiAgICB9OwogICAgUmVhZGFibGUuX2Zyb21MaXN0ID0gZnJvbUxpc3Q7CiAgICBmdW5jdGlvbiBmcm9tTGlzdChuLCBzdGF0ZSkgewogICAgICB2YXIgbGlzdCA9IHN0YXRlLmJ1ZmZlcjsKICAgICAgdmFyIGxlbmd0aCA9IHN0YXRlLmxlbmd0aDsKICAgICAgdmFyIHN0cmluZ01vZGUgPSAhIXN0YXRlLmRlY29kZXI7CiAgICAgIHZhciBvYmplY3RNb2RlID0gISFzdGF0ZS5vYmplY3RNb2RlOwogICAgICB2YXIgcmV0OwogICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIGlmIChsZW5ndGggPT09IDApCiAgICAgICAgcmV0ID0gbnVsbDsKICAgICAgZWxzZSBpZiAob2JqZWN0TW9kZSkKICAgICAgICByZXQgPSBsaXN0LnNoaWZ0KCk7CiAgICAgIGVsc2UgaWYgKCFuIHx8IG4gPj0gbGVuZ3RoKSB7CiAgICAgICAgaWYgKHN0cmluZ01vZGUpCiAgICAgICAgICByZXQgPSBsaXN0LmpvaW4oJycpOwogICAgICAgIGVsc2UKICAgICAgICAgIHJldCA9IEJ1ZmZlci5jb25jYXQobGlzdCwgbGVuZ3RoKTsKICAgICAgICBsaXN0Lmxlbmd0aCA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKG4gPCBsaXN0WzBdLmxlbmd0aCkgewogICAgICAgICAgdmFyIGJ1ZiA9IGxpc3RbMF07CiAgICAgICAgICByZXQgPSBidWYuc2xpY2UoMCwgbik7CiAgICAgICAgICBsaXN0WzBdID0gYnVmLnNsaWNlKG4pOwogICAgICAgIH0gZWxzZSBpZiAobiA9PT0gbGlzdFswXS5sZW5ndGgpIHsKICAgICAgICAgIHJldCA9IGxpc3Quc2hpZnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHN0cmluZ01vZGUpCiAgICAgICAgICAgIHJldCA9ICcnOwogICAgICAgICAgZWxzZQogICAgICAgICAgICByZXQgPSBuZXcgQnVmZmVyKG4pOwogICAgICAgICAgdmFyIGMgPSAwOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsCiAgICAgICAgICAgICAgbCA9IGxpc3QubGVuZ3RoOyBpIDwgbCAmJiBjIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciBidWYgPSBsaXN0WzBdOwogICAgICAgICAgICB2YXIgY3B5ID0gTWF0aC5taW4obiAtIGMsIGJ1Zi5sZW5ndGgpOwogICAgICAgICAgICBpZiAoc3RyaW5nTW9kZSkKICAgICAgICAgICAgICByZXQgKz0gYnVmLnNsaWNlKDAsIGNweSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBidWYuY29weShyZXQsIGMsIDAsIGNweSk7CiAgICAgICAgICAgIGlmIChjcHkgPCBidWYubGVuZ3RoKQogICAgICAgICAgICAgIGxpc3RbMF0gPSBidWYuc2xpY2UoY3B5KTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIGxpc3Quc2hpZnQoKTsKICAgICAgICAgICAgYyArPSBjcHk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICBmdW5jdGlvbiBlbmRSZWFkYWJsZShzdHJlYW0pIHsKICAgICAgdmFyIHN0YXRlID0gc3RyZWFtLl9yZWFkYWJsZVN0YXRlOwogICAgICBpZiAoc3RhdGUubGVuZ3RoID4gMCkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VuZFJlYWRhYmxlIGNhbGxlZCBvbiBub24tZW1wdHkgc3RyZWFtJyk7CiAgICAgIGlmICghc3RhdGUuZW5kRW1pdHRlZCkgewogICAgICAgIHN0YXRlLmVuZGVkID0gdHJ1ZTsKICAgICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFzdGF0ZS5lbmRFbWl0dGVkICYmIHN0YXRlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBzdGF0ZS5lbmRFbWl0dGVkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHN0cmVhbS5lbWl0KCdlbmQnKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZm9yRWFjaCh4cywgZikgewogICAgICBmb3IgKHZhciBpID0gMCwKICAgICAgICAgIGwgPSB4cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBmKHhzW2ldLCBpKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW5kZXhPZih4cywgeCkgewogICAgICBmb3IgKHZhciBpID0gMCwKICAgICAgICAgIGwgPSB4cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAoeHNbaV0gPT09IHgpCiAgICAgICAgICByZXR1cm4gaTsKICAgICAgfQogICAgICByZXR1cm4gLTE7CiAgICB9CiAgfSkocmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtYnVmZmVyQDAuMS4wIikuQnVmZmVyLCByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIikpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9hc3NpZ24iLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYXNzaWduV2l0aCIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VBc3NpZ24iLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9jcmVhdGVBc3NpZ25lciJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgdmFyIGFzc2lnbldpdGggPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Fzc2lnbldpdGgiKSwKICAgICAgYmFzZUFzc2lnbiA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZUFzc2lnbiIpLAogICAgICBjcmVhdGVBc3NpZ25lciA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvY3JlYXRlQXNzaWduZXIiKTsKICB2YXIgYXNzaWduID0gY3JlYXRlQXNzaWduZXIoZnVuY3Rpb24ob2JqZWN0LCBzb3VyY2UsIGN1c3RvbWl6ZXIpIHsKICAgIHJldHVybiBjdXN0b21pemVyID8gYXNzaWduV2l0aChvYmplY3QsIHNvdXJjZSwgY3VzdG9taXplcikgOiBiYXNlQXNzaWduKG9iamVjdCwgc291cmNlKTsKICB9KTsKICBtb2R1bGUuZXhwb3J0cyA9IGFzc2lnbjsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlQ2FsbGJhY2siLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZU1hdGNoZXMiLCAibnBtOmxvZGFzaEAzLjkuMy9pbnRlcm5hbC9iYXNlTWF0Y2hlc1Byb3BlcnR5IiwgIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmluZENhbGxiYWNrIiwgIm5wbTpsb2Rhc2hAMy45LjMvdXRpbGl0eS9pZGVudGl0eSIsICJucG06bG9kYXNoQDMuOS4zL3V0aWxpdHkvcHJvcGVydHkiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIHZhciBiYXNlTWF0Y2hlcyA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZU1hdGNoZXMiKSwKICAgICAgYmFzZU1hdGNoZXNQcm9wZXJ0eSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYmFzZU1hdGNoZXNQcm9wZXJ0eSIpLAogICAgICBiaW5kQ2FsbGJhY2sgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2JpbmRDYWxsYmFjayIpLAogICAgICBpZGVudGl0eSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvdXRpbGl0eS9pZGVudGl0eSIpLAogICAgICBwcm9wZXJ0eSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvdXRpbGl0eS9wcm9wZXJ0eSIpOwogIGZ1bmN0aW9uIGJhc2VDYWxsYmFjayhmdW5jLCB0aGlzQXJnLCBhcmdDb3VudCkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgZnVuYzsKICAgIGlmICh0eXBlID09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuIHRoaXNBcmcgPT09IHVuZGVmaW5lZCA/IGZ1bmMgOiBiaW5kQ2FsbGJhY2soZnVuYywgdGhpc0FyZywgYXJnQ291bnQpOwogICAgfQogICAgaWYgKGZ1bmMgPT0gbnVsbCkgewogICAgICByZXR1cm4gaWRlbnRpdHk7CiAgICB9CiAgICBpZiAodHlwZSA9PSAnb2JqZWN0JykgewogICAgICByZXR1cm4gYmFzZU1hdGNoZXMoZnVuYyk7CiAgICB9CiAgICByZXR1cm4gdGhpc0FyZyA9PT0gdW5kZWZpbmVkID8gcHJvcGVydHkoZnVuYykgOiBiYXNlTWF0Y2hlc1Byb3BlcnR5KGZ1bmMsIHRoaXNBcmcpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGJhc2VDYWxsYmFjazsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvcmVhZGFibGUiLCBbIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3JlYWRhYmxlIiwgIm5wbTpzdHJlYW0tYnJvd3NlcmlmeUAxLjAuMC9pbmRleCIsICJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV93cml0YWJsZSIsICJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9kdXBsZXgiLCAibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvbGliL19zdHJlYW1fdHJhbnNmb3JtIiwgIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3Bhc3N0aHJvdWdoIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9yZWFkYWJsZSIpOwogIGV4cG9ydHMuU3RyZWFtID0gcmVxdWlyZSgibnBtOnN0cmVhbS1icm93c2VyaWZ5QDEuMC4wL2luZGV4Iik7CiAgZXhwb3J0cy5SZWFkYWJsZSA9IGV4cG9ydHM7CiAgZXhwb3J0cy5Xcml0YWJsZSA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3dyaXRhYmxlIik7CiAgZXhwb3J0cy5EdXBsZXggPSByZXF1aXJlKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9kdXBsZXgiKTsKICBleHBvcnRzLlRyYW5zZm9ybSA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL2xpYi9fc3RyZWFtX3RyYW5zZm9ybSIpOwogIGV4cG9ydHMuUGFzc1Rocm91Z2ggPSByZXF1aXJlKCJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9saWIvX3N0cmVhbV9wYXNzdGhyb3VnaCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06bG9kYXNoQDMuOS4zL2NvbGxlY3Rpb24vZXZlcnkiLCBbIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYXJyYXlFdmVyeSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VDYWxsYmFjayIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VFdmVyeSIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIsICJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzSXRlcmF0ZWVDYWxsIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICB2YXIgYXJyYXlFdmVyeSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvaW50ZXJuYWwvYXJyYXlFdmVyeSIpLAogICAgICBiYXNlQ2FsbGJhY2sgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VDYWxsYmFjayIpLAogICAgICBiYXNlRXZlcnkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2Jhc2VFdmVyeSIpLAogICAgICBpc0FycmF5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzQXJyYXkiKSwKICAgICAgaXNJdGVyYXRlZUNhbGwgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2ludGVybmFsL2lzSXRlcmF0ZWVDYWxsIik7CiAgZnVuY3Rpb24gZXZlcnkoY29sbGVjdGlvbiwgcHJlZGljYXRlLCB0aGlzQXJnKSB7CiAgICB2YXIgZnVuYyA9IGlzQXJyYXkoY29sbGVjdGlvbikgPyBhcnJheUV2ZXJ5IDogYmFzZUV2ZXJ5OwogICAgaWYgKHRoaXNBcmcgJiYgaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgcHJlZGljYXRlLCB0aGlzQXJnKSkgewogICAgICBwcmVkaWNhdGUgPSBudWxsOwogICAgfQogICAgaWYgKHR5cGVvZiBwcmVkaWNhdGUgIT0gJ2Z1bmN0aW9uJyB8fCB0aGlzQXJnICE9PSB1bmRlZmluZWQpIHsKICAgICAgcHJlZGljYXRlID0gYmFzZUNhbGxiYWNrKHByZWRpY2F0ZSwgdGhpc0FyZywgMyk7CiAgICB9CiAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBwcmVkaWNhdGUpOwogIH0KICBtb2R1bGUuZXhwb3J0cyA9IGV2ZXJ5OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06c3RyZWFtLWJyb3dzZXJpZnlAMS4wLjAvaW5kZXgiLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLWV2ZW50c0AwLjEuMSIsICJucG06aW5oZXJpdHNAMi4wLjEiLCAibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvcmVhZGFibGUiLCAibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvd3JpdGFibGUiLCAibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvZHVwbGV4IiwgIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL3RyYW5zZm9ybSIsICJucG06cmVhZGFibGUtc3RyZWFtQDEuMS4xMy9wYXNzdGhyb3VnaCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgbW9kdWxlLmV4cG9ydHMgPSBTdHJlYW07CiAgdmFyIEVFID0gcmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtZXZlbnRzQDAuMS4xIikuRXZlbnRFbWl0dGVyOwogIHZhciBpbmhlcml0cyA9IHJlcXVpcmUoIm5wbTppbmhlcml0c0AyLjAuMSIpOwogIGluaGVyaXRzKFN0cmVhbSwgRUUpOwogIFN0cmVhbS5SZWFkYWJsZSA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL3JlYWRhYmxlIik7CiAgU3RyZWFtLldyaXRhYmxlID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvd3JpdGFibGUiKTsKICBTdHJlYW0uRHVwbGV4ID0gcmVxdWlyZSgibnBtOnJlYWRhYmxlLXN0cmVhbUAxLjEuMTMvZHVwbGV4Iik7CiAgU3RyZWFtLlRyYW5zZm9ybSA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL3RyYW5zZm9ybSIpOwogIFN0cmVhbS5QYXNzVGhyb3VnaCA9IHJlcXVpcmUoIm5wbTpyZWFkYWJsZS1zdHJlYW1AMS4xLjEzL3Bhc3N0aHJvdWdoIik7CiAgU3RyZWFtLlN0cmVhbSA9IFN0cmVhbTsKICBmdW5jdGlvbiBTdHJlYW0oKSB7CiAgICBFRS5jYWxsKHRoaXMpOwogIH0KICBTdHJlYW0ucHJvdG90eXBlLnBpcGUgPSBmdW5jdGlvbihkZXN0LCBvcHRpb25zKSB7CiAgICB2YXIgc291cmNlID0gdGhpczsKICAgIGZ1bmN0aW9uIG9uZGF0YShjaHVuaykgewogICAgICBpZiAoZGVzdC53cml0YWJsZSkgewogICAgICAgIGlmIChmYWxzZSA9PT0gZGVzdC53cml0ZShjaHVuaykgJiYgc291cmNlLnBhdXNlKSB7CiAgICAgICAgICBzb3VyY2UucGF1c2UoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHNvdXJjZS5vbignZGF0YScsIG9uZGF0YSk7CiAgICBmdW5jdGlvbiBvbmRyYWluKCkgewogICAgICBpZiAoc291cmNlLnJlYWRhYmxlICYmIHNvdXJjZS5yZXN1bWUpIHsKICAgICAgICBzb3VyY2UucmVzdW1lKCk7CiAgICAgIH0KICAgIH0KICAgIGRlc3Qub24oJ2RyYWluJywgb25kcmFpbik7CiAgICBpZiAoIWRlc3QuX2lzU3RkaW8gJiYgKCFvcHRpb25zIHx8IG9wdGlvbnMuZW5kICE9PSBmYWxzZSkpIHsKICAgICAgc291cmNlLm9uKCdlbmQnLCBvbmVuZCk7CiAgICAgIHNvdXJjZS5vbignY2xvc2UnLCBvbmNsb3NlKTsKICAgIH0KICAgIHZhciBkaWRPbkVuZCA9IGZhbHNlOwogICAgZnVuY3Rpb24gb25lbmQoKSB7CiAgICAgIGlmIChkaWRPbkVuZCkKICAgICAgICByZXR1cm4gOwogICAgICBkaWRPbkVuZCA9IHRydWU7CiAgICAgIGRlc3QuZW5kKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvbmNsb3NlKCkgewogICAgICBpZiAoZGlkT25FbmQpCiAgICAgICAgcmV0dXJuIDsKICAgICAgZGlkT25FbmQgPSB0cnVlOwogICAgICBpZiAodHlwZW9mIGRlc3QuZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykKICAgICAgICBkZXN0LmRlc3Ryb3koKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uZXJyb3IoZXIpIHsKICAgICAgY2xlYW51cCgpOwogICAgICBpZiAoRUUubGlzdGVuZXJDb3VudCh0aGlzLCAnZXJyb3InKSA9PT0gMCkgewogICAgICAgIHRocm93IGVyOwogICAgICB9CiAgICB9CiAgICBzb3VyY2Uub24oJ2Vycm9yJywgb25lcnJvcik7CiAgICBkZXN0Lm9uKCdlcnJvcicsIG9uZXJyb3IpOwogICAgZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgc291cmNlLnJlbW92ZUxpc3RlbmVyKCdkYXRhJywgb25kYXRhKTsKICAgICAgZGVzdC5yZW1vdmVMaXN0ZW5lcignZHJhaW4nLCBvbmRyYWluKTsKICAgICAgc291cmNlLnJlbW92ZUxpc3RlbmVyKCdlbmQnLCBvbmVuZCk7CiAgICAgIHNvdXJjZS5yZW1vdmVMaXN0ZW5lcignY2xvc2UnLCBvbmNsb3NlKTsKICAgICAgc291cmNlLnJlbW92ZUxpc3RlbmVyKCdlcnJvcicsIG9uZXJyb3IpOwogICAgICBkZXN0LnJlbW92ZUxpc3RlbmVyKCdlcnJvcicsIG9uZXJyb3IpOwogICAgICBzb3VyY2UucmVtb3ZlTGlzdGVuZXIoJ2VuZCcsIGNsZWFudXApOwogICAgICBzb3VyY2UucmVtb3ZlTGlzdGVuZXIoJ2Nsb3NlJywgY2xlYW51cCk7CiAgICAgIGRlc3QucmVtb3ZlTGlzdGVuZXIoJ2Nsb3NlJywgY2xlYW51cCk7CiAgICB9CiAgICBzb3VyY2Uub24oJ2VuZCcsIGNsZWFudXApOwogICAgc291cmNlLm9uKCdjbG9zZScsIGNsZWFudXApOwogICAgZGVzdC5vbignY2xvc2UnLCBjbGVhbnVwKTsKICAgIGRlc3QuZW1pdCgncGlwZScsIHNvdXJjZSk7CiAgICByZXR1cm4gZGVzdDsKICB9OwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRWxlbWVudCIsIFsibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIsICJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNGdW5jdGlvbiIsICJucG06bG9kYXNoQDMuOS4zL2NvbGxlY3Rpb24vZXZlcnkiLCAibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTE5vZGUiLCAibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTEF0dHJpYnV0ZSIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MUHJvY2Vzc2luZ0luc3RydWN0aW9uIl0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgWE1MQXR0cmlidXRlLAogICAgICAgIFhNTEVsZW1lbnQsCiAgICAgICAgWE1MTm9kZSwKICAgICAgICBYTUxQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24sCiAgICAgICAgY3JlYXRlLAogICAgICAgIGV2ZXJ5LAogICAgICAgIGlzQXJyYXksCiAgICAgICAgaXNGdW5jdGlvbiwKICAgICAgICBpc09iamVjdCwKICAgICAgICBleHRlbmQgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7CiAgICAgICAgICAgIGlmIChoYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKQogICAgICAgICAgICAgIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsKICAgICAgICAgIH0KICAgICAgICAgIGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsKICAgICAgICAgIGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7CiAgICAgICAgICBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOwogICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgIH0sCiAgICAgICAgaGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5OwogICAgY3JlYXRlID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIik7CiAgICBpc09iamVjdCA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIpOwogICAgaXNBcnJheSA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FycmF5Iik7CiAgICBpc0Z1bmN0aW9uID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzRnVuY3Rpb24iKTsKICAgIGV2ZXJ5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9jb2xsZWN0aW9uL2V2ZXJ5Iik7CiAgICBYTUxOb2RlID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTE5vZGUiKTsKICAgIFhNTEF0dHJpYnV0ZSA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxBdHRyaWJ1dGUiKTsKICAgIFhNTFByb2Nlc3NpbmdJbnN0cnVjdGlvbiA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24iKTsKICAgIG1vZHVsZS5leHBvcnRzID0gWE1MRWxlbWVudCA9IChmdW5jdGlvbihzdXBlckNsYXNzKSB7CiAgICAgIGV4dGVuZChYTUxFbGVtZW50LCBzdXBlckNsYXNzKTsKICAgICAgZnVuY3Rpb24gWE1MRWxlbWVudChwYXJlbnQsIG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgICAgICBYTUxFbGVtZW50Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmVudCk7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIGVsZW1lbnQgbmFtZSIpOwogICAgICAgIH0KICAgICAgICB0aGlzLm5hbWUgPSB0aGlzLnN0cmluZ2lmeS5lbGVOYW1lKG5hbWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgICAgICB0aGlzLmluc3RydWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgICAgIGlmIChhdHRyaWJ1dGVzICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMuYXR0cmlidXRlKGF0dHJpYnV0ZXMpOwogICAgICAgIH0KICAgICAgfQogICAgICBYTUxFbGVtZW50LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhdHQsCiAgICAgICAgICAgIGF0dE5hbWUsCiAgICAgICAgICAgIGNsb25lZFNlbGYsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgcGksCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgcmVmMTsKICAgICAgICBjbG9uZWRTZWxmID0gY3JlYXRlKFhNTEVsZW1lbnQucHJvdG90eXBlLCB0aGlzKTsKICAgICAgICBpZiAoY2xvbmVkU2VsZi5pc1Jvb3QpIHsKICAgICAgICAgIGNsb25lZFNlbGYuZG9jdW1lbnRPYmplY3QgPSBudWxsOwogICAgICAgIH0KICAgICAgICBjbG9uZWRTZWxmLmF0dHJpYnV0ZXMgPSB7fTsKICAgICAgICByZWYgPSB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgICAgZm9yIChhdHROYW1lIGluIHJlZikgewogICAgICAgICAgaWYgKCFoYXNQcm9wLmNhbGwocmVmLCBhdHROYW1lKSkKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBhdHQgPSByZWZbYXR0TmFtZV07CiAgICAgICAgICBjbG9uZWRTZWxmLmF0dHJpYnV0ZXNbYXR0TmFtZV0gPSBhdHQuY2xvbmUoKTsKICAgICAgICB9CiAgICAgICAgY2xvbmVkU2VsZi5pbnN0cnVjdGlvbnMgPSBbXTsKICAgICAgICByZWYxID0gdGhpcy5pbnN0cnVjdGlvbnM7CiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcmVmMS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgcGkgPSByZWYxW2ldOwogICAgICAgICAgY2xvbmVkU2VsZi5pbnN0cnVjdGlvbnMucHVzaChwaS5jbG9uZSgpKTsKICAgICAgICB9CiAgICAgICAgY2xvbmVkU2VsZi5jaGlsZHJlbiA9IFtdOwogICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihjaGlsZCkgewogICAgICAgICAgdmFyIGNsb25lZENoaWxkOwogICAgICAgICAgY2xvbmVkQ2hpbGQgPSBjaGlsZC5jbG9uZSgpOwogICAgICAgICAgY2xvbmVkQ2hpbGQucGFyZW50ID0gY2xvbmVkU2VsZjsKICAgICAgICAgIHJldHVybiBjbG9uZWRTZWxmLmNoaWxkcmVuLnB1c2goY2xvbmVkQ2hpbGQpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBjbG9uZWRTZWxmOwogICAgICB9OwogICAgICBYTUxFbGVtZW50LnByb3RvdHlwZS5hdHRyaWJ1dGUgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgIHZhciBhdHROYW1lLAogICAgICAgICAgICBhdHRWYWx1ZTsKICAgICAgICBpZiAobmFtZSAhPSBudWxsKSB7CiAgICAgICAgICBuYW1lID0gbmFtZS52YWx1ZU9mKCk7CiAgICAgICAgfQogICAgICAgIGlmIChpc09iamVjdChuYW1lKSkgewogICAgICAgICAgZm9yIChhdHROYW1lIGluIG5hbWUpIHsKICAgICAgICAgICAgaWYgKCFoYXNQcm9wLmNhbGwobmFtZSwgYXR0TmFtZSkpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGF0dFZhbHVlID0gbmFtZVthdHROYW1lXTsKICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGUoYXR0TmFtZSwgYXR0VmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaXNGdW5jdGlvbih2YWx1ZSkpIHsKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5hcHBseSgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2tpcE51bGxBdHRyaWJ1dGVzIHx8ICh2YWx1ZSAhPSBudWxsKSkgewogICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXNbbmFtZV0gPSBuZXcgWE1MQXR0cmlidXRlKHRoaXMsIG5hbWUsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTEVsZW1lbnQucHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICB2YXIgYXR0TmFtZSwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgbGVuOwogICAgICAgIGlmIChuYW1lID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBhdHRyaWJ1dGUgbmFtZSIpOwogICAgICAgIH0KICAgICAgICBuYW1lID0gbmFtZS52YWx1ZU9mKCk7CiAgICAgICAgaWYgKGlzQXJyYXkobmFtZSkpIHsKICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG5hbWUubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgYXR0TmFtZSA9IG5hbWVbaV07CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbYXR0TmFtZV07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbbmFtZV07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBYTUxFbGVtZW50LnByb3RvdHlwZS5pbnN0cnVjdGlvbiA9IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgaW5zVGFyZ2V0LAogICAgICAgICAgICBpbnNWYWx1ZSwKICAgICAgICAgICAgaW5zdHJ1Y3Rpb24sCiAgICAgICAgICAgIGxlbjsKICAgICAgICBpZiAodGFyZ2V0ICE9IG51bGwpIHsKICAgICAgICAgIHRhcmdldCA9IHRhcmdldC52YWx1ZU9mKCk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnZhbHVlT2YoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQXJyYXkodGFyZ2V0KSkgewogICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gdGFyZ2V0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGluc1RhcmdldCA9IHRhcmdldFtpXTsKICAgICAgICAgICAgdGhpcy5pbnN0cnVjdGlvbihpbnNUYXJnZXQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QodGFyZ2V0KSkgewogICAgICAgICAgZm9yIChpbnNUYXJnZXQgaW4gdGFyZ2V0KSB7CiAgICAgICAgICAgIGlmICghaGFzUHJvcC5jYWxsKHRhcmdldCwgaW5zVGFyZ2V0KSkKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaW5zVmFsdWUgPSB0YXJnZXRbaW5zVGFyZ2V0XTsKICAgICAgICAgICAgdGhpcy5pbnN0cnVjdGlvbihpbnNUYXJnZXQsIGluc1ZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGlzRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuYXBwbHkoKTsKICAgICAgICAgIH0KICAgICAgICAgIGluc3RydWN0aW9uID0gbmV3IFhNTFByb2Nlc3NpbmdJbnN0cnVjdGlvbih0aGlzLCB0YXJnZXQsIHZhbHVlKTsKICAgICAgICAgIHRoaXMuaW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgWE1MRWxlbWVudC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbihvcHRpb25zLCBsZXZlbCkgewogICAgICAgIHZhciBhdHQsCiAgICAgICAgICAgIGNoaWxkLAogICAgICAgICAgICBpLAogICAgICAgICAgICBpbmRlbnQsCiAgICAgICAgICAgIGluc3RydWN0aW9uLAogICAgICAgICAgICBqLAogICAgICAgICAgICBsZW4sCiAgICAgICAgICAgIGxlbjEsCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG5ld2xpbmUsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgcHJldHR5LAogICAgICAgICAgICByLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHJlZjEsCiAgICAgICAgICAgIHJlZjIsCiAgICAgICAgICAgIHJlZjMsCiAgICAgICAgICAgIHJlZjQsCiAgICAgICAgICAgIHJlZjUsCiAgICAgICAgICAgIHNwYWNlOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgbGV2ZWwgfHwgKGxldmVsID0gMCk7CiAgICAgICAgc3BhY2UgPSBuZXcgQXJyYXkobGV2ZWwgKyBvZmZzZXQgKyAxKS5qb2luKGluZGVudCk7CiAgICAgICAgciA9ICcnOwogICAgICAgIHJlZjMgPSB0aGlzLmluc3RydWN0aW9uczsKICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSByZWYzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBpbnN0cnVjdGlvbiA9IHJlZjNbaV07CiAgICAgICAgICByICs9IGluc3RydWN0aW9uLnRvU3RyaW5nKG9wdGlvbnMsIGxldmVsICsgMSk7CiAgICAgICAgfQogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgfQogICAgICAgIHIgKz0gJzwnICsgdGhpcy5uYW1lOwogICAgICAgIHJlZjQgPSB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgICAgZm9yIChuYW1lIGluIHJlZjQpIHsKICAgICAgICAgIGlmICghaGFzUHJvcC5jYWxsKHJlZjQsIG5hbWUpKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGF0dCA9IHJlZjRbbmFtZV07CiAgICAgICAgICByICs9IGF0dC50b1N0cmluZyhvcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID09PSAwIHx8IGV2ZXJ5KHRoaXMuY2hpbGRyZW4sIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIHJldHVybiBlLnZhbHVlID09PSAnJzsKICAgICAgICB9KSkgewogICAgICAgICAgciArPSAnLz4nOwogICAgICAgICAgaWYgKHByZXR0eSkgewogICAgICAgICAgICByICs9IG5ld2xpbmU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChwcmV0dHkgJiYgdGhpcy5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgKHRoaXMuY2hpbGRyZW5bMF0udmFsdWUgIT0gbnVsbCkpIHsKICAgICAgICAgIHIgKz0gJz4nOwogICAgICAgICAgciArPSB0aGlzLmNoaWxkcmVuWzBdLnZhbHVlOwogICAgICAgICAgciArPSAnPC8nICsgdGhpcy5uYW1lICsgJz4nOwogICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByICs9ICc+JzsKICAgICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgICAgciArPSBuZXdsaW5lOwogICAgICAgICAgfQogICAgICAgICAgcmVmNSA9IHRoaXMuY2hpbGRyZW47CiAgICAgICAgICBmb3IgKGogPSAwLCBsZW4xID0gcmVmNS5sZW5ndGg7IGogPCBsZW4xOyBqKyspIHsKICAgICAgICAgICAgY2hpbGQgPSByZWY1W2pdOwogICAgICAgICAgICByICs9IGNoaWxkLnRvU3RyaW5nKG9wdGlvbnMsIGxldmVsICsgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICAgIHIgKz0gc3BhY2U7CiAgICAgICAgICB9CiAgICAgICAgICByICs9ICc8LycgKyB0aGlzLm5hbWUgKyAnPic7CiAgICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICAgIHIgKz0gbmV3bGluZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH07CiAgICAgIFhNTEVsZW1lbnQucHJvdG90eXBlLmF0dCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlKG5hbWUsIHZhbHVlKTsKICAgICAgfTsKICAgICAgWE1MRWxlbWVudC5wcm90b3R5cGUuaW5zID0gZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmluc3RydWN0aW9uKHRhcmdldCwgdmFsdWUpOwogICAgICB9OwogICAgICBYTUxFbGVtZW50LnByb3RvdHlwZS5hID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGUobmFtZSwgdmFsdWUpOwogICAgICB9OwogICAgICBYTUxFbGVtZW50LnByb3RvdHlwZS5pID0gZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmluc3RydWN0aW9uKHRhcmdldCwgdmFsdWUpOwogICAgICB9OwogICAgICByZXR1cm4gWE1MRWxlbWVudDsKICAgIH0pKFhNTE5vZGUpOwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTpzdHJlYW0tYnJvd3NlcmlmeUAxLjAuMCIsIFsibnBtOnN0cmVhbS1icm93c2VyaWZ5QDEuMC4wL2luZGV4Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoIm5wbTpzdHJlYW0tYnJvd3NlcmlmeUAxLjAuMC9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MTm9kZSIsIFsibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0IiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0FycmF5IiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0Z1bmN0aW9uIiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0VtcHR5IiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxFbGVtZW50IiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxDRGF0YSIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MQ29tbWVudCIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRGVjbGFyYXRpb24iLCAibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERvY1R5cGUiLCAibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTFJhdyIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MVGV4dCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTENEYXRhLAogICAgICAgIFhNTENvbW1lbnQsCiAgICAgICAgWE1MRGVjbGFyYXRpb24sCiAgICAgICAgWE1MRG9jVHlwZSwKICAgICAgICBYTUxFbGVtZW50LAogICAgICAgIFhNTE5vZGUsCiAgICAgICAgWE1MUmF3LAogICAgICAgIFhNTFRleHQsCiAgICAgICAgaXNBcnJheSwKICAgICAgICBpc0VtcHR5LAogICAgICAgIGlzRnVuY3Rpb24sCiAgICAgICAgaXNPYmplY3QsCiAgICAgICAgaGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5OwogICAgaXNPYmplY3QgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNPYmplY3QiKTsKICAgIGlzQXJyYXkgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL2xhbmcvaXNBcnJheSIpOwogICAgaXNGdW5jdGlvbiA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc0Z1bmN0aW9uIik7CiAgICBpc0VtcHR5ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzRW1wdHkiKTsKICAgIFhNTEVsZW1lbnQgPSBudWxsOwogICAgWE1MQ0RhdGEgPSBudWxsOwogICAgWE1MQ29tbWVudCA9IG51bGw7CiAgICBYTUxEZWNsYXJhdGlvbiA9IG51bGw7CiAgICBYTUxEb2NUeXBlID0gbnVsbDsKICAgIFhNTFJhdyA9IG51bGw7CiAgICBYTUxUZXh0ID0gbnVsbDsKICAgIG1vZHVsZS5leHBvcnRzID0gWE1MTm9kZSA9IChmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gWE1MTm9kZShwYXJlbnQpIHsKICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAgICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLnBhcmVudC5vcHRpb25zOwogICAgICAgIHRoaXMuc3RyaW5naWZ5ID0gdGhpcy5wYXJlbnQuc3RyaW5naWZ5OwogICAgICAgIGlmIChYTUxFbGVtZW50ID09PSBudWxsKSB7CiAgICAgICAgICBYTUxFbGVtZW50ID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTEVsZW1lbnQiKTsKICAgICAgICAgIFhNTENEYXRhID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTENEYXRhIik7CiAgICAgICAgICBYTUxDb21tZW50ID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTENvbW1lbnQiKTsKICAgICAgICAgIFhNTERlY2xhcmF0aW9uID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERlY2xhcmF0aW9uIik7CiAgICAgICAgICBYTUxEb2NUeXBlID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERvY1R5cGUiKTsKICAgICAgICAgIFhNTFJhdyA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxSYXciKTsKICAgICAgICAgIFhNTFRleHQgPSByZXF1aXJlKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MVGV4dCIpOwogICAgICAgIH0KICAgICAgfQogICAgICBYTUxOb2RlLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGNsb25lIGdlbmVyaWMgWE1MTm9kZSIpOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5lbGVtZW50ID0gZnVuY3Rpb24obmFtZSwgYXR0cmlidXRlcywgdGV4dCkgewogICAgICAgIHZhciBpdGVtLAogICAgICAgICAgICBqLAogICAgICAgICAgICBrZXksCiAgICAgICAgICAgIGxhc3RDaGlsZCwKICAgICAgICAgICAgbGVuLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHZhbDsKICAgICAgICBsYXN0Q2hpbGQgPSBudWxsOwogICAgICAgIGlmIChhdHRyaWJ1dGVzID09IG51bGwpIHsKICAgICAgICAgIGF0dHJpYnV0ZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXMudmFsdWVPZigpOwogICAgICAgIGlmICghaXNPYmplY3QoYXR0cmlidXRlcykpIHsKICAgICAgICAgIHJlZiA9IFthdHRyaWJ1dGVzLCB0ZXh0XSwgdGV4dCA9IHJlZlswXSwgYXR0cmlidXRlcyA9IHJlZlsxXTsKICAgICAgICB9CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCkgewogICAgICAgICAgbmFtZSA9IG5hbWUudmFsdWVPZigpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNBcnJheShuYW1lKSkgewogICAgICAgICAgZm9yIChqID0gMCwgbGVuID0gbmFtZS5sZW5ndGg7IGogPCBsZW47IGorKykgewogICAgICAgICAgICBpdGVtID0gbmFtZVtqXTsKICAgICAgICAgICAgbGFzdENoaWxkID0gdGhpcy5lbGVtZW50KGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNGdW5jdGlvbihuYW1lKSkgewogICAgICAgICAgbGFzdENoaWxkID0gdGhpcy5lbGVtZW50KG5hbWUuYXBwbHkoKSk7CiAgICAgICAgfSBlbHNlIGlmIChpc09iamVjdChuYW1lKSkgewogICAgICAgICAgZm9yIChrZXkgaW4gbmFtZSkgewogICAgICAgICAgICBpZiAoIWhhc1Byb3AuY2FsbChuYW1lLCBrZXkpKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB2YWwgPSBuYW1lW2tleV07CiAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKHZhbCkpIHsKICAgICAgICAgICAgICB2YWwgPSB2YWwuYXBwbHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGlzT2JqZWN0KHZhbCkpICYmIChpc0VtcHR5KHZhbCkpKSB7CiAgICAgICAgICAgICAgdmFsID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVEZWNvcmF0b3JzICYmIHRoaXMuc3RyaW5naWZ5LmNvbnZlcnRBdHRLZXkgJiYga2V5LmluZGV4T2YodGhpcy5zdHJpbmdpZnkuY29udmVydEF0dEtleSkgPT09IDApIHsKICAgICAgICAgICAgICBsYXN0Q2hpbGQgPSB0aGlzLmF0dHJpYnV0ZShrZXkuc3Vic3RyKHRoaXMuc3RyaW5naWZ5LmNvbnZlcnRBdHRLZXkubGVuZ3RoKSwgdmFsKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZURlY29yYXRvcnMgJiYgdGhpcy5zdHJpbmdpZnkuY29udmVydFBJS2V5ICYmIGtleS5pbmRleE9mKHRoaXMuc3RyaW5naWZ5LmNvbnZlcnRQSUtleSkgPT09IDApIHsKICAgICAgICAgICAgICBsYXN0Q2hpbGQgPSB0aGlzLmluc3RydWN0aW9uKGtleS5zdWJzdHIodGhpcy5zdHJpbmdpZnkuY29udmVydFBJS2V5Lmxlbmd0aCksIHZhbCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QodmFsKSkgewogICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZURlY29yYXRvcnMgJiYgdGhpcy5zdHJpbmdpZnkuY29udmVydExpc3RLZXkgJiYga2V5LmluZGV4T2YodGhpcy5zdHJpbmdpZnkuY29udmVydExpc3RLZXkpID09PSAwICYmIGlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgbGFzdENoaWxkID0gdGhpcy5lbGVtZW50KHZhbCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxhc3RDaGlsZCA9IHRoaXMuZWxlbWVudChrZXkpOwogICAgICAgICAgICAgICAgbGFzdENoaWxkLmVsZW1lbnQodmFsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbGFzdENoaWxkID0gdGhpcy5lbGVtZW50KGtleSwgdmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVEZWNvcmF0b3JzICYmIHRoaXMuc3RyaW5naWZ5LmNvbnZlcnRUZXh0S2V5ICYmIG5hbWUuaW5kZXhPZih0aGlzLnN0cmluZ2lmeS5jb252ZXJ0VGV4dEtleSkgPT09IDApIHsKICAgICAgICAgICAgbGFzdENoaWxkID0gdGhpcy50ZXh0KHRleHQpOwogICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZURlY29yYXRvcnMgJiYgdGhpcy5zdHJpbmdpZnkuY29udmVydENEYXRhS2V5ICYmIG5hbWUuaW5kZXhPZih0aGlzLnN0cmluZ2lmeS5jb252ZXJ0Q0RhdGFLZXkpID09PSAwKSB7CiAgICAgICAgICAgIGxhc3RDaGlsZCA9IHRoaXMuY2RhdGEodGV4dCk7CiAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLm9wdGlvbnMuaWdub3JlRGVjb3JhdG9ycyAmJiB0aGlzLnN0cmluZ2lmeS5jb252ZXJ0Q29tbWVudEtleSAmJiBuYW1lLmluZGV4T2YodGhpcy5zdHJpbmdpZnkuY29udmVydENvbW1lbnRLZXkpID09PSAwKSB7CiAgICAgICAgICAgIGxhc3RDaGlsZCA9IHRoaXMuY29tbWVudCh0ZXh0KTsKICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVEZWNvcmF0b3JzICYmIHRoaXMuc3RyaW5naWZ5LmNvbnZlcnRSYXdLZXkgJiYgbmFtZS5pbmRleE9mKHRoaXMuc3RyaW5naWZ5LmNvbnZlcnRSYXdLZXkpID09PSAwKSB7CiAgICAgICAgICAgIGxhc3RDaGlsZCA9IHRoaXMucmF3KHRleHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGFzdENoaWxkID0gdGhpcy5ub2RlKG5hbWUsIGF0dHJpYnV0ZXMsIHRleHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobGFzdENoaWxkID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IGNyZWF0ZSBhbnkgZWxlbWVudHMgd2l0aDogIiArIG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGFzdENoaWxkOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbihuYW1lLCBhdHRyaWJ1dGVzLCB0ZXh0KSB7CiAgICAgICAgdmFyIGNoaWxkLAogICAgICAgICAgICBpLAogICAgICAgICAgICByZW1vdmVkOwogICAgICAgIGlmICh0aGlzLmlzUm9vdCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgaW5zZXJ0IGVsZW1lbnRzIGF0IHJvb3QgbGV2ZWwiKTsKICAgICAgICB9CiAgICAgICAgaSA9IHRoaXMucGFyZW50LmNoaWxkcmVuLmluZGV4T2YodGhpcyk7CiAgICAgICAgcmVtb3ZlZCA9IHRoaXMucGFyZW50LmNoaWxkcmVuLnNwbGljZShpKTsKICAgICAgICBjaGlsZCA9IHRoaXMucGFyZW50LmVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgdGV4dCk7CiAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkodGhpcy5wYXJlbnQuY2hpbGRyZW4sIHJlbW92ZWQpOwogICAgICAgIHJldHVybiBjaGlsZDsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbihuYW1lLCBhdHRyaWJ1dGVzLCB0ZXh0KSB7CiAgICAgICAgdmFyIGNoaWxkLAogICAgICAgICAgICBpLAogICAgICAgICAgICByZW1vdmVkOwogICAgICAgIGlmICh0aGlzLmlzUm9vdCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgaW5zZXJ0IGVsZW1lbnRzIGF0IHJvb3QgbGV2ZWwiKTsKICAgICAgICB9CiAgICAgICAgaSA9IHRoaXMucGFyZW50LmNoaWxkcmVuLmluZGV4T2YodGhpcyk7CiAgICAgICAgcmVtb3ZlZCA9IHRoaXMucGFyZW50LmNoaWxkcmVuLnNwbGljZShpICsgMSk7CiAgICAgICAgY2hpbGQgPSB0aGlzLnBhcmVudC5lbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMsIHRleHQpOwogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHRoaXMucGFyZW50LmNoaWxkcmVuLCByZW1vdmVkKTsKICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBpLAogICAgICAgICAgICByZWY7CiAgICAgICAgaWYgKHRoaXMuaXNSb290KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZW1vdmUgdGhlIHJvb3QgZWxlbWVudCIpOwogICAgICAgIH0KICAgICAgICBpID0gdGhpcy5wYXJlbnQuY2hpbGRyZW4uaW5kZXhPZih0aGlzKTsKICAgICAgICBbXS5zcGxpY2UuYXBwbHkodGhpcy5wYXJlbnQuY2hpbGRyZW4sIFtpLCBpIC0gaSArIDFdLmNvbmNhdChyZWYgPSBbXSkpLCByZWY7CiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50OwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24obmFtZSwgYXR0cmlidXRlcywgdGV4dCkgewogICAgICAgIHZhciBjaGlsZCwKICAgICAgICAgICAgcmVmOwogICAgICAgIGlmIChuYW1lICE9IG51bGwpIHsKICAgICAgICAgIG5hbWUgPSBuYW1lLnZhbHVlT2YoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGF0dHJpYnV0ZXMgPT0gbnVsbCkgewogICAgICAgICAgYXR0cmlidXRlcyA9IHt9OwogICAgICAgIH0KICAgICAgICBhdHRyaWJ1dGVzID0gYXR0cmlidXRlcy52YWx1ZU9mKCk7CiAgICAgICAgaWYgKCFpc09iamVjdChhdHRyaWJ1dGVzKSkgewogICAgICAgICAgcmVmID0gW2F0dHJpYnV0ZXMsIHRleHRdLCB0ZXh0ID0gcmVmWzBdLCBhdHRyaWJ1dGVzID0gcmVmWzFdOwogICAgICAgIH0KICAgICAgICBjaGlsZCA9IG5ldyBYTUxFbGVtZW50KHRoaXMsIG5hbWUsIGF0dHJpYnV0ZXMpOwogICAgICAgIGlmICh0ZXh0ICE9IG51bGwpIHsKICAgICAgICAgIGNoaWxkLnRleHQodGV4dCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS50ZXh0ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB2YXIgY2hpbGQ7CiAgICAgICAgY2hpbGQgPSBuZXcgWE1MVGV4dCh0aGlzLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuY2RhdGEgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHZhciBjaGlsZDsKICAgICAgICBjaGlsZCA9IG5ldyBYTUxDRGF0YSh0aGlzLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuY29tbWVudCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdmFyIGNoaWxkOwogICAgICAgIGNoaWxkID0gbmV3IFhNTENvbW1lbnQodGhpcywgdmFsdWUpOwogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLnJhdyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdmFyIGNoaWxkOwogICAgICAgIGNoaWxkID0gbmV3IFhNTFJhdyh0aGlzLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuZGVjbGFyYXRpb24gPSBmdW5jdGlvbih2ZXJzaW9uLCBlbmNvZGluZywgc3RhbmRhbG9uZSkgewogICAgICAgIHZhciBkb2MsCiAgICAgICAgICAgIHhtbGRlYzsKICAgICAgICBkb2MgPSB0aGlzLmRvY3VtZW50KCk7CiAgICAgICAgeG1sZGVjID0gbmV3IFhNTERlY2xhcmF0aW9uKGRvYywgdmVyc2lvbiwgZW5jb2RpbmcsIHN0YW5kYWxvbmUpOwogICAgICAgIGRvYy54bWxkZWMgPSB4bWxkZWM7CiAgICAgICAgcmV0dXJuIGRvYy5yb290KCk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLmRvY3R5cGUgPSBmdW5jdGlvbihwdWJJRCwgc3lzSUQpIHsKICAgICAgICB2YXIgZG9jLAogICAgICAgICAgICBkb2N0eXBlOwogICAgICAgIGRvYyA9IHRoaXMuZG9jdW1lbnQoKTsKICAgICAgICBkb2N0eXBlID0gbmV3IFhNTERvY1R5cGUoZG9jLCBwdWJJRCwgc3lzSUQpOwogICAgICAgIGRvYy5kb2N0eXBlID0gZG9jdHlwZTsKICAgICAgICByZXR1cm4gZG9jdHlwZTsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUudXAgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAodGhpcy5pc1Jvb3QpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIHJvb3Qgbm9kZSBoYXMgbm8gcGFyZW50LiBVc2UgZG9jKCkgaWYgeW91IG5lZWQgdG8gZ2V0IHRoZSBkb2N1bWVudCBvYmplY3QuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnBhcmVudDsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUucm9vdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBjaGlsZDsKICAgICAgICBpZiAodGhpcy5pc1Jvb3QpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBjaGlsZCA9IHRoaXMucGFyZW50OwogICAgICAgIHdoaWxlICghY2hpbGQuaXNSb290KSB7CiAgICAgICAgICBjaGlsZCA9IGNoaWxkLnBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5kb2N1bWVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnJvb3QoKS5kb2N1bWVudE9iamVjdDsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50KCkudG9TdHJpbmcob3B0aW9ucyk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLnByZXYgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaTsKICAgICAgICBpZiAodGhpcy5pc1Jvb3QpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUm9vdCBub2RlIGhhcyBubyBzaWJsaW5ncyIpOwogICAgICAgIH0KICAgICAgICBpID0gdGhpcy5wYXJlbnQuY2hpbGRyZW4uaW5kZXhPZih0aGlzKTsKICAgICAgICBpZiAoaSA8IDEpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxyZWFkeSBhdCB0aGUgZmlyc3Qgbm9kZSIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuY2hpbGRyZW5baSAtIDFdOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgaWYgKHRoaXMuaXNSb290KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlJvb3Qgbm9kZSBoYXMgbm8gc2libGluZ3MiKTsKICAgICAgICB9CiAgICAgICAgaSA9IHRoaXMucGFyZW50LmNoaWxkcmVuLmluZGV4T2YodGhpcyk7CiAgICAgICAgaWYgKGkgPT09IC0xIHx8IGkgPT09IHRoaXMucGFyZW50LmNoaWxkcmVuLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxyZWFkeSBhdCB0aGUgbGFzdCBub2RlIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5jaGlsZHJlbltpICsgMV07CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLmltcG9ydFhNTEJ1aWxkZXIgPSBmdW5jdGlvbih4bWxidWlsZGVyKSB7CiAgICAgICAgdmFyIGNsb25lZFJvb3Q7CiAgICAgICAgY2xvbmVkUm9vdCA9IHhtbGJ1aWxkZXIucm9vdCgpLmNsb25lKCk7CiAgICAgICAgY2xvbmVkUm9vdC5wYXJlbnQgPSB0aGlzOwogICAgICAgIGNsb25lZFJvb3QuaXNSb290ID0gZmFsc2U7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNsb25lZFJvb3QpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5lbGUgPSBmdW5jdGlvbihuYW1lLCBhdHRyaWJ1dGVzLCB0ZXh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCB0ZXh0KTsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUubm9kID0gZnVuY3Rpb24obmFtZSwgYXR0cmlidXRlcywgdGV4dCkgewogICAgICAgIHJldHVybiB0aGlzLm5vZGUobmFtZSwgYXR0cmlidXRlcywgdGV4dCk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLnR4dCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGV4dCh2YWx1ZSk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLmRhdCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2RhdGEodmFsdWUpOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5jb20gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmNvbW1lbnQodmFsdWUpOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5kb2MgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudCgpOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5kZWMgPSBmdW5jdGlvbih2ZXJzaW9uLCBlbmNvZGluZywgc3RhbmRhbG9uZSkgewogICAgICAgIHJldHVybiB0aGlzLmRlY2xhcmF0aW9uKHZlcnNpb24sIGVuY29kaW5nLCBzdGFuZGFsb25lKTsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuZHRkID0gZnVuY3Rpb24ocHViSUQsIHN5c0lEKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdHlwZShwdWJJRCwgc3lzSUQpOwogICAgICB9OwogICAgICBYTUxOb2RlLnByb3RvdHlwZS5lID0gZnVuY3Rpb24obmFtZSwgYXR0cmlidXRlcywgdGV4dCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgdGV4dCk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLm4gPSBmdW5jdGlvbihuYW1lLCBhdHRyaWJ1dGVzLCB0ZXh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMubm9kZShuYW1lLCBhdHRyaWJ1dGVzLCB0ZXh0KTsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUudCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGV4dCh2YWx1ZSk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLmQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLmNkYXRhKHZhbHVlKTsKICAgICAgfTsKICAgICAgWE1MTm9kZS5wcm90b3R5cGUuYyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29tbWVudCh2YWx1ZSk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLnIgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiB0aGlzLnJhdyh2YWx1ZSk7CiAgICAgIH07CiAgICAgIFhNTE5vZGUucHJvdG90eXBlLnUgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy51cCgpOwogICAgICB9OwogICAgICByZXR1cm4gWE1MTm9kZTsKICAgIH0pKCk7CiAgfSkuY2FsbCh0aGlzKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigiZ2l0aHViOmpzcG0vbm9kZWxpYnMtc3RyZWFtQDAuMS4wL2luZGV4IiwgWyJucG06c3RyZWFtLWJyb3dzZXJpZnlAMS4wLjAiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gU3lzdGVtLl9ub2RlUmVxdWlyZSA/IFN5c3RlbS5fbm9kZVJlcXVpcmUoJ3N0cmVhbScpIDogcmVxdWlyZSgibnBtOnN0cmVhbS1icm93c2VyaWZ5QDEuMC4wIik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEZWNsYXJhdGlvbiIsIFsibnBtOmxvZGFzaEAzLjkuMy9vYmplY3QvY3JlYXRlIiwgIm5wbTpsb2Rhc2hAMy45LjMvbGFuZy9pc09iamVjdCIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MTm9kZSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTERlY2xhcmF0aW9uLAogICAgICAgIFhNTE5vZGUsCiAgICAgICAgY3JlYXRlLAogICAgICAgIGlzT2JqZWN0LAogICAgICAgIGV4dGVuZCA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsKICAgICAgICAgICAgaWYgKGhhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpCiAgICAgICAgICAgICAgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gY3RvcigpIHsKICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOwogICAgICAgICAgfQogICAgICAgICAgY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOwogICAgICAgICAgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsKICAgICAgICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CiAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgfSwKICAgICAgICBoYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHk7CiAgICBjcmVhdGUgPSByZXF1aXJlKCJucG06bG9kYXNoQDMuOS4zL29iamVjdC9jcmVhdGUiKTsKICAgIGlzT2JqZWN0ID0gcmVxdWlyZSgibnBtOmxvZGFzaEAzLjkuMy9sYW5nL2lzT2JqZWN0Iik7CiAgICBYTUxOb2RlID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTE5vZGUiKTsKICAgIG1vZHVsZS5leHBvcnRzID0gWE1MRGVjbGFyYXRpb24gPSAoZnVuY3Rpb24oc3VwZXJDbGFzcykgewogICAgICBleHRlbmQoWE1MRGVjbGFyYXRpb24sIHN1cGVyQ2xhc3MpOwogICAgICBmdW5jdGlvbiBYTUxEZWNsYXJhdGlvbihwYXJlbnQsIHZlcnNpb24sIGVuY29kaW5nLCBzdGFuZGFsb25lKSB7CiAgICAgICAgdmFyIHJlZjsKICAgICAgICBYTUxEZWNsYXJhdGlvbi5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwYXJlbnQpOwogICAgICAgIGlmIChpc09iamVjdCh2ZXJzaW9uKSkgewogICAgICAgICAgcmVmID0gdmVyc2lvbiwgdmVyc2lvbiA9IHJlZi52ZXJzaW9uLCBlbmNvZGluZyA9IHJlZi5lbmNvZGluZywgc3RhbmRhbG9uZSA9IHJlZi5zdGFuZGFsb25lOwogICAgICAgIH0KICAgICAgICBpZiAoIXZlcnNpb24pIHsKICAgICAgICAgIHZlcnNpb24gPSAnMS4wJzsKICAgICAgICB9CiAgICAgICAgaWYgKHZlcnNpb24gIT0gbnVsbCkgewogICAgICAgICAgdGhpcy52ZXJzaW9uID0gdGhpcy5zdHJpbmdpZnkueG1sVmVyc2lvbih2ZXJzaW9uKTsKICAgICAgICB9CiAgICAgICAgaWYgKGVuY29kaW5nICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMuZW5jb2RpbmcgPSB0aGlzLnN0cmluZ2lmeS54bWxFbmNvZGluZyhlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgIGlmIChzdGFuZGFsb25lICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMuc3RhbmRhbG9uZSA9IHRoaXMuc3RyaW5naWZ5LnhtbFN0YW5kYWxvbmUoc3RhbmRhbG9uZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIFhNTERlY2xhcmF0aW9uLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoWE1MRGVjbGFyYXRpb24ucHJvdG90eXBlLCB0aGlzKTsKICAgICAgfTsKICAgICAgWE1MRGVjbGFyYXRpb24ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24ob3B0aW9ucywgbGV2ZWwpIHsKICAgICAgICB2YXIgaW5kZW50LAogICAgICAgICAgICBuZXdsaW5lLAogICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgIHByZXR0eSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcmVmLAogICAgICAgICAgICByZWYxLAogICAgICAgICAgICByZWYyLAogICAgICAgICAgICBzcGFjZTsKICAgICAgICBwcmV0dHkgPSAob3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5wcmV0dHkgOiB2b2lkIDApIHx8IGZhbHNlOwogICAgICAgIGluZGVudCA9IChyZWYgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLmluZGVudCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZiA6ICcgICc7CiAgICAgICAgb2Zmc2V0ID0gKHJlZjEgPSBvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLm9mZnNldCA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjEgOiAwOwogICAgICAgIG5ld2xpbmUgPSAocmVmMiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMubmV3bGluZSA6IHZvaWQgMCkgIT0gbnVsbCA/IHJlZjIgOiAnXG4nOwogICAgICAgIGxldmVsIHx8IChsZXZlbCA9IDApOwogICAgICAgIHNwYWNlID0gbmV3IEFycmF5KGxldmVsICsgb2Zmc2V0ICsgMSkuam9pbihpbmRlbnQpOwogICAgICAgIHIgPSAnJzsKICAgICAgICBpZiAocHJldHR5KSB7CiAgICAgICAgICByICs9IHNwYWNlOwogICAgICAgIH0KICAgICAgICByICs9ICc8P3htbCc7CiAgICAgICAgaWYgKHRoaXMudmVyc2lvbiAhPSBudWxsKSB7CiAgICAgICAgICByICs9ICcgdmVyc2lvbj0iJyArIHRoaXMudmVyc2lvbiArICciJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZW5jb2RpbmcgIT0gbnVsbCkgewogICAgICAgICAgciArPSAnIGVuY29kaW5nPSInICsgdGhpcy5lbmNvZGluZyArICciJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc3RhbmRhbG9uZSAhPSBudWxsKSB7CiAgICAgICAgICByICs9ICcgc3RhbmRhbG9uZT0iJyArIHRoaXMuc3RhbmRhbG9uZSArICciJzsKICAgICAgICB9CiAgICAgICAgciArPSAnPz4nOwogICAgICAgIGlmIChwcmV0dHkpIHsKICAgICAgICAgIHIgKz0gbmV3bGluZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH07CiAgICAgIHJldHVybiBYTUxEZWNsYXJhdGlvbjsKICAgIH0pKFhNTE5vZGUpOwogIH0pLmNhbGwodGhpcyk7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXN0cmVhbUAwLjEuMCIsIFsiZ2l0aHViOmpzcG0vbm9kZWxpYnMtc3RyZWFtQDAuMS4wL2luZGV4Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXN0cmVhbUAwLjEuMC9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MQnVpbGRlciIsIFsibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTFN0cmluZ2lmaWVyIiwgIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxEZWNsYXJhdGlvbiIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRG9jVHlwZSIsICJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRWxlbWVudCJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIFhNTEJ1aWxkZXIsCiAgICAgICAgWE1MRGVjbGFyYXRpb24sCiAgICAgICAgWE1MRG9jVHlwZSwKICAgICAgICBYTUxFbGVtZW50LAogICAgICAgIFhNTFN0cmluZ2lmaWVyOwogICAgWE1MU3RyaW5naWZpZXIgPSByZXF1aXJlKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MU3RyaW5naWZpZXIiKTsKICAgIFhNTERlY2xhcmF0aW9uID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERlY2xhcmF0aW9uIik7CiAgICBYTUxEb2NUeXBlID0gcmVxdWlyZSgibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTERvY1R5cGUiKTsKICAgIFhNTEVsZW1lbnQgPSByZXF1aXJlKCJucG06eG1sYnVpbGRlckAyLjYuNC9saWIvWE1MRWxlbWVudCIpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBYTUxCdWlsZGVyID0gKGZ1bmN0aW9uKCkgewogICAgICBmdW5jdGlvbiBYTUxCdWlsZGVyKG5hbWUsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgcm9vdCwKICAgICAgICAgICAgdGVtcDsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlJvb3QgZWxlbWVudCBuZWVkcyBhIG5hbWUiKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgIH0KICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIHRoaXMuc3RyaW5naWZ5ID0gbmV3IFhNTFN0cmluZ2lmaWVyKG9wdGlvbnMpOwogICAgICAgIHRlbXAgPSBuZXcgWE1MRWxlbWVudCh0aGlzLCAnZG9jJyk7CiAgICAgICAgcm9vdCA9IHRlbXAuZWxlbWVudChuYW1lKTsKICAgICAgICByb290LmlzUm9vdCA9IHRydWU7CiAgICAgICAgcm9vdC5kb2N1bWVudE9iamVjdCA9IHRoaXM7CiAgICAgICAgdGhpcy5yb290T2JqZWN0ID0gcm9vdDsKICAgICAgICBpZiAoIW9wdGlvbnMuaGVhZGxlc3MpIHsKICAgICAgICAgIHJvb3QuZGVjbGFyYXRpb24ob3B0aW9ucyk7CiAgICAgICAgICBpZiAoKG9wdGlvbnMucHViSUQgIT0gbnVsbCkgfHwgKG9wdGlvbnMuc3lzSUQgIT0gbnVsbCkpIHsKICAgICAgICAgICAgcm9vdC5kb2N0eXBlKG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBYTUxCdWlsZGVyLnByb3RvdHlwZS5yb290ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucm9vdE9iamVjdDsKICAgICAgfTsKICAgICAgWE1MQnVpbGRlci5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKG9wdGlvbnMpOwogICAgICB9OwogICAgICBYTUxCdWlsZGVyLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICB2YXIgaW5kZW50LAogICAgICAgICAgICBuZXdsaW5lLAogICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgIHByZXR0eSwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcmVmLAogICAgICAgICAgICByZWYxLAogICAgICAgICAgICByZWYyOwogICAgICAgIHByZXR0eSA9IChvcHRpb25zICE9IG51bGwgPyBvcHRpb25zLnByZXR0eSA6IHZvaWQgMCkgfHwgZmFsc2U7CiAgICAgICAgaW5kZW50ID0gKHJlZiA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMuaW5kZW50IDogdm9pZCAwKSAhPSBudWxsID8gcmVmIDogJyAgJzsKICAgICAgICBvZmZzZXQgPSAocmVmMSA9IG9wdGlvbnMgIT0gbnVsbCA/IG9wdGlvbnMub2Zmc2V0IDogdm9pZCAwKSAhPSBudWxsID8gcmVmMSA6IDA7CiAgICAgICAgbmV3bGluZSA9IChyZWYyID0gb3B0aW9ucyAhPSBudWxsID8gb3B0aW9ucy5uZXdsaW5lIDogdm9pZCAwKSAhPSBudWxsID8gcmVmMiA6ICdcbic7CiAgICAgICAgciA9ICcnOwogICAgICAgIGlmICh0aGlzLnhtbGRlYyAhPSBudWxsKSB7CiAgICAgICAgICByICs9IHRoaXMueG1sZGVjLnRvU3RyaW5nKG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5kb2N0eXBlICE9IG51bGwpIHsKICAgICAgICAgIHIgKz0gdGhpcy5kb2N0eXBlLnRvU3RyaW5nKG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICByICs9IHRoaXMucm9vdE9iamVjdC50b1N0cmluZyhvcHRpb25zKTsKICAgICAgICBpZiAocHJldHR5ICYmIHIuc2xpY2UoLW5ld2xpbmUubGVuZ3RoKSA9PT0gbmV3bGluZSkgewogICAgICAgICAgciA9IHIuc2xpY2UoMCwgLW5ld2xpbmUubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH07CiAgICAgIHJldHVybiBYTUxCdWlsZGVyOwogICAgfSkoKTsKICB9KS5jYWxsKHRoaXMpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06c2F4QDAuNi4xL2xpYi9zYXgiLCBbImdpdGh1Yjpqc3BtL25vZGVsaWJzLXN0cmVhbUAwLjEuMCIsICJnaXRodWI6anNwbS9ub2RlbGlicy1zdHJpbmdfZGVjb2RlckAwLjEuMCIsICJnaXRodWI6anNwbS9ub2RlbGlicy1idWZmZXJAMC4xLjAiLCAiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMSJdLCB0cnVlLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICB2YXIgZ2xvYmFsID0gU3lzdGVtLmdsb2JhbCwKICAgICAgX19kZWZpbmUgPSBnbG9iYWwuZGVmaW5lOwogIGdsb2JhbC5kZWZpbmUgPSB1bmRlZmluZWQ7CiAgKGZ1bmN0aW9uKEJ1ZmZlciwgcHJvY2VzcykgewogICAgOwogICAgKGZ1bmN0aW9uKHNheCkgewogICAgICBzYXgucGFyc2VyID0gZnVuY3Rpb24oc3RyaWN0LCBvcHQpIHsKICAgICAgICByZXR1cm4gbmV3IFNBWFBhcnNlcihzdHJpY3QsIG9wdCk7CiAgICAgIH07CiAgICAgIHNheC5TQVhQYXJzZXIgPSBTQVhQYXJzZXI7CiAgICAgIHNheC5TQVhTdHJlYW0gPSBTQVhTdHJlYW07CiAgICAgIHNheC5jcmVhdGVTdHJlYW0gPSBjcmVhdGVTdHJlYW07CiAgICAgIHNheC5NQVhfQlVGRkVSX0xFTkdUSCA9IDY0ICogMTAyNDsKICAgICAgdmFyIGJ1ZmZlcnMgPSBbImNvbW1lbnQiLCAic2dtbERlY2wiLCAidGV4dE5vZGUiLCAidGFnTmFtZSIsICJkb2N0eXBlIiwgInByb2NJbnN0TmFtZSIsICJwcm9jSW5zdEJvZHkiLCAiZW50aXR5IiwgImF0dHJpYk5hbWUiLCAiYXR0cmliVmFsdWUiLCAiY2RhdGEiLCAic2NyaXB0Il07CiAgICAgIHNheC5FVkVOVFMgPSBbInRleHQiLCAicHJvY2Vzc2luZ2luc3RydWN0aW9uIiwgInNnbWxkZWNsYXJhdGlvbiIsICJkb2N0eXBlIiwgImNvbW1lbnQiLCAiYXR0cmlidXRlIiwgIm9wZW50YWciLCAiY2xvc2V0YWciLCAib3BlbmNkYXRhIiwgImNkYXRhIiwgImNsb3NlY2RhdGEiLCAiZXJyb3IiLCAiZW5kIiwgInJlYWR5IiwgInNjcmlwdCIsICJvcGVubmFtZXNwYWNlIiwgImNsb3NlbmFtZXNwYWNlIl07CiAgICAgIGZ1bmN0aW9uIFNBWFBhcnNlcihzdHJpY3QsIG9wdCkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTQVhQYXJzZXIpKQogICAgICAgICAgcmV0dXJuIG5ldyBTQVhQYXJzZXIoc3RyaWN0LCBvcHQpOwogICAgICAgIHZhciBwYXJzZXIgPSB0aGlzOwogICAgICAgIGNsZWFyQnVmZmVycyhwYXJzZXIpOwogICAgICAgIHBhcnNlci5xID0gcGFyc2VyLmMgPSAiIjsKICAgICAgICBwYXJzZXIuYnVmZmVyQ2hlY2tQb3NpdGlvbiA9IHNheC5NQVhfQlVGRkVSX0xFTkdUSDsKICAgICAgICBwYXJzZXIub3B0ID0gb3B0IHx8IHt9OwogICAgICAgIHBhcnNlci5vcHQubG93ZXJjYXNlID0gcGFyc2VyLm9wdC5sb3dlcmNhc2UgfHwgcGFyc2VyLm9wdC5sb3dlcmNhc2V0YWdzOwogICAgICAgIHBhcnNlci5sb29zZUNhc2UgPSBwYXJzZXIub3B0Lmxvd2VyY2FzZSA/ICJ0b0xvd2VyQ2FzZSIgOiAidG9VcHBlckNhc2UiOwogICAgICAgIHBhcnNlci50YWdzID0gW107CiAgICAgICAgcGFyc2VyLmNsb3NlZCA9IHBhcnNlci5jbG9zZWRSb290ID0gcGFyc2VyLnNhd1Jvb3QgPSBmYWxzZTsKICAgICAgICBwYXJzZXIudGFnID0gcGFyc2VyLmVycm9yID0gbnVsbDsKICAgICAgICBwYXJzZXIuc3RyaWN0ID0gISFzdHJpY3Q7CiAgICAgICAgcGFyc2VyLm5vc2NyaXB0ID0gISEoc3RyaWN0IHx8IHBhcnNlci5vcHQubm9zY3JpcHQpOwogICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQkVHSU47CiAgICAgICAgcGFyc2VyLkVOVElUSUVTID0gT2JqZWN0LmNyZWF0ZShzYXguRU5USVRJRVMpOwogICAgICAgIHBhcnNlci5hdHRyaWJMaXN0ID0gW107CiAgICAgICAgaWYgKHBhcnNlci5vcHQueG1sbnMpCiAgICAgICAgICBwYXJzZXIubnMgPSBPYmplY3QuY3JlYXRlKHJvb3ROUyk7CiAgICAgICAgcGFyc2VyLnRyYWNrUG9zaXRpb24gPSBwYXJzZXIub3B0LnBvc2l0aW9uICE9PSBmYWxzZTsKICAgICAgICBpZiAocGFyc2VyLnRyYWNrUG9zaXRpb24pIHsKICAgICAgICAgIHBhcnNlci5wb3NpdGlvbiA9IHBhcnNlci5saW5lID0gcGFyc2VyLmNvbHVtbiA9IDA7CiAgICAgICAgfQogICAgICAgIGVtaXQocGFyc2VyLCAib25yZWFkeSIpOwogICAgICB9CiAgICAgIGlmICghT2JqZWN0LmNyZWF0ZSkKICAgICAgICBPYmplY3QuY3JlYXRlID0gZnVuY3Rpb24obykgewogICAgICAgICAgZnVuY3Rpb24gZigpIHsKICAgICAgICAgICAgdGhpcy5fX3Byb3RvX18gPSBvOwogICAgICAgICAgfQogICAgICAgICAgZi5wcm90b3R5cGUgPSBvOwogICAgICAgICAgcmV0dXJuIG5ldyBmOwogICAgICAgIH07CiAgICAgIGlmICghT2JqZWN0LmdldFByb3RvdHlwZU9mKQogICAgICAgIE9iamVjdC5nZXRQcm90b3R5cGVPZiA9IGZ1bmN0aW9uKG8pIHsKICAgICAgICAgIHJldHVybiBvLl9fcHJvdG9fXzsKICAgICAgICB9OwogICAgICBpZiAoIU9iamVjdC5rZXlzKQogICAgICAgIE9iamVjdC5rZXlzID0gZnVuY3Rpb24obykgewogICAgICAgICAgdmFyIGEgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgaW4gbykKICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoaSkpCiAgICAgICAgICAgICAgYS5wdXNoKGkpOwogICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfTsKICAgICAgZnVuY3Rpb24gY2hlY2tCdWZmZXJMZW5ndGgocGFyc2VyKSB7CiAgICAgICAgdmFyIG1heEFsbG93ZWQgPSBNYXRoLm1heChzYXguTUFYX0JVRkZFUl9MRU5HVEgsIDEwKSwKICAgICAgICAgICAgbWF4QWN0dWFsID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMCwKICAgICAgICAgICAgbCA9IGJ1ZmZlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2YXIgbGVuID0gcGFyc2VyW2J1ZmZlcnNbaV1dLmxlbmd0aDsKICAgICAgICAgIGlmIChsZW4gPiBtYXhBbGxvd2VkKSB7CiAgICAgICAgICAgIHN3aXRjaCAoYnVmZmVyc1tpXSkgewogICAgICAgICAgICAgIGNhc2UgInRleHROb2RlIjoKICAgICAgICAgICAgICAgIGNsb3NlVGV4dChwYXJzZXIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiY2RhdGEiOgogICAgICAgICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25jZGF0YSIsIHBhcnNlci5jZGF0YSk7CiAgICAgICAgICAgICAgICBwYXJzZXIuY2RhdGEgPSAiIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInNjcmlwdCI6CiAgICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbnNjcmlwdCIsIHBhcnNlci5zY3JpcHQpOwogICAgICAgICAgICAgICAgcGFyc2VyLnNjcmlwdCA9ICIiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGVycm9yKHBhcnNlciwgIk1heCBidWZmZXIgbGVuZ3RoIGV4Y2VlZGVkOiAiICsgYnVmZmVyc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG1heEFjdHVhbCA9IE1hdGgubWF4KG1heEFjdHVhbCwgbGVuKTsKICAgICAgICB9CiAgICAgICAgcGFyc2VyLmJ1ZmZlckNoZWNrUG9zaXRpb24gPSAoc2F4Lk1BWF9CVUZGRVJfTEVOR1RIIC0gbWF4QWN0dWFsKSArIHBhcnNlci5wb3NpdGlvbjsKICAgICAgfQogICAgICBmdW5jdGlvbiBjbGVhckJ1ZmZlcnMocGFyc2VyKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsCiAgICAgICAgICAgIGwgPSBidWZmZXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgcGFyc2VyW2J1ZmZlcnNbaV1dID0gIiI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZsdXNoQnVmZmVycyhwYXJzZXIpIHsKICAgICAgICBjbG9zZVRleHQocGFyc2VyKTsKICAgICAgICBpZiAocGFyc2VyLmNkYXRhICE9PSAiIikgewogICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25jZGF0YSIsIHBhcnNlci5jZGF0YSk7CiAgICAgICAgICBwYXJzZXIuY2RhdGEgPSAiIjsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcnNlci5zY3JpcHQgIT09ICIiKSB7CiAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbnNjcmlwdCIsIHBhcnNlci5zY3JpcHQpOwogICAgICAgICAgcGFyc2VyLnNjcmlwdCA9ICIiOwogICAgICAgIH0KICAgICAgfQogICAgICBTQVhQYXJzZXIucHJvdG90eXBlID0gewogICAgICAgIGVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBlbmQodGhpcyk7CiAgICAgICAgfSwKICAgICAgICB3cml0ZTogd3JpdGUsCiAgICAgICAgcmVzdW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuZXJyb3IgPSBudWxsOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICBjbG9zZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy53cml0ZShudWxsKTsKICAgICAgICB9LAogICAgICAgIGZsdXNoOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGZsdXNoQnVmZmVycyh0aGlzKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIFN0cmVhbSA9IHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLXN0cmVhbUAwLjEuMCIpLlN0cmVhbTsKICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICB2YXIgU3RyZWFtID0gZnVuY3Rpb24oKSB7fTsKICAgICAgfQogICAgICB2YXIgc3RyZWFtV3JhcHMgPSBzYXguRVZFTlRTLmZpbHRlcihmdW5jdGlvbihldikgewogICAgICAgIHJldHVybiBldiAhPT0gImVycm9yIiAmJiBldiAhPT0gImVuZCI7CiAgICAgIH0pOwogICAgICBmdW5jdGlvbiBjcmVhdGVTdHJlYW0oc3RyaWN0LCBvcHQpIHsKICAgICAgICByZXR1cm4gbmV3IFNBWFN0cmVhbShzdHJpY3QsIG9wdCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU0FYU3RyZWFtKHN0cmljdCwgb3B0KSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNBWFN0cmVhbSkpCiAgICAgICAgICByZXR1cm4gbmV3IFNBWFN0cmVhbShzdHJpY3QsIG9wdCk7CiAgICAgICAgU3RyZWFtLmFwcGx5KHRoaXMpOwogICAgICAgIHRoaXMuX3BhcnNlciA9IG5ldyBTQVhQYXJzZXIoc3RyaWN0LCBvcHQpOwogICAgICAgIHRoaXMud3JpdGFibGUgPSB0cnVlOwogICAgICAgIHRoaXMucmVhZGFibGUgPSB0cnVlOwogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgdGhpcy5fcGFyc2VyLm9uZW5kID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBtZS5lbWl0KCJlbmQiKTsKICAgICAgICB9OwogICAgICAgIHRoaXMuX3BhcnNlci5vbmVycm9yID0gZnVuY3Rpb24oZXIpIHsKICAgICAgICAgIG1lLmVtaXQoImVycm9yIiwgZXIpOwogICAgICAgICAgbWUuX3BhcnNlci5lcnJvciA9IG51bGw7CiAgICAgICAgfTsKICAgICAgICB0aGlzLl9kZWNvZGVyID0gbnVsbDsKICAgICAgICBzdHJlYW1XcmFwcy5mb3JFYWNoKGZ1bmN0aW9uKGV2KSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobWUsICJvbiIgKyBldiwgewogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBtZS5fcGFyc2VyWyJvbiIgKyBldl07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oaCkgewogICAgICAgICAgICAgIGlmICghaCkgewogICAgICAgICAgICAgICAgbWUucmVtb3ZlQWxsTGlzdGVuZXJzKGV2KTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5fcGFyc2VyWyJvbiIgKyBldl0gPSBoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtZS5vbihldiwgaCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIFNBWFN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFN0cmVhbS5wcm90b3R5cGUsIHtjb25zdHJ1Y3Rvcjoge3ZhbHVlOiBTQVhTdHJlYW19fSk7CiAgICAgIFNBWFN0cmVhbS5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgaWYgKHR5cGVvZiBCdWZmZXIgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIEJ1ZmZlci5pc0J1ZmZlciA9PT0gJ2Z1bmN0aW9uJyAmJiBCdWZmZXIuaXNCdWZmZXIoZGF0YSkpIHsKICAgICAgICAgIGlmICghdGhpcy5fZGVjb2RlcikgewogICAgICAgICAgICB2YXIgU0QgPSByZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1zdHJpbmdfZGVjb2RlckAwLjEuMCIpLlN0cmluZ0RlY29kZXI7CiAgICAgICAgICAgIHRoaXMuX2RlY29kZXIgPSBuZXcgU0QoJ3V0ZjgnKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEgPSB0aGlzLl9kZWNvZGVyLndyaXRlKGRhdGEpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9wYXJzZXIud3JpdGUoZGF0YS50b1N0cmluZygpKTsKICAgICAgICB0aGlzLmVtaXQoImRhdGEiLCBkYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfTsKICAgICAgU0FYU3RyZWFtLnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbihjaHVuaykgewogICAgICAgIGlmIChjaHVuayAmJiBjaHVuay5sZW5ndGgpCiAgICAgICAgICB0aGlzLndyaXRlKGNodW5rKTsKICAgICAgICB0aGlzLl9wYXJzZXIuZW5kKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH07CiAgICAgIFNBWFN0cmVhbS5wcm90b3R5cGUub24gPSBmdW5jdGlvbihldiwgaGFuZGxlcikgewogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgaWYgKCFtZS5fcGFyc2VyWyJvbiIgKyBldl0gJiYgc3RyZWFtV3JhcHMuaW5kZXhPZihldikgIT09IC0xKSB7CiAgICAgICAgICBtZS5fcGFyc2VyWyJvbiIgKyBldl0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gW2FyZ3VtZW50c1swXV0gOiBBcnJheS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgICAgICBhcmdzLnNwbGljZSgwLCAwLCBldik7CiAgICAgICAgICAgIG1lLmVtaXQuYXBwbHkobWUsIGFyZ3MpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFN0cmVhbS5wcm90b3R5cGUub24uY2FsbChtZSwgZXYsIGhhbmRsZXIpOwogICAgICB9OwogICAgICB2YXIgd2hpdGVzcGFjZSA9ICJcclxuXHQgIiwKICAgICAgICAgIG51bWJlciA9ICIwMTI0MzU2Nzg5IiwKICAgICAgICAgIGxldHRlciA9ICJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaIiwKICAgICAgICAgIHF1b3RlID0gIidcIiIsCiAgICAgICAgICBlbnRpdHkgPSBudW1iZXIgKyBsZXR0ZXIgKyAiIyIsCiAgICAgICAgICBhdHRyaWJFbmQgPSB3aGl0ZXNwYWNlICsgIj4iLAogICAgICAgICAgQ0RBVEEgPSAiW0NEQVRBWyIsCiAgICAgICAgICBET0NUWVBFID0gIkRPQ1RZUEUiLAogICAgICAgICAgWE1MX05BTUVTUEFDRSA9ICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLAogICAgICAgICAgWE1MTlNfTkFNRVNQQUNFID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIiwKICAgICAgICAgIHJvb3ROUyA9IHsKICAgICAgICAgICAgeG1sOiBYTUxfTkFNRVNQQUNFLAogICAgICAgICAgICB4bWxuczogWE1MTlNfTkFNRVNQQUNFCiAgICAgICAgICB9OwogICAgICB3aGl0ZXNwYWNlID0gY2hhckNsYXNzKHdoaXRlc3BhY2UpOwogICAgICBudW1iZXIgPSBjaGFyQ2xhc3MobnVtYmVyKTsKICAgICAgbGV0dGVyID0gY2hhckNsYXNzKGxldHRlcik7CiAgICAgIHZhciBuYW1lU3RhcnQgPSAvWzpfQS1aYS16XHUwMEMwLVx1MDBENlx1MDBEOC1cdTAwRjZcdTAwRjgtXHUwMkZGXHUwMzcwLVx1MDM3RFx1MDM3Ri1cdTFGRkZcdTIwMEMtXHUyMDBEXHUyMDcwLVx1MjE4Rlx1MkMwMC1cdTJGRUZcdTMwMDEtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRkRdLzsKICAgICAgdmFyIG5hbWVCb2R5ID0gL1s6X0EtWmEtelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXHUwMEI3XHUwMzAwLVx1MDM2Rlx1MjAzRi1cdTIwNDBcLlxkLV0vOwogICAgICBxdW90ZSA9IGNoYXJDbGFzcyhxdW90ZSk7CiAgICAgIGVudGl0eSA9IGNoYXJDbGFzcyhlbnRpdHkpOwogICAgICBhdHRyaWJFbmQgPSBjaGFyQ2xhc3MoYXR0cmliRW5kKTsKICAgICAgZnVuY3Rpb24gY2hhckNsYXNzKHN0cikgewogICAgICAgIHJldHVybiBzdHIuc3BsaXQoIiIpLnJlZHVjZShmdW5jdGlvbihzLCBjKSB7CiAgICAgICAgICBzW2NdID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0sIHt9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpc1JlZ0V4cChjKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChjKSA9PT0gJ1tvYmplY3QgUmVnRXhwXSc7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaXMoY2hhcmNsYXNzLCBjKSB7CiAgICAgICAgcmV0dXJuIGlzUmVnRXhwKGNoYXJjbGFzcykgPyAhIWMubWF0Y2goY2hhcmNsYXNzKSA6IGNoYXJjbGFzc1tjXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBub3QoY2hhcmNsYXNzLCBjKSB7CiAgICAgICAgcmV0dXJuICFpcyhjaGFyY2xhc3MsIGMpOwogICAgICB9CiAgICAgIHZhciBTID0gMDsKICAgICAgc2F4LlNUQVRFID0gewogICAgICAgIEJFR0lOOiBTKyssCiAgICAgICAgVEVYVDogUysrLAogICAgICAgIFRFWFRfRU5USVRZOiBTKyssCiAgICAgICAgT1BFTl9XQUtBOiBTKyssCiAgICAgICAgU0dNTF9ERUNMOiBTKyssCiAgICAgICAgU0dNTF9ERUNMX1FVT1RFRDogUysrLAogICAgICAgIERPQ1RZUEU6IFMrKywKICAgICAgICBET0NUWVBFX1FVT1RFRDogUysrLAogICAgICAgIERPQ1RZUEVfRFREOiBTKyssCiAgICAgICAgRE9DVFlQRV9EVERfUVVPVEVEOiBTKyssCiAgICAgICAgQ09NTUVOVF9TVEFSVElORzogUysrLAogICAgICAgIENPTU1FTlQ6IFMrKywKICAgICAgICBDT01NRU5UX0VORElORzogUysrLAogICAgICAgIENPTU1FTlRfRU5ERUQ6IFMrKywKICAgICAgICBDREFUQTogUysrLAogICAgICAgIENEQVRBX0VORElORzogUysrLAogICAgICAgIENEQVRBX0VORElOR18yOiBTKyssCiAgICAgICAgUFJPQ19JTlNUOiBTKyssCiAgICAgICAgUFJPQ19JTlNUX0JPRFk6IFMrKywKICAgICAgICBQUk9DX0lOU1RfRU5ESU5HOiBTKyssCiAgICAgICAgT1BFTl9UQUc6IFMrKywKICAgICAgICBPUEVOX1RBR19TTEFTSDogUysrLAogICAgICAgIEFUVFJJQjogUysrLAogICAgICAgIEFUVFJJQl9OQU1FOiBTKyssCiAgICAgICAgQVRUUklCX05BTUVfU0FXX1dISVRFOiBTKyssCiAgICAgICAgQVRUUklCX1ZBTFVFOiBTKyssCiAgICAgICAgQVRUUklCX1ZBTFVFX1FVT1RFRDogUysrLAogICAgICAgIEFUVFJJQl9WQUxVRV9DTE9TRUQ6IFMrKywKICAgICAgICBBVFRSSUJfVkFMVUVfVU5RVU9URUQ6IFMrKywKICAgICAgICBBVFRSSUJfVkFMVUVfRU5USVRZX1E6IFMrKywKICAgICAgICBBVFRSSUJfVkFMVUVfRU5USVRZX1U6IFMrKywKICAgICAgICBDTE9TRV9UQUc6IFMrKywKICAgICAgICBDTE9TRV9UQUdfU0FXX1dISVRFOiBTKyssCiAgICAgICAgU0NSSVBUOiBTKyssCiAgICAgICAgU0NSSVBUX0VORElORzogUysrCiAgICAgIH07CiAgICAgIHNheC5FTlRJVElFUyA9IHsKICAgICAgICAiYW1wIjogIiYiLAogICAgICAgICJndCI6ICI+IiwKICAgICAgICAibHQiOiAiPCIsCiAgICAgICAgInF1b3QiOiAiXCIiLAogICAgICAgICJhcG9zIjogIiciLAogICAgICAgICJBRWxpZyI6IDE5OCwKICAgICAgICAiQWFjdXRlIjogMTkzLAogICAgICAgICJBY2lyYyI6IDE5NCwKICAgICAgICAiQWdyYXZlIjogMTkyLAogICAgICAgICJBcmluZyI6IDE5NywKICAgICAgICAiQXRpbGRlIjogMTk1LAogICAgICAgICJBdW1sIjogMTk2LAogICAgICAgICJDY2VkaWwiOiAxOTksCiAgICAgICAgIkVUSCI6IDIwOCwKICAgICAgICAiRWFjdXRlIjogMjAxLAogICAgICAgICJFY2lyYyI6IDIwMiwKICAgICAgICAiRWdyYXZlIjogMjAwLAogICAgICAgICJFdW1sIjogMjAzLAogICAgICAgICJJYWN1dGUiOiAyMDUsCiAgICAgICAgIkljaXJjIjogMjA2LAogICAgICAgICJJZ3JhdmUiOiAyMDQsCiAgICAgICAgIkl1bWwiOiAyMDcsCiAgICAgICAgIk50aWxkZSI6IDIwOSwKICAgICAgICAiT2FjdXRlIjogMjExLAogICAgICAgICJPY2lyYyI6IDIxMiwKICAgICAgICAiT2dyYXZlIjogMjEwLAogICAgICAgICJPc2xhc2giOiAyMTYsCiAgICAgICAgIk90aWxkZSI6IDIxMywKICAgICAgICAiT3VtbCI6IDIxNCwKICAgICAgICAiVEhPUk4iOiAyMjIsCiAgICAgICAgIlVhY3V0ZSI6IDIxOCwKICAgICAgICAiVWNpcmMiOiAyMTksCiAgICAgICAgIlVncmF2ZSI6IDIxNywKICAgICAgICAiVXVtbCI6IDIyMCwKICAgICAgICAiWWFjdXRlIjogMjIxLAogICAgICAgICJhYWN1dGUiOiAyMjUsCiAgICAgICAgImFjaXJjIjogMjI2LAogICAgICAgICJhZWxpZyI6IDIzMCwKICAgICAgICAiYWdyYXZlIjogMjI0LAogICAgICAgICJhcmluZyI6IDIyOSwKICAgICAgICAiYXRpbGRlIjogMjI3LAogICAgICAgICJhdW1sIjogMjI4LAogICAgICAgICJjY2VkaWwiOiAyMzEsCiAgICAgICAgImVhY3V0ZSI6IDIzMywKICAgICAgICAiZWNpcmMiOiAyMzQsCiAgICAgICAgImVncmF2ZSI6IDIzMiwKICAgICAgICAiZXRoIjogMjQwLAogICAgICAgICJldW1sIjogMjM1LAogICAgICAgICJpYWN1dGUiOiAyMzcsCiAgICAgICAgImljaXJjIjogMjM4LAogICAgICAgICJpZ3JhdmUiOiAyMzYsCiAgICAgICAgIml1bWwiOiAyMzksCiAgICAgICAgIm50aWxkZSI6IDI0MSwKICAgICAgICAib2FjdXRlIjogMjQzLAogICAgICAgICJvY2lyYyI6IDI0NCwKICAgICAgICAib2dyYXZlIjogMjQyLAogICAgICAgICJvc2xhc2giOiAyNDgsCiAgICAgICAgIm90aWxkZSI6IDI0NSwKICAgICAgICAib3VtbCI6IDI0NiwKICAgICAgICAic3psaWciOiAyMjMsCiAgICAgICAgInRob3JuIjogMjU0LAogICAgICAgICJ1YWN1dGUiOiAyNTAsCiAgICAgICAgInVjaXJjIjogMjUxLAogICAgICAgICJ1Z3JhdmUiOiAyNDksCiAgICAgICAgInV1bWwiOiAyNTIsCiAgICAgICAgInlhY3V0ZSI6IDI1MywKICAgICAgICAieXVtbCI6IDI1NSwKICAgICAgICAiY29weSI6IDE2OSwKICAgICAgICAicmVnIjogMTc0LAogICAgICAgICJuYnNwIjogMTYwLAogICAgICAgICJpZXhjbCI6IDE2MSwKICAgICAgICAiY2VudCI6IDE2MiwKICAgICAgICAicG91bmQiOiAxNjMsCiAgICAgICAgImN1cnJlbiI6IDE2NCwKICAgICAgICAieWVuIjogMTY1LAogICAgICAgICJicnZiYXIiOiAxNjYsCiAgICAgICAgInNlY3QiOiAxNjcsCiAgICAgICAgInVtbCI6IDE2OCwKICAgICAgICAib3JkZiI6IDE3MCwKICAgICAgICAibGFxdW8iOiAxNzEsCiAgICAgICAgIm5vdCI6IDE3MiwKICAgICAgICAic2h5IjogMTczLAogICAgICAgICJtYWNyIjogMTc1LAogICAgICAgICJkZWciOiAxNzYsCiAgICAgICAgInBsdXNtbiI6IDE3NywKICAgICAgICAic3VwMSI6IDE4NSwKICAgICAgICAic3VwMiI6IDE3OCwKICAgICAgICAic3VwMyI6IDE3OSwKICAgICAgICAiYWN1dGUiOiAxODAsCiAgICAgICAgIm1pY3JvIjogMTgxLAogICAgICAgICJwYXJhIjogMTgyLAogICAgICAgICJtaWRkb3QiOiAxODMsCiAgICAgICAgImNlZGlsIjogMTg0LAogICAgICAgICJvcmRtIjogMTg2LAogICAgICAgICJyYXF1byI6IDE4NywKICAgICAgICAiZnJhYzE0IjogMTg4LAogICAgICAgICJmcmFjMTIiOiAxODksCiAgICAgICAgImZyYWMzNCI6IDE5MCwKICAgICAgICAiaXF1ZXN0IjogMTkxLAogICAgICAgICJ0aW1lcyI6IDIxNSwKICAgICAgICAiZGl2aWRlIjogMjQ3LAogICAgICAgICJPRWxpZyI6IDMzOCwKICAgICAgICAib2VsaWciOiAzMzksCiAgICAgICAgIlNjYXJvbiI6IDM1MiwKICAgICAgICAic2Nhcm9uIjogMzUzLAogICAgICAgICJZdW1sIjogMzc2LAogICAgICAgICJmbm9mIjogNDAyLAogICAgICAgICJjaXJjIjogNzEwLAogICAgICAgICJ0aWxkZSI6IDczMiwKICAgICAgICAiQWxwaGEiOiA5MTMsCiAgICAgICAgIkJldGEiOiA5MTQsCiAgICAgICAgIkdhbW1hIjogOTE1LAogICAgICAgICJEZWx0YSI6IDkxNiwKICAgICAgICAiRXBzaWxvbiI6IDkxNywKICAgICAgICAiWmV0YSI6IDkxOCwKICAgICAgICAiRXRhIjogOTE5LAogICAgICAgICJUaGV0YSI6IDkyMCwKICAgICAgICAiSW90YSI6IDkyMSwKICAgICAgICAiS2FwcGEiOiA5MjIsCiAgICAgICAgIkxhbWJkYSI6IDkyMywKICAgICAgICAiTXUiOiA5MjQsCiAgICAgICAgIk51IjogOTI1LAogICAgICAgICJYaSI6IDkyNiwKICAgICAgICAiT21pY3JvbiI6IDkyNywKICAgICAgICAiUGkiOiA5MjgsCiAgICAgICAgIlJobyI6IDkyOSwKICAgICAgICAiU2lnbWEiOiA5MzEsCiAgICAgICAgIlRhdSI6IDkzMiwKICAgICAgICAiVXBzaWxvbiI6IDkzMywKICAgICAgICAiUGhpIjogOTM0LAogICAgICAgICJDaGkiOiA5MzUsCiAgICAgICAgIlBzaSI6IDkzNiwKICAgICAgICAiT21lZ2EiOiA5MzcsCiAgICAgICAgImFscGhhIjogOTQ1LAogICAgICAgICJiZXRhIjogOTQ2LAogICAgICAgICJnYW1tYSI6IDk0NywKICAgICAgICAiZGVsdGEiOiA5NDgsCiAgICAgICAgImVwc2lsb24iOiA5NDksCiAgICAgICAgInpldGEiOiA5NTAsCiAgICAgICAgImV0YSI6IDk1MSwKICAgICAgICAidGhldGEiOiA5NTIsCiAgICAgICAgImlvdGEiOiA5NTMsCiAgICAgICAgImthcHBhIjogOTU0LAogICAgICAgICJsYW1iZGEiOiA5NTUsCiAgICAgICAgIm11IjogOTU2LAogICAgICAgICJudSI6IDk1NywKICAgICAgICAieGkiOiA5NTgsCiAgICAgICAgIm9taWNyb24iOiA5NTksCiAgICAgICAgInBpIjogOTYwLAogICAgICAgICJyaG8iOiA5NjEsCiAgICAgICAgInNpZ21hZiI6IDk2MiwKICAgICAgICAic2lnbWEiOiA5NjMsCiAgICAgICAgInRhdSI6IDk2NCwKICAgICAgICAidXBzaWxvbiI6IDk2NSwKICAgICAgICAicGhpIjogOTY2LAogICAgICAgICJjaGkiOiA5NjcsCiAgICAgICAgInBzaSI6IDk2OCwKICAgICAgICAib21lZ2EiOiA5NjksCiAgICAgICAgInRoZXRhc3ltIjogOTc3LAogICAgICAgICJ1cHNpaCI6IDk3OCwKICAgICAgICAicGl2IjogOTgyLAogICAgICAgICJlbnNwIjogODE5NCwKICAgICAgICAiZW1zcCI6IDgxOTUsCiAgICAgICAgInRoaW5zcCI6IDgyMDEsCiAgICAgICAgInp3bmoiOiA4MjA0LAogICAgICAgICJ6d2oiOiA4MjA1LAogICAgICAgICJscm0iOiA4MjA2LAogICAgICAgICJybG0iOiA4MjA3LAogICAgICAgICJuZGFzaCI6IDgyMTEsCiAgICAgICAgIm1kYXNoIjogODIxMiwKICAgICAgICAibHNxdW8iOiA4MjE2LAogICAgICAgICJyc3F1byI6IDgyMTcsCiAgICAgICAgInNicXVvIjogODIxOCwKICAgICAgICAibGRxdW8iOiA4MjIwLAogICAgICAgICJyZHF1byI6IDgyMjEsCiAgICAgICAgImJkcXVvIjogODIyMiwKICAgICAgICAiZGFnZ2VyIjogODIyNCwKICAgICAgICAiRGFnZ2VyIjogODIyNSwKICAgICAgICAiYnVsbCI6IDgyMjYsCiAgICAgICAgImhlbGxpcCI6IDgyMzAsCiAgICAgICAgInBlcm1pbCI6IDgyNDAsCiAgICAgICAgInByaW1lIjogODI0MiwKICAgICAgICAiUHJpbWUiOiA4MjQzLAogICAgICAgICJsc2FxdW8iOiA4MjQ5LAogICAgICAgICJyc2FxdW8iOiA4MjUwLAogICAgICAgICJvbGluZSI6IDgyNTQsCiAgICAgICAgImZyYXNsIjogODI2MCwKICAgICAgICAiZXVybyI6IDgzNjQsCiAgICAgICAgImltYWdlIjogODQ2NSwKICAgICAgICAid2VpZXJwIjogODQ3MiwKICAgICAgICAicmVhbCI6IDg0NzYsCiAgICAgICAgInRyYWRlIjogODQ4MiwKICAgICAgICAiYWxlZnN5bSI6IDg1MDEsCiAgICAgICAgImxhcnIiOiA4NTkyLAogICAgICAgICJ1YXJyIjogODU5MywKICAgICAgICAicmFyciI6IDg1OTQsCiAgICAgICAgImRhcnIiOiA4NTk1LAogICAgICAgICJoYXJyIjogODU5NiwKICAgICAgICAiY3JhcnIiOiA4NjI5LAogICAgICAgICJsQXJyIjogODY1NiwKICAgICAgICAidUFyciI6IDg2NTcsCiAgICAgICAgInJBcnIiOiA4NjU4LAogICAgICAgICJkQXJyIjogODY1OSwKICAgICAgICAiaEFyciI6IDg2NjAsCiAgICAgICAgImZvcmFsbCI6IDg3MDQsCiAgICAgICAgInBhcnQiOiA4NzA2LAogICAgICAgICJleGlzdCI6IDg3MDcsCiAgICAgICAgImVtcHR5IjogODcwOSwKICAgICAgICAibmFibGEiOiA4NzExLAogICAgICAgICJpc2luIjogODcxMiwKICAgICAgICAibm90aW4iOiA4NzEzLAogICAgICAgICJuaSI6IDg3MTUsCiAgICAgICAgInByb2QiOiA4NzE5LAogICAgICAgICJzdW0iOiA4NzIxLAogICAgICAgICJtaW51cyI6IDg3MjIsCiAgICAgICAgImxvd2FzdCI6IDg3MjcsCiAgICAgICAgInJhZGljIjogODczMCwKICAgICAgICAicHJvcCI6IDg3MzMsCiAgICAgICAgImluZmluIjogODczNCwKICAgICAgICAiYW5nIjogODczNiwKICAgICAgICAiYW5kIjogODc0MywKICAgICAgICAib3IiOiA4NzQ0LAogICAgICAgICJjYXAiOiA4NzQ1LAogICAgICAgICJjdXAiOiA4NzQ2LAogICAgICAgICJpbnQiOiA4NzQ3LAogICAgICAgICJ0aGVyZTQiOiA4NzU2LAogICAgICAgICJzaW0iOiA4NzY0LAogICAgICAgICJjb25nIjogODc3MywKICAgICAgICAiYXN5bXAiOiA4Nzc2LAogICAgICAgICJuZSI6IDg4MDAsCiAgICAgICAgImVxdWl2IjogODgwMSwKICAgICAgICAibGUiOiA4ODA0LAogICAgICAgICJnZSI6IDg4MDUsCiAgICAgICAgInN1YiI6IDg4MzQsCiAgICAgICAgInN1cCI6IDg4MzUsCiAgICAgICAgIm5zdWIiOiA4ODM2LAogICAgICAgICJzdWJlIjogODgzOCwKICAgICAgICAic3VwZSI6IDg4MzksCiAgICAgICAgIm9wbHVzIjogODg1MywKICAgICAgICAib3RpbWVzIjogODg1NSwKICAgICAgICAicGVycCI6IDg4NjksCiAgICAgICAgInNkb3QiOiA4OTAxLAogICAgICAgICJsY2VpbCI6IDg5NjgsCiAgICAgICAgInJjZWlsIjogODk2OSwKICAgICAgICAibGZsb29yIjogODk3MCwKICAgICAgICAicmZsb29yIjogODk3MSwKICAgICAgICAibGFuZyI6IDkwMDEsCiAgICAgICAgInJhbmciOiA5MDAyLAogICAgICAgICJsb3oiOiA5Njc0LAogICAgICAgICJzcGFkZXMiOiA5ODI0LAogICAgICAgICJjbHVicyI6IDk4MjcsCiAgICAgICAgImhlYXJ0cyI6IDk4MjksCiAgICAgICAgImRpYW1zIjogOTgzMAogICAgICB9OwogICAgICBPYmplY3Qua2V5cyhzYXguRU5USVRJRVMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgdmFyIGUgPSBzYXguRU5USVRJRVNba2V5XTsKICAgICAgICB2YXIgcyA9IHR5cGVvZiBlID09PSAnbnVtYmVyJyA/IFN0cmluZy5mcm9tQ2hhckNvZGUoZSkgOiBlOwogICAgICAgIHNheC5FTlRJVElFU1trZXldID0gczsKICAgICAgfSk7CiAgICAgIGZvciAodmFyIFMgaW4gc2F4LlNUQVRFKQogICAgICAgIHNheC5TVEFURVtzYXguU1RBVEVbU11dID0gUzsKICAgICAgUyA9IHNheC5TVEFURTsKICAgICAgZnVuY3Rpb24gZW1pdChwYXJzZXIsIGV2ZW50LCBkYXRhKSB7CiAgICAgICAgcGFyc2VyW2V2ZW50XSAmJiBwYXJzZXJbZXZlbnRdKGRhdGEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGVtaXROb2RlKHBhcnNlciwgbm9kZVR5cGUsIGRhdGEpIHsKICAgICAgICBpZiAocGFyc2VyLnRleHROb2RlKQogICAgICAgICAgY2xvc2VUZXh0KHBhcnNlcik7CiAgICAgICAgZW1pdChwYXJzZXIsIG5vZGVUeXBlLCBkYXRhKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjbG9zZVRleHQocGFyc2VyKSB7CiAgICAgICAgcGFyc2VyLnRleHROb2RlID0gdGV4dG9wdHMocGFyc2VyLm9wdCwgcGFyc2VyLnRleHROb2RlKTsKICAgICAgICBpZiAocGFyc2VyLnRleHROb2RlKQogICAgICAgICAgZW1pdChwYXJzZXIsICJvbnRleHQiLCBwYXJzZXIudGV4dE5vZGUpOwogICAgICAgIHBhcnNlci50ZXh0Tm9kZSA9ICIiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHRleHRvcHRzKG9wdCwgdGV4dCkgewogICAgICAgIGlmIChvcHQudHJpbSkKICAgICAgICAgIHRleHQgPSB0ZXh0LnRyaW0oKTsKICAgICAgICBpZiAob3B0Lm5vcm1hbGl6ZSkKICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xzKy9nLCAiICIpOwogICAgICAgIHJldHVybiB0ZXh0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGVycm9yKHBhcnNlciwgZXIpIHsKICAgICAgICBjbG9zZVRleHQocGFyc2VyKTsKICAgICAgICBpZiAocGFyc2VyLnRyYWNrUG9zaXRpb24pIHsKICAgICAgICAgIGVyICs9ICJcbkxpbmU6ICIgKyBwYXJzZXIubGluZSArICJcbkNvbHVtbjogIiArIHBhcnNlci5jb2x1bW4gKyAiXG5DaGFyOiAiICsgcGFyc2VyLmM7CiAgICAgICAgfQogICAgICAgIGVyID0gbmV3IEVycm9yKGVyKTsKICAgICAgICBwYXJzZXIuZXJyb3IgPSBlcjsKICAgICAgICBlbWl0KHBhcnNlciwgIm9uZXJyb3IiLCBlcik7CiAgICAgICAgcmV0dXJuIHBhcnNlcjsKICAgICAgfQogICAgICBmdW5jdGlvbiBlbmQocGFyc2VyKSB7CiAgICAgICAgaWYgKCFwYXJzZXIuY2xvc2VkUm9vdCkKICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiVW5jbG9zZWQgcm9vdCB0YWciKTsKICAgICAgICBpZiAoKHBhcnNlci5zdGF0ZSAhPT0gUy5CRUdJTikgJiYgKHBhcnNlci5zdGF0ZSAhPT0gUy5URVhUKSkKICAgICAgICAgIGVycm9yKHBhcnNlciwgIlVuZXhwZWN0ZWQgZW5kIik7CiAgICAgICAgY2xvc2VUZXh0KHBhcnNlcik7CiAgICAgICAgcGFyc2VyLmMgPSAiIjsKICAgICAgICBwYXJzZXIuY2xvc2VkID0gdHJ1ZTsKICAgICAgICBlbWl0KHBhcnNlciwgIm9uZW5kIik7CiAgICAgICAgU0FYUGFyc2VyLmNhbGwocGFyc2VyLCBwYXJzZXIuc3RyaWN0LCBwYXJzZXIub3B0KTsKICAgICAgICByZXR1cm4gcGFyc2VyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHN0cmljdEZhaWwocGFyc2VyLCBtZXNzYWdlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBwYXJzZXIgIT09ICdvYmplY3QnIHx8ICEocGFyc2VyIGluc3RhbmNlb2YgU0FYUGFyc2VyKSkKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYmFkIGNhbGwgdG8gc3RyaWN0RmFpbCcpOwogICAgICAgIGlmIChwYXJzZXIuc3RyaWN0KQogICAgICAgICAgZXJyb3IocGFyc2VyLCBtZXNzYWdlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBuZXdUYWcocGFyc2VyKSB7CiAgICAgICAgaWYgKCFwYXJzZXIuc3RyaWN0KQogICAgICAgICAgcGFyc2VyLnRhZ05hbWUgPSBwYXJzZXIudGFnTmFtZVtwYXJzZXIubG9vc2VDYXNlXSgpOwogICAgICAgIHZhciBwYXJlbnQgPSBwYXJzZXIudGFnc1twYXJzZXIudGFncy5sZW5ndGggLSAxXSB8fCBwYXJzZXIsCiAgICAgICAgICAgIHRhZyA9IHBhcnNlci50YWcgPSB7CiAgICAgICAgICAgICAgbmFtZTogcGFyc2VyLnRhZ05hbWUsCiAgICAgICAgICAgICAgYXR0cmlidXRlczoge30KICAgICAgICAgICAgfTsKICAgICAgICBpZiAocGFyc2VyLm9wdC54bWxucykKICAgICAgICAgIHRhZy5ucyA9IHBhcmVudC5uczsKICAgICAgICBwYXJzZXIuYXR0cmliTGlzdC5sZW5ndGggPSAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHFuYW1lKG5hbWUsIGF0dHJpYnV0ZSkgewogICAgICAgIHZhciBpID0gbmFtZS5pbmRleE9mKCI6IiksCiAgICAgICAgICAgIHF1YWxOYW1lID0gaSA8IDAgPyBbIiIsIG5hbWVdIDogbmFtZS5zcGxpdCgiOiIpLAogICAgICAgICAgICBwcmVmaXggPSBxdWFsTmFtZVswXSwKICAgICAgICAgICAgbG9jYWwgPSBxdWFsTmFtZVsxXTsKICAgICAgICBpZiAoYXR0cmlidXRlICYmIG5hbWUgPT09ICJ4bWxucyIpIHsKICAgICAgICAgIHByZWZpeCA9ICJ4bWxucyI7CiAgICAgICAgICBsb2NhbCA9ICIiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgcHJlZml4OiBwcmVmaXgsCiAgICAgICAgICBsb2NhbDogbG9jYWwKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGF0dHJpYihwYXJzZXIpIHsKICAgICAgICBpZiAoIXBhcnNlci5zdHJpY3QpCiAgICAgICAgICBwYXJzZXIuYXR0cmliTmFtZSA9IHBhcnNlci5hdHRyaWJOYW1lW3BhcnNlci5sb29zZUNhc2VdKCk7CiAgICAgICAgaWYgKHBhcnNlci5hdHRyaWJMaXN0LmluZGV4T2YocGFyc2VyLmF0dHJpYk5hbWUpICE9PSAtMSB8fCBwYXJzZXIudGFnLmF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkocGFyc2VyLmF0dHJpYk5hbWUpKSB7CiAgICAgICAgICByZXR1cm4gcGFyc2VyLmF0dHJpYk5hbWUgPSBwYXJzZXIuYXR0cmliVmFsdWUgPSAiIjsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcnNlci5vcHQueG1sbnMpIHsKICAgICAgICAgIHZhciBxbiA9IHFuYW1lKHBhcnNlci5hdHRyaWJOYW1lLCB0cnVlKSwKICAgICAgICAgICAgICBwcmVmaXggPSBxbi5wcmVmaXgsCiAgICAgICAgICAgICAgbG9jYWwgPSBxbi5sb2NhbDsKICAgICAgICAgIGlmIChwcmVmaXggPT09ICJ4bWxucyIpIHsKICAgICAgICAgICAgaWYgKGxvY2FsID09PSAieG1sIiAmJiBwYXJzZXIuYXR0cmliVmFsdWUgIT09IFhNTF9OQU1FU1BBQ0UpIHsKICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgInhtbDogcHJlZml4IG11c3QgYmUgYm91bmQgdG8gIiArIFhNTF9OQU1FU1BBQ0UgKyAiXG4iICsgIkFjdHVhbDogIiArIHBhcnNlci5hdHRyaWJWYWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobG9jYWwgPT09ICJ4bWxucyIgJiYgcGFyc2VyLmF0dHJpYlZhbHVlICE9PSBYTUxOU19OQU1FU1BBQ0UpIHsKICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgInhtbG5zOiBwcmVmaXggbXVzdCBiZSBib3VuZCB0byAiICsgWE1MTlNfTkFNRVNQQUNFICsgIlxuIiArICJBY3R1YWw6ICIgKyBwYXJzZXIuYXR0cmliVmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciB0YWcgPSBwYXJzZXIudGFnLAogICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJzZXIudGFnc1twYXJzZXIudGFncy5sZW5ndGggLSAxXSB8fCBwYXJzZXI7CiAgICAgICAgICAgICAgaWYgKHRhZy5ucyA9PT0gcGFyZW50Lm5zKSB7CiAgICAgICAgICAgICAgICB0YWcubnMgPSBPYmplY3QuY3JlYXRlKHBhcmVudC5ucyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRhZy5uc1tsb2NhbF0gPSBwYXJzZXIuYXR0cmliVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlci5hdHRyaWJMaXN0LnB1c2goW3BhcnNlci5hdHRyaWJOYW1lLCBwYXJzZXIuYXR0cmliVmFsdWVdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFyc2VyLnRhZy5hdHRyaWJ1dGVzW3BhcnNlci5hdHRyaWJOYW1lXSA9IHBhcnNlci5hdHRyaWJWYWx1ZTsKICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uYXR0cmlidXRlIiwgewogICAgICAgICAgICBuYW1lOiBwYXJzZXIuYXR0cmliTmFtZSwKICAgICAgICAgICAgdmFsdWU6IHBhcnNlci5hdHRyaWJWYWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHBhcnNlci5hdHRyaWJOYW1lID0gcGFyc2VyLmF0dHJpYlZhbHVlID0gIiI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb3BlblRhZyhwYXJzZXIsIHNlbGZDbG9zaW5nKSB7CiAgICAgICAgaWYgKHBhcnNlci5vcHQueG1sbnMpIHsKICAgICAgICAgIHZhciB0YWcgPSBwYXJzZXIudGFnOwogICAgICAgICAgdmFyIHFuID0gcW5hbWUocGFyc2VyLnRhZ05hbWUpOwogICAgICAgICAgdGFnLnByZWZpeCA9IHFuLnByZWZpeDsKICAgICAgICAgIHRhZy5sb2NhbCA9IHFuLmxvY2FsOwogICAgICAgICAgdGFnLnVyaSA9IHRhZy5uc1txbi5wcmVmaXhdIHx8ICIiOwogICAgICAgICAgaWYgKHRhZy5wcmVmaXggJiYgIXRhZy51cmkpIHsKICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJVbmJvdW5kIG5hbWVzcGFjZSBwcmVmaXg6ICIgKyBKU09OLnN0cmluZ2lmeShwYXJzZXIudGFnTmFtZSkpOwogICAgICAgICAgICB0YWcudXJpID0gcW4ucHJlZml4OwogICAgICAgICAgfQogICAgICAgICAgdmFyIHBhcmVudCA9IHBhcnNlci50YWdzW3BhcnNlci50YWdzLmxlbmd0aCAtIDFdIHx8IHBhcnNlcjsKICAgICAgICAgIGlmICh0YWcubnMgJiYgcGFyZW50Lm5zICE9PSB0YWcubnMpIHsKICAgICAgICAgICAgT2JqZWN0LmtleXModGFnLm5zKS5mb3JFYWNoKGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbm9wZW5uYW1lc3BhY2UiLCB7CiAgICAgICAgICAgICAgICBwcmVmaXg6IHAsCiAgICAgICAgICAgICAgICB1cmk6IHRhZy5uc1twXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGkgPSAwLAogICAgICAgICAgICAgIGwgPSBwYXJzZXIuYXR0cmliTGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgdmFyIG52ID0gcGFyc2VyLmF0dHJpYkxpc3RbaV07CiAgICAgICAgICAgIHZhciBuYW1lID0gbnZbMF0sCiAgICAgICAgICAgICAgICB2YWx1ZSA9IG52WzFdLAogICAgICAgICAgICAgICAgcXVhbE5hbWUgPSBxbmFtZShuYW1lLCB0cnVlKSwKICAgICAgICAgICAgICAgIHByZWZpeCA9IHF1YWxOYW1lLnByZWZpeCwKICAgICAgICAgICAgICAgIGxvY2FsID0gcXVhbE5hbWUubG9jYWwsCiAgICAgICAgICAgICAgICB1cmkgPSBwcmVmaXggPT0gIiIgPyAiIiA6ICh0YWcubnNbcHJlZml4XSB8fCAiIiksCiAgICAgICAgICAgICAgICBhID0gewogICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgIHByZWZpeDogcHJlZml4LAogICAgICAgICAgICAgICAgICBsb2NhbDogbG9jYWwsCiAgICAgICAgICAgICAgICAgIHVyaTogdXJpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAocHJlZml4ICYmIHByZWZpeCAhPSAieG1sbnMiICYmICF1cmkpIHsKICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIlVuYm91bmQgbmFtZXNwYWNlIHByZWZpeDogIiArIEpTT04uc3RyaW5naWZ5KHByZWZpeCkpOwogICAgICAgICAgICAgIGEudXJpID0gcHJlZml4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhcnNlci50YWcuYXR0cmlidXRlc1tuYW1lXSA9IGE7CiAgICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uYXR0cmlidXRlIiwgYSk7CiAgICAgICAgICB9CiAgICAgICAgICBwYXJzZXIuYXR0cmliTGlzdC5sZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgICBwYXJzZXIudGFnLmlzU2VsZkNsb3NpbmcgPSAhIXNlbGZDbG9zaW5nOwogICAgICAgIHBhcnNlci5zYXdSb290ID0gdHJ1ZTsKICAgICAgICBwYXJzZXIudGFncy5wdXNoKHBhcnNlci50YWcpOwogICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9ub3BlbnRhZyIsIHBhcnNlci50YWcpOwogICAgICAgIGlmICghc2VsZkNsb3NpbmcpIHsKICAgICAgICAgIGlmICghcGFyc2VyLm5vc2NyaXB0ICYmIHBhcnNlci50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzY3JpcHQiKSB7CiAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuU0NSSVBUOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5URVhUOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VyLnRhZyA9IG51bGw7CiAgICAgICAgICBwYXJzZXIudGFnTmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICBwYXJzZXIuYXR0cmliTmFtZSA9IHBhcnNlci5hdHRyaWJWYWx1ZSA9ICIiOwogICAgICAgIHBhcnNlci5hdHRyaWJMaXN0Lmxlbmd0aCA9IDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2xvc2VUYWcocGFyc2VyKSB7CiAgICAgICAgaWYgKCFwYXJzZXIudGFnTmFtZSkgewogICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJXZWlyZCBlbXB0eSBjbG9zZSB0YWcuIik7CiAgICAgICAgICBwYXJzZXIudGV4dE5vZGUgKz0gIjwvPiI7CiAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQ7CiAgICAgICAgICByZXR1cm4gOwogICAgICAgIH0KICAgICAgICBpZiAocGFyc2VyLnNjcmlwdCkgewogICAgICAgICAgaWYgKHBhcnNlci50YWdOYW1lICE9PSAic2NyaXB0IikgewogICAgICAgICAgICBwYXJzZXIuc2NyaXB0ICs9ICI8LyIgKyBwYXJzZXIudGFnTmFtZSArICI+IjsKICAgICAgICAgICAgcGFyc2VyLnRhZ05hbWUgPSAiIjsKICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5TQ1JJUFQ7CiAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICB9CiAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbnNjcmlwdCIsIHBhcnNlci5zY3JpcHQpOwogICAgICAgICAgcGFyc2VyLnNjcmlwdCA9ICIiOwogICAgICAgIH0KICAgICAgICB2YXIgdCA9IHBhcnNlci50YWdzLmxlbmd0aDsKICAgICAgICB2YXIgdGFnTmFtZSA9IHBhcnNlci50YWdOYW1lOwogICAgICAgIGlmICghcGFyc2VyLnN0cmljdCkKICAgICAgICAgIHRhZ05hbWUgPSB0YWdOYW1lW3BhcnNlci5sb29zZUNhc2VdKCk7CiAgICAgICAgdmFyIGNsb3NlVG8gPSB0YWdOYW1lOwogICAgICAgIHdoaWxlICh0LS0pIHsKICAgICAgICAgIHZhciBjbG9zZSA9IHBhcnNlci50YWdzW3RdOwogICAgICAgICAgaWYgKGNsb3NlLm5hbWUgIT09IGNsb3NlVG8pIHsKICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJVbmV4cGVjdGVkIGNsb3NlIHRhZyIpOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodCA8IDApIHsKICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiVW5tYXRjaGVkIGNsb3NpbmcgdGFnOiAiICsgcGFyc2VyLnRhZ05hbWUpOwogICAgICAgICAgcGFyc2VyLnRleHROb2RlICs9ICI8LyIgKyBwYXJzZXIudGFnTmFtZSArICI+IjsKICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVDsKICAgICAgICAgIHJldHVybiA7CiAgICAgICAgfQogICAgICAgIHBhcnNlci50YWdOYW1lID0gdGFnTmFtZTsKICAgICAgICB2YXIgcyA9IHBhcnNlci50YWdzLmxlbmd0aDsKICAgICAgICB3aGlsZSAocy0tID4gdCkgewogICAgICAgICAgdmFyIHRhZyA9IHBhcnNlci50YWcgPSBwYXJzZXIudGFncy5wb3AoKTsKICAgICAgICAgIHBhcnNlci50YWdOYW1lID0gcGFyc2VyLnRhZy5uYW1lOwogICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25jbG9zZXRhZyIsIHBhcnNlci50YWdOYW1lKTsKICAgICAgICAgIHZhciB4ID0ge307CiAgICAgICAgICBmb3IgKHZhciBpIGluIHRhZy5ucykKICAgICAgICAgICAgeFtpXSA9IHRhZy5uc1tpXTsKICAgICAgICAgIHZhciBwYXJlbnQgPSBwYXJzZXIudGFnc1twYXJzZXIudGFncy5sZW5ndGggLSAxXSB8fCBwYXJzZXI7CiAgICAgICAgICBpZiAocGFyc2VyLm9wdC54bWxucyAmJiB0YWcubnMgIT09IHBhcmVudC5ucykgewogICAgICAgICAgICBPYmplY3Qua2V5cyh0YWcubnMpLmZvckVhY2goZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgIHZhciBuID0gdGFnLm5zW3BdOwogICAgICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9uY2xvc2VuYW1lc3BhY2UiLCB7CiAgICAgICAgICAgICAgICBwcmVmaXg6IHAsCiAgICAgICAgICAgICAgICB1cmk6IG4KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0ID09PSAwKQogICAgICAgICAgcGFyc2VyLmNsb3NlZFJvb3QgPSB0cnVlOwogICAgICAgIHBhcnNlci50YWdOYW1lID0gcGFyc2VyLmF0dHJpYlZhbHVlID0gcGFyc2VyLmF0dHJpYk5hbWUgPSAiIjsKICAgICAgICBwYXJzZXIuYXR0cmliTGlzdC5sZW5ndGggPSAwOwogICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVDsKICAgICAgfQogICAgICBmdW5jdGlvbiBwYXJzZUVudGl0eShwYXJzZXIpIHsKICAgICAgICB2YXIgZW50aXR5ID0gcGFyc2VyLmVudGl0eSwKICAgICAgICAgICAgZW50aXR5TEMgPSBlbnRpdHkudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgbnVtLAogICAgICAgICAgICBudW1TdHIgPSAiIjsKICAgICAgICBpZiAocGFyc2VyLkVOVElUSUVTW2VudGl0eV0pCiAgICAgICAgICByZXR1cm4gcGFyc2VyLkVOVElUSUVTW2VudGl0eV07CiAgICAgICAgaWYgKHBhcnNlci5FTlRJVElFU1tlbnRpdHlMQ10pCiAgICAgICAgICByZXR1cm4gcGFyc2VyLkVOVElUSUVTW2VudGl0eUxDXTsKICAgICAgICBlbnRpdHkgPSBlbnRpdHlMQzsKICAgICAgICBpZiAoZW50aXR5LmNoYXJBdCgwKSA9PT0gIiMiKSB7CiAgICAgICAgICBpZiAoZW50aXR5LmNoYXJBdCgxKSA9PT0gIngiKSB7CiAgICAgICAgICAgIGVudGl0eSA9IGVudGl0eS5zbGljZSgyKTsKICAgICAgICAgICAgbnVtID0gcGFyc2VJbnQoZW50aXR5LCAxNik7CiAgICAgICAgICAgIG51bVN0ciA9IG51bS50b1N0cmluZygxNik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbnRpdHkgPSBlbnRpdHkuc2xpY2UoMSk7CiAgICAgICAgICAgIG51bSA9IHBhcnNlSW50KGVudGl0eSwgMTApOwogICAgICAgICAgICBudW1TdHIgPSBudW0udG9TdHJpbmcoMTApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbnRpdHkgPSBlbnRpdHkucmVwbGFjZSgvXjArLywgIiIpOwogICAgICAgIGlmIChudW1TdHIudG9Mb3dlckNhc2UoKSAhPT0gZW50aXR5KSB7CiAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkludmFsaWQgY2hhcmFjdGVyIGVudGl0eSIpOwogICAgICAgICAgcmV0dXJuICImIiArIHBhcnNlci5lbnRpdHkgKyAiOyI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChudW0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHdyaXRlKGNodW5rKSB7CiAgICAgICAgdmFyIHBhcnNlciA9IHRoaXM7CiAgICAgICAgaWYgKHRoaXMuZXJyb3IpCiAgICAgICAgICB0aHJvdyB0aGlzLmVycm9yOwogICAgICAgIGlmIChwYXJzZXIuY2xvc2VkKQogICAgICAgICAgcmV0dXJuIGVycm9yKHBhcnNlciwgIkNhbm5vdCB3cml0ZSBhZnRlciBjbG9zZS4gQXNzaWduIGFuIG9ucmVhZHkgaGFuZGxlci4iKTsKICAgICAgICBpZiAoY2h1bmsgPT09IG51bGwpCiAgICAgICAgICByZXR1cm4gZW5kKHBhcnNlcik7CiAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICBjID0gIiI7CiAgICAgICAgd2hpbGUgKHBhcnNlci5jID0gYyA9IGNodW5rLmNoYXJBdChpKyspKSB7CiAgICAgICAgICBpZiAocGFyc2VyLnRyYWNrUG9zaXRpb24pIHsKICAgICAgICAgICAgcGFyc2VyLnBvc2l0aW9uKys7CiAgICAgICAgICAgIGlmIChjID09PSAiXG4iKSB7CiAgICAgICAgICAgICAgcGFyc2VyLmxpbmUrKzsKICAgICAgICAgICAgICBwYXJzZXIuY29sdW1uID0gMDsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbisrOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChwYXJzZXIuc3RhdGUpIHsKICAgICAgICAgICAgY2FzZSBTLkJFR0lOOgogICAgICAgICAgICAgIGlmIChjID09PSAiPCIpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuT1BFTl9XQUtBOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXJ0VGFnUG9zaXRpb24gPSBwYXJzZXIucG9zaXRpb247CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChub3Qod2hpdGVzcGFjZSwgYykpIHsKICAgICAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiTm9uLXdoaXRlc3BhY2UgYmVmb3JlIGZpcnN0IHRhZy4iKTsKICAgICAgICAgICAgICAgIHBhcnNlci50ZXh0Tm9kZSA9IGM7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuVEVYVDoKICAgICAgICAgICAgICBpZiAocGFyc2VyLnNhd1Jvb3QgJiYgIXBhcnNlci5jbG9zZWRSb290KSB7CiAgICAgICAgICAgICAgICB2YXIgc3RhcnRpID0gaSAtIDE7CiAgICAgICAgICAgICAgICB3aGlsZSAoYyAmJiBjICE9PSAiPCIgJiYgYyAhPT0gIiYiKSB7CiAgICAgICAgICAgICAgICAgIGMgPSBjaHVuay5jaGFyQXQoaSsrKTsKICAgICAgICAgICAgICAgICAgaWYgKGMgJiYgcGFyc2VyLnRyYWNrUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwYXJzZXIucG9zaXRpb24rKzsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PT0gIlxuIikgewogICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmxpbmUrKzsKICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gPSAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbisrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwYXJzZXIudGV4dE5vZGUgKz0gY2h1bmsuc3Vic3RyaW5nKHN0YXJ0aSwgaSAtIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoYyA9PT0gIjwiKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLk9QRU5fV0FLQTsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGFydFRhZ1Bvc2l0aW9uID0gcGFyc2VyLnBvc2l0aW9uOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobm90KHdoaXRlc3BhY2UsIGMpICYmICghcGFyc2VyLnNhd1Jvb3QgfHwgcGFyc2VyLmNsb3NlZFJvb3QpKQogICAgICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIlRleHQgZGF0YSBvdXRzaWRlIG9mIHJvb3Qgbm9kZS4iKTsKICAgICAgICAgICAgICAgIGlmIChjID09PSAiJiIpCiAgICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVF9FTlRJVFk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgIHBhcnNlci50ZXh0Tm9kZSArPSBjOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLlNDUklQVDoKICAgICAgICAgICAgICBpZiAoYyA9PT0gIjwiKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlNDUklQVF9FTkRJTkc7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBwYXJzZXIuc2NyaXB0ICs9IGM7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5TQ1JJUFRfRU5ESU5HOgogICAgICAgICAgICAgIGlmIChjID09PSAiLyIpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ0xPU0VfVEFHOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc2NyaXB0ICs9ICI8IiArIGM7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlNDUklQVDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5PUEVOX1dBS0E6CiAgICAgICAgICAgICAgaWYgKGMgPT09ICIhIikgewogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5TR01MX0RFQ0w7CiAgICAgICAgICAgICAgICBwYXJzZXIuc2dtbERlY2wgPSAiIjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKSB7fSBlbHNlIGlmIChpcyhuYW1lU3RhcnQsIGMpKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLk9QRU5fVEFHOwogICAgICAgICAgICAgICAgcGFyc2VyLnRhZ05hbWUgPSBjOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gIi8iKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkNMT1NFX1RBRzsKICAgICAgICAgICAgICAgIHBhcnNlci50YWdOYW1lID0gIiI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChjID09PSAiPyIpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuUFJPQ19JTlNUOwogICAgICAgICAgICAgICAgcGFyc2VyLnByb2NJbnN0TmFtZSA9IHBhcnNlci5wcm9jSW5zdEJvZHkgPSAiIjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJVbmVuY29kZWQgPCIpOwogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5zdGFydFRhZ1Bvc2l0aW9uICsgMSA8IHBhcnNlci5wb3NpdGlvbikgewogICAgICAgICAgICAgICAgICB2YXIgcGFkID0gcGFyc2VyLnBvc2l0aW9uIC0gcGFyc2VyLnN0YXJ0VGFnUG9zaXRpb247CiAgICAgICAgICAgICAgICAgIGMgPSBuZXcgQXJyYXkocGFkKS5qb2luKCIgIikgKyBjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGFyc2VyLnRleHROb2RlICs9ICI8IiArIGM7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuU0dNTF9ERUNMOgogICAgICAgICAgICAgIGlmICgocGFyc2VyLnNnbWxEZWNsICsgYykudG9VcHBlckNhc2UoKSA9PT0gQ0RBVEEpIHsKICAgICAgICAgICAgICAgIGVtaXROb2RlKHBhcnNlciwgIm9ub3BlbmNkYXRhIik7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkNEQVRBOwogICAgICAgICAgICAgICAgcGFyc2VyLnNnbWxEZWNsID0gIiI7CiAgICAgICAgICAgICAgICBwYXJzZXIuY2RhdGEgPSAiIjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnNlci5zZ21sRGVjbCArIGMgPT09ICItLSIpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ09NTUVOVDsKICAgICAgICAgICAgICAgIHBhcnNlci5jb21tZW50ID0gIiI7CiAgICAgICAgICAgICAgICBwYXJzZXIuc2dtbERlY2wgPSAiIjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKChwYXJzZXIuc2dtbERlY2wgKyBjKS50b1VwcGVyQ2FzZSgpID09PSBET0NUWVBFKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEU7CiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmRvY3R5cGUgfHwgcGFyc2VyLnNhd1Jvb3QpCiAgICAgICAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiSW5hcHByb3ByaWF0ZWx5IGxvY2F0ZWQgZG9jdHlwZSBkZWNsYXJhdGlvbiIpOwogICAgICAgICAgICAgICAgcGFyc2VyLmRvY3R5cGUgPSAiIjsKICAgICAgICAgICAgICAgIHBhcnNlci5zZ21sRGVjbCA9ICIiOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gIj4iKSB7CiAgICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbnNnbWxkZWNsYXJhdGlvbiIsIHBhcnNlci5zZ21sRGVjbCk7CiAgICAgICAgICAgICAgICBwYXJzZXIuc2dtbERlY2wgPSAiIjsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuVEVYVDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzKHF1b3RlLCBjKSkgewogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5TR01MX0RFQ0xfUVVPVEVEOwogICAgICAgICAgICAgICAgcGFyc2VyLnNnbWxEZWNsICs9IGM7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBwYXJzZXIuc2dtbERlY2wgKz0gYzsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLlNHTUxfREVDTF9RVU9URUQ6CiAgICAgICAgICAgICAgaWYgKGMgPT09IHBhcnNlci5xKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlNHTUxfREVDTDsKICAgICAgICAgICAgICAgIHBhcnNlci5xID0gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHBhcnNlci5zZ21sRGVjbCArPSBjOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuRE9DVFlQRToKICAgICAgICAgICAgICBpZiAoYyA9PT0gIj4iKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQ7CiAgICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbmRvY3R5cGUiLCBwYXJzZXIuZG9jdHlwZSk7CiAgICAgICAgICAgICAgICBwYXJzZXIuZG9jdHlwZSA9IHRydWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhcnNlci5kb2N0eXBlICs9IGM7CiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gIlsiKQogICAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEVfRFREOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoaXMocXVvdGUsIGMpKSB7CiAgICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuRE9DVFlQRV9RVU9URUQ7CiAgICAgICAgICAgICAgICAgIHBhcnNlci5xID0gYzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5ET0NUWVBFX1FVT1RFRDoKICAgICAgICAgICAgICBwYXJzZXIuZG9jdHlwZSArPSBjOwogICAgICAgICAgICAgIGlmIChjID09PSBwYXJzZXIucSkgewogICAgICAgICAgICAgICAgcGFyc2VyLnEgPSAiIjsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuRE9DVFlQRTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5ET0NUWVBFX0RURDoKICAgICAgICAgICAgICBwYXJzZXIuZG9jdHlwZSArPSBjOwogICAgICAgICAgICAgIGlmIChjID09PSAiXSIpCiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEU7CiAgICAgICAgICAgICAgZWxzZSBpZiAoaXMocXVvdGUsIGMpKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkRPQ1RZUEVfRFREX1FVT1RFRDsKICAgICAgICAgICAgICAgIHBhcnNlci5xID0gYzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5ET0NUWVBFX0RURF9RVU9URUQ6CiAgICAgICAgICAgICAgcGFyc2VyLmRvY3R5cGUgKz0gYzsKICAgICAgICAgICAgICBpZiAoYyA9PT0gcGFyc2VyLnEpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuRE9DVFlQRV9EVEQ7CiAgICAgICAgICAgICAgICBwYXJzZXIucSA9ICIiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkNPTU1FTlQ6CiAgICAgICAgICAgICAgaWYgKGMgPT09ICItIikKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ09NTUVOVF9FTkRJTkc7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGFyc2VyLmNvbW1lbnQgKz0gYzsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkNPTU1FTlRfRU5ESU5HOgogICAgICAgICAgICAgIGlmIChjID09PSAiLSIpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ09NTUVOVF9FTkRFRDsKICAgICAgICAgICAgICAgIHBhcnNlci5jb21tZW50ID0gdGV4dG9wdHMocGFyc2VyLm9wdCwgcGFyc2VyLmNvbW1lbnQpOwogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5jb21tZW50KQogICAgICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbmNvbW1lbnQiLCBwYXJzZXIuY29tbWVudCk7CiAgICAgICAgICAgICAgICBwYXJzZXIuY29tbWVudCA9ICIiOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuY29tbWVudCArPSAiLSIgKyBjOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DT01NRU5UOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkNPTU1FTlRfRU5ERUQ6CiAgICAgICAgICAgICAgaWYgKGMgIT09ICI+IikgewogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJNYWxmb3JtZWQgY29tbWVudCIpOwogICAgICAgICAgICAgICAgcGFyc2VyLmNvbW1lbnQgKz0gIi0tIiArIGM7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkNPTU1FTlQ7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlRFWFQ7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5DREFUQToKICAgICAgICAgICAgICBpZiAoYyA9PT0gIl0iKQogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DREFUQV9FTkRJTkc7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGFyc2VyLmNkYXRhICs9IGM7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5DREFUQV9FTkRJTkc6CiAgICAgICAgICAgICAgaWYgKGMgPT09ICJdIikKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ0RBVEFfRU5ESU5HXzI7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuY2RhdGEgKz0gIl0iICsgYzsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQ0RBVEE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuQ0RBVEFfRU5ESU5HXzI6CiAgICAgICAgICAgICAgaWYgKGMgPT09ICI+IikgewogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5jZGF0YSkKICAgICAgICAgICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25jZGF0YSIsIHBhcnNlci5jZGF0YSk7CiAgICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbmNsb3NlY2RhdGEiKTsKICAgICAgICAgICAgICAgIHBhcnNlci5jZGF0YSA9ICIiOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5URVhUOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gIl0iKSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuY2RhdGEgKz0gIl0iOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJzZXIuY2RhdGEgKz0gIl1dIiArIGM7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkNEQVRBOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLlBST0NfSU5TVDoKICAgICAgICAgICAgICBpZiAoYyA9PT0gIj8iKQogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5QUk9DX0lOU1RfRU5ESU5HOwogICAgICAgICAgICAgIGVsc2UgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKQogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5QUk9DX0lOU1RfQk9EWTsKICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwYXJzZXIucHJvY0luc3ROYW1lICs9IGM7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5QUk9DX0lOU1RfQk9EWToKICAgICAgICAgICAgICBpZiAoIXBhcnNlci5wcm9jSW5zdEJvZHkgJiYgaXMod2hpdGVzcGFjZSwgYykpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBlbHNlIGlmIChjID09PSAiPyIpCiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlBST0NfSU5TVF9FTkRJTkc7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGFyc2VyLnByb2NJbnN0Qm9keSArPSBjOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuUFJPQ19JTlNUX0VORElORzoKICAgICAgICAgICAgICBpZiAoYyA9PT0gIj4iKSB7CiAgICAgICAgICAgICAgICBlbWl0Tm9kZShwYXJzZXIsICJvbnByb2Nlc3NpbmdpbnN0cnVjdGlvbiIsIHsKICAgICAgICAgICAgICAgICAgbmFtZTogcGFyc2VyLnByb2NJbnN0TmFtZSwKICAgICAgICAgICAgICAgICAgYm9keTogcGFyc2VyLnByb2NJbnN0Qm9keQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBwYXJzZXIucHJvY0luc3ROYW1lID0gcGFyc2VyLnByb2NJbnN0Qm9keSA9ICIiOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5URVhUOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJzZXIucHJvY0luc3RCb2R5ICs9ICI/IiArIGM7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLlBST0NfSU5TVF9CT0RZOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLk9QRU5fVEFHOgogICAgICAgICAgICAgIGlmIChpcyhuYW1lQm9keSwgYykpCiAgICAgICAgICAgICAgICBwYXJzZXIudGFnTmFtZSArPSBjOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbmV3VGFnKHBhcnNlcik7CiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gIj4iKQogICAgICAgICAgICAgICAgICBvcGVuVGFnKHBhcnNlcik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChjID09PSAiLyIpCiAgICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuT1BFTl9UQUdfU0xBU0g7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKG5vdCh3aGl0ZXNwYWNlLCBjKSkKICAgICAgICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkludmFsaWQgY2hhcmFjdGVyIGluIHRhZyBuYW1lIik7CiAgICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLk9QRU5fVEFHX1NMQVNIOgogICAgICAgICAgICAgIGlmIChjID09PSAiPiIpIHsKICAgICAgICAgICAgICAgIG9wZW5UYWcocGFyc2VyLCB0cnVlKTsKICAgICAgICAgICAgICAgIGNsb3NlVGFnKHBhcnNlcik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiRm9yd2FyZC1zbGFzaCBpbiBvcGVuaW5nIHRhZyBub3QgZm9sbG93ZWQgYnkgPiIpOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuQVRUUklCOgogICAgICAgICAgICAgIGlmIChpcyh3aGl0ZXNwYWNlLCBjKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGVsc2UgaWYgKGMgPT09ICI+IikKICAgICAgICAgICAgICAgIG9wZW5UYWcocGFyc2VyKTsKICAgICAgICAgICAgICBlbHNlIGlmIChjID09PSAiLyIpCiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLk9QRU5fVEFHX1NMQVNIOwogICAgICAgICAgICAgIGVsc2UgaWYgKGlzKG5hbWVTdGFydCwgYykpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5hdHRyaWJOYW1lID0gYzsKICAgICAgICAgICAgICAgIHBhcnNlci5hdHRyaWJWYWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfTkFNRTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiSW52YWxpZCBhdHRyaWJ1dGUgbmFtZSIpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuQVRUUklCX05BTUU6CiAgICAgICAgICAgICAgaWYgKGMgPT09ICI9IikKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFOwogICAgICAgICAgICAgIGVsc2UgaWYgKGMgPT09ICI+IikgewogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJBdHRyaWJ1dGUgd2l0aG91dCB2YWx1ZSIpOwogICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gcGFyc2VyLmF0dHJpYk5hbWU7CiAgICAgICAgICAgICAgICBhdHRyaWIocGFyc2VyKTsKICAgICAgICAgICAgICAgIG9wZW5UYWcocGFyc2VyKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKQogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfTkFNRV9TQVdfV0hJVEU7CiAgICAgICAgICAgICAgZWxzZSBpZiAoaXMobmFtZUJvZHksIGMpKQogICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYk5hbWUgKz0gYzsKICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkludmFsaWQgYXR0cmlidXRlIG5hbWUiKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkFUVFJJQl9OQU1FX1NBV19XSElURToKICAgICAgICAgICAgICBpZiAoYyA9PT0gIj0iKQogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfVkFMVUU7CiAgICAgICAgICAgICAgZWxzZSBpZiAoaXMod2hpdGVzcGFjZSwgYykpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiQXR0cmlidXRlIHdpdGhvdXQgdmFsdWUiKTsKICAgICAgICAgICAgICAgIHBhcnNlci50YWcuYXR0cmlidXRlc1twYXJzZXIuYXR0cmliTmFtZV0gPSAiIjsKICAgICAgICAgICAgICAgIHBhcnNlci5hdHRyaWJWYWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgZW1pdE5vZGUocGFyc2VyLCAib25hdHRyaWJ1dGUiLCB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcnNlci5hdHRyaWJOYW1lLAogICAgICAgICAgICAgICAgICB2YWx1ZTogIiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYk5hbWUgPSAiIjsKICAgICAgICAgICAgICAgIGlmIChjID09PSAiPiIpCiAgICAgICAgICAgICAgICAgIG9wZW5UYWcocGFyc2VyKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzKG5hbWVTdGFydCwgYykpIHsKICAgICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYk5hbWUgPSBjOwogICAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQl9OQU1FOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGF0dHJpYnV0ZSBuYW1lIik7CiAgICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkFUVFJJQl9WQUxVRToKICAgICAgICAgICAgICBpZiAoaXMod2hpdGVzcGFjZSwgYykpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBlbHNlIGlmIChpcyhxdW90ZSwgYykpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5xID0gYzsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFX1FVT1RFRDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJVbnF1b3RlZCBhdHRyaWJ1dGUgdmFsdWUiKTsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCX1ZBTFVFX1VOUVVPVEVEOwogICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gYzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5BVFRSSUJfVkFMVUVfUVVPVEVEOgogICAgICAgICAgICAgIGlmIChjICE9PSBwYXJzZXIucSkgewogICAgICAgICAgICAgICAgaWYgKGMgPT09ICImIikKICAgICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfVkFMVUVfRU5USVRZX1E7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgIHBhcnNlci5hdHRyaWJWYWx1ZSArPSBjOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGF0dHJpYihwYXJzZXIpOwogICAgICAgICAgICAgIHBhcnNlci5xID0gIiI7CiAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5BVFRSSUJfVkFMVUVfQ0xPU0VEOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0NMT1NFRDoKICAgICAgICAgICAgICBpZiAoaXMod2hpdGVzcGFjZSwgYykpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuQVRUUklCOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gIj4iKQogICAgICAgICAgICAgICAgb3BlblRhZyhwYXJzZXIpOwogICAgICAgICAgICAgIGVsc2UgaWYgKGMgPT09ICIvIikKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuT1BFTl9UQUdfU0xBU0g7CiAgICAgICAgICAgICAgZWxzZSBpZiAoaXMobmFtZVN0YXJ0LCBjKSkgewogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJObyB3aGl0ZXNwYWNlIGJldHdlZW4gYXR0cmlidXRlcyIpOwogICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYk5hbWUgPSBjOwogICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQl9OQU1FOwogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGF0dHJpYnV0ZSBuYW1lIik7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNhc2UgUy5BVFRSSUJfVkFMVUVfVU5RVU9URUQ6CiAgICAgICAgICAgICAgaWYgKG5vdChhdHRyaWJFbmQsIGMpKSB7CiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gIiYiKQogICAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQl9WQUxVRV9FTlRJVFlfVTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgcGFyc2VyLmF0dHJpYlZhbHVlICs9IGM7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXR0cmliKHBhcnNlcik7CiAgICAgICAgICAgICAgaWYgKGMgPT09ICI+IikKICAgICAgICAgICAgICAgIG9wZW5UYWcocGFyc2VyKTsKICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBwYXJzZXIuc3RhdGUgPSBTLkFUVFJJQjsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkNMT1NFX1RBRzoKICAgICAgICAgICAgICBpZiAoIXBhcnNlci50YWdOYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAoaXMod2hpdGVzcGFjZSwgYykpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgZWxzZSBpZiAobm90KG5hbWVTdGFydCwgYykpIHsKICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5zY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJzZXIuc2NyaXB0ICs9ICI8LyIgKyBjOwogICAgICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuU0NSSVBUOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0cmljdEZhaWwocGFyc2VyLCAiSW52YWxpZCB0YWduYW1lIGluIGNsb3NpbmcgdGFnLiIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgcGFyc2VyLnRhZ05hbWUgPSBjOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gIj4iKQogICAgICAgICAgICAgICAgY2xvc2VUYWcocGFyc2VyKTsKICAgICAgICAgICAgICBlbHNlIGlmIChpcyhuYW1lQm9keSwgYykpCiAgICAgICAgICAgICAgICBwYXJzZXIudGFnTmFtZSArPSBjOwogICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci5zY3JpcHQpIHsKICAgICAgICAgICAgICAgIHBhcnNlci5zY3JpcHQgKz0gIjwvIiArIHBhcnNlci50YWdOYW1lOwogICAgICAgICAgICAgICAgcGFyc2VyLnRhZ05hbWUgPSAiIjsKICAgICAgICAgICAgICAgIHBhcnNlci5zdGF0ZSA9IFMuU0NSSVBUOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobm90KHdoaXRlc3BhY2UsIGMpKQogICAgICAgICAgICAgICAgICBzdHJpY3RGYWlsKHBhcnNlciwgIkludmFsaWQgdGFnbmFtZSBpbiBjbG9zaW5nIHRhZyIpOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gUy5DTE9TRV9UQUdfU0FXX1dISVRFOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLkNMT1NFX1RBR19TQVdfV0hJVEU6CiAgICAgICAgICAgICAgaWYgKGlzKHdoaXRlc3BhY2UsIGMpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgaWYgKGMgPT09ICI+IikKICAgICAgICAgICAgICAgIGNsb3NlVGFnKHBhcnNlcik7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGNoYXJhY3RlcnMgaW4gY2xvc2luZyB0YWciKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSBTLlRFWFRfRU5USVRZOgogICAgICAgICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0VOVElUWV9ROgogICAgICAgICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0VOVElUWV9VOgogICAgICAgICAgICAgIHN3aXRjaCAocGFyc2VyLnN0YXRlKSB7CiAgICAgICAgICAgICAgICBjYXNlIFMuVEVYVF9FTlRJVFk6CiAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5TdGF0ZSA9IFMuVEVYVCwKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9ICJ0ZXh0Tm9kZSI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTLkFUVFJJQl9WQUxVRV9FTlRJVFlfUToKICAgICAgICAgICAgICAgICAgdmFyIHJldHVyblN0YXRlID0gUy5BVFRSSUJfVkFMVUVfUVVPVEVELAogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gImF0dHJpYlZhbHVlIjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFMuQVRUUklCX1ZBTFVFX0VOVElUWV9VOgogICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuU3RhdGUgPSBTLkFUVFJJQl9WQUxVRV9VTlFVT1RFRCwKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9ICJhdHRyaWJWYWx1ZSI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoYyA9PT0gIjsiKSB7CiAgICAgICAgICAgICAgICBwYXJzZXJbYnVmZmVyXSArPSBwYXJzZUVudGl0eShwYXJzZXIpOwogICAgICAgICAgICAgICAgcGFyc2VyLmVudGl0eSA9ICIiOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gcmV0dXJuU3RhdGU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpcyhlbnRpdHksIGMpKQogICAgICAgICAgICAgICAgcGFyc2VyLmVudGl0eSArPSBjOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgc3RyaWN0RmFpbChwYXJzZXIsICJJbnZhbGlkIGNoYXJhY3RlciBlbnRpdHkiKTsKICAgICAgICAgICAgICAgIHBhcnNlcltidWZmZXJdICs9ICImIiArIHBhcnNlci5lbnRpdHkgKyBjOwogICAgICAgICAgICAgICAgcGFyc2VyLmVudGl0eSA9ICIiOwogICAgICAgICAgICAgICAgcGFyc2VyLnN0YXRlID0gcmV0dXJuU3RhdGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihwYXJzZXIsICJVbmtub3duIHN0YXRlOiAiICsgcGFyc2VyLnN0YXRlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHBhcnNlci5wb3NpdGlvbiA+PSBwYXJzZXIuYnVmZmVyQ2hlY2tQb3NpdGlvbikKICAgICAgICAgIGNoZWNrQnVmZmVyTGVuZ3RoKHBhcnNlcik7CiAgICAgICAgcmV0dXJuIHBhcnNlcjsKICAgICAgfQogICAgICBpZiAoIVN0cmluZy5mcm9tQ29kZVBvaW50KSB7CiAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHN0cmluZ0Zyb21DaGFyQ29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CiAgICAgICAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwogICAgICAgICAgdmFyIGZyb21Db2RlUG9pbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIE1BWF9TSVpFID0gMHg0MDAwOwogICAgICAgICAgICB2YXIgY29kZVVuaXRzID0gW107CiAgICAgICAgICAgIHZhciBoaWdoU3Vycm9nYXRlOwogICAgICAgICAgICB2YXIgbG93U3Vycm9nYXRlOwogICAgICAgICAgICB2YXIgaW5kZXggPSAtMTsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICAgIGlmICghbGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXN1bHQgPSAnJzsKICAgICAgICAgICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgY29kZVBvaW50ID0gTnVtYmVyKGFyZ3VtZW50c1tpbmRleF0pOwogICAgICAgICAgICAgIGlmICghaXNGaW5pdGUoY29kZVBvaW50KSB8fCBjb2RlUG9pbnQgPCAwIHx8IGNvZGVQb2ludCA+IDB4MTBGRkZGIHx8IGZsb29yKGNvZGVQb2ludCkgIT0gY29kZVBvaW50KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBSYW5nZUVycm9yKCdJbnZhbGlkIGNvZGUgcG9pbnQ6ICcgKyBjb2RlUG9pbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY29kZVBvaW50IDw9IDB4RkZGRikgewogICAgICAgICAgICAgICAgY29kZVVuaXRzLnB1c2goY29kZVBvaW50KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29kZVBvaW50IC09IDB4MTAwMDA7CiAgICAgICAgICAgICAgICBoaWdoU3Vycm9nYXRlID0gKGNvZGVQb2ludCA+PiAxMCkgKyAweEQ4MDA7CiAgICAgICAgICAgICAgICBsb3dTdXJyb2dhdGUgPSAoY29kZVBvaW50ICUgMHg0MDApICsgMHhEQzAwOwogICAgICAgICAgICAgICAgY29kZVVuaXRzLnB1c2goaGlnaFN1cnJvZ2F0ZSwgbG93U3Vycm9nYXRlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGluZGV4ICsgMSA9PSBsZW5ndGggfHwgY29kZVVuaXRzLmxlbmd0aCA+IE1BWF9TSVpFKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgKz0gc3RyaW5nRnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNvZGVVbml0cyk7CiAgICAgICAgICAgICAgICBjb2RlVW5pdHMubGVuZ3RoID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CiAgICAgICAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcsICdmcm9tQ29kZVBvaW50JywgewogICAgICAgICAgICAgICd2YWx1ZSc6IGZyb21Db2RlUG9pbnQsCiAgICAgICAgICAgICAgJ2NvbmZpZ3VyYWJsZSc6IHRydWUsCiAgICAgICAgICAgICAgJ3dyaXRhYmxlJzogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN0cmluZy5mcm9tQ29kZVBvaW50ID0gZnJvbUNvZGVQb2ludDsKICAgICAgICAgIH0KICAgICAgICB9KCkpOwogICAgICB9CiAgICB9KSh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyBzYXggPSB7fSA6IGV4cG9ydHMpOwogIH0pKHJlcXVpcmUoImdpdGh1Yjpqc3BtL25vZGVsaWJzLWJ1ZmZlckAwLjEuMCIpLkJ1ZmZlciwgcmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtcHJvY2Vzc0AwLjEuMSIpKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL2luZGV4IiwgWyJucG06bG9kYXNoQDMuOS4zL29iamVjdC9hc3NpZ24iLCAibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL1hNTEJ1aWxkZXIiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbigpIHsKICAgIHZhciBYTUxCdWlsZGVyLAogICAgICAgIGFzc2lnbjsKICAgIGFzc2lnbiA9IHJlcXVpcmUoIm5wbTpsb2Rhc2hAMy45LjMvb2JqZWN0L2Fzc2lnbiIpOwogICAgWE1MQnVpbGRlciA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9YTUxCdWlsZGVyIik7CiAgICBtb2R1bGUuZXhwb3J0cy5jcmVhdGUgPSBmdW5jdGlvbihuYW1lLCB4bWxkZWMsIGRvY3R5cGUsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IGFzc2lnbih7fSwgeG1sZGVjLCBkb2N0eXBlLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG5ldyBYTUxCdWlsZGVyKG5hbWUsIG9wdGlvbnMpLnJvb3QoKTsKICAgIH07CiAgfSkuY2FsbCh0aGlzKTsKICBnbG9iYWwuZGVmaW5lID0gX19kZWZpbmU7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9KTsKClN5c3RlbS5yZWdpc3RlcigibnBtOnNheEAwLjYuMSIsIFsibnBtOnNheEAwLjYuMS9saWIvc2F4Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoIm5wbTpzYXhAMC42LjEvbGliL3NheCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sYnVpbGRlckAyLjYuNCIsIFsibnBtOnhtbGJ1aWxkZXJAMi42LjQvbGliL2luZGV4Il0sIHRydWUsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogIHZhciBnbG9iYWwgPSBTeXN0ZW0uZ2xvYmFsLAogICAgICBfX2RlZmluZSA9IGdsb2JhbC5kZWZpbmU7CiAgZ2xvYmFsLmRlZmluZSA9IHVuZGVmaW5lZDsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoIm5wbTp4bWxidWlsZGVyQDIuNi40L2xpYi9pbmRleCIpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sMmpzQDAuNC45L2xpYi94bWwyanMiLCBbIm5wbTpzYXhAMC42LjEiLCAiZ2l0aHViOmpzcG0vbm9kZWxpYnMtZXZlbnRzQDAuMS4xIiwgIm5wbTp4bWxidWlsZGVyQDIuNi40IiwgIm5wbTp4bWwyanNAMC40LjkvbGliL2JvbSIsICJucG06eG1sMmpzQDAuNC45L2xpYi9wcm9jZXNzb3JzIiwgImdpdGh1Yjpqc3BtL25vZGVsaWJzLXByb2Nlc3NAMC4xLjEiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIChmdW5jdGlvbihwcm9jZXNzKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBib20sCiAgICAgICAgICBidWlsZGVyLAogICAgICAgICAgZXNjYXBlQ0RBVEEsCiAgICAgICAgICBldmVudHMsCiAgICAgICAgICBpc0VtcHR5LAogICAgICAgICAgcHJvY2Vzc05hbWUsCiAgICAgICAgICBwcm9jZXNzb3JzLAogICAgICAgICAgcmVxdWlyZXNDREFUQSwKICAgICAgICAgIHNheCwKICAgICAgICAgIHdyYXBDREFUQSwKICAgICAgICAgIGV4dGVuZCA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHBhcmVudCkgewogICAgICAgICAgICAgIGlmIChoYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKQogICAgICAgICAgICAgICAgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGN0b3IoKSB7CiAgICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsKICAgICAgICAgICAgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsKICAgICAgICAgICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKICAgICAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICAgICAgfSwKICAgICAgICAgIGhhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgICAgICAgIGJpbmQgPSBmdW5jdGlvbihmbiwgbWUpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH07CiAgICAgIHNheCA9IHJlcXVpcmUoIm5wbTpzYXhAMC42LjEiKTsKICAgICAgZXZlbnRzID0gcmVxdWlyZSgiZ2l0aHViOmpzcG0vbm9kZWxpYnMtZXZlbnRzQDAuMS4xIik7CiAgICAgIGJ1aWxkZXIgPSByZXF1aXJlKCJucG06eG1sYnVpbGRlckAyLjYuNCIpOwogICAgICBib20gPSByZXF1aXJlKCJucG06eG1sMmpzQDAuNC45L2xpYi9ib20iKTsKICAgICAgcHJvY2Vzc29ycyA9IHJlcXVpcmUoIm5wbTp4bWwyanNAMC40LjkvbGliL3Byb2Nlc3NvcnMiKTsKICAgICAgaXNFbXB0eSA9IGZ1bmN0aW9uKHRoaW5nKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB0aGluZyA9PT0gIm9iamVjdCIgJiYgKHRoaW5nICE9IG51bGwpICYmIE9iamVjdC5rZXlzKHRoaW5nKS5sZW5ndGggPT09IDA7CiAgICAgIH07CiAgICAgIHByb2Nlc3NOYW1lID0gZnVuY3Rpb24ocHJvY2Vzc29ycywgcHJvY2Vzc2VkTmFtZSkgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBsZW4sCiAgICAgICAgICAgIHByb2Nlc3M7CiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcHJvY2Vzc29ycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgcHJvY2VzcyA9IHByb2Nlc3NvcnNbaV07CiAgICAgICAgICBwcm9jZXNzZWROYW1lID0gcHJvY2Vzcyhwcm9jZXNzZWROYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZE5hbWU7CiAgICAgIH07CiAgICAgIHJlcXVpcmVzQ0RBVEEgPSBmdW5jdGlvbihlbnRyeSkgewogICAgICAgIHJldHVybiBlbnRyeS5pbmRleE9mKCcmJykgPj0gMCB8fCBlbnRyeS5pbmRleE9mKCc+JykgPj0gMCB8fCBlbnRyeS5pbmRleE9mKCc8JykgPj0gMDsKICAgICAgfTsKICAgICAgd3JhcENEQVRBID0gZnVuY3Rpb24oZW50cnkpIHsKICAgICAgICByZXR1cm4gIjwhW0NEQVRBWyIgKyAoZXNjYXBlQ0RBVEEoZW50cnkpKSArICJdXT4iOwogICAgICB9OwogICAgICBlc2NhcGVDREFUQSA9IGZ1bmN0aW9uKGVudHJ5KSB7CiAgICAgICAgcmV0dXJuIGVudHJ5LnJlcGxhY2UoJ11dPicsICddXV1dPjwhW0NEQVRBWz4nKTsKICAgICAgfTsKICAgICAgZXhwb3J0cy5wcm9jZXNzb3JzID0gcHJvY2Vzc29yczsKICAgICAgZXhwb3J0cy5kZWZhdWx0cyA9IHsKICAgICAgICAiMC4xIjogewogICAgICAgICAgZXhwbGljaXRDaGFya2V5OiBmYWxzZSwKICAgICAgICAgIHRyaW06IHRydWUsCiAgICAgICAgICBub3JtYWxpemU6IHRydWUsCiAgICAgICAgICBub3JtYWxpemVUYWdzOiBmYWxzZSwKICAgICAgICAgIGF0dHJrZXk6ICJAIiwKICAgICAgICAgIGNoYXJrZXk6ICIjIiwKICAgICAgICAgIGV4cGxpY2l0QXJyYXk6IGZhbHNlLAogICAgICAgICAgaWdub3JlQXR0cnM6IGZhbHNlLAogICAgICAgICAgbWVyZ2VBdHRyczogZmFsc2UsCiAgICAgICAgICBleHBsaWNpdFJvb3Q6IGZhbHNlLAogICAgICAgICAgdmFsaWRhdG9yOiBudWxsLAogICAgICAgICAgeG1sbnM6IGZhbHNlLAogICAgICAgICAgZXhwbGljaXRDaGlsZHJlbjogZmFsc2UsCiAgICAgICAgICBjaGlsZGtleTogJ0BAJywKICAgICAgICAgIGNoYXJzQXNDaGlsZHJlbjogZmFsc2UsCiAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICBzdHJpY3Q6IHRydWUsCiAgICAgICAgICBhdHRyTmFtZVByb2Nlc3NvcnM6IG51bGwsCiAgICAgICAgICB0YWdOYW1lUHJvY2Vzc29yczogbnVsbCwKICAgICAgICAgIHZhbHVlUHJvY2Vzc29yczogbnVsbCwKICAgICAgICAgIGVtcHR5VGFnOiAnJwogICAgICAgIH0sCiAgICAgICAgIjAuMiI6IHsKICAgICAgICAgIGV4cGxpY2l0Q2hhcmtleTogZmFsc2UsCiAgICAgICAgICB0cmltOiBmYWxzZSwKICAgICAgICAgIG5vcm1hbGl6ZTogZmFsc2UsCiAgICAgICAgICBub3JtYWxpemVUYWdzOiBmYWxzZSwKICAgICAgICAgIGF0dHJrZXk6ICIkIiwKICAgICAgICAgIGNoYXJrZXk6ICJfIiwKICAgICAgICAgIGV4cGxpY2l0QXJyYXk6IHRydWUsCiAgICAgICAgICBpZ25vcmVBdHRyczogZmFsc2UsCiAgICAgICAgICBtZXJnZUF0dHJzOiBmYWxzZSwKICAgICAgICAgIGV4cGxpY2l0Um9vdDogdHJ1ZSwKICAgICAgICAgIHZhbGlkYXRvcjogbnVsbCwKICAgICAgICAgIHhtbG5zOiBmYWxzZSwKICAgICAgICAgIGV4cGxpY2l0Q2hpbGRyZW46IGZhbHNlLAogICAgICAgICAgcHJlc2VydmVDaGlsZHJlbk9yZGVyOiBmYWxzZSwKICAgICAgICAgIGNoaWxka2V5OiAnJCQnLAogICAgICAgICAgY2hhcnNBc0NoaWxkcmVuOiBmYWxzZSwKICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgIHN0cmljdDogdHJ1ZSwKICAgICAgICAgIGF0dHJOYW1lUHJvY2Vzc29yczogbnVsbCwKICAgICAgICAgIHRhZ05hbWVQcm9jZXNzb3JzOiBudWxsLAogICAgICAgICAgdmFsdWVQcm9jZXNzb3JzOiBudWxsLAogICAgICAgICAgcm9vdE5hbWU6ICdyb290JywKICAgICAgICAgIHhtbGRlYzogewogICAgICAgICAgICAndmVyc2lvbic6ICcxLjAnLAogICAgICAgICAgICAnZW5jb2RpbmcnOiAnVVRGLTgnLAogICAgICAgICAgICAnc3RhbmRhbG9uZSc6IHRydWUKICAgICAgICAgIH0sCiAgICAgICAgICBkb2N0eXBlOiBudWxsLAogICAgICAgICAgcmVuZGVyT3B0czogewogICAgICAgICAgICAncHJldHR5JzogdHJ1ZSwKICAgICAgICAgICAgJ2luZGVudCc6ICcgICcsCiAgICAgICAgICAgICduZXdsaW5lJzogJ1xuJwogICAgICAgICAgfSwKICAgICAgICAgIGhlYWRsZXNzOiBmYWxzZSwKICAgICAgICAgIGNodW5rU2l6ZTogMTAwMDAsCiAgICAgICAgICBlbXB0eVRhZzogJycsCiAgICAgICAgICBjZGF0YTogZmFsc2UKICAgICAgICB9CiAgICAgIH07CiAgICAgIGV4cG9ydHMuVmFsaWRhdGlvbkVycm9yID0gKGZ1bmN0aW9uKHN1cGVyQ2xhc3MpIHsKICAgICAgICBleHRlbmQoVmFsaWRhdGlvbkVycm9yLCBzdXBlckNsYXNzKTsKICAgICAgICBmdW5jdGlvbiBWYWxpZGF0aW9uRXJyb3IobWVzc2FnZSkgewogICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFZhbGlkYXRpb25FcnJvcjsKICAgICAgfSkoRXJyb3IpOwogICAgICBleHBvcnRzLkJ1aWxkZXIgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgZnVuY3Rpb24gQnVpbGRlcihvcHRzKSB7CiAgICAgICAgICB2YXIga2V5LAogICAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgICB2YWx1ZTsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICAgICAgcmVmID0gZXhwb3J0cy5kZWZhdWx0c1siMC4yIl07CiAgICAgICAgICBmb3IgKGtleSBpbiByZWYpIHsKICAgICAgICAgICAgaWYgKCFoYXNQcm9wLmNhbGwocmVmLCBrZXkpKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB2YWx1ZSA9IHJlZltrZXldOwogICAgICAgICAgICB0aGlzLm9wdGlvbnNba2V5XSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChrZXkgaW4gb3B0cykgewogICAgICAgICAgICBpZiAoIWhhc1Byb3AuY2FsbChvcHRzLCBrZXkpKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB2YWx1ZSA9IG9wdHNba2V5XTsKICAgICAgICAgICAgdGhpcy5vcHRpb25zW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQnVpbGRlci5wcm90b3R5cGUuYnVpbGRPYmplY3QgPSBmdW5jdGlvbihyb290T2JqKSB7CiAgICAgICAgICB2YXIgYXR0cmtleSwKICAgICAgICAgICAgICBjaGFya2V5LAogICAgICAgICAgICAgIHJlbmRlciwKICAgICAgICAgICAgICByb290RWxlbWVudCwKICAgICAgICAgICAgICByb290TmFtZTsKICAgICAgICAgIGF0dHJrZXkgPSB0aGlzLm9wdGlvbnMuYXR0cmtleTsKICAgICAgICAgIGNoYXJrZXkgPSB0aGlzLm9wdGlvbnMuY2hhcmtleTsKICAgICAgICAgIGlmICgoT2JqZWN0LmtleXMocm9vdE9iaikubGVuZ3RoID09PSAxKSAmJiAodGhpcy5vcHRpb25zLnJvb3ROYW1lID09PSBleHBvcnRzLmRlZmF1bHRzWycwLjInXS5yb290TmFtZSkpIHsKICAgICAgICAgICAgcm9vdE5hbWUgPSBPYmplY3Qua2V5cyhyb290T2JqKVswXTsKICAgICAgICAgICAgcm9vdE9iaiA9IHJvb3RPYmpbcm9vdE5hbWVdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm9vdE5hbWUgPSB0aGlzLm9wdGlvbnMucm9vdE5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICByZW5kZXIgPSAoZnVuY3Rpb24oX3RoaXMpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW1lbnQsIG9iaikgewogICAgICAgICAgICAgIHZhciBhdHRyLAogICAgICAgICAgICAgICAgICBjaGlsZCwKICAgICAgICAgICAgICAgICAgZW50cnksCiAgICAgICAgICAgICAgICAgIGluZGV4LAogICAgICAgICAgICAgICAgICBrZXksCiAgICAgICAgICAgICAgICAgIHZhbHVlOwogICAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuY2RhdGEgJiYgcmVxdWlyZXNDREFUQShvYmopKSB7CiAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmF3KHdyYXBDREFUQShvYmopKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVsZW1lbnQudHh0KG9iaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIG9iaikgewogICAgICAgICAgICAgICAgICBpZiAoIWhhc1Byb3AuY2FsbChvYmosIGtleSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIGNoaWxkID0gb2JqW2tleV07CiAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IGF0dHJrZXkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNoaWxkID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChhdHRyIGluIGNoaWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hpbGRbYXR0cl07CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LmF0dChhdHRyLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gY2hhcmtleSkgewogICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmNkYXRhICYmIHJlcXVpcmVzQ0RBVEEoY2hpbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5yYXcod3JhcENEQVRBKGNoaWxkKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnR4dChjaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbmRleCBpbiBjaGlsZCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNQcm9wLmNhbGwoY2hpbGQsIGluZGV4KSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICBlbnRyeSA9IGNoaWxkW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLmNkYXRhICYmIHJlcXVpcmVzQ0RBVEEoZW50cnkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQuZWxlKGtleSkucmF3KHdyYXBDREFUQShlbnRyeSkpLnVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQuZWxlKGtleSwgZW50cnkpLnVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBhcmd1bWVudHMuY2FsbGVlKGVsZW1lbnQuZWxlKGtleSksIGVudHJ5KS51cCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY2hpbGQgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGFyZ3VtZW50cy5jYWxsZWUoZWxlbWVudC5lbGUoa2V5KSwgY2hpbGQpLnVwKCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycgJiYgX3RoaXMub3B0aW9ucy5jZGF0YSAmJiByZXF1aXJlc0NEQVRBKGNoaWxkKSkgewogICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQuZWxlKGtleSkucmF3KHdyYXBDREFUQShjaGlsZCkpLnVwKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LmVsZShrZXksIGNoaWxkLnRvU3RyaW5nKCkpLnVwKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICAgICAgICB9OwogICAgICAgICAgfSkodGhpcyk7CiAgICAgICAgICByb290RWxlbWVudCA9IGJ1aWxkZXIuY3JlYXRlKHJvb3ROYW1lLCB0aGlzLm9wdGlvbnMueG1sZGVjLCB0aGlzLm9wdGlvbnMuZG9jdHlwZSwge2hlYWRsZXNzOiB0aGlzLm9wdGlvbnMuaGVhZGxlc3N9KTsKICAgICAgICAgIHJldHVybiByZW5kZXIocm9vdEVsZW1lbnQsIHJvb3RPYmopLmVuZCh0aGlzLm9wdGlvbnMucmVuZGVyT3B0cyk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQnVpbGRlcjsKICAgICAgfSkoKTsKICAgICAgZXhwb3J0cy5QYXJzZXIgPSAoZnVuY3Rpb24oc3VwZXJDbGFzcykgewogICAgICAgIGV4dGVuZChQYXJzZXIsIHN1cGVyQ2xhc3MpOwogICAgICAgIGZ1bmN0aW9uIFBhcnNlcihvcHRzKSB7CiAgICAgICAgICB0aGlzLnBhcnNlU3RyaW5nID0gYmluZCh0aGlzLnBhcnNlU3RyaW5nLCB0aGlzKTsKICAgICAgICAgIHRoaXMucmVzZXQgPSBiaW5kKHRoaXMucmVzZXQsIHRoaXMpOwogICAgICAgICAgdGhpcy5hc3NpZ25PclB1c2ggPSBiaW5kKHRoaXMuYXNzaWduT3JQdXNoLCB0aGlzKTsKICAgICAgICAgIHRoaXMucHJvY2Vzc0FzeW5jID0gYmluZCh0aGlzLnByb2Nlc3NBc3luYywgdGhpcyk7CiAgICAgICAgICB2YXIga2V5LAogICAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgICB2YWx1ZTsKICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBleHBvcnRzLlBhcnNlcikpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBleHBvcnRzLlBhcnNlcihvcHRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICAgICAgcmVmID0gZXhwb3J0cy5kZWZhdWx0c1siMC4yIl07CiAgICAgICAgICBmb3IgKGtleSBpbiByZWYpIHsKICAgICAgICAgICAgaWYgKCFoYXNQcm9wLmNhbGwocmVmLCBrZXkpKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB2YWx1ZSA9IHJlZltrZXldOwogICAgICAgICAgICB0aGlzLm9wdGlvbnNba2V5XSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChrZXkgaW4gb3B0cykgewogICAgICAgICAgICBpZiAoIWhhc1Byb3AuY2FsbChvcHRzLCBrZXkpKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB2YWx1ZSA9IG9wdHNba2V5XTsKICAgICAgICAgICAgdGhpcy5vcHRpb25zW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMueG1sbnMpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLnhtbG5za2V5ID0gdGhpcy5vcHRpb25zLmF0dHJrZXkgKyAibnMiOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5ub3JtYWxpemVUYWdzKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnRhZ05hbWVQcm9jZXNzb3JzKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRhZ05hbWVQcm9jZXNzb3JzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRhZ05hbWVQcm9jZXNzb3JzLnVuc2hpZnQocHJvY2Vzc29ycy5ub3JtYWxpemUpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgIH0KICAgICAgICBQYXJzZXIucHJvdG90eXBlLnByb2Nlc3NBc3luYyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGNodW5rOwogICAgICAgICAgaWYgKHRoaXMucmVtYWluaW5nLmxlbmd0aCA8PSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplKSB7CiAgICAgICAgICAgIGNodW5rID0gdGhpcy5yZW1haW5pbmc7CiAgICAgICAgICAgIHRoaXMucmVtYWluaW5nID0gJyc7CiAgICAgICAgICAgIHRoaXMuc2F4UGFyc2VyID0gdGhpcy5zYXhQYXJzZXIud3JpdGUoY2h1bmspOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zYXhQYXJzZXIuY2xvc2UoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNodW5rID0gdGhpcy5yZW1haW5pbmcuc3Vic3RyKDAsIHRoaXMub3B0aW9ucy5jaHVua1NpemUpOwogICAgICAgICAgICB0aGlzLnJlbWFpbmluZyA9IHRoaXMucmVtYWluaW5nLnN1YnN0cih0aGlzLm9wdGlvbnMuY2h1bmtTaXplLCB0aGlzLnJlbWFpbmluZy5sZW5ndGgpOwogICAgICAgICAgICB0aGlzLnNheFBhcnNlciA9IHRoaXMuc2F4UGFyc2VyLndyaXRlKGNodW5rKTsKICAgICAgICAgICAgcmV0dXJuIHNldEltbWVkaWF0ZSh0aGlzLnByb2Nlc3NBc3luYyk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBQYXJzZXIucHJvdG90eXBlLmFzc2lnbk9yUHVzaCA9IGZ1bmN0aW9uKG9iaiwga2V5LCBuZXdWYWx1ZSkgewogICAgICAgICAgaWYgKCEoa2V5IGluIG9iaikpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuZXhwbGljaXRBcnJheSkgewogICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XSA9IG5ld1ZhbHVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiBvYmpba2V5XSA9IFtuZXdWYWx1ZV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghKG9ialtrZXldIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgICAgICAgb2JqW2tleV0gPSBbb2JqW2tleV1dOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvYmpba2V5XS5wdXNoKG5ld1ZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIFBhcnNlci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhdHRya2V5LAogICAgICAgICAgICAgIGNoYXJrZXksCiAgICAgICAgICAgICAgb250ZXh0LAogICAgICAgICAgICAgIHN0YWNrOwogICAgICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTsKICAgICAgICAgIHRoaXMuc2F4UGFyc2VyID0gc2F4LnBhcnNlcih0aGlzLm9wdGlvbnMuc3RyaWN0LCB7CiAgICAgICAgICAgIHRyaW06IGZhbHNlLAogICAgICAgICAgICBub3JtYWxpemU6IGZhbHNlLAogICAgICAgICAgICB4bWxuczogdGhpcy5vcHRpb25zLnhtbG5zCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuc2F4UGFyc2VyLmVyclRocm93biA9IGZhbHNlOwogICAgICAgICAgdGhpcy5zYXhQYXJzZXIub25lcnJvciA9IChmdW5jdGlvbihfdGhpcykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICAgICAgICBfdGhpcy5zYXhQYXJzZXIucmVzdW1lKCk7CiAgICAgICAgICAgICAgaWYgKCFfdGhpcy5zYXhQYXJzZXIuZXJyVGhyb3duKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zYXhQYXJzZXIuZXJyVGhyb3duID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbWl0KCJlcnJvciIsIGVycm9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KSh0aGlzKTsKICAgICAgICAgIHRoaXMuc2F4UGFyc2VyLmVuZGVkID0gZmFsc2U7CiAgICAgICAgICB0aGlzLkVYUExJQ0lUX0NIQVJLRVkgPSB0aGlzLm9wdGlvbnMuZXhwbGljaXRDaGFya2V5OwogICAgICAgICAgdGhpcy5yZXN1bHRPYmplY3QgPSBudWxsOwogICAgICAgICAgc3RhY2sgPSBbXTsKICAgICAgICAgIGF0dHJrZXkgPSB0aGlzLm9wdGlvbnMuYXR0cmtleTsKICAgICAgICAgIGNoYXJrZXkgPSB0aGlzLm9wdGlvbnMuY2hhcmtleTsKICAgICAgICAgIHRoaXMuc2F4UGFyc2VyLm9ub3BlbnRhZyA9IChmdW5jdGlvbihfdGhpcykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgIHZhciBrZXksCiAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlLAogICAgICAgICAgICAgICAgICBvYmosCiAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZEtleSwKICAgICAgICAgICAgICAgICAgcmVmOwogICAgICAgICAgICAgIG9iaiA9IHt9OwogICAgICAgICAgICAgIG9ialtjaGFya2V5XSA9ICIiOwogICAgICAgICAgICAgIGlmICghX3RoaXMub3B0aW9ucy5pZ25vcmVBdHRycykgewogICAgICAgICAgICAgICAgcmVmID0gbm9kZS5hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gcmVmKSB7CiAgICAgICAgICAgICAgICAgIGlmICghaGFzUHJvcC5jYWxsKHJlZiwga2V5KSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgaWYgKCEoYXR0cmtleSBpbiBvYmopICYmICFfdGhpcy5vcHRpb25zLm1lcmdlQXR0cnMpIHsKICAgICAgICAgICAgICAgICAgICBvYmpbYXR0cmtleV0gPSB7fTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBuZXdWYWx1ZSA9IG5vZGUuYXR0cmlidXRlc1trZXldOwogICAgICAgICAgICAgICAgICBwcm9jZXNzZWRLZXkgPSBfdGhpcy5vcHRpb25zLmF0dHJOYW1lUHJvY2Vzc29ycyA/IHByb2Nlc3NOYW1lKF90aGlzLm9wdGlvbnMuYXR0ck5hbWVQcm9jZXNzb3JzLCBrZXkpIDoga2V5OwogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5tZXJnZUF0dHJzKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXNzaWduT3JQdXNoKG9iaiwgcHJvY2Vzc2VkS2V5LCBuZXdWYWx1ZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb2JqW2F0dHJrZXldW3Byb2Nlc3NlZEtleV0gPSBuZXdWYWx1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBvYmpbIiNuYW1lIl0gPSBfdGhpcy5vcHRpb25zLnRhZ05hbWVQcm9jZXNzb3JzID8gcHJvY2Vzc05hbWUoX3RoaXMub3B0aW9ucy50YWdOYW1lUHJvY2Vzc29ycywgbm9kZS5uYW1lKSA6IG5vZGUubmFtZTsKICAgICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy54bWxucykgewogICAgICAgICAgICAgICAgb2JqW190aGlzLm9wdGlvbnMueG1sbnNrZXldID0gewogICAgICAgICAgICAgICAgICB1cmk6IG5vZGUudXJpLAogICAgICAgICAgICAgICAgICBsb2NhbDogbm9kZS5sb2NhbAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHN0YWNrLnB1c2gob2JqKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pKHRoaXMpOwogICAgICAgICAgdGhpcy5zYXhQYXJzZXIub25jbG9zZXRhZyA9IChmdW5jdGlvbihfdGhpcykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGNkYXRhLAogICAgICAgICAgICAgICAgICBlbXB0eVN0ciwKICAgICAgICAgICAgICAgICAgZXJyLAogICAgICAgICAgICAgICAgICBrZXksCiAgICAgICAgICAgICAgICAgIG5vZGUsCiAgICAgICAgICAgICAgICAgIG5vZGVOYW1lLAogICAgICAgICAgICAgICAgICBvYmosCiAgICAgICAgICAgICAgICAgIG9iakNsb25lLAogICAgICAgICAgICAgICAgICBvbGQsCiAgICAgICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgICAgIHhwYXRoOwogICAgICAgICAgICAgIG9iaiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgIG5vZGVOYW1lID0gb2JqWyIjbmFtZSJdOwogICAgICAgICAgICAgIGlmICghX3RoaXMub3B0aW9ucy5leHBsaWNpdENoaWxkcmVuIHx8ICFfdGhpcy5vcHRpb25zLnByZXNlcnZlQ2hpbGRyZW5PcmRlcikgewogICAgICAgICAgICAgICAgZGVsZXRlIG9ialsiI25hbWUiXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKG9iai5jZGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgY2RhdGEgPSBvYmouY2RhdGE7CiAgICAgICAgICAgICAgICBkZWxldGUgb2JqLmNkYXRhOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgaWYgKG9ialtjaGFya2V5XS5tYXRjaCgvXlxzKiQvKSAmJiAhY2RhdGEpIHsKICAgICAgICAgICAgICAgIGVtcHR5U3RyID0gb2JqW2NoYXJrZXldOwogICAgICAgICAgICAgICAgZGVsZXRlIG9ialtjaGFya2V5XTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMudHJpbSkgewogICAgICAgICAgICAgICAgICBvYmpbY2hhcmtleV0gPSBvYmpbY2hhcmtleV0udHJpbSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMubm9ybWFsaXplKSB7CiAgICAgICAgICAgICAgICAgIG9ialtjaGFya2V5XSA9IG9ialtjaGFya2V5XS5yZXBsYWNlKC9cc3syLH0vZywgIiAiKS50cmltKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvYmpbY2hhcmtleV0gPSBfdGhpcy5vcHRpb25zLnZhbHVlUHJvY2Vzc29ycyA/IHByb2Nlc3NOYW1lKF90aGlzLm9wdGlvbnMudmFsdWVQcm9jZXNzb3JzLCBvYmpbY2hhcmtleV0pIDogb2JqW2NoYXJrZXldOwogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID09PSAxICYmIGNoYXJrZXkgaW4gb2JqICYmICFfdGhpcy5FWFBMSUNJVF9DSEFSS0VZKSB7CiAgICAgICAgICAgICAgICAgIG9iaiA9IG9ialtjaGFya2V5XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGlzRW1wdHkob2JqKSkgewogICAgICAgICAgICAgICAgb2JqID0gX3RoaXMub3B0aW9ucy5lbXB0eVRhZyAhPT0gJycgPyBfdGhpcy5vcHRpb25zLmVtcHR5VGFnIDogZW1wdHlTdHI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLnZhbGlkYXRvciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB4cGF0aCA9ICIvIiArICgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgICAgICAgICAgbGVuLAogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czsKICAgICAgICAgICAgICAgICAgcmVzdWx0cyA9IFtdOwogICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBzdGFjay5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgICAgIG5vZGUgPSBzdGFja1tpXTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2gobm9kZVsiI25hbWUiXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICAgICAgICB9KSgpKS5jb25jYXQobm9kZU5hbWUpLmpvaW4oIi8iKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIG9iaiA9IF90aGlzLm9wdGlvbnMudmFsaWRhdG9yKHhwYXRoLCBzICYmIHNbbm9kZU5hbWVdLCBvYmopOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoX2Vycm9yKSB7CiAgICAgICAgICAgICAgICAgIGVyciA9IF9lcnJvcjsKICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdCgiZXJyb3IiLCBlcnIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5leHBsaWNpdENoaWxkcmVuICYmICFfdGhpcy5vcHRpb25zLm1lcmdlQXR0cnMgJiYgdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgIGlmICghX3RoaXMub3B0aW9ucy5wcmVzZXJ2ZUNoaWxkcmVuT3JkZXIpIHsKICAgICAgICAgICAgICAgICAgbm9kZSA9IHt9OwogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5hdHRya2V5IGluIG9iaikgewogICAgICAgICAgICAgICAgICAgIG5vZGVbX3RoaXMub3B0aW9ucy5hdHRya2V5XSA9IG9ialtfdGhpcy5vcHRpb25zLmF0dHJrZXldOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmpbX3RoaXMub3B0aW9ucy5hdHRya2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIV90aGlzLm9wdGlvbnMuY2hhcnNBc0NoaWxkcmVuICYmIF90aGlzLm9wdGlvbnMuY2hhcmtleSBpbiBvYmopIHsKICAgICAgICAgICAgICAgICAgICBub2RlW190aGlzLm9wdGlvbnMuY2hhcmtleV0gPSBvYmpbX3RoaXMub3B0aW9ucy5jaGFya2V5XTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgb2JqW190aGlzLm9wdGlvbnMuY2hhcmtleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG9iaikubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIG5vZGVbX3RoaXMub3B0aW9ucy5jaGlsZGtleV0gPSBvYmo7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgb2JqID0gbm9kZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocykgewogICAgICAgICAgICAgICAgICBzW190aGlzLm9wdGlvbnMuY2hpbGRrZXldID0gc1tfdGhpcy5vcHRpb25zLmNoaWxka2V5XSB8fCBbXTsKICAgICAgICAgICAgICAgICAgb2JqQ2xvbmUgPSB7fTsKICAgICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gb2JqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNQcm9wLmNhbGwob2JqLCBrZXkpKQogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgb2JqQ2xvbmVba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHNbX3RoaXMub3B0aW9ucy5jaGlsZGtleV0ucHVzaChvYmpDbG9uZSk7CiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmpbIiNuYW1lIl07CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA9PT0gMSAmJiBjaGFya2V5IGluIG9iaiAmJiAhX3RoaXMuRVhQTElDSVRfQ0hBUktFWSkgewogICAgICAgICAgICAgICAgICAgIG9iaiA9IG9ialtjaGFya2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmFzc2lnbk9yUHVzaChzLCBub2RlTmFtZSwgb2JqKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuZXhwbGljaXRSb290KSB7CiAgICAgICAgICAgICAgICAgIG9sZCA9IG9iajsKICAgICAgICAgICAgICAgICAgb2JqID0ge307CiAgICAgICAgICAgICAgICAgIG9ialtub2RlTmFtZV0gPSBvbGQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdGhpcy5yZXN1bHRPYmplY3QgPSBvYmo7CiAgICAgICAgICAgICAgICBfdGhpcy5zYXhQYXJzZXIuZW5kZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVtaXQoImVuZCIsIF90aGlzLnJlc3VsdE9iamVjdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgfSkodGhpcyk7CiAgICAgICAgICBvbnRleHQgPSAoZnVuY3Rpb24oX3RoaXMpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHsKICAgICAgICAgICAgICB2YXIgY2hhckNoaWxkLAogICAgICAgICAgICAgICAgICBzOwogICAgICAgICAgICAgIHMgPSBzdGFja1tzdGFjay5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICBpZiAocykgewogICAgICAgICAgICAgICAgc1tjaGFya2V5XSArPSB0ZXh0OwogICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuZXhwbGljaXRDaGlsZHJlbiAmJiBfdGhpcy5vcHRpb25zLnByZXNlcnZlQ2hpbGRyZW5PcmRlciAmJiBfdGhpcy5vcHRpb25zLmNoYXJzQXNDaGlsZHJlbiAmJiB0ZXh0LnJlcGxhY2UoL1xcbi9nLCAnJykudHJpbSgpICE9PSAnJykgewogICAgICAgICAgICAgICAgICBzW190aGlzLm9wdGlvbnMuY2hpbGRrZXldID0gc1tfdGhpcy5vcHRpb25zLmNoaWxka2V5XSB8fCBbXTsKICAgICAgICAgICAgICAgICAgY2hhckNoaWxkID0geycjbmFtZSc6ICdfX3RleHRfXyd9OwogICAgICAgICAgICAgICAgICBjaGFyQ2hpbGRbY2hhcmtleV0gPSB0ZXh0OwogICAgICAgICAgICAgICAgICBzW190aGlzLm9wdGlvbnMuY2hpbGRrZXldLnB1c2goY2hhckNoaWxkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0pKHRoaXMpOwogICAgICAgICAgdGhpcy5zYXhQYXJzZXIub250ZXh0ID0gb250ZXh0OwogICAgICAgICAgcmV0dXJuIHRoaXMuc2F4UGFyc2VyLm9uY2RhdGEgPSAoZnVuY3Rpb24oX3RoaXMpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHsKICAgICAgICAgICAgICB2YXIgczsKICAgICAgICAgICAgICBzID0gb250ZXh0KHRleHQpOwogICAgICAgICAgICAgIGlmIChzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcy5jZGF0YSA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgfSkodGhpcyk7CiAgICAgICAgfTsKICAgICAgICBQYXJzZXIucHJvdG90eXBlLnBhcnNlU3RyaW5nID0gZnVuY3Rpb24oc3RyLCBjYikgewogICAgICAgICAgdmFyIGVycjsKICAgICAgICAgIGlmICgoY2IgIT0gbnVsbCkgJiYgdHlwZW9mIGNiID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHRoaXMub24oImVuZCIsIGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgICAgICByZXR1cm4gY2IobnVsbCwgcmVzdWx0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMub24oImVycm9yIiwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHN0ciA9IHN0ci50b1N0cmluZygpOwogICAgICAgICAgaWYgKHN0ci50cmltKCkgPT09ICcnKSB7CiAgICAgICAgICAgIHRoaXMuZW1pdCgiZW5kIiwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RyID0gYm9tLnN0cmlwQk9NKHN0cik7CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXN5bmMpIHsKICAgICAgICAgICAgICB0aGlzLnJlbWFpbmluZyA9IHN0cjsKICAgICAgICAgICAgICBzZXRJbW1lZGlhdGUodGhpcy5wcm9jZXNzQXN5bmMpOwogICAgICAgICAgICAgIHRoaXMuc2F4UGFyc2VyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNheFBhcnNlci53cml0ZShzdHIpLmNsb3NlKCk7CiAgICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHsKICAgICAgICAgICAgZXJyID0gX2Vycm9yOwogICAgICAgICAgICBpZiAoISh0aGlzLnNheFBhcnNlci5lcnJUaHJvd24gfHwgdGhpcy5zYXhQYXJzZXIuZW5kZWQpKSB7CiAgICAgICAgICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIGVycik7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2F4UGFyc2VyLmVyclRocm93biA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zYXhQYXJzZXIuZW5kZWQpIHsKICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJldHVybiBQYXJzZXI7CiAgICAgIH0pKGV2ZW50cy5FdmVudEVtaXR0ZXIpOwogICAgICBleHBvcnRzLnBhcnNlU3RyaW5nID0gZnVuY3Rpb24oc3RyLCBhLCBiKSB7CiAgICAgICAgdmFyIGNiLAogICAgICAgICAgICBvcHRpb25zLAogICAgICAgICAgICBwYXJzZXI7CiAgICAgICAgaWYgKGIgIT0gbnVsbCkgewogICAgICAgICAgaWYgKHR5cGVvZiBiID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGNiID0gYjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgb3B0aW9ucyA9IGE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBjYiA9IGE7CiAgICAgICAgICB9CiAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgfQogICAgICAgIHBhcnNlciA9IG5ldyBleHBvcnRzLlBhcnNlcihvcHRpb25zKTsKICAgICAgICByZXR1cm4gcGFyc2VyLnBhcnNlU3RyaW5nKHN0ciwgY2IpOwogICAgICB9OwogICAgfSkuY2FsbCh0aGlzKTsKICB9KShyZXF1aXJlKCJnaXRodWI6anNwbS9ub2RlbGlicy1wcm9jZXNzQDAuMS4xIikpOwogIGdsb2JhbC5kZWZpbmUgPSBfX2RlZmluZTsKICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJucG06eG1sMmpzQDAuNC45IiwgWyJucG06eG1sMmpzQDAuNC45L2xpYi94bWwyanMiXSwgdHJ1ZSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgdmFyIGdsb2JhbCA9IFN5c3RlbS5nbG9iYWwsCiAgICAgIF9fZGVmaW5lID0gZ2xvYmFsLmRlZmluZTsKICBnbG9iYWwuZGVmaW5lID0gdW5kZWZpbmVkOwogIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgibnBtOnhtbDJqc0AwLjQuOS9saWIveG1sMmpzIik7CiAgZ2xvYmFsLmRlZmluZSA9IF9fZGVmaW5lOwogIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoImdpdGh1YjpCaXpib2FyZC9hcnZhLXV0aWxzQG1hc3Rlci9PYmplY3RIZWxwZXIiLCBbIm5wbTpsb2Rhc2hAMy45LjMiXSwgZnVuY3Rpb24oJF9fZXhwb3J0KSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAiZ2l0aHViOkJpemJvYXJkL2FydmEtdXRpbHNAbWFzdGVyL09iamVjdEhlbHBlciI7CiAgdmFyIF8sCiAgICAgIE9iamVjdEhlbHBlcjsKICByZXR1cm4gewogICAgc2V0dGVyczogW2Z1bmN0aW9uKCRfX20pIHsKICAgICAgXyA9ICRfX20uZGVmYXVsdDsKICAgIH1dLAogICAgZXhlY3V0ZTogZnVuY3Rpb24oKSB7CiAgICAgIE9iamVjdEhlbHBlciA9IChmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBPYmplY3RIZWxwZXIoKSB7fQogICAgICAgIHJldHVybiAoJHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKShPYmplY3RIZWxwZXIsIHt9LCB7CiAgICAgICAgICBoaWRlTWV0aG9kc0FuZFByaXZhdGVQcm9wZXJ0aWVzRnJvbU9iamVjdDogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgICAgIGZvciAodmFyIHByb3BOYW1lIGluIG9iamVjdCkgewogICAgICAgICAgICAgIHZhciBwcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsKICAgICAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3RvdHlwZSA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG90eXBlLCBwcm9wTmFtZSkgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgaWYgKGRlc2NyaXB0b3IgJiYgKGRlc2NyaXB0b3IuZ2V0IHx8IGRlc2NyaXB0b3Iuc2V0KSAmJiAhcHJvcE5hbWUuc3RhcnRzV2l0aCgnXycpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIHByb3BlcnR5ID0gb2JqZWN0W3Byb3BOYW1lXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3BlcnR5ID09PSAnZnVuY3Rpb24nIHx8IHByb3BOYW1lLnN0YXJ0c1dpdGgoJ18nKSkgewogICAgICAgICAgICAgICAgT2JqZWN0SGVscGVyLmhpZGVQcm9wZXJ0eUZyb21PYmplY3Qob2JqZWN0LCBwcm9wTmFtZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgaGlkZU1ldGhvZHNGcm9tT2JqZWN0OiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICAgICAgZm9yICh2YXIgcHJvcE5hbWUgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgdmFyIHByb3BlcnR5ID0gb2JqZWN0W3Byb3BOYW1lXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3BlcnR5ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICBPYmplY3RIZWxwZXIuaGlkZVByb3BlcnR5RnJvbU9iamVjdChvYmplY3QsIHByb3BOYW1lKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBoaWRlUHJvcGVydHlGcm9tT2JqZWN0OiBmdW5jdGlvbihvYmplY3QsIHByb3BOYW1lKSB7CiAgICAgICAgICAgIHZhciBwcm90b3R5cGUgPSBvYmplY3Q7CiAgICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BOYW1lKTsKICAgICAgICAgICAgd2hpbGUgKCFkZXNjcmlwdG9yKSB7CiAgICAgICAgICAgICAgcHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvdHlwZSk7CiAgICAgICAgICAgICAgaWYgKHByb3RvdHlwZS5jb25zdHJ1Y3Rvci5uYW1lID09PSAnT2JqZWN0JyB8fCBwcm90b3R5cGUuY29uc3RydWN0b3IubmFtZSA9PT0gJ0FycmF5JykgewogICAgICAgICAgICAgICAgcmV0dXJuIDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG90eXBlLCBwcm9wTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90b3R5cGUsIHByb3BOYW1lLCBkZXNjcmlwdG9yKTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcE5hbWUsIGRlc2NyaXB0b3IpOwogICAgICAgICAgfSwKICAgICAgICAgIGhpZGVBbGxQcm9wZXJ0aWVzRnJvbU9iamVjdDogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgICAgIGZvciAodmFyIHByb3BOYW1lIGluIG9iamVjdCkgewogICAgICAgICAgICAgIE9iamVjdEhlbHBlci5oaWRlUHJvcGVydHlGcm9tT2JqZWN0KG9iamVjdCwgcHJvcE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgYWRkSGlkZGVuUHJvcGVydHlUb09iamVjdDogZnVuY3Rpb24ob2JqZWN0LCBwcm9wTmFtZSwgcHJvcCkgewogICAgICAgICAgICB2YXIgd3JpdGFibGUgPSBhcmd1bWVudHNbM10gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzNdIDogdHJ1ZTsKICAgICAgICAgICAgdmFyIHVzZUFjY2Vzc29ycyA9IGFyZ3VtZW50c1s0XSAhPT0gKHZvaWQgMCkgPyBhcmd1bWVudHNbNF0gOiB0cnVlOwogICAgICAgICAgICByZXR1cm4gT2JqZWN0SGVscGVyLmFkZFByb3BlcnR5VG9PYmplY3Qob2JqZWN0LCBwcm9wTmFtZSwgcHJvcCwgZmFsc2UsIHdyaXRhYmxlLCB1bmRlZmluZWQsIHVzZUFjY2Vzc29ycyk7CiAgICAgICAgICB9LAogICAgICAgICAgYWRkUHJvcGVydHlUb09iamVjdDogZnVuY3Rpb24ob2JqZWN0LCBwcm9wTmFtZSwgcHJvcCkgewogICAgICAgICAgICB2YXIgZW51bWVyYWJsZSA9IGFyZ3VtZW50c1szXSAhPT0gKHZvaWQgMCkgPyBhcmd1bWVudHNbM10gOiB0cnVlOwogICAgICAgICAgICB2YXIgd3JpdGFibGUgPSBhcmd1bWVudHNbNF0gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzRdIDogdHJ1ZTsKICAgICAgICAgICAgdmFyIHNldENhbGxiYWNrID0gYXJndW1lbnRzWzVdICE9PSAodm9pZCAwKSA/IGFyZ3VtZW50c1s1XSA6IG51bGw7CiAgICAgICAgICAgIHZhciB1c2VBY2Nlc3NvcnMgPSBhcmd1bWVudHNbNl0gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzZdIDogdHJ1ZTsKICAgICAgICAgICAgaWYgKCF3cml0YWJsZSB8fCAhdXNlQWNjZXNzb3JzKSB7CiAgICAgICAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSB7CiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBlbnVtZXJhYmxlLAogICAgICAgICAgICAgICAgd3JpdGFibGU6IHdyaXRhYmxlLAogICAgICAgICAgICAgICAgdmFsdWU6IHByb3AKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BOYW1lLCBkZXNjcmlwdG9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBPYmplY3RIZWxwZXIuYWRkR2V0U2V0UHJvcGVydHlXaXRoU2hhZG93KG9iamVjdCwgcHJvcE5hbWUsIHByb3AsIGVudW1lcmFibGUsIHdyaXRhYmxlLCBzZXRDYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBhZGRHZXRTZXRQcm9wZXJ0eVdpdGhTaGFkb3c6IGZ1bmN0aW9uKG9iamVjdCwgcHJvcE5hbWUsIHByb3ApIHsKICAgICAgICAgICAgdmFyIGVudW1lcmFibGUgPSBhcmd1bWVudHNbM10gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzNdIDogdHJ1ZTsKICAgICAgICAgICAgdmFyIHdyaXRhYmxlID0gYXJndW1lbnRzWzRdICE9PSAodm9pZCAwKSA/IGFyZ3VtZW50c1s0XSA6IHRydWU7CiAgICAgICAgICAgIHZhciBzZXRDYWxsYmFjayA9IGFyZ3VtZW50c1s1XSAhPT0gKHZvaWQgMCkgPyBhcmd1bWVudHNbNV0gOiBudWxsOwogICAgICAgICAgICBPYmplY3RIZWxwZXIuYnVpbGRQcm9wZXJ0eVNoYWRvdyhvYmplY3QsIHByb3BOYW1lLCBwcm9wKTsKICAgICAgICAgICAgT2JqZWN0SGVscGVyLmJ1aWxkR2V0U2V0UHJvcGVydHkob2JqZWN0LCBwcm9wTmFtZSwgZW51bWVyYWJsZSwgd3JpdGFibGUsIHNldENhbGxiYWNrKTsKICAgICAgICAgIH0sCiAgICAgICAgICBidWlsZFByb3BlcnR5U2hhZG93OiBmdW5jdGlvbihvYmplY3QsIHByb3BOYW1lLCBwcm9wKSB7CiAgICAgICAgICAgIHZhciBzaGFkb3cgPSB7fTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoJ3NoYWRvdycgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgICBzaGFkb3cgPSBvYmplY3Quc2hhZG93OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNoYWRvd1twcm9wTmFtZV0gPSBwcm9wOwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqZWN0LCAnc2hhZG93JywgewogICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICB2YWx1ZTogc2hhZG93CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1aWxkR2V0U2V0UHJvcGVydHk6IGZ1bmN0aW9uKG9iamVjdCwgcHJvcE5hbWUpIHsKICAgICAgICAgICAgdmFyIGVudW1lcmFibGUgPSBhcmd1bWVudHNbMl0gIT09ICh2b2lkIDApID8gYXJndW1lbnRzWzJdIDogdHJ1ZTsKICAgICAgICAgICAgdmFyIHdyaXRhYmxlID0gYXJndW1lbnRzWzNdICE9PSAodm9pZCAwKSA/IGFyZ3VtZW50c1szXSA6IHRydWU7CiAgICAgICAgICAgIHZhciBzZXRDYWxsYmFjayA9IGFyZ3VtZW50c1s0XSAhPT0gKHZvaWQgMCkgPyBhcmd1bWVudHNbNF0gOiBudWxsOwogICAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHsKICAgICAgICAgICAgICBlbnVtZXJhYmxlOiBlbnVtZXJhYmxlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdC5zaGFkb3dbcHJvcE5hbWVdOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHdyaXRhYmxlKSB7CiAgICAgICAgICAgICAgICAgIG9iamVjdC5zaGFkb3dbcHJvcE5hbWVdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgIGlmIChzZXRDYWxsYmFjayAmJiB0eXBlb2Ygc2V0Q2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICBzZXRDYWxsYmFjayh7CiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWU6IHByb3BOYW1lLAogICAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWU6IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcignQXR0ZW1wdGVkIHRvIHdyaXRlIHRvIG5vbi13cml0YWJsZSBwcm9wZXJ0eSAnICsgcHJvcE5hbWUgKyAnLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iamVjdCwgcHJvcE5hbWUsIGRlc2NyaXB0b3IpOwogICAgICAgICAgfSwKICAgICAgICAgIGJpbmRBbGxNZXRob2RzOiBmdW5jdGlvbihvYmplY3QsIGJpbmRUYXJnZXQpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZE5hbWVzID0gT2JqZWN0SGVscGVyLmdldE1ldGhvZE5hbWVzKG9iamVjdCk7CiAgICAgICAgICAgIG1ldGhvZE5hbWVzLmZvckVhY2goZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgICAgIG9iamVjdFtuYW1lXSA9IG9iamVjdFtuYW1lXS5iaW5kKGJpbmRUYXJnZXQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRNZXRob2ROYW1lczogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgICAgIHZhciBtZXRob2ROYW1lcyA9IGFyZ3VtZW50c1sxXSAhPT0gKHZvaWQgMCkgPyBhcmd1bWVudHNbMV0gOiBbXTsKICAgICAgICAgICAgdmFyIHByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG9iamVjdCkuZmlsdGVyKGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iamVjdFtjXSA9PT0gJ2Z1bmN0aW9uJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG1ldGhvZE5hbWVzID0gbWV0aG9kTmFtZXMuY29uY2F0KHByb3BOYW1lcyk7CiAgICAgICAgICAgIHZhciBwcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsKICAgICAgICAgICAgaWYgKHByb3RvdHlwZS5jb25zdHJ1Y3Rvci5uYW1lICE9PSAnT2JqZWN0JyAmJiBwcm90b3R5cGUuY29uc3RydWN0b3IubmFtZSAhPT0gJ0FycmF5JykgewogICAgICAgICAgICAgIHJldHVybiBPYmplY3RIZWxwZXIuZ2V0TWV0aG9kTmFtZXMocHJvdG90eXBlLCBtZXRob2ROYW1lcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG1ldGhvZE5hbWVzOwogICAgICAgICAgfSwKICAgICAgICAgIGdldEVudW1lcmFibGVQcm9wZXJ0aWVzOiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdEhlbHBlci5nZXRQcm90b3R5cGVFbnVtZXJhYmxlUHJvcGVydGllcyhvYmplY3QsIG9iamVjdCk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0UHJvdG90eXBlRW51bWVyYWJsZVByb3BlcnRpZXM6IGZ1bmN0aW9uKHJvb3RPYmplY3QsIHByb3RvdHlwZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgICAgICAgIHZhciBwcm9wTmFtZXMgPSBPYmplY3Qua2V5cyhwcm90b3R5cGUpOwogICAgICAgICAgICB2YXIgJF9fNCA9IHRydWU7CiAgICAgICAgICAgIHZhciAkX181ID0gZmFsc2U7CiAgICAgICAgICAgIHZhciAkX182ID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAodmFyICRfXzIgPSB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICRfXzEgPSAocHJvcE5hbWVzLnZhbHVlcygpKVskdHJhY2V1clJ1bnRpbWUudG9Qcm9wZXJ0eShTeW1ib2wuaXRlcmF0b3IpXSgpOyAhKCRfXzQgPSAoJF9fMiA9ICRfXzEubmV4dCgpKS5kb25lKTsgJF9fNCA9IHRydWUpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lID0gJF9fMi52YWx1ZTsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcm9vdE9iamVjdFtuYW1lXTsKICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W25hbWVdID0gT2JqZWN0SGVscGVyLmdldEVudW1lcmFibGVQcm9wZXJ0aWVzKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W25hbWVdID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoICgkX183KSB7CiAgICAgICAgICAgICAgJF9fNSA9IHRydWU7CiAgICAgICAgICAgICAgJF9fNiA9ICRfXzc7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghJF9fNCAmJiAkX18xLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICRfXzEucmV0dXJuKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmICgkX181KSB7CiAgICAgICAgICAgICAgICAgIHRocm93ICRfXzY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkZXNjcmlwdG9yTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhwcm90b3R5cGUpOwogICAgICAgICAgICBkZXNjcmlwdG9yTmFtZXMgPSBkZXNjcmlwdG9yTmFtZXMuZmlsdGVyKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvcE5hbWVzLmluZGV4T2YobmFtZSkgPCAwOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyICRfXzExID0gdHJ1ZTsKICAgICAgICAgICAgdmFyICRfXzEyID0gZmFsc2U7CiAgICAgICAgICAgIHZhciAkX18xMyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKHZhciAkX185ID0gdm9pZCAwLAogICAgICAgICAgICAgICAgICAkX184ID0gKGRlc2NyaXB0b3JOYW1lcy52YWx1ZXMoKSlbJHRyYWNldXJSdW50aW1lLnRvUHJvcGVydHkoU3ltYm9sLml0ZXJhdG9yKV0oKTsgISgkX18xMSA9ICgkX185ID0gJF9fOC5uZXh0KCkpLmRvbmUpOyAkX18xMSA9IHRydWUpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lJF9fMTUgPSAkX185LnZhbHVlOwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG90eXBlLCBuYW1lJF9fMTUpOwogICAgICAgICAgICAgICAgICBpZiAoZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLmVudW1lcmFibGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUkX18xNiA9IHJvb3RPYmplY3RbbmFtZSRfXzE1XTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUkX18xNiAhPT0gbnVsbCAmJiB2YWx1ZSRfXzE2ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlJF9fMTYgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUkX18xNiA9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbbmFtZSRfXzE1XSA9IE9iamVjdEhlbHBlci5nZXRFbnVtZXJhYmxlUHJvcGVydGllcyh2YWx1ZSRfXzE2KTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtuYW1lJF9fMTVdID0gdmFsdWUkX18xNjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKCRfXzE0KSB7CiAgICAgICAgICAgICAgJF9fMTIgPSB0cnVlOwogICAgICAgICAgICAgICRfXzEzID0gJF9fMTQ7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghJF9fMTEgJiYgJF9fOC5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAkX184LnJldHVybigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoJF9fMTIpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgJF9fMTM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzdXBlclByb3RvdHlwZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihwcm90b3R5cGUpOwogICAgICAgICAgICB2YXIgaWdub3JhYmxlVHlwZXMgPSBbJ09iamVjdCcsICdBcnJheScsICdFdmVudEVtaXR0ZXInXTsKICAgICAgICAgICAgaWYgKGlnbm9yYWJsZVR5cGVzLmluZGV4T2Yoc3VwZXJQcm90b3R5cGUuY29uc3RydWN0b3IubmFtZSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgdmFyIHByb3RvdHlwZUVudW1lcmFibGVzID0gT2JqZWN0SGVscGVyLmdldFByb3RvdHlwZUVudW1lcmFibGVQcm9wZXJ0aWVzKHJvb3RPYmplY3QsIHN1cGVyUHJvdG90eXBlKTsKICAgICAgICAgICAgICBfLm1lcmdlKHJlc3VsdCwgcHJvdG90eXBlRW51bWVyYWJsZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0oKSk7CiAgICAgICRfX2V4cG9ydCgiT2JqZWN0SGVscGVyIiwgT2JqZWN0SGVscGVyKTsKICAgIH0KICB9Owp9KTsKClN5c3RlbS5yZWdpc3RlcigiZ2l0aHViOkJpemJvYXJkL2FydmEtdXRpbHNAbWFzdGVyL3JlcXVlc3QvUmVxdWVzdENsaWVudCIsIFtdLCBmdW5jdGlvbigkX19leHBvcnQpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fbW9kdWxlTmFtZSA9ICJnaXRodWI6Qml6Ym9hcmQvYXJ2YS11dGlsc0BtYXN0ZXIvcmVxdWVzdC9SZXF1ZXN0Q2xpZW50IjsKICBmdW5jdGlvbiBHZXRSZXF1ZXN0KHVybCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgIHJlcS5vcGVuKCdHRVQnLCB1cmwsIHRydWUpOwogICAgICByZXEub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgcmVzb2x2ZShyZXEucmVzcG9uc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWplY3QoRXJyb3IocmVxLnN0YXR1c1RleHQpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJlcS5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmVqZWN0KEVycm9yKCdOZXR3b3JrIEVycm9yJykpOwogICAgICB9OwogICAgICByZXEuc2VuZCgpOwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIFBvc3RSZXF1ZXN0KG9wdGlvbnMpIHsKICAgIGlmICghb3B0aW9ucykgewogICAgICBvcHRpb25zID0ge307CiAgICB9CiAgICBpZiAoIW9wdGlvbnMuaGVhZGVycykgewogICAgICBvcHRpb25zLmhlYWRlcnMgPSBuZXcgTWFwKCk7CiAgICB9CiAgICBpZiAoIW9wdGlvbnMuZGF0YSkgewogICAgICBvcHRpb25zLmRhdGEgPSAnJzsKICAgIH0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgcmVxLm9wZW4oJ1BPU1QnLCBvcHRpb25zLnVybCwgdHJ1ZSk7CiAgICAgIHZhciAkX18zID0gdHJ1ZTsKICAgICAgdmFyICRfXzQgPSBmYWxzZTsKICAgICAgdmFyICRfXzUgPSB1bmRlZmluZWQ7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yICh2YXIgJF9fMSA9IHZvaWQgMCwKICAgICAgICAgICAgJF9fMCA9IChvcHRpb25zLmhlYWRlcnMuZW50cmllcygpKVskdHJhY2V1clJ1bnRpbWUudG9Qcm9wZXJ0eShTeW1ib2wuaXRlcmF0b3IpXSgpOyAhKCRfXzMgPSAoJF9fMSA9ICRfXzAubmV4dCgpKS5kb25lKTsgJF9fMyA9IHRydWUpIHsKICAgICAgICAgIHZhciBlbnRyeSA9ICRfXzEudmFsdWU7CiAgICAgICAgICByZXEuc2V0UmVxdWVzdEhlYWRlcihlbnRyeVswXSwgZW50cnlbMV0pOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoJF9fNikgewogICAgICAgICRfXzQgPSB0cnVlOwogICAgICAgICRfXzUgPSAkX182OwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoISRfXzMgJiYgJF9fMC5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICAkX18wLnJldHVybigpOwogICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoJF9fNCkgewogICAgICAgICAgICB0aHJvdyAkX181OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXEub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgcmVzb2x2ZShyZXEucmVzcG9uc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWplY3QoRXJyb3IocmVxLnN0YXR1c1RleHQpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJlcS5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmVqZWN0KEVycm9yKCdOZXR3b3JrIEVycm9yJykpOwogICAgICB9OwogICAgICByZXEuc2VuZChvcHRpb25zLmRhdGEpOwogICAgfSkpOwogIH0KICAkX19leHBvcnQoIkdldFJlcXVlc3QiLCBHZXRSZXF1ZXN0KTsKICAkX19leHBvcnQoIlBvc3RSZXF1ZXN0IiwgUG9zdFJlcXVlc3QpOwogIHJldHVybiB7CiAgICBzZXR0ZXJzOiBbXSwKICAgIGV4ZWN1dGU6IGZ1bmN0aW9uKCkgewogICAgfQogIH07Cn0pOwoKU3lzdGVtLnJlZ2lzdGVyKCJnaXRodWI6Qml6Ym9hcmQvYXJ2YS11dGlsc0BtYXN0ZXIvcmVxdWVzdC9YbWxQYXJzZXIiLCBbXSwgZnVuY3Rpb24oJF9fZXhwb3J0KSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAiZ2l0aHViOkJpemJvYXJkL2FydmEtdXRpbHNAbWFzdGVyL3JlcXVlc3QvWG1sUGFyc2VyIjsKICBmdW5jdGlvbiBQYXJzZVN0cmluZ1RvWG1sKHRleHQpIHsKICAgIHRyeSB7CiAgICAgIHZhciB4bWwgPSBudWxsOwogICAgICBpZiAod2luZG93LkRPTVBhcnNlcikgewogICAgICAgIHZhciBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7CiAgICAgICAgeG1sID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh0ZXh0LCAndGV4dC94bWwnKTsKICAgICAgICB2YXIgZm91bmQgPSB4bWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3BhcnNlcmVycm9yJyk7CiAgICAgICAgaWYgKCFmb3VuZCB8fCAhZm91bmQubGVuZ3RoIHx8ICFmb3VuZFswXS5jaGlsZE5vZGVzLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIHhtbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGVvZiBBY3RpdmVYT2JqZWN0ICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB2YXIgQWN0aXZlWE9iamVjdCA9IChmdW5jdGlvbigpIHt9KTsKICAgICAgICB9CiAgICAgICAgeG1sID0gbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxET00nKTsKICAgICAgICB4bWwuYXN5bmMgPSBmYWxzZTsKICAgICAgICB4bWwubG9hZFhNTCh0ZXh0KTsKICAgICAgICByZXR1cm4geG1sOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBwYXJzaW5nIHRoZSBzdHJpbmcgdG8geG1sLicpOwogICAgfQogIH0KICAkX19leHBvcnQoIlBhcnNlU3RyaW5nVG9YbWwiLCBQYXJzZVN0cmluZ1RvWG1sKTsKICByZXR1cm4gewogICAgc2V0dGVyczogW10sCiAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsKICAgIH0KICB9Owp9KTsKClN5c3RlbS5yZWdpc3RlcigiZ2l0aHViOkJpemJvYXJkL2FydmEtdXRpbHNAbWFzdGVyL3JlcXVlc3QvVXJsUGFyc2VyIiwgW10sIGZ1bmN0aW9uKCRfX2V4cG9ydCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gImdpdGh1YjpCaXpib2FyZC9hcnZhLXV0aWxzQG1hc3Rlci9yZXF1ZXN0L1VybFBhcnNlciI7CiAgZnVuY3Rpb24gVXJsUGFyc2VyKHVybCkgewogICAgdmFyIGUgPSAvXihbYS16XVthLXowLTkrLi1dKik6KD86XC9cLygoPzooPz0oKD86W2EtejAtOS0uX34hJCYnKCkqKyw7PTpdfCVbMC05QS1GXXsyfSkqKSkoXDMpQCk/KD89KFxbWzAtOUEtRjouXXsyLH1cXXwoPzpbYS16MC05LS5ffiEkJicoKSorLDs9XXwlWzAtOUEtRl17Mn0pKikpXDUoPzo6KD89KFxkKikpXDYpPykoXC8oPz0oKD86W2EtejAtOS0uX34hJCYnKCkqKyw7PTpAXC9dfCVbMC05QS1GXXsyfSkqKSlcOCk/fChcLz8oPyFcLykoPz0oKD86W2EtejAtOS0uX34hJCYnKCkqKyw7PTpAXC9dfCVbMC05QS1GXXsyfSkqKSlcMTApPykoPzpcPyg/PSgoPzpbYS16MC05LS5ffiEkJicoKSorLDs9OkBcLz9dfCVbMC05QS1GXXsyfSkqKSlcMTEpPyg/OiMoPz0oKD86W2EtejAtOS0uX34hJCYnKCkqKyw7PTpAXC8/XXwlWzAtOUEtRl17Mn0pKikpXDEyKT8kL2k7CiAgICBpZiAodXJsLm1hdGNoKGUpKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdXJsOiBSZWdFeHBbJyQmJ10sCiAgICAgICAgcHJvdG9jb2w6IFJlZ0V4cC4kMSwKICAgICAgICBob3N0OiBSZWdFeHAuJDIsCiAgICAgICAgcGF0aDogUmVnRXhwLiQ4LAogICAgICAgIGhhc2g6IFJlZ0V4cC4kMTIKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICAkX19leHBvcnQoIlVybFBhcnNlciIsIFVybFBhcnNlcik7CiAgcmV0dXJuIHsKICAgIHNldHRlcnM6IFtdLAogICAgZXhlY3V0ZTogZnVuY3Rpb24oKSB7CiAgICB9CiAgfTsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIlNvYXBDbGllbnQiLCBbInhtbGpzIiwgIm5wbTp4bWwyanNAMC40LjkiLCAibnBtOmxvZGFzaEAzLjkuMyIsICJnaXRodWI6Qml6Ym9hcmQvYXJ2YS11dGlsc0BtYXN0ZXIvT2JqZWN0SGVscGVyIiwgImdpdGh1YjpCaXpib2FyZC9hcnZhLXV0aWxzQG1hc3Rlci9yZXF1ZXN0L1JlcXVlc3RDbGllbnQiLCAiZ2l0aHViOkJpemJvYXJkL2FydmEtdXRpbHNAbWFzdGVyL3JlcXVlc3QvWG1sUGFyc2VyIl0sIGZ1bmN0aW9uKCRfX2V4cG9ydCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19tb2R1bGVOYW1lID0gIlNvYXBDbGllbnQiOwogIHZhciBYTUwySlMsCiAgICAgIHhtbGpzLAogICAgICBfLAogICAgICBPYmplY3RIZWxwZXIsCiAgICAgIFBvc3RSZXF1ZXN0LAogICAgICBQYXJzZVN0cmluZ1RvWG1sLAogICAgICBTb2FwQ2xpZW50OwogIHJldHVybiB7CiAgICBzZXR0ZXJzOiBbZnVuY3Rpb24oJF9fbSkgewogICAgICBYTUwySlMgPSAkX19tLmRlZmF1bHQ7CiAgICB9LCBmdW5jdGlvbigkX19tKSB7CiAgICAgIHhtbGpzID0gJF9fbS5kZWZhdWx0OwogICAgfSwgZnVuY3Rpb24oJF9fbSkgewogICAgICBfID0gJF9fbS5kZWZhdWx0OwogICAgfSwgZnVuY3Rpb24oJF9fbSkgewogICAgICBPYmplY3RIZWxwZXIgPSAkX19tLk9iamVjdEhlbHBlcjsKICAgIH0sIGZ1bmN0aW9uKCRfX20pIHsKICAgICAgUG9zdFJlcXVlc3QgPSAkX19tLlBvc3RSZXF1ZXN0OwogICAgfSwgZnVuY3Rpb24oJF9fbSkgewogICAgICBQYXJzZVN0cmluZ1RvWG1sID0gJF9fbS5QYXJzZVN0cmluZ1RvWG1sOwogICAgfV0sCiAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsKICAgICAgU29hcENsaWVudCA9IChmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBTb2FwQ2xpZW50KCkgewogICAgICAgICAgT2JqZWN0SGVscGVyLmJpbmRBbGxNZXRob2RzKHRoaXMsIHRoaXMpOwogICAgICAgICAgT2JqZWN0SGVscGVyLmhpZGVNZXRob2RzQW5kUHJpdmF0ZVByb3BlcnRpZXNGcm9tT2JqZWN0KHRoaXMpOwogICAgICAgICAgT2JqZWN0SGVscGVyLmhpZGVQcm9wZXJ0eUZyb21PYmplY3QoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLCAnbGVuZ3RoJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoJHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKShTb2FwQ2xpZW50LCB7CiAgICAgICAgICBfYXBwbHlTb2FwVGVtcGxhdGU6IGZ1bmN0aW9uKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgcmV0dXJuIF8udGVtcGxhdGUoJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+JyArICc8c29hcDpFbnZlbG9wZSAnICsgJyAgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgJyArICcgIHhtbG5zOnhzZD0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiICcgKyAnICB4bWxuczpzb2FwPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9zb2FwL2VudmVsb3BlLyI+JyArICc8c29hcDpCb2R5PicgKyAnPDwlPSBtZXRob2QgJT4geG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vc2hhcmVwb2ludC9zb2FwLyI+JyArICc8JT0gcGFyYW1zICU+JyArICc8LzwlPSBtZXRob2QgJT4+JyArICc8L3NvYXA6Qm9keT4nICsgJzwvc29hcDpFbnZlbG9wZT4nKShwcm9wZXJ0aWVzKTsKICAgICAgICAgIH0sCiAgICAgICAgICBfc2VyaWFsaXplUGFyYW1zOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgaWYgKCFwYXJhbXMgfHwgcGFyYW1zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgdmFyIGRhdGEgPSB7InJvb3QiOiBwYXJhbXN9OwogICAgICAgICAgICB2YXIgY3JlYXRvciA9IG5ldyBYTUwySlMoKTsKICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBjcmVhdG9yLmpzb24yeG1sX3N0cihkYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQucmVwbGFjZSgiPHJvb3Q+IiwgIiIpLnJlcGxhY2UoIjwvcm9vdD4iLCAiIik7CiAgICAgICAgICB9LAogICAgICAgICAgX2hhbmRsZUVycm9yOiBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICByZXR1cm4gIkVycm9yISI7CiAgICAgICAgICB9LAogICAgICAgICAgX2hhbmRsZVN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgdmFyIG5vZGVzLAogICAgICAgICAgICAgICAgbm9kZSwKICAgICAgICAgICAgICAgIHJvb3Rub2RlLAogICAgICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgICAgIE5PREVfRUxFTUVOVCA9IDEsCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLAogICAgICAgICAgICAgICAgYXR0cmlidXRlLAogICAgICAgICAgICAgICAgcmVzdWx0cyA9IFtdLAogICAgICAgICAgICAgICAgcmVzdWx0LAogICAgICAgICAgICAgICAgcm9vdCA9ICcnLAogICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgIGo7CiAgICAgICAgICAgIGlmICh0eXBlb2YoZGF0YS5zZWxlY3RTaW5nbGVOb2RlKSAhPSAidW5kZWZpbmVkIikKICAgICAgICAgICAgICByb290bm9kZSA9IGRhdGEuc2VsZWN0U2luZ2xlTm9kZSgiLy9yczpkYXRhIik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICByb290bm9kZSA9IGRhdGEucXVlcnlTZWxlY3RvcigiZGF0YSIpOwogICAgICAgICAgICBpZiAocm9vdG5vZGUpIHsKICAgICAgICAgICAgICBub2RlcyA9IHJvb3Rub2RlLmNoaWxkTm9kZXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZihkYXRhLnNlbGVjdFNpbmdsZU5vZGUpICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICByb290bm9kZSA9IGRhdGEuc2VsZWN0U2luZ2xlTm9kZSgiLy9SZXN1bHQiKTsKICAgICAgICAgICAgICAgIG5vZGVzID0gcm9vdG5vZGUuc2VsZWN0Tm9kZXMoIi8vcm93Iik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvb3Rub2RlID0gZGF0YS5xdWVyeVNlbGVjdG9yKCJSZXN1bHQiKTsKICAgICAgICAgICAgICAgIG5vZGVzID0gcm9vdG5vZGUucXVlcnlTZWxlY3RvckFsbCgicm93Iik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgIG5vZGUgPSBub2Rlc1tpXTsKICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gTk9ERV9FTEVNRU5UKSB7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzID0gbm9kZS5hdHRyaWJ1dGVzOwogICAgICAgICAgICAgICAgcmVzdWx0ID0ge307CiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgYXR0cmlidXRlcy5sZW5ndGg7IGogKz0gMSkgewogICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzW2pdOwogICAgICAgICAgICAgICAgICBuYW1lID0gYXR0cmlidXRlLm5hbWUucmVwbGFjZSgnb3dzXycsICcnKTsKICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gIklEIikgewogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiaWQiOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtuYW1lXSA9IGF0dHJpYnV0ZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaXNOYU4oYXR0cmlidXRlLnZhbHVlKSkKICAgICAgICAgICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBwYXJzZUZsb2F0KGF0dHJpYnV0ZS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBhdHRyaWJ1dGUudmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKHJlc3VsdC5IaWRkZW4gfHwgJycpLnRvVXBwZXJDYXNlKCkgIT09ICJUUlVFIikgewogICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICB9LAogICAgICAgICAgY2FsbDogZnVuY3Rpb24oY29uZmlnKSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0OwogICAgICAgICAgICBjb25maWcgPSBjb25maWcgfHwge307CiAgICAgICAgICAgIHJlcXVlc3QgPSB7CiAgICAgICAgICAgICAgdXJsOiBjb25maWcudXJsLAogICAgICAgICAgICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLAogICAgICAgICAgICAgIGRhdGE6IHRoaXMuX2FwcGx5U29hcFRlbXBsYXRlKHsKICAgICAgICAgICAgICAgIG1ldGhvZDogY29uZmlnLm1ldGhvZCwKICAgICAgICAgICAgICAgIHBhcmFtczogdGhpcy5fc2VyaWFsaXplUGFyYW1zKGNvbmZpZy5wYXJhbXMpCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgUG9zdFJlcXVlc3QocmVxdWVzdCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgdmFyIHBhcnNlU3RyaW5nID0geG1sanMucGFyc2VTdHJpbmc7CiAgICAgICAgICAgICAgICBwYXJzZVN0cmluZyhyZXNwb25zZSwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSByZXN1bHRbInNvYXA6RW52ZWxvcGUiXVsic29hcDpCb2R5Il1bMF0uR2V0TGlzdEl0ZW1zUmVzcG9uc2VbMF0uR2V0TGlzdEl0ZW1zUmVzdWx0WzBdLmxpc3RpdGVtc1swXVsicnM6ZGF0YSJdWzBdOwogICAgICAgICAgICAgICAgICB2YXIgYXJyYXlPZk9iamVjdHMgPSBbXTsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHMuJC5JdGVtQ291bnQgIT09ICcwJykgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHJvdyBpbiByZXN1bHRzWyd6OnJvdyddKSB7CiAgICAgICAgICAgICAgICAgICAgICBhcnJheU9mT2JqZWN0cy5wdXNoKHJlc3VsdHNbJ3o6cm93J11bcm93XS4kKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmVzb2x2ZShhcnJheU9mT2JqZWN0cyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICAgICAgcmVqZWN0KGNvbnRleHQuX2hhbmRsZUVycm9yKGVycm9yKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sIHt9KTsKICAgICAgfSgpKTsKICAgICAgJF9fZXhwb3J0KCJTb2FwQ2xpZW50IiwgU29hcENsaWVudCk7CiAgICB9CiAgfTsKfSk7CgpTeXN0ZW0ucmVnaXN0ZXIoIk9wZXJhdGlvbnMiLCBbIlNvYXBDbGllbnQiLCAiZ2l0aHViOkJpemJvYXJkL2FydmEtdXRpbHNAbWFzdGVyL3JlcXVlc3QvVXJsUGFyc2VyIiwgIm5wbTpsb2Rhc2hAMy45LjMiXSwgZnVuY3Rpb24oJF9fZXhwb3J0KSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX21vZHVsZU5hbWUgPSAiT3BlcmF0aW9ucyI7CiAgdmFyIFNvYXBDbGllbnQsCiAgICAgIFVybFBhcnNlciwKICAgICAgXywKICAgICAgc29hcENsaWVudCwKICAgICAgY2FjaGUsCiAgICAgIHdpbmRvdywKICAgICAgZ2xvYmFsOwogIGZ1bmN0aW9uIF9QYXJzZVBhdGgocGF0aCwgZW5kUG9pbnQpIHsKICAgIHZhciB1cmwgPSBVcmxQYXJzZXIocGF0aCk7CiAgICBpZiAoIXVybCkKICAgICAgY29uc29sZS5sb2coIkludmFsaWQgZGF0YXNvdXJjZSBwYXRoIHByb3ZpZGVkISIpOwogICAgdmFyIHBhdGhQYXJ0cyA9IHVybC5wYXRoLnNwbGl0KCcvJyk7CiAgICB2YXIgbmV3UGF0aCA9IHVybC5wcm90b2NvbCArICI6Ly8iICsgdXJsLmhvc3QgKyAiLyI7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGhQYXJ0cy5sZW5ndGg7IGkrKykKICAgICAgbmV3UGF0aCArPSBwYXRoUGFydHNbaV0gKyAiLyI7CiAgICBuZXdQYXRoICs9IGVuZFBvaW50OwogICAgcmV0dXJuIG5ld1BhdGg7CiAgfQogIGZ1bmN0aW9uIF9VcGRhdGVMaXN0SXRlbXNEZWZhdWx0Q29uZmlndXJhdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgIHVybDogJycsCiAgICAgIHNlcnZpY2U6ICdMaXN0cycsCiAgICAgIG1ldGhvZDogJ1VwZGF0ZUxpc3RJdGVtcycsCiAgICAgIHBhcmFtczogJycsCiAgICAgIGhlYWRlcnM6IG5ldyBNYXAoW1snU09BUEFjdGlvbicsICdodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3NoYXJlcG9pbnQvc29hcC9VcGRhdGVMaXN0SXRlbXMnXSwgWydDb250ZW50LVR5cGUnLCAndGV4dC94bWwnXV0pCiAgICB9OwogIH0KICBmdW5jdGlvbiBfR2V0TGlzdEl0ZW1zRGVmYXVsdENvbmZpZ3VyYXRpb24oKSB7CiAgICByZXR1cm4gewogICAgICB1cmw6ICcnLAogICAgICBzZXJ2aWNlOiAnTGlzdHMnLAogICAgICBtZXRob2Q6ICdHZXRMaXN0SXRlbXMnLAogICAgICBwYXJhbXM6ICcnLAogICAgICBoZWFkZXJzOiBuZXcgTWFwKFtbJ1NPQVBBY3Rpb24nLCAnaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS9zaGFyZXBvaW50L3NvYXAvR2V0TGlzdEl0ZW1zJ10sIFsnQ29udGVudC1UeXBlJywgJ3RleHQveG1sJ11dKQogICAgfTsKICB9CiAgZnVuY3Rpb24gX0dldExpc3RTZXJ2aWNlKCkgewogICAgcmV0dXJuICdfdnRpX2Jpbi9MaXN0cy5hc214JzsKICB9CiAgZnVuY3Rpb24gX0dldFVzZXJHcm91cFNlcnZpY2UoKSB7CiAgICByZXR1cm4gJ192dGlfYmluL1VzZXJHcm91cC5hc214JzsKICB9CiAgcmV0dXJuIHsKICAgIHNldHRlcnM6IFtmdW5jdGlvbigkX19tKSB7CiAgICAgIFNvYXBDbGllbnQgPSAkX19tLlNvYXBDbGllbnQ7CiAgICB9LCBmdW5jdGlvbigkX19tKSB7CiAgICAgIFVybFBhcnNlciA9ICRfX20uVXJsUGFyc2VyOwogICAgfSwgZnVuY3Rpb24oJF9fbSkgewogICAgICBfID0gJF9fbS5kZWZhdWx0OwogICAgfV0sCiAgICBleGVjdXRlOiBmdW5jdGlvbigpIHsKICAgICAgc29hcENsaWVudCA9IG5ldyBTb2FwQ2xpZW50KCk7CiAgICAgIGNhY2hlID0gW107CiAgICAgIHdpbmRvdyA9IHRoaXM7CiAgICAgIGdsb2JhbCA9IHRoaXM7CiAgICAgIHRoaXMub25tZXNzYWdlID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICB2YXIgJF9fMCA9IHRoaXM7CiAgICAgICAgdmFyIG9wZXJhdGlvbiA9IGV2ZW50LmRhdGFbMF07CiAgICAgICAgdmFyIGFyZ3MgPSBldmVudC5kYXRhWzFdOwogICAgICAgIGlmIChvcGVyYXRpb24gPT09ICdpbml0JykgewogICAgICAgICAgdGhpcy5fcmV0cmlldmVyID0gX0dldExpc3RJdGVtc0RlZmF1bHRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICB0aGlzLl9yZXRyaWV2ZXIudXJsID0gX1BhcnNlUGF0aChhcmdzLmVuZFBvaW50LCBfR2V0TGlzdFNlcnZpY2UoKSk7CiAgICAgICAgICB0aGlzLl9yZXRyaWV2ZXIucGFyYW1zID0gewogICAgICAgICAgICAibGlzdE5hbWUiOiBhcmdzLmxpc3ROYW1lLAogICAgICAgICAgICAicXVlcnkiOiB7IlF1ZXJ5IjogeyJXaGVyZSI6IHsiR2VxIjogeyJGaWVsZFJlZiI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAiX05hbWUiOiAiTW9kaWZpZWQiLAogICAgICAgICAgICAgICAgICAgICAgIl9JbmNsdWRlVGltZVZhbHVlIjogIlRSVUUiLAogICAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogewogICAgICAgICAgICAgICAgICAgICAgICAiX1R5cGUiOiAiX0RhdGVUaW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgIl92YWx1ZSI6ICIyMDIwLTA4LTEwVDEwOjAwOjAwWiIKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9XX19fX0sCiAgICAgICAgICAgICJxdWVyeU9wdGlvbnMiOiB7IlF1ZXJ5T3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJJbmNsdWRlTWFuZGF0b3J5Q29sdW1ucyI6ICJGQUxTRSIsCiAgICAgICAgICAgICAgICAiVmlld0F0dHJpYnV0ZXMiOiB7Il9TY29wZSI6ICJSZWN1cnNpdmVBbGwifQogICAgICAgICAgICAgIH19CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAob3BlcmF0aW9uID09PSAndmFsdWUnKSB7CiAgICAgICAgICBzb2FwQ2xpZW50LmNhbGwodGhpcy5fcmV0cmlldmVyKS50aGVuKChmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICRfXzAucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIGV2ZW50OiAndmFsdWUnLAogICAgICAgICAgICAgIHJlc3VsdDogZGF0YQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdGlvbiA9PT0gJ2NoaWxkX2FkZGVkJykgewogICAgICAgICAgc2V0SW50ZXJ2YWwoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzb2FwQ2xpZW50LmNhbGwoJF9fMC5fcmV0cmlldmVyKS50aGVuKChmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgdmFyICRfXzEgPSBmdW5jdGlvbihyZWNvcmQpIHsKICAgICAgICAgICAgICAgIHZhciBpc0NhY2hlZCA9IF8uZmluZEluZGV4KGNhY2hlLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhW3JlY29yZF1bJ293c19JRCddID09IGl0ZW1bJ293c19JRCddOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoaXNDYWNoZWQgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgY2FjaGUucHVzaChkYXRhW3JlY29yZF0pOwogICAgICAgICAgICAgICAgICAkX18wLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICBldmVudDogJ2NoaWxkX2FkZGVkJywKICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IGRhdGFbcmVjb3JkXQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGZvciAodmFyIHJlY29yZCBpbiBkYXRhKSB7CiAgICAgICAgICAgICAgICAkX18xKHJlY29yZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9KSwgMzAwMCk7CiAgICAgICAgfQogICAgICB9OwogICAgICA7CiAgICAgIDsKICAgICAgOwogICAgICA7CiAgICAgIDsKICAgIH0KICB9Owp9KTsKCn0pOwovLyMgc291cmNlTWFwcGluZ1VSTD13b3JrZXIuanMubWFw";
  global.define = __define;
  return module.exports;
});

System.register("npm:eventemitter3@1.1.0", ["npm:eventemitter3@1.1.0/index"], true, function(require, exports, module) {
  var global = System.global,
      __define = global.define;
  global.define = undefined;
  module.exports = require("npm:eventemitter3@1.1.0/index");
  global.define = __define;
  return module.exports;
});

System.register("SharePoint", ["npm:eventemitter3@1.1.0", "worker.js!base64"], function($__export) {
  "use strict";
  var __moduleName = "SharePoint";
  var EventEmitter,
      worker,
      sourcecodeBlob,
      SharePoint;
  function b64toBlob(b64Data, contentType, sliceSize) {
    contentType = contentType || '';
    sliceSize = sliceSize || 512;
    var byteCharacters = atob(b64Data);
    var byteArrays = [];
    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
      var slice = byteCharacters.slice(offset, offset + sliceSize);
      var byteNumbers = new Array(slice.length);
      for (var i = 0; i < slice.length; i++) {
        byteNumbers[i] = slice.charCodeAt(i);
      }
      var byteArray = new Uint8Array(byteNumbers);
      byteArrays.push(byteArray);
    }
    var blob = new Blob(byteArrays, {type: contentType});
    return blob;
  }
  return {
    setters: [function($__m) {
      EventEmitter = $__m.default;
    }, function($__m) {
      worker = $__m.default;
    }],
    execute: function() {
      sourcecodeBlob = b64toBlob(worker);
      SharePoint = (function($__super) {
        function SharePoint() {
          var options = arguments[0] !== (void 0) ? arguments[0] : {};
          var $__0;
          $traceurRuntime.superConstructor(SharePoint).call(this);
          var url = window.URL.createObjectURL(sourcecodeBlob);
          this.worker = new Worker(url);
          this.worker.onmessage = ($__0 = this, function(msg) {
            $__0.emit(msg.data.event, msg.data.result);
          });
          this.worker.postMessage(['init', options]);
        }
        return ($traceurRuntime.createClass)(SharePoint, {on: function(event, handler) {
            if (event === 'value') {
              this.worker.postMessage(['value']);
            }
            if (event === 'child_added') {
              this.worker.postMessage(['child_added']);
            }
            if (event === 'child_changed') {
              this.worker.postMessage(['value']);
            }
            if (event === 'child_removed') {
              this.worker.postMessage(['value']);
            }
            $traceurRuntime.superGet(this, SharePoint.prototype, "on").call(this, event, handler);
          }}, {}, $__super);
      }(EventEmitter));
      $__export("SharePoint", SharePoint);
    }
  };
});

System.register("main", ["SharePoint"], function($__export) {
  "use strict";
  var __moduleName = "main";
  var SharePoint,
      spWorker;
  return {
    setters: [function($__m) {
      SharePoint = $__m.SharePoint;
    }],
    execute: function() {
      spWorker = new SharePoint({
        endPoint: 'https://bizboardapps.sharepoint.com/sites/Bizmark01',
        listName: 'Offers'
      });
      spWorker.on('child_added', function(data) {
        console.log(data);
      });
    }
  };
});

});
//# sourceMappingURL=bundle.js.map